"use strict";(self.webpackChunkezyview=self.webpackChunkezyview||[]).push([[581],{7581:function(e,r,n){n.r(r),n.d(r,{USDZLoader:function(){return u}});var t=n(136),i=n(9388),a=n(5671),o=n(3144),s=n(3272),f=n(2038),p=function(){function e(){(0,a.Z)(this,e)}return(0,o.Z)(e,[{key:"parse",value:function(e){var r={},n=e.split("\n"),t=n.length,i=0,a=null,o=r,s=[r];return function e(){var r=n[i];if(r.includes("=")){var f=r.split("="),p=f[0].trim(),u=f[1].trim();if(u.endsWith("{")){var l={};s.push(l),o[p]=l,o=l}else o[p]=u}else if(r.endsWith("{")){var c=o[a]||{};s.push(c),o[a]=c,o=c}else if(r.endsWith("}")){if(s.pop(),0===s.length)return;o=s[s.length-1]}else if(r.endsWith("(")){var d={};s.push(d),a=r.split("(")[0].trim()||a,o[a]=d,o=d}else r.endsWith(")")?(s.pop(),o=s[s.length-1]):a=r.trim();++i<t&&e()}(),r}}]),e}(),u=function(e){(0,t.Z)(n,e);var r=(0,i.Z)(n);function n(e){return(0,a.Z)(this,n),r.call(this,e)}return(0,o.Z)(n,[{key:"load",value:function(e,r,n,t){var i=this,a=new s.hH6(i.manager);a.setPath(i.path),a.setResponseType("arraybuffer"),a.setRequestHeader(i.requestHeader),a.setWithCredentials(i.withCredentials),a.load(e,(function(n){try{r(i.parse(n))}catch(a){t?t(a):console.error(a),i.manager.itemError(e)}}),n,t)}},{key:"parse",value:function(e){var r=new p;var n=f.GZ(new Uint8Array(e)),t=function(e){var n={},t=new s.hH6;for(var i in t.setResponseType("arraybuffer"),e){if(i.endsWith("png")){var a=new Blob([e[i]],{type:{type:"image/png"}});n[i]=URL.createObjectURL(a)}if(i.endsWith("usd")){var o=f.T8(e[i]);n[i]=r.parse(o)}}return n}(n),i=function(e){for(var r in e)if(r.endsWith("usda"))return e[r]}(n);if(void 0===i)return console.warn("THREE.USDZLoader: No usda file found."),new s.ZAu;var a=f.T8(i),o=r.parse(a);function u(e,r){if(void 0!==r){var n='def "'.concat(r,'"');if(n in e)return e[n]}for(var t in e){var i=e[t];if(t.startsWith("def Mesh"))return"point3f[] points"in e&&(i["point3f[] points"]=e["point3f[] points"]),"float2[] primvars:st"in e&&(i["float2[] primvars:st"]=e["float2[] primvars:st"]),"int[] primvars:st:indices"in e&&(i["int[] primvars:st:indices"]=e["int[] primvars:st:indices"]),i;if("object"===typeof i){var a=u(i);if(a)return a}}}function l(e){if(e){var r=new s.u9r;if("int[] faceVertexIndices"in e){var n=JSON.parse(e["int[] faceVertexIndices"]);r.setIndex(new s.TlE(new Uint16Array(n),1))}if("point3f[] points"in e){var t=JSON.parse(e["point3f[] points"].replace(/[()]*/g,"")),i=new s.TlE(new Float32Array(t),3);r.setAttribute("position",i)}if("normal3f[] normals"in e){var a=JSON.parse(e["normal3f[] normals"].replace(/[()]*/g,"")),o=new s.TlE(new Float32Array(a),3);r.setAttribute("normal",o)}else r.computeVertexNormals();if("float2[] primvars:st"in e&&(e["texCoord2f[] primvars:st"]=e["float2[] primvars:st"]),"texCoord2f[] primvars:st"in e){var f=JSON.parse(e["texCoord2f[] primvars:st"].replace(/[()]*/g,"")),p=new s.TlE(new Float32Array(f),2);if("int[] primvars:st:indices"in e){r=r.toNonIndexed();var u=JSON.parse(e["int[] primvars:st:indices"]);r.setAttribute("uv",function(e,r){for(var n=e.array,t=e.itemSize,i=new n.constructor(r.length*t),a=0,o=0,f=0,p=r.length;f<p;f++){a=r[f]*t;for(var u=0;u<t;u++)i[o++]=n[a++]}return new s.TlE(i,t)}(p,u))}else r.setAttribute("uv",p)}return r}}function c(e){var r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"";for(var n in e){var t=e[n];if(n.startsWith("def Material"+r))return t;if("object"===typeof t){var i=c(t,r);if(i)return i}}}function d(e,r){for(var n in e){var t=e[n];if(n.startsWith('def Shader "'.concat(r,'"')))return t;if("object"===typeof t){var i=d(t,r);if(i)return i}}}function v(e){if("asset inputs:file"in e){var r=e["asset inputs:file"].replace(/@*/g,""),n=(new s.dpR).load(t[r]),i={'"clamp"':s.uWy,'"mirror"':s.OoA,'"repeat"':s.rpg};return"token inputs:wrapS"in e&&(n.wrapS=i[e["token inputs:wrapS"]]),"token inputs:wrapT"in e&&(n.wrapT=i[e["token inputs:wrapT"]]),n}return null}function m(e){var r=l(function(e){if(e){if("prepend references"in e){var r=e["prepend references"].split("@"),n=r[1].replace(/^.\//,""),i=r[2].replace(/^<\//,"").replace(/>$/,"");return u(t[n],i)}return u(e)}}(e)),n=function(e){var r=new s.Wid;if(void 0!==e){if('def Shader "PreviewSurface"'in e){var n=e['def Shader "PreviewSurface"'];if("color3f inputs:diffuseColor.connect"in n){var t=n["color3f inputs:diffuseColor.connect"],i=d(o,/(\w+).output/.exec(t)[1]);r.map=v(i),r.map.encoding=s.knz}else if("color3f inputs:diffuseColor"in n){var a=n["color3f inputs:diffuseColor"].replace(/[()]*/g,"");r.color.fromArray(JSON.parse("["+a+"]"))}if("normal3f inputs:normal.connect"in n){var f=n["normal3f inputs:normal.connect"],p=d(o,/(\w+).output/.exec(f)[1]);r.normalMap=v(p)}"float inputs:roughness"in n&&(r.roughness=parseFloat(n["float inputs:roughness"])),"float inputs:metallic"in n&&(r.metalness=parseFloat(n["float inputs:metallic"]))}if('def Shader "diffuseColor_texture"'in e){var u=e['def Shader "diffuseColor_texture"'];r.map=v(u),r.map.encoding=s.knz}if('def Shader "normal_texture"'in e){var l=e['def Shader "normal_texture"'];r.normalMap=v(l)}}return r}(function(e){if(e){if("rel material:binding"in e){var r=e["rel material:binding"].replace(/^<\//,"").replace(/>$/,"").split("/");return c(o,' "'.concat(r[1],'"'))}return c(e)}}(e)),i=r?new s.Kj0(r,n):new s.Tme;if("matrix4d xformOp:transform"in e){var a=JSON.parse("["+e["matrix4d xformOp:transform"].replace(/[()]*/g,"")+"]");i.matrix.fromArray(a),i.matrix.decompose(i.position,i.quaternion,i.scale)}return i}var h=new s.ZAu;return function e(r,n){for(var t in r)if(t.startsWith("def Scope"))e(r[t],n);else if(t.startsWith("def Xform")){var i=m(r[t]);/def Xform "(\w+)"/.test(t)&&(i.name=/def Xform "(\w+)"/.exec(t)[1]),n.add(i),e(r[t],i)}}(o,h),h}}]),n}(s.aNw)}}]);