"use strict";(self.webpackChunkezyvuefree=self.webpackChunkezyvuefree||[]).push([[97],{4097:function(e,t,i){i.r(t),i.d(t,{PCDLoader:function(){return o}});var n=i(5671),s=i(3144),r=i(136),a=i(9388),l=i(3272),o=function(e){(0,r.Z)(i,e);var t=(0,a.Z)(i);function i(e){var s;return(0,n.Z)(this,i),(s=t.call(this,e)).littleEndian=!0,s}return(0,s.Z)(i,[{key:"load",value:function(e,t,i,n){var s=this,r=new l.hH6(s.manager);r.setPath(s.path),r.setResponseType("arraybuffer"),r.setRequestHeader(s.requestHeader),r.setWithCredentials(s.withCredentials),r.load(e,(function(i){try{t(s.parse(i))}catch(r){n?n(r):console.error(r),s.manager.itemError(e)}}),i,n)}},{key:"parse",value:function(e){var t=(new TextDecoder).decode(e),i=function(e){var t={},i=e.search(/[\r\n]DATA\s(\S*)\s/i),n=/[\r\n]DATA\s(\S*)\s/i.exec(e.slice(i-1));if(t.data=n[1],t.headerLen=n[0].length+i,t.str=e.slice(0,t.headerLen),t.str=t.str.replace(/#.*/gi,""),t.version=/VERSION (.*)/i.exec(t.str),t.fields=/FIELDS (.*)/i.exec(t.str),t.size=/SIZE (.*)/i.exec(t.str),t.type=/TYPE (.*)/i.exec(t.str),t.count=/COUNT (.*)/i.exec(t.str),t.width=/WIDTH (.*)/i.exec(t.str),t.height=/HEIGHT (.*)/i.exec(t.str),t.viewpoint=/VIEWPOINT (.*)/i.exec(t.str),t.points=/POINTS (.*)/i.exec(t.str),null!==t.version&&(t.version=parseFloat(t.version[1])),t.fields=null!==t.fields?t.fields[1].split(" "):[],null!==t.type&&(t.type=t.type[1].split(" ")),null!==t.width&&(t.width=parseInt(t.width[1])),null!==t.height&&(t.height=parseInt(t.height[1])),null!==t.viewpoint&&(t.viewpoint=t.viewpoint[1]),null!==t.points&&(t.points=parseInt(t.points[1],10)),null===t.points&&(t.points=t.width*t.height),null!==t.size&&(t.size=t.size[1].split(" ").map((function(e){return parseInt(e,10)}))),null!==t.count)t.count=t.count[1].split(" ").map((function(e){return parseInt(e,10)}));else{t.count=[];for(var s=0,r=t.fields.length;s<r;s++)t.count.push(1)}t.offset={};for(var a=0,l=0,o=t.fields.length;l<o;l++)"ascii"===t.data?t.offset[t.fields[l]]=l:(t.offset[t.fields[l]]=a,a+=t.size[l]*t.count[l]);return t.rowSize=a,t}(t),n=[],s=[],r=[],a=[],o=[];if("ascii"===i.data)for(var d=i.offset,h=t.slice(i.headerLen).split("\n"),p=0,u=h.length;p<u;p++)if(""!==h[p]){var f=h[p].split(" ");if(void 0!==d.x&&(n.push(parseFloat(f[d.x])),n.push(parseFloat(f[d.y])),n.push(parseFloat(f[d.z]))),void 0!==d.rgb){var g=i.fields.findIndex((function(e){return"rgb"===e})),v=i.type[g],c=parseFloat(f[d.rgb]),w=c;if("F"===v){var x=new Float32Array(1);x[0]=c,w=new Int32Array(x.buffer)[0]}var y=w>>16&255,b=w>>8&255,E=w>>0&255;r.push(y/255,b/255,E/255)}void 0!==d.normal_x&&(s.push(parseFloat(f[d.normal_x])),s.push(parseFloat(f[d.normal_y])),s.push(parseFloat(f[d.normal_z]))),void 0!==d.intensity&&a.push(parseFloat(f[d.intensity])),void 0!==d.label&&o.push(parseInt(f[d.label]))}if("binary_compressed"===i.data)for(var z=new Uint32Array(e.slice(i.headerLen,i.headerLen+8)),m=z[0],F=z[1],I=function(e,t){var i,n,s,r=e.length,a=new Uint8Array(t),l=0,o=0;do{if((i=e[l++])<32){if(o+ ++i>t)throw new Error("Output buffer is not large enough");if(l+i>r)throw new Error("Invalid compressed data");do{a[o++]=e[l++]}while(--i)}else{if(n=i>>5,s=o-((31&i)<<8)-1,l>=r)throw new Error("Invalid compressed data");if(7===n&&(n+=e[l++],l>=r))throw new Error("Invalid compressed data");if(s-=e[l++],o+n+2>t)throw new Error("Output buffer is not large enough");if(s<0)throw new Error("Invalid compressed data");if(s>=o)throw new Error("Invalid compressed data");do{a[o++]=a[s++]}while(2+--n)}}while(l<r);return a}(new Uint8Array(e,i.headerLen+8,m),F),_=new DataView(I.buffer),O=i.offset,A=0;A<i.points;A++){if(void 0!==O.x){var U=i.fields.indexOf("x"),T=i.fields.indexOf("y"),L=i.fields.indexOf("z");n.push(_.getFloat32(i.points*O.x+i.size[U]*A,this.littleEndian)),n.push(_.getFloat32(i.points*O.y+i.size[T]*A,this.littleEndian)),n.push(_.getFloat32(i.points*O.z+i.size[L]*A,this.littleEndian))}if(void 0!==O.rgb){var S=i.fields.indexOf("rgb");r.push(_.getUint8(i.points*O.rgb+i.size[S]*A+2)/255),r.push(_.getUint8(i.points*O.rgb+i.size[S]*A+1)/255),r.push(_.getUint8(i.points*O.rgb+i.size[S]*A+0)/255)}if(void 0!==O.normal_x){var D=i.fields.indexOf("normal_x"),C=i.fields.indexOf("normal_y"),k=i.fields.indexOf("normal_z");s.push(_.getFloat32(i.points*O.normal_x+i.size[D]*A,this.littleEndian)),s.push(_.getFloat32(i.points*O.normal_y+i.size[C]*A,this.littleEndian)),s.push(_.getFloat32(i.points*O.normal_z+i.size[k]*A,this.littleEndian))}if(void 0!==O.intensity){var H=i.fields.indexOf("intensity");a.push(_.getFloat32(i.points*O.intensity+i.size[H]*A,this.littleEndian))}if(void 0!==O.label){var N=i.fields.indexOf("label");o.push(_.getInt32(i.points*O.label+i.size[N]*A,this.littleEndian))}}if("binary"===i.data)for(var P=new DataView(e,i.headerLen),Z=i.offset,V=0,$=0;V<i.points;V++,$+=i.rowSize)void 0!==Z.x&&(n.push(P.getFloat32($+Z.x,this.littleEndian)),n.push(P.getFloat32($+Z.y,this.littleEndian)),n.push(P.getFloat32($+Z.z,this.littleEndian))),void 0!==Z.rgb&&(r.push(P.getUint8($+Z.rgb+2)/255),r.push(P.getUint8($+Z.rgb+1)/255),r.push(P.getUint8($+Z.rgb+0)/255)),void 0!==Z.normal_x&&(s.push(P.getFloat32($+Z.normal_x,this.littleEndian)),s.push(P.getFloat32($+Z.normal_y,this.littleEndian)),s.push(P.getFloat32($+Z.normal_z,this.littleEndian))),void 0!==Z.intensity&&a.push(P.getFloat32($+Z.intensity,this.littleEndian)),void 0!==Z.label&&o.push(P.getInt32($+Z.label,this.littleEndian));var R=new l.u9r;n.length>0&&R.setAttribute("position",new l.a$l(n,3)),s.length>0&&R.setAttribute("normal",new l.a$l(s,3)),r.length>0&&R.setAttribute("color",new l.a$l(r,3)),a.length>0&&R.setAttribute("intensity",new l.a$l(a,1)),o.length>0&&R.setAttribute("label",new l.j87(o,1)),R.computeBoundingSphere();var W=new l.UY4({size:.005});return r.length>0&&(W.vertexColors=!0),new l.woe(R,W)}}]),i}(l.aNw)}}]);