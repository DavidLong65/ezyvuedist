"use strict";(self.webpackChunkezyvuefree=self.webpackChunkezyvuefree||[]).push([[2821],{91850:function(e,t,n){n.d(t,{Z:function(){return u}});var i=n(72791),o=n(85221),a=n(1413),s=n(35720),r=n(38302),l=n(63144),c=n(80184);function d(e){return(0,c.jsxs)(l.Z,{position:"relative",display:"inline-flex",children:[(0,c.jsx)(s.Z,(0,a.Z)({},e)),"determinate"===e.variant&&(0,c.jsx)(l.Z,{top:0,left:0,bottom:0,right:0,position:"absolute",display:"flex",alignItems:"center",justifyContent:"center",children:(0,c.jsx)(r.Z,{variant:"caption",component:"div",color:"textSecondary",children:(0,c.jsx)("span",{style:{fontSize:e.fontSize},children:"".concat(Math.round(e.value),"%")})})})]})}var h=(0,n(38596).Z)((function(){return{backdrop:{zIndex:5,color:"white",backgroundColor:"rgb(255, 255, 255)"}}}));function u(e){var t=h();return(0,c.jsxs)(i.Fragment,{children:[(0,c.jsx)(o.Z,{className:t.backdrop,open:e.show,transitionDuration:{exit:1e3,enter:0,appear:0},children:(0,c.jsx)("div",{style:{textAlign:"center"},children:(0,c.jsx)(d,{variant:e.variant,color:"primary",value:e.value,size:85,fontSize:"24px"})})}),e.children]})}u.defaultProps={variant:"indeterminate",value:0}},58121:function(e,t,n){n.d(t,{Z:function(){return d}});var i=n(15671),o=n(43144),a=n(60136),s=n(29388),r=n(72791),l=n(62130),c=n(80184),d=function(e){(0,a.Z)(n,e);var t=(0,s.Z)(n);function n(){return(0,i.Z)(this,n),t.apply(this,arguments)}return(0,o.Z)(n,[{key:"componentDidUpdate",value:function(e){var t=this;this.props.open&&!e.open&&setTimeout((function(){t.props.onClose&&t.props.onClose(!0)}),1e4)}},{key:"render",value:function(){var e=this;return(0,c.jsx)("div",{style:{position:"fixed",left:"15px",top:"100px",display:this.props.open?"block":"none",minWidth:"250px",maxWidth:"95%",zIndex:"1500"},children:(0,c.jsx)(l.Z,{severity:this.props.severity||"error",onClose:function(){e.props.onClose&&e.props.onClose(!1)},children:this.props.message})})}}]),n}(r.Component)},14213:function(e,t,n){n.d(t,{Z:function(){return c}});n(72791);var i=n(26513),o=n(83837),a=n(20269),s=n(94026),r=n(80800),l=n(80184);function c(e){return(0,l.jsxs)(o.Z,{fullWidth:!1,maxWidth:"md",open:e.open,children:[(0,l.jsxs)(s.Z,{children:[(0,l.jsxs)("div",{style:{color:"red",display:"flex",alignItems:"center"},children:[(0,l.jsx)(r.Z,{fontSize:"large",color:"error"}),"\xa0Alert"]}),(0,l.jsx)("div",{style:{color:"red",paddingTop:"2   0px"},dangerouslySetInnerHTML:{__html:e.message}})]}),(0,l.jsxs)(a.Z,{children:[(0,l.jsx)(i.Z,{onClick:e.onOk,children:(0,l.jsx)("span",{style:{color:"red"},children:e.okText})}),(0,l.jsx)(i.Z,{style:{color:"green"},onClick:e.onCancel,children:e.cancelText})]})]})}c.defaultProps={okText:"OK",cancelText:"CANCEL"}},32333:function(e,t,n){n.d(t,{Pl:function(){return i}});var i={MEMBER_ACCESS:1,CREATE_UPDATE_ASSET:2,DELETE_ASSET:3,ADMIN_ACCESS:4,MASTER_ADMIN_ACCESS:10,COUNT:5}},22821:function(e,t,n){n.r(t),n.d(t,{default:function(){return K}});var i=n(74165),o=n(15861),a=n(15671),s=n(43144),r=n(60136),l=n(29388),c=n(51345),d=n(91850),h=n(72791),u=n(95094),p=n(58121),m=n(26513),v=n(7857),x=n(31462),f=n(47788),g=n(55121),w=n(97595),C=n(97326),y=n(83837),k=n(20269),S=n(94026),Z=n(30014),b=n(80184);function j(e){return(0,b.jsxs)("div",{className:"tool-heading",children:[e.showCloseIcon&&(0,b.jsx)(Z.Z,{style:{alignSelf:"center",fontSize:"medium",textAlign:"left"},onClick:e.onClose}),(0,b.jsx)("div",{className:"tool-heading-title",children:e.title})]})}var P=function(e){(0,r.Z)(n,e);var t=(0,l.Z)(n);function n(){return(0,a.Z)(this,n),t.apply(this,arguments)}return(0,s.Z)(n,[{key:"render",value:function(){return(0,b.jsxs)(y.Z,{fullWidth:this.props.fullWidth,fullScreen:this.props.fullScreen,maxWidth:this.props.maxWidth,open:this.props.open,onClose:this.props.handleCancel,"aria-labelledby":"responsive-dialog-title",children:[this.props.showHeader&&(0,b.jsx)(j,{title:this.props.title}),(0,b.jsx)(S.Z,{children:this.props.renderContent&&this.props.renderContent()}),(0,b.jsx)("div",{children:this.props.renderFixedContent&&this.props.renderFixedContent()}),(0,b.jsxs)(k.Z,{children:[(0,b.jsx)(m.Z,{autoFocus:!0,disabled:this.props.okButtonDisabled,onClick:this.props.handleOk,color:"primary",children:this.props.okButtonName}),this.props.showCancelButton&&(0,b.jsx)(m.Z,{onClick:this.props.handleCancel,color:"primary",autoFocus:!0,children:this.props.cancelButtonName})]})]})}}]),n}(h.Component);P.defaultProps={fullScreen:!1,fullWidth:!1,title:"",open:!1,okButtonName:"Ok",okButtonDisabled:!1,cancelButtonName:"Cancel",maxWidth:"md",showCancelButton:!0,showHeader:!0};var I=n(66532),D=n(51859),M=function(e){(0,r.Z)(n,e);var t=(0,l.Z)(n);function n(){var e;return(0,a.Z)(this,n),(e=t.call(this)).state={mouseX:null,mouseY:null},e.handleClick=e.handleClick.bind((0,C.Z)(e)),e.handleClose=e.handleClose.bind((0,C.Z)(e)),e}return(0,s.Z)(n,[{key:"handleClick",value:function(e){e.preventDefault(),this.props.enabled&&this.setState({mouseX:e.clientX-2,mouseY:e.clientY-4})}},{key:"handleClose",value:function(){this.setState({mouseX:null,mouseY:null})}},{key:"render",value:function(){var e=this;return(0,b.jsxs)("div",{onContextMenu:this.handleClick,style:{cursor:"context-menu"},children:[this.props.children,(0,b.jsx)(I.Z,{keepMounted:!0,open:null!==this.state.mouseY&&this.props.menuItems,onClose:this.handleClose,anchorReference:"anchorPosition",anchorPosition:null!==this.state.mouseY&&null!==this.state.mouseX?{top:this.state.mouseY,left:this.state.mouseX}:void 0,children:this.props.menuItems&&this.props.menuItems.map((function(t,n){return(0,b.jsx)(D.Z,{onClick:function(){t.onClick(e.props.target,n),e.handleClose()},children:t.text},n)}))})]})}}]),n}(h.Component),E=function(e){(0,r.Z)(n,e);var t=(0,l.Z)(n);function n(){var e;return(0,a.Z)(this,n),(e=t.call(this)).handleClick=e.handleClick.bind((0,C.Z)(e)),e}return(0,s.Z)(n,[{key:"handleClick",value:function(e){this.props.disableTileClickEvents||(this.props.handleSelectionChanged&&this.props.handleSelectionChanged(e),this.props.onTileClicked&&this.props.onTileClicked(e))}},{key:"render",value:function(){var e=this,t=this.props.tileWidth||"auto",n=this.props.tileHeight||"auto";return(0,b.jsxs)("div",{className:"imageGridContainer",style:{flexDirection:this.props.flexDirection},children:[this.props.tiles&&this.props.tiles.map((function(i,o){var a=i.img;return(0,b.jsx)(M,{target:i,enabled:i.hasContextMenu,menuItems:e.props.contextMenuItems,children:(0,b.jsxs)("div",{className:"imageGridItem",style:{margin:e.props.tileMargin,marginBottom:e.props.titleUnderImage?"25px":e.props.tileMargin,boxShadow:e.props.tileShadow},children:[e.props.renderTileContent&&e.props.renderTileContent(i),e.props.colorTiles?(0,b.jsx)("div",{style:{border:i.id===e.props.selectedTileId?"2px solid orange":"none",backgroundColor:i.color,width:t,height:n,borderRadius:e.props.tileBorderRadius}}):(0,b.jsx)("img",{src:a,alt:i.title,style:{border:i.id===e.props.selectedTileId?"2px solid orange":"none",backgroundColor:i.color,width:t,height:n,borderRadius:e.props.tileBorderRadius},onClick:function(){e.handleClick(i)}}),e.props.showLabels&&(0,b.jsx)("div",{className:"title",style:{width:t,fontSize:e.props.labelFontSize,bottom:e.props.titleUnderImage?"-25px":"0",color:e.props.titleColour,backgroundColor:e.props.titleUnderImage?"transparent":"rgba(0, 0, 0, 0.5)"},children:i.title})]})},o)})),this.props.showOnAddItem&&(0,b.jsx)("div",{className:"imageGridItem",style:{width:t,height:n,borderRadius:this.props.tileBorderRadius},children:(0,b.jsx)("img",{src:this.props.addItemImageSrc,alt:"add",style:{width:t,height:n,backgroundColor:"orange",borderRadius:this.props.tileBorderRadius},onClick:this.props.onAddNewClick})})]})}}]),n}(h.Component);E.defaultProps={tileMargin:"8px",titleUnderImage:!1,showOnAddItem:!1,tileBorderRadius:"0",labelFontSize:"1em",tileShadow:"auto",showLabels:!0,flexDirection:"row",titleColour:"white"};var T=n(29439),O=(0,n(38596).Z)((function(e){return{root:{"& > *":{margin:e.spacing(1)}},input:{display:"none"}}}));function N(e){var t=O(),n=(0,h.useState)(null),i=(0,T.Z)(n,2),o=i[0],a=i[1];return(0,b.jsxs)("div",{className:t.root,children:[(0,b.jsx)("input",{accept:e.accept,id:"file-input",type:"file",onChange:function(e){a(e.target.files[0])}}),(0,b.jsx)(m.Z,{variant:"contained",color:"primary",component:"span",onClick:function(t){o&&(e.handleUpload(o),document.getElementById("file-input").value="")},children:"Upload"})]})}var A=n(75566),V=n(57407),F=n(14213),U=function(e){(0,r.Z)(n,e);var t=(0,l.Z)(n);function n(e){var i;return(0,a.Z)(this,n),(i=t.call(this,e)).state={deleteDialogOpen:!1},i.onDelete=i.onDelete.bind((0,C.Z)(i)),i.deleteImage=i.deleteImage.bind((0,C.Z)(i)),i}return(0,s.Z)(n,[{key:"renderTileMenu",value:function(e){var t=this;return!this.state.deleteEnabled||this.state.noTileMenu?null:(0,b.jsx)("div",{style:{position:"absolute",top:"5px",right:"5px"},children:(0,b.jsx)(A.ZP,{title:"Delete",children:(0,b.jsx)(V.Z,{style:{color:"orange",fontSize:24},onClick:function(){return t.onDelete(e)}})})})}},{key:"deleteImage",value:function(){this.setState({deleteDialogOpen:!1}),this.props.viewModel.onDeleteImage(this.imageToDelete)}},{key:"onDelete",value:function(e){this.setState({deleteDialogOpen:!0}),this.imageToDelete=e}},{key:"render",value:function(){var e=this;return this.props.viewModel?(0,b.jsxs)(h.Fragment,{children:[(0,b.jsx)(P,{open:this.state.open,handleOk:this.props.viewModel.onOk,handleCancel:this.props.viewModel.onCancel,renderContent:function(){return(0,b.jsx)(E,{tiles:e.state.imageTiles,selectedTileId:e.state.selectedTileId,tileWidth:"200px",tileHeight:"200px",handleSelectionChanged:e.props.viewModel.onSelectChange,renderTileContent:function(t){return e.renderTileMenu(t)}})},renderFixedContent:function(){return!e.state.uploadDisabled&&!e.state.overAssetLimit&&(0,b.jsx)(N,{handleUpload:e.props.viewModel.handleImageUpload,accept:"image/*"})},okButtonDisabled:this.state.okButtonDisabled,title:"Choose an Image",okButtonName:"OK",cancelButtonName:"CANCEL"}),(0,b.jsx)(F.Z,{open:Boolean(this.state.deleteDialogOpen),message:"Are you sure you want to delete this texture? This operation cannot be undone!",okText:"DELETE",onOk:this.deleteImage,onCancel:function(){return e.setState({deleteDialogOpen:!1})}})]}):null}}]),n}(h.Component),z=n(4444),B=function(e){(0,r.Z)(n,e);var t=(0,l.Z)(n);function n(){return(0,a.Z)(this,n),t.apply(this,arguments)}return(0,s.Z)(n,[{key:"render",value:function(){return(0,b.jsx)("div",{style:{position:"fixed",display:this.props.open?"block":"none",top:"0",left:"0",right:"0",bottom:"0",backgroundColor:"white",zIndex:"2000",cursor:"pointer"},children:this.props.children})}}]),n}(h.Component),_=n(35720),L=n(62130),R=n(64880),W=function(e){(0,r.Z)(n,e);var t=(0,l.Z)(n);function n(e){var i;return(0,a.Z)(this,n),(i=t.call(this,e)).state={viewState:{modified:!1,alertMessage:"",showLoadingOverlay:!1,expandedPanel:!1,popOverOpen:!1,deleteDialogOpen:!1,panoramaId:""},modelState:{collections:[]}},i}return(0,s.Z)(n,[{key:"renderPanorama",value:function(e,t,n){var i=this;return(0,b.jsx)("div",{style:{margin:"10px"},children:(0,b.jsx)("table",{children:(0,b.jsxs)("tbody",{children:[(0,b.jsxs)("tr",{children:[(0,b.jsx)("td",{children:(0,b.jsx)("img",{style:{width:"200px",height:"auto",cursor:"pointer"},loading:"lazy",src:this.props.viewModel.getImageUrl(e,t,t.imageUrl),onClick:function(){return i.props.viewModel.onImageClick(e,t)}})}),(0,b.jsx)("td",{style:{position:"relative"},children:this.state.viewState.hasEditPermission&&(0,b.jsx)(Z.Z,{style:{position:"absolute",top:"10px",right:"10px"},onClick:function(){return i.props.viewModel.onDeletePanorama(e,t)}})})]}),(0,b.jsxs)("tr",{children:[(0,b.jsx)("td",{children:"Title"}),(0,b.jsx)("td",{children:(0,b.jsx)("input",{disabled:!this.state.viewState.hasEditPermission,style:{width:"100%"},label:"Name",name:"name",value:t.name||"",onChange:function(e){return i.props.viewModel.onPanoramaNameChange(e,t)}})})]}),(0,b.jsxs)("tr",{children:[(0,b.jsx)("td",{children:"Description"}),(0,b.jsx)("td",{children:(0,b.jsx)("textarea",{disabled:!this.state.viewState.hasEditPermission,style:{width:"100%",height:"50px",overflowY:"scroll"},value:t.description||"",name:"description",onChange:function(e){return i.props.viewModel.onPanoramaDescChange(e,t)}})})]})]})})},n)}},{key:"renderCollection",value:function(e){var t,n,i=this,o='<iframe src="'.concat("https://www.ezyvue.com","/panoramic-viewer?panoramaCollectionId=").concat(e._id,'"\n            width="100%"\n            height="100%"\n            style="border: none;"\n            frameBorder="0"\n            allow="xr-spatial-tracking" \n            allowFullScreen={true}\n            mozallowfullscreen="true"\n            webkitallowfullscreen="true"\n            />');return(0,b.jsxs)("div",{style:{width:"100%",marginTop:"30px"},children:[(0,b.jsx)("table",{children:(0,b.jsxs)("tbody",{children:[(0,b.jsxs)("tr",{children:[(0,b.jsx)("td",{children:"Collection Name"}),(0,b.jsxs)("td",{style:{position:"relative"},children:[(0,b.jsx)("input",{disabled:!this.state.viewState.hasEditPermission,style:{width:"100%"},label:"Name",name:"name",value:e.name||"",onChange:function(t){return i.props.viewModel.onCollectionNameChange(t,e)}}),this.state.viewState.hasEditPermission&&(0,b.jsx)(Z.Z,{style:{position:"absolute",top:"10px",right:"10px"},onClick:function(){return i.props.viewModel.onDeleteCollection(e)}})]})]}),(0,b.jsxs)("tr",{children:[(0,b.jsx)("td",{children:"Description"}),(0,b.jsx)("td",{children:(0,b.jsx)("textarea",{disabled:!this.state.viewState.hasEditPermission,style:{width:"100%",height:"50px",overflowY:"scroll"},value:e.description||"",name:"description",onChange:function(t){return i.props.viewModel.onCollectionDescChange(t,e)}})}),(0,b.jsx)("td",{})]}),(0,b.jsxs)("tr",{children:[(0,b.jsx)("td",{children:"ID"}),(0,b.jsx)("td",{style:{fontSize:"small",color:"#888"},children:e._id})]}),(0,b.jsxs)("tr",{children:[(0,b.jsx)("td",{children:"Embed Code"}),(0,b.jsx)("td",{children:(0,b.jsxs)(x.Z,{expanded:null===e||void 0===e||null===(t=e.uiState)||void 0===t?void 0:t.embedCodeVisible,onChange:this.props.viewModel.onOpenEmbedCode,children:[(0,b.jsx)(f.Z,{expandIcon:(0,b.jsx)(w.Z,{})}),(0,b.jsx)(g.Z,{style:{backgroundColor:"white"},children:(0,b.jsx)("div",{style:{padding:"10px"},children:o})})]})}),(0,b.jsx)("td",{})]}),(0,b.jsx)("tr",{}),(0,b.jsx)("tr",{children:(0,b.jsx)("td",{style:{position:"relative"},children:(0,b.jsx)(m.Z,{disabled:!e.panoramas.length,startIcon:(0,b.jsx)(z.Z,{size:"small"}),variant:"contained",color:"primary",size:"small",style:{width:"120px"},onClick:function(){return i.props.viewModel.onPreviewClick(e)},children:"Preview"})})})]})}),(0,b.jsxs)("div",{children:[(0,b.jsx)("div",{children:!this.state.viewState.collectionLoading&&(0,b.jsxs)(x.Z,{expanded:null===e||void 0===e||null===(n=e.uiState)||void 0===n?void 0:n.open,onChange:function(){i.props.viewModel.onOpenCollection(e)},children:[(0,b.jsx)(f.Z,{expandIcon:(0,b.jsx)(w.Z,{}),children:(0,b.jsx)("h4",{children:"Panoramas"})}),(0,b.jsx)(g.Z,{style:{backgroundColor:"white",display:"flex",flexDirection:"column"},children:e.panoramas.map((function(t,n){return i.renderPanorama(e,t,n)}))}),(0,b.jsx)("div",{children:(0,b.jsx)(m.Z,{disabled:!this.state.viewState.hasEditPermission||this.state.viewState.overAssetLimit,variant:"contained",color:"primary",size:"large",onClick:function(){return i.props.viewModel.onNewPanorama(e)},startIcon:(0,b.jsx)(v.Z,{fontSize:"large",style:{color:"black"}}),children:"New Panorama"})})]})}),(0,b.jsx)(_.Z,{style:{display:this.state.viewState.collectionLoading?"block":"none",margin:"auto"}})]})]})}},{key:"renderCollections",value:function(){var e=this;return(0,b.jsx)(h.Fragment,{children:this.state.modelState.collections.length?this.state.modelState.collections.map((function(t,n){return e.renderCollection(t)})):(0,b.jsx)("div",{style:{margin:"auto"},children:"You don't have any collections"})})}},{key:"render",value:function(){return this.props.viewModel&&this.state.modelState&&this.state.viewState?(0,b.jsxs)(h.Fragment,{children:[(0,b.jsx)("div",{className:"std-page center-page-x center",children:(0,b.jsxs)("div",{className:"centered-page-box",style:{width:"100%"},children:[this.state.viewState.uploadLimitReached&&(0,b.jsx)(L.Z,{severity:"warning",children:"You have reached your plan storage limit."}),(0,b.jsx)(d.Z,{variant:"indeterminate",show:this.state.viewState.showLoadingOverlay}),(0,b.jsx)(p.Z,{message:this.state.viewState.alertMessage,severity:this.state.viewState.alertSeverity,open:""!==this.state.viewState.alertMessage,onClose:this.props.viewModel.onAlertDialogClose}),(0,b.jsx)(F.Z,{open:this.state.viewState.deleteDialogOpen,message:"Are you sure you want to delete this asset? This operation cannot be undone!",onOk:this.props.viewModel.onDeleteObject,onCancel:this.props.viewModel.onDeleteCancel}),(0,b.jsx)("h1",{children:"Manage 360\xb0 Panoramas"}),this.renderCollections(),(0,b.jsxs)("div",{style:{display:"flex",marginTop:"20px"},children:[(0,b.jsx)(m.Z,{disabled:!this.state.viewState.hasEditPermission||this.state.viewState.overAssetLimit,variant:"contained",color:"primary",size:"large",onClick:this.props.viewModel.onNewCollection,startIcon:(0,b.jsx)(v.Z,{fontSize:"large",style:{color:"black"}}),children:"New Collection"}),(0,b.jsx)(m.Z,{disabled:!this.state.viewState.modified,variant:"contained",color:"primary",size:"large",style:{margin:"auto"},onClick:this.props.viewModel.onSaveChanges,children:"Save changes"})]}),(0,b.jsx)(U,{ref:this.props.viewModel.texturePicker.updateViewState,viewModel:this.props.viewModel.texturePicker})]})}),(0,b.jsxs)(B,{open:this.state.viewState.popOverOpen,children:[(0,b.jsx)("div",{style:{width:"100%",height:"100%"},children:this.state.viewState.panoramaCollectionId&&(0,b.jsx)("iframe",{src:"".concat("https://www.ezyvue.com","/panoramic-viewer?panoramaCollectionId=").concat(this.state.viewState.panoramaCollectionId),width:"100%",height:"100%",style:{border:"none"},frameBorder:"0",allowFullScreen:!0,mozallowfullscreen:"true",webkitallowfullscreen:"true"})}),(0,b.jsx)(Z.Z,{style:{position:"absolute",right:"20px",top:"20px"},onClick:this.props.viewModel.onClosePreview})]}),(0,b.jsx)(R.Prompt,{when:!0,message:"Are you sure you want to leave? Unsaved changes will be lost."})]}):null}}]),n}(h.Component),Y=n(1413),H=function(){function e(t){(0,a.Z)(this,e),this.model=t,this.model.okButtonDisabled=!1,this.model.uploadDisabled=!1,this.onOk=this.onOk.bind(this),this.onCancel=this.onCancel.bind(this),this.onSelectChange=this.onSelectChange.bind(this),this.handleImageUpload=this.handleImageUpload.bind(this),this.onDeleteImage=this.onDeleteImage.bind(this),this.updateViewState=this.updateViewState.bind(this)}return(0,s.Z)(e,[{key:"show",value:function(){var e=!(arguments.length>0&&void 0!==arguments[0])||arguments[0];this.model.open=e,this.updateViewState()}},{key:"onOk",value:function(){this.show(!1),this.onTextureSelectedHandler&&this.onTextureSelectedHandler(this.selectedTile),this.selectedTile=null,this.model.selectedTileId=null}},{key:"onCancel",value:function(){this.show(!1)}},{key:"onSelectChange",value:function(e){e.isLoading||(this.selectedTile===e?(this.selectedTile=null,this.model.selectedTileId=null):(this.selectedTile=e,this.model.selectedTileId=e.id),this.updateViewState())}},{key:"handleImageUpload",value:function(){var e=(0,o.Z)((0,i.Z)().mark((function e(t){return(0,i.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!this.onServerUpload){e.next=13;break}return this.model.okButtonDisabled=!0,this.model.uploadDisabled=!0,this.model.deleteEnabled=!1,this.model.imageTiles.push({id:t.name,img:"".concat("https://www.ezyvue.com/file-service/api","/files/images/loading.gif"),title:t.name,isLoading:!0}),this.updateViewState(),e.next=8,this.onServerUpload(t);case 8:this.model.okButtonDisabled=!1,this.model.uploadDisabled=!1,this.model.deleteEnabled=!0,this.updateViewState(),this.model.uploading=!1;case 13:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()},{key:"onDeleteImage",value:function(){var e=(0,o.Z)((0,i.Z)().mark((function e(t){var n;return(0,i.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!t){e.next=17;break}if(!this.onServerDelete){e.next=17;break}return this.model.okButtonDisabled=!0,this.model.uploadDisabled=!0,this.model.deleteEnabled=!1,this.selectedTile=null,this.model.selectedTileId=null,n=t.img,t.img="".concat("https://www.ezyvue.com/file-service/api","/files/images/loading.gif"),this.onImageDeletedHandler&&this.onImageDeletedHandler(n),this.updateViewState(),e.next=13,this.onServerDelete(t);case 13:this.model.okButtonDisabled=!1,this.model.uploadDisabled=!1,this.model.deleteEnabled=!0,this.updateViewState();case 17:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()},{key:"updateViewState",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null;e&&(this.view=e),this.view&&this.view.setState((0,Y.Z)({},this.model))}}]),e}(),X=n(32333),G=function(){function e(t,n){var s=this;(0,a.Z)(this,e),this.model=n,this.account=t,this.viewState={modified:!1,alertMessage:"",alertSeverity:"error",showLoadingOverlay:!1,popOverOpen:!1,panoramaCollectionId:""},this.modelState={collections:[]},this.onNewCollection=this.onNewCollection.bind(this),this.onOpenCollection=this.onOpenCollection.bind(this),this.updateViewState=this.updateViewState.bind(this),this.onNewPanorama=this.onNewPanorama.bind(this),this.onCollectionDescChange=this.onCollectionDescChange.bind(this),this.onCollectionNameChange=this.onCollectionNameChange.bind(this),this.onPanoramaDescChange=this.onCollectionDescChange.bind(this),this.onPanoramaNameChange=this.onPanoramaNameChange.bind(this),this.onSaveChanges=this.onSaveChanges.bind(this),this.onAlertDialogClose=this.onAlertDialogClose.bind(this),this.onClosePreview=this.onClosePreview.bind(this),this.onPreviewClick=this.onPreviewClick.bind(this),this.onOpenEmbedCode=this.onOpenEmbedCode.bind(this),this.onDeletePanorama=this.onDeletePanorama.bind(this),this.onDeleteCancel=this.onDeleteCancel.bind(this),this.onDeleteObject=this.onDeleteObject.bind(this),this.deletePanorama=this.deletePanorama.bind(this),this.deleteCollection=this.deleteCollection.bind(this),this.texturePickerModel={open:!1,imageTiles:[],selectedTileId:null,deleteEnabled:!0,overAssetLimit:!1,noTileMenu:!0},this.setPermissions(),this.texturePicker=new H(this.texturePickerModel),this.texturePicker.onServerUpload=function(){var e=(0,o.Z)((0,i.Z)().mark((function e(t){return(0,i.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(e.prev=0,!s.uploadContext.panorama.imageUrl){e.next=7;break}return e.next=4,s.deleteImage(s.uploadContext.collection,s.uploadContext.panorama,s.uploadContext.panorama.imageUrl);case 4:if(e.sent.ok){e.next=7;break}throw"failed to delete existing image";case 7:return e.next=9,s.uploadImage(t,s.uploadContext.collection,s.uploadContext.panorama);case 9:if(e.sent.ok){e.next=12;break}throw"failed to upload image";case 12:return s.uploadContext.panorama.imageUrl=t.name,e.next=15,u.Z.panoramaService.updatePanorama(s.uploadContext.panorama);case 15:if(e.sent.ok){e.next=19;break}throw s.deleteImage(s.uploadContext.collection,s.uploadContext.panorama,s.uploadContext.panorama.imageUrl),"failed to update panorama";case 19:s.texturePickerModel.imageTiles=[s.getImageTile(s.uploadContext.collection,s.uploadContext.panorama)],s.texturePicker.updateViewState(),s.setPermissions(),s.displayMessage("Image uploaded"),e.next=30;break;case 25:e.prev=25,e.t0=e.catch(0),s.texturePicker.show(!1),console.log(e.t0),s.displayError("Failed to upload texture. Check your connection and try again.");case 30:case"end":return e.stop()}}),e,null,[[0,25]])})));return function(t){return e.apply(this,arguments)}}()}return(0,s.Z)(e,[{key:"setPermissions",value:function(){var e=(0,o.Z)((0,i.Z)().mark((function e(){var t,n,o;return(0,i.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return t=c.ZP.getAuthCookie(),e.next=3,u.Z.accountService.getStatus(t.storeAccountId);case 3:n=e.sent,o=t.permissions.find((function(e){return e.PermissionId===X.Pl.CREATE_UPDATE_ASSET})),this.viewState.hasEditPermission=o&&o.Granted,this.viewState.overAssetLimit=!n.underAssetLimit,this.updateViewState();case 8:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}()},{key:"getImageTile",value:function(e,t){return{id:t,img:this.getImageUrl(e,t,t.imageUrl),title:t.imageUrl,filename:t.imageUrl}}},{key:"getImageUrl",value:function(e,t,n){return n?"".concat("https://www.ezyvue.com/file-service/api","/files/").concat(this.getImagePath(e,t,n)):"".concat("https://www.ezyvue.com/file-service/api","/files/images/upload.jpg")}},{key:"getImagePath",value:function(e,t,n){return"".concat(this.account.AssetFolderName,"/panoramas/").concat(e.assetFolder,"/").concat(t.assetFolder,"/").concat(n)}},{key:"deleteImage",value:function(){var e=(0,o.Z)((0,i.Z)().mark((function e(t,n,o){return(0,i.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",u.Z.fileService.deleteFile(this.account._id,this.getImagePath(t,n,o)));case 1:case"end":return e.stop()}}),e,this)})));return function(t,n,i){return e.apply(this,arguments)}}()},{key:"uploadImage",value:function(){var e=(0,o.Z)((0,i.Z)().mark((function e(t,n,o){var a;return(0,i.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return a="".concat(this.account.AssetFolderName,"/panoramas/").concat(n.assetFolder,"/").concat(o.assetFolder),e.abrupt("return",u.Z.fileService.uploadFiles(this.account._id,a,[t.name],[t]));case 2:case"end":return e.stop()}}),e,this)})));return function(t,n,i){return e.apply(this,arguments)}}()},{key:"displayError",value:function(e){this.viewState.alertMessage=e,this.viewState.alertSeverity="error",this.updateViewState()}},{key:"displayMessage",value:function(e){this.viewState.alertMessage=e,this.viewState.alertSeverity="success",this.updateViewState()}},{key:"onAlertDialogClose",value:function(){this.displayError("")}},{key:"onNewCollection",value:function(){var e=(0,o.Z)((0,i.Z)().mark((function e(){var t,n,o;return(0,i.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return t=Date.now().toString(),n="".concat(this.account.AssetFolderName,"/panoramas/").concat(t),e.next=4,u.Z.fileService.createFolder(this.account._id,n);case 4:if(e.sent.ok){e.next=8;break}return this.displayError("Error creating collection. Check your connection and try again."),e.abrupt("return");case 8:return o={accountId:this.account._id,assetFolder:t,assetFolderPath:"".concat(this.account.AssetFolderName,"/panoramas/").concat(t),name:"Untiltled",description:"",panoramas:[]},e.next=11,u.Z.panoramaService.postPanoramaCollection(o);case 11:if(e.sent.ok){e.next=15;break}return this.displayError("Error creating collection. Check your connection and try again."),e.abrupt("return");case 15:return e.next=17,u.Z.panoramaService.getCollections();case 17:this.model.collections=e.sent,this.updateViewState();case 19:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}()},{key:"onDeletePanorama",value:function(){var e=(0,o.Z)((0,i.Z)().mark((function e(t,n){return(0,i.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:this.deleteContext={deleteMethod:this.deletePanorama,collection:t,panorama:n},this.viewState.deleteDialogOpen=!0,this.updateViewState();case 3:case"end":return e.stop()}}),e,this)})));return function(t,n){return e.apply(this,arguments)}}()},{key:"onDeleteCollection",value:function(){var e=(0,o.Z)((0,i.Z)().mark((function e(t){return(0,i.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:this.deleteContext={deleteMethod:this.deleteCollection,collection:t},this.viewState.deleteDialogOpen=!0,this.updateViewState();case 3:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()},{key:"onDeleteObject",value:function(){this.deleteContext.deleteMethod(this.deleteContext.collection,this.deleteContext.panorama),this.viewState.deleteDialogOpen=!1,this.updateViewState()}},{key:"onDeleteCancel",value:function(){this.viewState.deleteDialogOpen=!1,this.updateViewState()}},{key:"deletePanorama",value:function(){var e=(0,o.Z)((0,i.Z)().mark((function e(t,n){return(0,i.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,u.Z.panoramaService.deletePanorama(n._id);case 2:if(e.sent.ok){e.next=6;break}return this.displayError("Error deleting panorama. Check your connection and try again."),e.abrupt("return");case 6:return t.panoramas=t.panoramas.filter((function(e){return e._id!==n._id})),e.next=9,u.Z.fileService.deleteFolder(this.account._id,n.assetFolderPath);case 9:if(e.sent.ok){e.next=13;break}return this.displayError("Error deleting panorama folder. Check your connection and try again."),e.abrupt("return");case 13:this.setPermissions(),this.displayMessage("Panormama deleted"),this.updateViewState();case 16:case"end":return e.stop()}}),e,this)})));return function(t,n){return e.apply(this,arguments)}}()},{key:"deleteCollection",value:function(){var e=(0,o.Z)((0,i.Z)().mark((function e(t){return(0,i.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,u.Z.panoramaService.deletePanoramaCollection(t._id);case 2:if(e.sent.ok){e.next=6;break}return this.displayError("Error deleting collection. Check your connection and try again."),e.abrupt("return");case 6:return this.model.collections=this.model.collections.filter((function(e){return e._id!==t._id})),e.next=9,u.Z.fileService.deleteFolder(this.account._id,t.assetFolderPath);case 9:if(e.sent.ok){e.next=13;break}return this.displayError("Error deleting collection folder. Check your connection and try again."),e.abrupt("return");case 13:this.setPermissions(),this.displayMessage("Collection deleted"),this.updateViewState();case 16:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()},{key:"onNewPanorama",value:function(){var e=(0,o.Z)((0,i.Z)().mark((function e(t){var n,o,a,s;return(0,i.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return n=Date.now().toString(),o="".concat(this.account.AssetFolderName,"/panoramas/").concat(t.assetFolder,"/").concat(n),e.next=4,u.Z.fileService.createFolder(this.account._id,o);case 4:if(e.sent.ok){e.next=8;break}return this.displayError("Error creating collection. Check your connection and try again."),e.abrupt("return");case 8:return a={collectionId:t._id,assetFolder:n,assetFolderPath:"".concat(this.account.AssetFolderName,"/panoramas/").concat(t.assetFolder,"/").concat(n),imageUrl:"",name:"Untiltled",description:""},e.next=11,u.Z.panoramaService.postPanorama(a);case 11:if(s=e.sent){e.next=15;break}return this.displayError("Error creating collection. Check your connection and try again."),e.abrupt("return");case 15:return e.next=17,u.Z.panoramaService.getPanoramaById(s);case 17:a=e.sent,t.panoramas.push(a),this.updateViewState();case 20:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()},{key:"onOpenEmbedCode",value:function(e){e.uiState||(e.uiState={embedCodeVisible:!1}),e.uiState.embedCodeVisible=!e.uiState.embedCodeVisible,this.updateViewState()}},{key:"onOpenCollection",value:function(){var e=(0,o.Z)((0,i.Z)().mark((function e(t){return(0,i.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(e.prev=0,t.uiState||(t.uiState={open:!1}),t.uiState.open=!t.uiState.open,t.panoramas.length){e.next=9;break}return this.viewState.collectionLoading=!0,this.updateViewState(),e.next=8,u.Z.panoramaService.getPanoramasByCollectionId(t._id);case 8:t.panoramas=e.sent;case 9:e.next=14;break;case 11:e.prev=11,e.t0=e.catch(0),this.displayError("Error loading collection. Check your connection and try again.");case 14:return e.prev=14,this.viewState.collectionLoading=!1,this.updateViewState(),e.finish(14);case 18:case"end":return e.stop()}}),e,this,[[0,11,14,18]])})));return function(t){return e.apply(this,arguments)}}()},{key:"onPreviewClick",value:function(e){this.viewState.popOverOpen=!0,this.viewState.panoramaCollectionId=e._id,this.updateViewState()}},{key:"onClosePreview",value:function(){this.viewState.popOverOpen=!1,this.updateViewState()}},{key:"onCollectionNameChange",value:function(e,t){t.name=e.target.value,this.viewState.modified=!0,this.updateViewState()}},{key:"onCollectionDescChange",value:function(e,t){t.description=e.target.value,this.viewState.modified=!0,this.updateViewState()}},{key:"onPanoramaNameChange",value:function(e,t){t.name=e.target.value,this.viewState.modified=!0,this.updateViewState()}},{key:"onPanoramaDescChange",value:function(e,t){t.description=e.target.value,this.viewState.modified=!0,this.updateViewState()}},{key:"onImageClick",value:function(e,t){this.uploadContext={collection:e,panorama:t},t.imageUrl?this.texturePickerModel.imageTiles=[this.getImageTile(this.uploadContext.collection,this.uploadContext.panorama)]:this.texturePickerModel.imageTiles=[],this.texturePicker.show(!0),this.updateViewState()}},{key:"onSaveChanges",value:function(){var e=(0,o.Z)((0,i.Z)().mark((function e(){return(0,i.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,u.Z.panoramaService.updateCollections(this.model.collections);case 2:this.displayMessage("Changes saved.");case 3:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}()},{key:"updateViewState",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null;e&&(this.view=e),this.view&&this.view.setState({viewState:(0,Y.Z)({},this.viewState),modelState:(0,Y.Z)({},this.model)})}}]),e}(),K=function(e){(0,r.Z)(n,e);var t=(0,l.Z)(n);function n(e){var i;return(0,a.Z)(this,n),(i=t.call(this,e)).state={showLoadingOverlay:!0},i}return(0,s.Z)(n,[{key:"componentDidMount",value:function(){var e=(0,o.Z)((0,i.Z)().mark((function e(){var t;return(0,i.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return this.model={},e.next=3,u.Z.panoramaService.getCollections();case 3:return this.model.collections=e.sent,e.next=6,u.Z.accountService.getById(c.ZP.getAuthCookie().storeAccountId);case 6:t=e.sent,this.viewModel=new G(t,this.model),this.forceUpdate(),this.setState({showLoadingOverlay:!1});case 10:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}()},{key:"render",value:function(){var e;return(0,b.jsxs)(h.Fragment,{children:[(0,b.jsx)(d.Z,{variant:"indeterminate",show:this.state.showLoadingOverlay,style:{height:"100%"}}),(0,b.jsx)(W,{viewModel:this.viewModel,ref:null===(e=this.viewModel)||void 0===e?void 0:e.updateViewState})]})}}]),n}(h.Component)}}]);
//# sourceMappingURL=2821.6f025466.chunk.js.map