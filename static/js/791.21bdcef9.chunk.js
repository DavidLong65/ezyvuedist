"use strict";(self.webpackChunkezyview=self.webpackChunkezyview||[]).push([[791],{791:function(e,t,r){r.r(t),r.d(t,{PLYLoader:function(){return l}});var n=r(7762),a=r(5671),s=r(3144),i=r(136),u=r(9388),o=r(3272),c=new o.Ilk,l=function(e){(0,i.Z)(r,e);var t=(0,u.Z)(r);function r(e){var n;return(0,a.Z)(this,r),(n=t.call(this,e)).propertyNameMapping={},n.customPropertyMapping={},n}return(0,s.Z)(r,[{key:"load",value:function(e,t,r,n){var a=this,s=new o.hH6(this.manager);s.setPath(this.path),s.setResponseType("arraybuffer"),s.setRequestHeader(this.requestHeader),s.setWithCredentials(this.withCredentials),s.load(e,(function(r){try{t(a.parse(r))}catch(s){n?n(s):console.error(s),a.manager.itemError(e)}}),r,n)}},{key:"setPropertyNameMapping",value:function(e){this.propertyNameMapping=e}},{key:"setCustomPropertyNameMapping",value:function(e){this.customPropertyMapping=e}},{key:"parse",value:function(e){function t(e){var t="",r=0,n=/^ply([\s\S]*)end_header(\r\n|\r|\n)/.exec(e);null!==n&&(t=n[1],r=new Blob([n[0]]).size);var a,s={comments:[],elements:[],headerLength:r,objInfo:""},i=t.split(/\r\n|\r|\n/);function u(e,t){var r={type:e[0]};return"list"===r.type?(r.name=e[3],r.countType=e[1],r.itemType=e[2]):r.name=e[1],r.name in t&&(r.name=t[r.name]),r}for(var o=0;o<i.length;o++){var c=i[o];if(""!==(c=c.trim())){var l=c.split(/\s+/),p=l.shift();switch(c=l.join(" "),p){case"format":s.format=l[0],s.version=l[1];break;case"comment":s.comments.push(c);break;case"element":void 0!==a&&s.elements.push(a),(a={}).name=l[0],a.count=parseInt(l[1]),a.properties=[];break;case"property":a.properties.push(u(l,d.propertyNameMapping));break;case"obj_info":s.objInfo=c;break;default:console.log("unhandled",p,l)}}}return void 0!==a&&s.elements.push(a),s}function r(e,t){switch(t){case"char":case"uchar":case"short":case"ushort":case"int":case"uint":case"int8":case"uint8":case"int16":case"uint16":case"int32":case"uint32":return parseInt(e);case"float":case"double":case"float32":case"float64":return parseFloat(e)}}function a(e,t){for(var n=t.split(/\s+/),a={},s=0;s<e.length;s++)if("list"===e[s].type){for(var i=[],u=r(n.shift(),e[s].countType),o=0;o<u;o++)i.push(r(n.shift(),e[s].itemType));a[e[s].name]=i}else a[e[s].name]=r(n.shift(),e[s].type);return a}function s(){for(var e={indices:[],vertices:[],normals:[],uvs:[],faceVertexUvs:[],colors:[]},t=0,r=Object.keys(d.customPropertyMapping);t<r.length;t++){e[r[t]]=[]}return e}function i(e){var t=e.map((function(e){return e.name}));function r(e){for(var r=0,n=e.length;r<n;r++){var a=e[r];if(t.includes(a))return a}return null}return{attrX:r(["x","px","posx"])||"x",attrY:r(["y","py","posy"])||"y",attrZ:r(["z","pz","posz"])||"z",attrNX:r(["nx","normalx"]),attrNY:r(["ny","normaly"]),attrNZ:r(["nz","normalz"]),attrS:r(["s","u","texture_u","tx"]),attrT:r(["t","v","texture_v","ty"]),attrR:r(["red","diffuse_red","r","diffuse_r"]),attrG:r(["green","diffuse_green","g","diffuse_g"]),attrB:r(["blue","diffuse_blue","b","diffuse_b"])}}function u(e,t){var r,n=s(),u="";null!==(r=/end_header\s([\s\S]*)$/.exec(e))&&(u=r[1]);for(var o=u.split(/\r\n|\r|\n/),c=0,f=0,h=t.elements[c],v=i(h.properties),d=0;d<o.length;d++){var m=o[d];if(""!==(m=m.trim())){f>=h.count&&(c++,f=0,v=i((h=t.elements[c]).properties));var g=a(h.properties,m);p(n,h.name,g,v),f++}}return l(n)}function l(e){var t=new o.u9r;e.indices.length>0&&t.setIndex(e.indices),t.setAttribute("position",new o.a$l(e.vertices,3)),e.normals.length>0&&t.setAttribute("normal",new o.a$l(e.normals,3)),e.uvs.length>0&&t.setAttribute("uv",new o.a$l(e.uvs,2)),e.colors.length>0&&t.setAttribute("color",new o.a$l(e.colors,3)),e.faceVertexUvs.length>0&&(t=t.toNonIndexed()).setAttribute("uv",new o.a$l(e.faceVertexUvs,2));for(var r=0,n=Object.keys(d.customPropertyMapping);r<n.length;r++){var a=n[r];e[a].length>0&&t.setAttribute(a,new o.a$l(e[a],d.customPropertyMapping[a].length))}return t.computeBoundingSphere(),t}function p(e,t,r,a){if("vertex"===t){e.vertices.push(r[a.attrX],r[a.attrY],r[a.attrZ]),null!==a.attrNX&&null!==a.attrNY&&null!==a.attrNZ&&e.normals.push(r[a.attrNX],r[a.attrNY],r[a.attrNZ]),null!==a.attrS&&null!==a.attrT&&e.uvs.push(r[a.attrS],r[a.attrT]),null!==a.attrR&&null!==a.attrG&&null!==a.attrB&&(c.setRGB(r[a.attrR]/255,r[a.attrG]/255,r[a.attrB]/255).convertSRGBToLinear(),e.colors.push(c.r,c.g,c.b));for(var s=0,i=Object.keys(d.customPropertyMapping);s<i.length;s++){var u,o=i[s],l=(0,n.Z)(d.customPropertyMapping[o]);try{for(l.s();!(u=l.n()).done;){var p=u.value;e[o].push(r[p])}}catch(v){l.e(v)}finally{l.f()}}}else if("face"===t){var f=r.vertex_indices||r.vertex_index,h=r.texcoord;3===f.length?(e.indices.push(f[0],f[1],f[2]),h&&6===h.length&&(e.faceVertexUvs.push(h[0],h[1]),e.faceVertexUvs.push(h[2],h[3]),e.faceVertexUvs.push(h[4],h[5]))):4===f.length&&(e.indices.push(f[0],f[1],f[3]),e.indices.push(f[1],f[2],f[3]))}}function f(e,t){for(var r={},n=0,a=0;a<t.length;a++){var s=t[a],i=s.valueReader;if("list"===s.type){var u=[],o=s.countReader.read(e+n);n+=s.countReader.size;for(var c=0;c<o;c++)u.push(i.read(e+n)),n+=i.size;r[s.name]=u}else r[s.name]=i.read(e+n),n+=i.size}return[r,n]}function h(e,t,r){function n(e,t,r){switch(t){case"int8":case"char":return{read:function(t){return e.getInt8(t)},size:1};case"uint8":case"uchar":return{read:function(t){return e.getUint8(t)},size:1};case"int16":case"short":return{read:function(t){return e.getInt16(t,r)},size:2};case"uint16":case"ushort":return{read:function(t){return e.getUint16(t,r)},size:2};case"int32":case"int":return{read:function(t){return e.getInt32(t,r)},size:4};case"uint32":case"uint":return{read:function(t){return e.getUint32(t,r)},size:4};case"float32":case"float":return{read:function(t){return e.getFloat32(t,r)},size:4};case"float64":case"double":return{read:function(t){return e.getFloat64(t,r)},size:8}}}for(var a=0,s=e.length;a<s;a++){var i=e[a];"list"===i.type?(i.countReader=n(t,i.countType,r),i.valueReader=n(t,i.itemType,r)):i.valueReader=n(t,i.type,r)}}var v,d=this;if(e instanceof ArrayBuffer){var m=new Uint8Array(e),g=function(e){var t=0,r=!0,n="",a=[];do{var s=String.fromCharCode(e[t++]);"\n"!==s&&"\r"!==s?n+=s:("end_header"===n&&(r=!1),""!==n&&(a.push(n),n=""))}while(r&&t<e.length);return a.join("\r")+"\r"}(m),y=t(g);if("ascii"===y.format)v=u((new TextDecoder).decode(m),y);else v=function(e,t){for(var r,n=s(),a="binary_little_endian"===t.format,u=new DataView(e,t.headerLength),o=0,c=0;c<t.elements.length;c++){var v=t.elements[c],d=v.properties,m=i(d);h(d,u,a);for(var g=0;g<v.count;g++){o+=(r=f(o,d))[1];var y=r[0];p(n,v.name,y,m)}}return l(n)}(e,y)}else v=u(e,t(e));return v}}]),r}(o.aNw)}}]);