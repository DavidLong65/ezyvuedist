/*! For license information please see 2137.5bb10174.chunk.js.LICENSE.txt */
"use strict";(self.webpackChunkezyvuefree=self.webpackChunkezyvuefree||[]).push([[2137],{37795:function(e,t,n){n.d(t,{Z:function(){return f}});var i=n(15671),r=n(43144),a=n(97326),o=n(60136),s=n(29388),l=n(72791),u=n(91523),c=n(51859),h=n(66532),d=n(80184),f=function(e){(0,o.Z)(n,e);var t=(0,s.Z)(n);function n(){var e;return(0,i.Z)(this,n),(e=t.call(this)).state={platformAnchorElem:null,industriesAnchorElem:null,projectMenuAnchorElem:null},e.onMenuClose=e.onMenuClose.bind((0,a.Z)(e)),e.onPlatformClick=e.onPlatformClick.bind((0,a.Z)(e)),e.onIndustriesClick=e.onIndustriesClick.bind((0,a.Z)(e)),e.onProjectClick=e.onProjectClick.bind((0,a.Z)(e)),e.onProjectMenuClose=e.onProjectMenuClose.bind((0,a.Z)(e)),e.onPlatformMenuClose=e.onPlatformMenuClose.bind((0,a.Z)(e)),e.onIndustriesMenuClose=e.onIndustriesMenuClose.bind((0,a.Z)(e)),e}return(0,r.Z)(n,[{key:"onPlatformClick",value:function(e){this.setState({platformAnchorElem:e.currentTarget})}},{key:"onIndustriesClick",value:function(e){this.setState({industriesAnchorElem:e.currentTarget})}},{key:"onMenuClose",value:function(){this.props.onMenuClose&&this.props.onMenuClose()}},{key:"onPlatformMenuClose",value:function(){this.setState({platformAnchorElem:null}),this.onMenuClose()}},{key:"onIndustriesMenuClose",value:function(){this.setState({industriesAnchorElem:null}),this.onMenuClose()}},{key:"onProjectClick",value:function(e){this.setState({projectMenuAnchorElem:e.currentTarget})}},{key:"onProjectMenuClose",value:function(){this.setState({projectMenuAnchorElem:null}),this.onMenuClose()}},{key:"renderProjectMenu",value:function(){return(0,d.jsxs)(h.Z,{anchorReference:"anchorEl",style:{zIndex:"2000"},anchorEl:this.state.projectMenuAnchorElem,anchorOrigin:{vertical:"bottom",horizontal:"right"},keepMounted:!0,transformOrigin:{vertical:"top",horizontal:"left"},open:Boolean(this.state.projectMenuAnchorElem),onClose:this.onProjectMenuClose,children:[(0,d.jsx)(c.Z,{onClick:this.onProjectMenuClose,children:(0,d.jsx)(u.rU,{to:"/uploadProjectAssets",children:"New Project"})}),(0,d.jsx)(c.Z,{onClick:this.onProjectMenuClose,children:(0,d.jsx)(u.rU,{to:"/projectManager",children:"Manage Projects"})})]})}},{key:"renderPlatformMenu",value:function(){return(0,d.jsxs)(h.Z,{anchorReference:"anchorEl",style:{zIndex:"2000"},anchorEl:this.state.platformAnchorElem,anchorOrigin:{vertical:"bottom",horizontal:"right"},keepMounted:!0,transformOrigin:{vertical:"top",horizontal:"left"},open:Boolean(this.state.platformAnchorElem),onClose:this.onPlatformMenuClose,children:[(0,d.jsx)(c.Z,{onClick:this.onPlatformMenuClose,children:(0,d.jsx)(u.rU,{to:"/platform/webviewer",children:"3D Viewer"})}),(0,d.jsx)(c.Z,{onClick:this.onPlatformMenuClose,children:(0,d.jsx)(u.rU,{to:"/platform/augmentedreality",children:"Augmented Reality"})}),(0,d.jsx)(c.Z,{onClick:this.onPlatformMenuClose,children:(0,d.jsx)(u.rU,{to:"/platform/configurator",children:"Product Configurator"})})]})}},{key:"renderIndustriesMenu",value:function(){return(0,d.jsxs)(h.Z,{anchorReference:"anchorEl",style:{zIndex:"2000"},anchorEl:this.state.industriesAnchorElem,anchorOrigin:{vertical:"bottom",horizontal:"right"},keepMounted:!0,transformOrigin:{vertical:"top",horizontal:"left"},open:Boolean(this.state.industriesAnchorElem),onClose:this.onIndustriesMenuClose,children:[(0,d.jsx)(c.Z,{onClick:this.onIndustriesMenuClose,children:(0,d.jsx)(u.rU,{to:"/industries/homeAppliances",children:"Home appliances"})}),(0,d.jsx)(c.Z,{onClick:this.onIndustriesMenuClose,children:(0,d.jsx)(u.rU,{to:"/industries/fashion",children:"Fashion & accessories"})}),(0,d.jsx)(c.Z,{onClick:this.onIndustriesMenuClose,children:(0,d.jsx)(u.rU,{to:"/industries/jewellery",children:"Jewellery & watches"})}),(0,d.jsx)(c.Z,{onClick:this.onIndustriesMenuClose,children:(0,d.jsx)(u.rU,{to:"/industries/furniture",children:"Furniture"})})]})}},{key:"renderUserMenu",value:function(){return(0,d.jsxs)("div",{className:"main-menu",children:[(0,d.jsx)("div",{children:(0,d.jsx)(u.rU,{to:"/home",children:"Dashboard"})}),(0,d.jsx)("div",{onClick:this.onProjectClick,children:"Project"}),this.props.showIntegrateItem&&(0,d.jsx)("div",{children:(0,d.jsx)(u.rU,{to:"/embed",children:"Integrate Viewer"})}),this.props.showProductCatalogItem&&(0,d.jsx)("div",{children:(0,d.jsx)(u.rU,{to:"/productCatalog",children:"Product Catalog"})}),(0,d.jsx)("div",{children:(0,d.jsx)(u.rU,{to:"/qrCodeGenerator",children:"QR Codes"})}),(0,d.jsx)("div",{children:(0,d.jsx)(u.rU,{to:"/help",children:"Help Center"})})]})}},{key:"renderMobileUserMenu",value:function(){return(0,d.jsxs)(h.Z,{anchorEl:this.props.anchorElem,anchorOrigin:{vertical:"top",horizontal:"right"},keepMounted:!0,transformOrigin:{vertical:"top",horizontal:"right"},open:Boolean(this.props.anchorElem),onClose:this.onMenuClose,children:[(0,d.jsx)(c.Z,{onClick:this.onMenuClose,children:(0,d.jsx)(u.rU,{to:"/home",children:"Dashboard"})}),(0,d.jsx)(c.Z,{onClick:this.onProjectClick,children:"Project"}),(0,d.jsx)(c.Z,{onClick:this.onMenuClose,children:(0,d.jsx)(u.rU,{to:"/embed",children:"Integrate Viewer"})}),this.props.showProductCatalogItem&&(0,d.jsx)(c.Z,{onClick:this.onMenuClose,children:(0,d.jsx)(u.rU,{to:"/productCatalog",children:"Product Catalog"})}),(0,d.jsx)(c.Z,{onClick:this.onMenuClose,children:(0,d.jsx)(u.rU,{to:"/qrCodeGenerator",children:"QR Codes"})}),(0,d.jsx)(c.Z,{onClick:this.onMenuClose,children:(0,d.jsx)(u.rU,{to:"/help",children:"Help Center"})})]})}},{key:"renderMobileMainMenu",value:function(){return(0,d.jsxs)(h.Z,{anchorEl:this.props.anchorElem,anchorOrigin:{vertical:"top",horizontal:"right"},keepMounted:!0,transformOrigin:{vertical:"top",horizontal:"right"},open:Boolean(this.props.anchorElem),onClose:this.onMenuClose,children:[(0,d.jsx)(c.Z,{onClick:this.onMenuClose,children:(0,d.jsx)(u.rU,{to:"/",children:"Home"})}),(0,d.jsx)(u.rU,{to:"/editor",children:"Editor"}),(0,d.jsx)(c.Z,{onClick:this.onPlatformClick,children:"Platform"}),(0,d.jsx)(c.Z,{onClick:this.onIndustriesClick,children:"Use Cases"}),(0,d.jsx)(c.Z,{onClick:this.onMenuClose,children:(0,d.jsx)(u.rU,{to:"/demos",children:"Demos"})}),(0,d.jsx)(c.Z,{onClick:this.onMenuClose,children:(0,d.jsx)(u.rU,{to:"/productModelling",children:"3d models"})}),(0,d.jsx)(c.Z,{onClick:this.onMenuClose,children:(0,d.jsx)(u.rU,{to:"/blog/blog",children:"Blog"})})]})}},{key:"renderMainMenu",value:function(){return(0,d.jsxs)("div",{className:"main-menu",children:[(0,d.jsx)("div",{children:(0,d.jsx)(u.rU,{to:"/",children:"Home"})}),(0,d.jsx)("div",{children:(0,d.jsx)(u.rU,{to:"/editor",children:"Editor"})}),(0,d.jsx)("div",{onClick:this.onPlatformClick,children:"Platform"}),(0,d.jsx)("div",{onClick:this.onIndustriesClick,children:"Use Cases"}),(0,d.jsx)("div",{children:(0,d.jsx)(u.rU,{to:"/demos",children:"Demos"})}),(0,d.jsx)("div",{children:(0,d.jsx)(u.rU,{to:"/blog/blog",children:"Blog"})})]})}},{key:"render",value:function(){if(this.props.loggedIn)return this.props.isMobile?[this.renderMobileUserMenu(),this.renderProjectMenu()]:[this.renderUserMenu(),this.renderProjectMenu()];var e=this.renderPlatformMenu(),t=this.renderIndustriesMenu();return[e,this.props.isMobile?this.renderMobileMainMenu():this.renderMainMenu(),t]}}]),n}(l.Component)},58121:function(e,t,n){n.d(t,{Z:function(){return c}});var i=n(15671),r=n(43144),a=n(60136),o=n(29388),s=n(72791),l=n(62130),u=n(80184),c=function(e){(0,a.Z)(n,e);var t=(0,o.Z)(n);function n(){return(0,i.Z)(this,n),t.apply(this,arguments)}return(0,r.Z)(n,[{key:"componentDidUpdate",value:function(e){var t=this;this.props.open&&!e.open&&setTimeout((function(){t.props.onClose&&t.props.onClose(!0)}),1e4)}},{key:"render",value:function(){var e=this;return(0,u.jsx)("div",{style:{position:"fixed",left:"15px",top:"100px",display:this.props.open?"block":"none",minWidth:"250px",maxWidth:"95%",zIndex:"1500"},children:(0,u.jsx)(l.Z,{severity:this.props.severity||"error",onClose:function(){e.props.onClose&&e.props.onClose(!1)},children:this.props.message})})}}]),n}(s.Component)},14213:function(e,t,n){n.d(t,{Z:function(){return u}});n(72791);var i=n(26513),r=n(83837),a=n(20269),o=n(94026),s=n(80800),l=n(80184);function u(e){return(0,l.jsxs)(r.Z,{fullWidth:!1,maxWidth:"md",open:e.open,children:[(0,l.jsxs)(o.Z,{children:[(0,l.jsxs)("div",{style:{color:"red",display:"flex",alignItems:"center"},children:[(0,l.jsx)(s.Z,{fontSize:"large",color:"error"}),"\xa0Alert"]}),(0,l.jsx)("div",{style:{color:"red",paddingTop:"2   0px"},dangerouslySetInnerHTML:{__html:e.message}})]}),(0,l.jsxs)(a.Z,{children:[(0,l.jsx)(i.Z,{onClick:e.onOk,children:(0,l.jsx)("span",{style:{color:"red"},children:e.okText})}),(0,l.jsx)(i.Z,{style:{color:"green"},onClick:e.onCancel,children:e.cancelText})]})]})}u.defaultProps={okText:"OK",cancelText:"CANCEL"}},10205:function(e,t,n){n.d(t,{R:function(){return s}});var i=n(43144),r=n(15671),a=n(60136),o=n(29388),s=function(e){(0,a.Z)(n,e);var t=(0,o.Z)(n);function n(e){return(0,r.Z)(this,n),t.call(this,"Invalid argument: ".concat(e))}return(0,i.Z)(n)}((0,n(98737).Z)(Error))},54836:function(e,t,n){n.d(t,{Z:function(){return a}});var i=n(43144),r=n(15671),a=(0,i.Z)((function e(){(0,r.Z)(this,e)}))},86065:function(e,t,n){n.d(t,{Z:function(){return l}});var i=n(43144),r=n(15671),a=n(60136),o=n(29388),s=n(10205),l=function(e){(0,a.Z)(n,e);var t=(0,o.Z)(n);function n(){var e;if((0,r.Z)(this,n),(e=t.call(this)).instance)throw new Error("only one instance of EventAggregator permitted");return e}return(0,i.Z)(n)}(function(){function e(){(0,r.Z)(this,e),this.observers=[],this.map=new Map}return(0,i.Z)(e,[{key:"subscribe",value:function(e,t){if(!e)throw new s.R("eventType");if(!t)throw new s.R("observer");var n=this.map.get(e);if(void 0===n&&(n=[]),n.indexOf(t)>-1)throw Error("subscribe: already subscribed");n.push(t),this.map.set(e,n)}},{key:"unsubscribe",value:function(e,t){if(!e)throw new s.R("eventType");if(!t)throw new s.R("observer");var n=this.map.get(e);if(void 0!==n){var i=n.indexOf(t);i>-1&&this.map.set(e,this.observers.splice(i,1))}}},{key:"isSubscribed",value:function(e,t){if(!e)throw new s.R("eventType");if(!t)throw new s.R("observer");var n=this.map.get(e);return void 0!==n&&n.indexOf(t)>-1}},{key:"notifyAll",value:function(e){if(!e)throw new s.R("event");var t=this.map.get(e.constructor);void 0!==t&&t.forEach((function(t){return t(e)}))}}]),e}());l.instance=new l},70804:function(e,t,n){n.d(t,{$V:function(){return Ch},$YQ:function(){return Ts},A5E:function(){return kh},BVQ:function(){return fu},CP7:function(){return Ls},D1R:function(){return Se},DvJ:function(){return Qr},EB7:function(){return jl},EJi:function(){return ac},F5T:function(){return rr},FIo:function(){return ic},FM8:function(){return An},H$k:function(){return $u},Hw6:function(){return Ln},Hyl:function(){return Gl},IEO:function(){return dl},ILR:function(){return et},Ilk:function(){return Rn},JOQ:function(){return Xr},JUT:function(){return On},KI_:function(){return zt},Kgo:function(){return mu},Kj0:function(){return Pr},LsT:function(){return De},Ltg:function(){return Fn},M8C:function(){return pn},Mig:function(){return $c},N$j:function(){return hl},NMF:function(){return kt},OdW:function(){return Al},OoA:function(){return Ce},Ox3:function(){return Kc},PMe:function(){return Hc},Pa4:function(){return Gn},QRU:function(){return rh},QmN:function(){return x},ROQ:function(){return zl},RsA:function(){return y},SPe:function(){return Cl},SUY:function(){return ah},Syv:function(){return St},TUj:function(){return _h},TUv:function(){return cl},T_1:function(){return Mh},T_f:function(){return eh},TlE:function(){return lr},Tme:function(){return Hi},Tn7:function(){return nc},TyD:function(){return be},USm:function(){return Bi},UY4:function(){return Pl},UlW:function(){return Qt},V1s:function(){return Or},VLJ:function(){return Eh},Vkp:function(){return vn},VzW:function(){return Le},WMw:function(){return D},WXh:function(){return tc},Wid:function(){return rc},Wl3:function(){return I},WwZ:function(){return Lt},Xcj:function(){return mh},XvJ:function(){return ec},YBo:function(){return sc},YKA:function(){return It},YLQ:function(){return _e},ZAu:function(){return Ss},Z_g:function(){return Ol},Zp0:function(){return th},ZzF:function(){return Wn},_12:function(){return ia},_AM:function(){return tt},_C8:function(){return pc},_Li:function(){return S},_fP:function(){return zn},a$l:function(){return dr},aH4:function(){return Ee},aLr:function(){return hi},aNw:function(){return Tc},av9:function(){return qe},b_z:function(){return vu},blk:function(){return Rl},bnF:function(){return yu},bsb:function(){return Ct},cJO:function(){return qu},cLu:function(){return Qe},cPb:function(){return zr},cek:function(){return Jc},dSO:function(){return ge},dUE:function(){return wc},dd2:function(){return Un},dpR:function(){return Zc},eaV:function(){return it},ehD:function(){return k},ejS:function(){return Dl},ekQ:function(){return st},fHI:function(){return Au},fto:function(){return at},hEm:function(){return Ve},hH6:function(){return Pc},iDF:function(){return Hu},iKG:function(){return pa},iLg:function(){return bc},iMs:function(){return yh},iUV:function(){return Ah},j87:function(){return cr},jFi:function(){return B},jyi:function(){return il},jyz:function(){return jr},kB5:function(){return zs},knz:function(){return Ft},l0P:function(){return ot},lLk:function(){return kc},lRF:function(){return ys},m7l:function(){return Mc},mSO:function(){return Ut},nls:function(){return bl},ntZ:function(){return E},o8S:function(){return Ju},oa8:function(){return Xu},p7y:function(){return du},pBf:function(){return $t},pQR:function(){return Yu},ptH:function(){return lt},qlB:function(){return ur},qyh:function(){return Ie},rBU:function(){return aa},rDY:function(){return Ur},rnI:function(){return Nt},rpg:function(){return xe},s4_:function(){return ih},tEQ:function(){return Bc},u9r:function(){return xr},uL9:function(){return ue},uWy:function(){return we},vBJ:function(){return ar},vmT:function(){return Fc},vpT:function(){return js},w$m:function(){return re},wem:function(){return Me},wk1:function(){return je},woe:function(){return Fl},wuA:function(){return Xe},x12:function(){return kl},xEZ:function(){return Nn},xeV:function(){return Gs},xo$:function(){return Ku},xoR:function(){return oc},xsS:function(){return Us},y$t:function(){return hu},yC1:function(){return Ec},yGw:function(){return xi},ybr:function(){return Fs},yo9:function(){return Ns},ywz:function(){return ke},yxD:function(){return Qc},z$h:function(){return Zt},zHn:function(){return yi},zf8:function(){return pu}});var i,r=n(98737),a=n(93433),o=n(15861),s=n(37762),l=n(29439),u=n(11752),c=n(61120),h=n(97326),d=n(60136),f=n(29388),p=n(4942),A=n(74165),v=n(15671),g=n(43144),m="149",y={LEFT:0,MIDDLE:1,RIGHT:2,ROTATE:0,DOLLY:1,PAN:2},x={ROTATE:0,PAN:1,DOLLY_PAN:2,DOLLY_ROTATE:3},w=0,C=1,b=2,_=1,E=2,M=3,I=0,S=1,k=2,B=0,T=1,D=2,R=3,P=4,L=5,Q=100,Z=101,N=102,F=103,U=104,j=200,O=201,z=202,G=203,H=204,V=205,W=206,q=207,Y=208,J=209,X=210,K=0,$=1,ee=2,te=3,ne=4,ie=5,re=6,ae=7,oe=0,se=1,le=2,ue=0,ce=1,he=2,de=3,fe=4,pe=5,Ae=301,ve=302,ge=303,me=304,ye=306,xe=1e3,we=1001,Ce=1002,be=1003,_e=1004,Ee=1005,Me=1006,Ie=1007,Se=1008,ke=1009,Be=1010,Te=1011,De=1012,Re=1013,Pe=1014,Le=1015,Qe=1016,Ze=1017,Ne=1018,Fe=1020,Ue=1021,je=1023,Oe=1024,ze=1025,Ge=1026,He=1027,Ve=1028,We=1029,qe=1030,Ye=1031,Je=1033,Xe=33776,Ke=33777,$e=33778,et=33779,tt=35840,nt=35841,it=35842,rt=35843,at=36196,ot=37492,st=37496,lt=37808,ut=37809,ct=37810,ht=37811,dt=37812,ft=37813,pt=37814,At=37815,vt=37816,gt=37817,mt=37818,yt=37819,xt=37820,wt=37821,Ct=36492,bt=36283,_t=36284,Et=36285,Mt=36286,It=2201,St=2300,kt=2301,Bt=2302,Tt=2400,Dt=2401,Rt=2402,Pt=2500,Lt=0,Qt=1,Zt=2,Nt=3e3,Ft=3001,Ut=3201,jt=0,Ot=1,zt="srgb",Gt="srgb-linear",Ht=7680,Vt=35044,Wt="300 es",qt=1035,Yt=window,Jt=Yt.XRWebGLLayer,Xt=Yt.XRWebGLBinding,Kt=Yt.__THREE_DEVTOOLS__,$t=function(){function e(){(0,v.Z)(this,e)}return(0,g.Z)(e,[{key:"addEventListener",value:function(e,t){void 0===this._listeners&&(this._listeners={});var n=this._listeners;void 0===n[e]&&(n[e]=[]),-1===n[e].indexOf(t)&&n[e].push(t)}},{key:"hasEventListener",value:function(e,t){if(void 0===this._listeners)return!1;var n=this._listeners;return void 0!==n[e]&&-1!==n[e].indexOf(t)}},{key:"removeEventListener",value:function(e,t){if(void 0!==this._listeners){var n=this._listeners[e];if(void 0!==n){var i=n.indexOf(t);-1!==i&&n.splice(i,1)}}}},{key:"dispatchEvent",value:function(e){if(void 0!==this._listeners){var t=this._listeners[e.type];if(void 0!==t){e.target=this;for(var n=t.slice(0),i=0,r=n.length;i<r;i++)n[i].call(this,e);e.target=null}}}}]),e}(),en=["00","01","02","03","04","05","06","07","08","09","0a","0b","0c","0d","0e","0f","10","11","12","13","14","15","16","17","18","19","1a","1b","1c","1d","1e","1f","20","21","22","23","24","25","26","27","28","29","2a","2b","2c","2d","2e","2f","30","31","32","33","34","35","36","37","38","39","3a","3b","3c","3d","3e","3f","40","41","42","43","44","45","46","47","48","49","4a","4b","4c","4d","4e","4f","50","51","52","53","54","55","56","57","58","59","5a","5b","5c","5d","5e","5f","60","61","62","63","64","65","66","67","68","69","6a","6b","6c","6d","6e","6f","70","71","72","73","74","75","76","77","78","79","7a","7b","7c","7d","7e","7f","80","81","82","83","84","85","86","87","88","89","8a","8b","8c","8d","8e","8f","90","91","92","93","94","95","96","97","98","99","9a","9b","9c","9d","9e","9f","a0","a1","a2","a3","a4","a5","a6","a7","a8","a9","aa","ab","ac","ad","ae","af","b0","b1","b2","b3","b4","b5","b6","b7","b8","b9","ba","bb","bc","bd","be","bf","c0","c1","c2","c3","c4","c5","c6","c7","c8","c9","ca","cb","cc","cd","ce","cf","d0","d1","d2","d3","d4","d5","d6","d7","d8","d9","da","db","dc","dd","de","df","e0","e1","e2","e3","e4","e5","e6","e7","e8","e9","ea","eb","ec","ed","ee","ef","f0","f1","f2","f3","f4","f5","f6","f7","f8","f9","fa","fb","fc","fd","fe","ff"],tn=1234567,nn=Math.PI/180,rn=180/Math.PI;function an(){var e=4294967295*Math.random()|0,t=4294967295*Math.random()|0,n=4294967295*Math.random()|0,i=4294967295*Math.random()|0;return(en[255&e]+en[e>>8&255]+en[e>>16&255]+en[e>>24&255]+"-"+en[255&t]+en[t>>8&255]+"-"+en[t>>16&15|64]+en[t>>24&255]+"-"+en[63&n|128]+en[n>>8&255]+"-"+en[n>>16&255]+en[n>>24&255]+en[255&i]+en[i>>8&255]+en[i>>16&255]+en[i>>24&255]).toLowerCase()}function on(e,t,n){return Math.max(t,Math.min(n,e))}function sn(e,t){return(e%t+t)%t}function ln(e,t,n){return(1-n)*e+n*t}function un(e){return 0===(e&e-1)&&0!==e}function cn(e){return Math.pow(2,Math.ceil(Math.log(e)/Math.LN2))}function hn(e){return Math.pow(2,Math.floor(Math.log(e)/Math.LN2))}function dn(e,t){switch(t.constructor){case Float32Array:return e;case Uint16Array:return e/65535;case Uint8Array:return e/255;case Int16Array:return Math.max(e/32767,-1);case Int8Array:return Math.max(e/127,-1);default:throw new Error("Invalid component type.")}}function fn(e,t){switch(t.constructor){case Float32Array:return e;case Uint16Array:return Math.round(65535*e);case Uint8Array:return Math.round(255*e);case Int16Array:return Math.round(32767*e);case Int8Array:return Math.round(127*e);default:throw new Error("Invalid component type.")}}var pn=Object.freeze({__proto__:null,DEG2RAD:nn,RAD2DEG:rn,ceilPowerOfTwo:cn,clamp:on,damp:function(e,t,n,i){return ln(e,t,1-Math.exp(-n*i))},degToRad:function(e){return e*nn},denormalize:dn,euclideanModulo:sn,floorPowerOfTwo:hn,generateUUID:an,inverseLerp:function(e,t,n){return e!==t?(n-e)/(t-e):0},isPowerOfTwo:un,lerp:ln,mapLinear:function(e,t,n,i,r){return i+(e-t)*(r-i)/(n-t)},normalize:fn,pingpong:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1;return t-Math.abs(sn(e,2*t)-t)},radToDeg:function(e){return e*rn},randFloat:function(e,t){return e+Math.random()*(t-e)},randFloatSpread:function(e){return e*(.5-Math.random())},randInt:function(e,t){return e+Math.floor(Math.random()*(t-e+1))},seededRandom:function(e){void 0!==e&&(tn=e);var t=tn+=1831565813;return t=Math.imul(t^t>>>15,1|t),(((t^=t+Math.imul(t^t>>>7,61|t))^t>>>14)>>>0)/4294967296},setQuaternionFromProperEuler:function(e,t,n,i,r){var a=Math.cos,o=Math.sin,s=a(n/2),l=o(n/2),u=a((t+i)/2),c=o((t+i)/2),h=a((t-i)/2),d=o((t-i)/2),f=a((i-t)/2),p=o((i-t)/2);switch(r){case"XYX":e.set(s*c,l*h,l*d,s*u);break;case"YZY":e.set(l*d,s*c,l*h,s*u);break;case"ZXZ":e.set(l*h,l*d,s*c,s*u);break;case"XZX":e.set(s*c,l*p,l*f,s*u);break;case"YXY":e.set(l*f,s*c,l*p,s*u);break;case"ZYZ":e.set(l*p,l*f,s*c,s*u);break;default:console.warn("THREE.MathUtils: .setQuaternionFromProperEuler() encountered an unknown order: "+r)}},smootherstep:function(e,t,n){return e<=t?0:e>=n?1:(e=(e-t)/(n-t))*e*e*(e*(6*e-15)+10)},smoothstep:function(e,t,n){return e<=t?0:e>=n?1:(e=(e-t)/(n-t))*e*(3-2*e)}}),An=function(e){function t(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;(0,v.Z)(this,t),t.prototype.isVector2=!0,this.x=e,this.y=n}return(0,g.Z)(t,[{key:"width",get:function(){return this.x},set:function(e){this.x=e}},{key:"height",get:function(){return this.y},set:function(e){this.y=e}},{key:"set",value:function(e,t){return this.x=e,this.y=t,this}},{key:"setScalar",value:function(e){return this.x=e,this.y=e,this}},{key:"setX",value:function(e){return this.x=e,this}},{key:"setY",value:function(e){return this.y=e,this}},{key:"setComponent",value:function(e,t){switch(e){case 0:this.x=t;break;case 1:this.y=t;break;default:throw new Error("index is out of range: "+e)}return this}},{key:"getComponent",value:function(e){switch(e){case 0:return this.x;case 1:return this.y;default:throw new Error("index is out of range: "+e)}}},{key:"clone",value:function(){return new this.constructor(this.x,this.y)}},{key:"copy",value:function(e){return this.x=e.x,this.y=e.y,this}},{key:"add",value:function(e){return this.x+=e.x,this.y+=e.y,this}},{key:"addScalar",value:function(e){return this.x+=e,this.y+=e,this}},{key:"addVectors",value:function(e,t){return this.x=e.x+t.x,this.y=e.y+t.y,this}},{key:"addScaledVector",value:function(e,t){return this.x+=e.x*t,this.y+=e.y*t,this}},{key:"sub",value:function(e){return this.x-=e.x,this.y-=e.y,this}},{key:"subScalar",value:function(e){return this.x-=e,this.y-=e,this}},{key:"subVectors",value:function(e,t){return this.x=e.x-t.x,this.y=e.y-t.y,this}},{key:"multiply",value:function(e){return this.x*=e.x,this.y*=e.y,this}},{key:"multiplyScalar",value:function(e){return this.x*=e,this.y*=e,this}},{key:"divide",value:function(e){return this.x/=e.x,this.y/=e.y,this}},{key:"divideScalar",value:function(e){return this.multiplyScalar(1/e)}},{key:"applyMatrix3",value:function(e){var t=this.x,n=this.y,i=e.elements;return this.x=i[0]*t+i[3]*n+i[6],this.y=i[1]*t+i[4]*n+i[7],this}},{key:"min",value:function(e){return this.x=Math.min(this.x,e.x),this.y=Math.min(this.y,e.y),this}},{key:"max",value:function(e){return this.x=Math.max(this.x,e.x),this.y=Math.max(this.y,e.y),this}},{key:"clamp",value:function(e,t){return this.x=Math.max(e.x,Math.min(t.x,this.x)),this.y=Math.max(e.y,Math.min(t.y,this.y)),this}},{key:"clampScalar",value:function(e,t){return this.x=Math.max(e,Math.min(t,this.x)),this.y=Math.max(e,Math.min(t,this.y)),this}},{key:"clampLength",value:function(e,t){var n=this.length();return this.divideScalar(n||1).multiplyScalar(Math.max(e,Math.min(t,n)))}},{key:"floor",value:function(){return this.x=Math.floor(this.x),this.y=Math.floor(this.y),this}},{key:"ceil",value:function(){return this.x=Math.ceil(this.x),this.y=Math.ceil(this.y),this}},{key:"round",value:function(){return this.x=Math.round(this.x),this.y=Math.round(this.y),this}},{key:"roundToZero",value:function(){return this.x=this.x<0?Math.ceil(this.x):Math.floor(this.x),this.y=this.y<0?Math.ceil(this.y):Math.floor(this.y),this}},{key:"negate",value:function(){return this.x=-this.x,this.y=-this.y,this}},{key:"dot",value:function(e){return this.x*e.x+this.y*e.y}},{key:"cross",value:function(e){return this.x*e.y-this.y*e.x}},{key:"lengthSq",value:function(){return this.x*this.x+this.y*this.y}},{key:"length",value:function(){return Math.sqrt(this.x*this.x+this.y*this.y)}},{key:"manhattanLength",value:function(){return Math.abs(this.x)+Math.abs(this.y)}},{key:"normalize",value:function(){return this.divideScalar(this.length()||1)}},{key:"angle",value:function(){var e=Math.atan2(-this.y,-this.x)+Math.PI;return e}},{key:"distanceTo",value:function(e){return Math.sqrt(this.distanceToSquared(e))}},{key:"distanceToSquared",value:function(e){var t=this.x-e.x,n=this.y-e.y;return t*t+n*n}},{key:"manhattanDistanceTo",value:function(e){return Math.abs(this.x-e.x)+Math.abs(this.y-e.y)}},{key:"setLength",value:function(e){return this.normalize().multiplyScalar(e)}},{key:"lerp",value:function(e,t){return this.x+=(e.x-this.x)*t,this.y+=(e.y-this.y)*t,this}},{key:"lerpVectors",value:function(e,t,n){return this.x=e.x+(t.x-e.x)*n,this.y=e.y+(t.y-e.y)*n,this}},{key:"equals",value:function(e){return e.x===this.x&&e.y===this.y}},{key:"fromArray",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;return this.x=e[t],this.y=e[t+1],this}},{key:"toArray",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[],t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;return e[t]=this.x,e[t+1]=this.y,e}},{key:"fromBufferAttribute",value:function(e,t){return this.x=e.getX(t),this.y=e.getY(t),this}},{key:"rotateAround",value:function(e,t){var n=Math.cos(t),i=Math.sin(t),r=this.x-e.x,a=this.y-e.y;return this.x=r*n-a*i+e.x,this.y=r*i+a*n+e.y,this}},{key:"random",value:function(){return this.x=Math.random(),this.y=Math.random(),this}},{key:e,value:(0,A.Z)().mark((function e(){return(0,A.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.x;case 2:return e.next=4,this.y;case 4:case"end":return e.stop()}}),e,this)}))}]),t}(Symbol.iterator),vn=function(){function e(){(0,v.Z)(this,e),e.prototype.isMatrix3=!0,this.elements=[1,0,0,0,1,0,0,0,1]}return(0,g.Z)(e,[{key:"set",value:function(e,t,n,i,r,a,o,s,l){var u=this.elements;return u[0]=e,u[1]=i,u[2]=o,u[3]=t,u[4]=r,u[5]=s,u[6]=n,u[7]=a,u[8]=l,this}},{key:"identity",value:function(){return this.set(1,0,0,0,1,0,0,0,1),this}},{key:"copy",value:function(e){var t=this.elements,n=e.elements;return t[0]=n[0],t[1]=n[1],t[2]=n[2],t[3]=n[3],t[4]=n[4],t[5]=n[5],t[6]=n[6],t[7]=n[7],t[8]=n[8],this}},{key:"extractBasis",value:function(e,t,n){return e.setFromMatrix3Column(this,0),t.setFromMatrix3Column(this,1),n.setFromMatrix3Column(this,2),this}},{key:"setFromMatrix4",value:function(e){var t=e.elements;return this.set(t[0],t[4],t[8],t[1],t[5],t[9],t[2],t[6],t[10]),this}},{key:"multiply",value:function(e){return this.multiplyMatrices(this,e)}},{key:"premultiply",value:function(e){return this.multiplyMatrices(e,this)}},{key:"multiplyMatrices",value:function(e,t){var n=e.elements,i=t.elements,r=this.elements,a=n[0],o=n[3],s=n[6],l=n[1],u=n[4],c=n[7],h=n[2],d=n[5],f=n[8],p=i[0],A=i[3],v=i[6],g=i[1],m=i[4],y=i[7],x=i[2],w=i[5],C=i[8];return r[0]=a*p+o*g+s*x,r[3]=a*A+o*m+s*w,r[6]=a*v+o*y+s*C,r[1]=l*p+u*g+c*x,r[4]=l*A+u*m+c*w,r[7]=l*v+u*y+c*C,r[2]=h*p+d*g+f*x,r[5]=h*A+d*m+f*w,r[8]=h*v+d*y+f*C,this}},{key:"multiplyScalar",value:function(e){var t=this.elements;return t[0]*=e,t[3]*=e,t[6]*=e,t[1]*=e,t[4]*=e,t[7]*=e,t[2]*=e,t[5]*=e,t[8]*=e,this}},{key:"determinant",value:function(){var e=this.elements,t=e[0],n=e[1],i=e[2],r=e[3],a=e[4],o=e[5],s=e[6],l=e[7],u=e[8];return t*a*u-t*o*l-n*r*u+n*o*s+i*r*l-i*a*s}},{key:"invert",value:function(){var e=this.elements,t=e[0],n=e[1],i=e[2],r=e[3],a=e[4],o=e[5],s=e[6],l=e[7],u=e[8],c=u*a-o*l,h=o*s-u*r,d=l*r-a*s,f=t*c+n*h+i*d;if(0===f)return this.set(0,0,0,0,0,0,0,0,0);var p=1/f;return e[0]=c*p,e[1]=(i*l-u*n)*p,e[2]=(o*n-i*a)*p,e[3]=h*p,e[4]=(u*t-i*s)*p,e[5]=(i*r-o*t)*p,e[6]=d*p,e[7]=(n*s-l*t)*p,e[8]=(a*t-n*r)*p,this}},{key:"transpose",value:function(){var e,t=this.elements;return e=t[1],t[1]=t[3],t[3]=e,e=t[2],t[2]=t[6],t[6]=e,e=t[5],t[5]=t[7],t[7]=e,this}},{key:"getNormalMatrix",value:function(e){return this.setFromMatrix4(e).invert().transpose()}},{key:"transposeIntoArray",value:function(e){var t=this.elements;return e[0]=t[0],e[1]=t[3],e[2]=t[6],e[3]=t[1],e[4]=t[4],e[5]=t[7],e[6]=t[2],e[7]=t[5],e[8]=t[8],this}},{key:"setUvTransform",value:function(e,t,n,i,r,a,o){var s=Math.cos(r),l=Math.sin(r);return this.set(n*s,n*l,-n*(s*a+l*o)+a+e,-i*l,i*s,-i*(-l*a+s*o)+o+t,0,0,1),this}},{key:"scale",value:function(e,t){return this.premultiply(gn.makeScale(e,t)),this}},{key:"rotate",value:function(e){return this.premultiply(gn.makeRotation(-e)),this}},{key:"translate",value:function(e,t){return this.premultiply(gn.makeTranslation(e,t)),this}},{key:"makeTranslation",value:function(e,t){return this.set(1,0,e,0,1,t,0,0,1),this}},{key:"makeRotation",value:function(e){var t=Math.cos(e),n=Math.sin(e);return this.set(t,-n,0,n,t,0,0,0,1),this}},{key:"makeScale",value:function(e,t){return this.set(e,0,0,0,t,0,0,0,1),this}},{key:"equals",value:function(e){for(var t=this.elements,n=e.elements,i=0;i<9;i++)if(t[i]!==n[i])return!1;return!0}},{key:"fromArray",value:function(e){for(var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,n=0;n<9;n++)this.elements[n]=e[n+t];return this}},{key:"toArray",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[],t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,n=this.elements;return e[t]=n[0],e[t+1]=n[1],e[t+2]=n[2],e[t+3]=n[3],e[t+4]=n[4],e[t+5]=n[5],e[t+6]=n[6],e[t+7]=n[7],e[t+8]=n[8],e}},{key:"clone",value:function(){return(new this.constructor).fromArray(this.elements)}}]),e}(),gn=new vn;function mn(e){for(var t=e.length-1;t>=0;--t)if(e[t]>=65535)return!0;return!1}var yn={Int8Array:Int8Array,Uint8Array:Uint8Array,Uint8ClampedArray:Uint8ClampedArray,Int16Array:Int16Array,Uint16Array:Uint16Array,Int32Array:Int32Array,Uint32Array:Uint32Array,Float32Array:Float32Array,Float64Array:Float64Array};function xn(e,t){return new yn[e](t)}function wn(e){return document.createElementNS("http://www.w3.org/1999/xhtml",e)}function Cn(e){return e<.04045?.0773993808*e:Math.pow(.9478672986*e+.0521327014,2.4)}function bn(e){return e<.0031308?12.92*e:1.055*Math.pow(e,.41666)-.055}var _n=(i={},(0,p.Z)(i,zt,(0,p.Z)({},Gt,Cn)),(0,p.Z)(i,Gt,(0,p.Z)({},zt,bn)),i),En={legacyMode:!0,get workingColorSpace(){return Gt},set workingColorSpace(e){console.warn("THREE.ColorManagement: .workingColorSpace is readonly.")},convert:function(e,t,n){if(this.legacyMode||t===n||!t||!n)return e;if(_n[t]&&void 0!==_n[t][n]){var i=_n[t][n];return e.r=i(e.r),e.g=i(e.g),e.b=i(e.b),e}throw new Error("Unsupported color space conversion.")},fromWorkingColorSpace:function(e,t){return this.convert(e,this.workingColorSpace,t)},toWorkingColorSpace:function(e,t){return this.convert(e,t,this.workingColorSpace)}},Mn={aliceblue:15792383,antiquewhite:16444375,aqua:65535,aquamarine:8388564,azure:15794175,beige:16119260,bisque:16770244,black:0,blanchedalmond:16772045,blue:255,blueviolet:9055202,brown:10824234,burlywood:14596231,cadetblue:6266528,chartreuse:8388352,chocolate:13789470,coral:16744272,cornflowerblue:6591981,cornsilk:16775388,crimson:14423100,cyan:65535,darkblue:139,darkcyan:35723,darkgoldenrod:12092939,darkgray:11119017,darkgreen:25600,darkgrey:11119017,darkkhaki:12433259,darkmagenta:9109643,darkolivegreen:5597999,darkorange:16747520,darkorchid:10040012,darkred:9109504,darksalmon:15308410,darkseagreen:9419919,darkslateblue:4734347,darkslategray:3100495,darkslategrey:3100495,darkturquoise:52945,darkviolet:9699539,deeppink:16716947,deepskyblue:49151,dimgray:6908265,dimgrey:6908265,dodgerblue:2003199,firebrick:11674146,floralwhite:16775920,forestgreen:2263842,fuchsia:16711935,gainsboro:14474460,ghostwhite:16316671,gold:16766720,goldenrod:14329120,gray:8421504,green:32768,greenyellow:11403055,grey:8421504,honeydew:15794160,hotpink:16738740,indianred:13458524,indigo:4915330,ivory:16777200,khaki:15787660,lavender:15132410,lavenderblush:16773365,lawngreen:8190976,lemonchiffon:16775885,lightblue:11393254,lightcoral:15761536,lightcyan:14745599,lightgoldenrodyellow:16448210,lightgray:13882323,lightgreen:9498256,lightgrey:13882323,lightpink:16758465,lightsalmon:16752762,lightseagreen:2142890,lightskyblue:8900346,lightslategray:7833753,lightslategrey:7833753,lightsteelblue:11584734,lightyellow:16777184,lime:65280,limegreen:3329330,linen:16445670,magenta:16711935,maroon:8388608,mediumaquamarine:6737322,mediumblue:205,mediumorchid:12211667,mediumpurple:9662683,mediumseagreen:3978097,mediumslateblue:8087790,mediumspringgreen:64154,mediumturquoise:4772300,mediumvioletred:13047173,midnightblue:1644912,mintcream:16121850,mistyrose:16770273,moccasin:16770229,navajowhite:16768685,navy:128,oldlace:16643558,olive:8421376,olivedrab:7048739,orange:16753920,orangered:16729344,orchid:14315734,palegoldenrod:15657130,palegreen:10025880,paleturquoise:11529966,palevioletred:14381203,papayawhip:16773077,peachpuff:16767673,peru:13468991,pink:16761035,plum:14524637,powderblue:11591910,purple:8388736,rebeccapurple:6697881,red:16711680,rosybrown:12357519,royalblue:4286945,saddlebrown:9127187,salmon:16416882,sandybrown:16032864,seagreen:3050327,seashell:16774638,sienna:10506797,silver:12632256,skyblue:8900331,slateblue:6970061,slategray:7372944,slategrey:7372944,snow:16775930,springgreen:65407,steelblue:4620980,tan:13808780,teal:32896,thistle:14204888,tomato:16737095,turquoise:4251856,violet:15631086,wheat:16113331,white:16777215,whitesmoke:16119285,yellow:16776960,yellowgreen:10145074},In={r:0,g:0,b:0},Sn={h:0,s:0,l:0},kn={h:0,s:0,l:0};function Bn(e,t,n){return n<0&&(n+=1),n>1&&(n-=1),n<1/6?e+6*(t-e)*n:n<.5?t:n<2/3?e+6*(t-e)*(2/3-n):e}function Tn(e,t){return t.r=e.r,t.g=e.g,t.b=e.b,t}var Dn,Rn=function(e){function t(e,n,i){return(0,v.Z)(this,t),this.isColor=!0,this.r=1,this.g=1,this.b=1,void 0===n&&void 0===i?this.set(e):this.setRGB(e,n,i)}return(0,g.Z)(t,[{key:"set",value:function(e){return e&&e.isColor?this.copy(e):"number"===typeof e?this.setHex(e):"string"===typeof e&&this.setStyle(e),this}},{key:"setScalar",value:function(e){return this.r=e,this.g=e,this.b=e,this}},{key:"setHex",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:zt;return e=Math.floor(e),this.r=(e>>16&255)/255,this.g=(e>>8&255)/255,this.b=(255&e)/255,En.toWorkingColorSpace(this,t),this}},{key:"setRGB",value:function(e,t,n){var i=arguments.length>3&&void 0!==arguments[3]?arguments[3]:En.workingColorSpace;return this.r=e,this.g=t,this.b=n,En.toWorkingColorSpace(this,i),this}},{key:"setHSL",value:function(e,t,n){var i=arguments.length>3&&void 0!==arguments[3]?arguments[3]:En.workingColorSpace;if(e=sn(e,1),t=on(t,0,1),n=on(n,0,1),0===t)this.r=this.g=this.b=n;else{var r=n<=.5?n*(1+t):n+t-n*t,a=2*n-r;this.r=Bn(a,r,e+1/3),this.g=Bn(a,r,e),this.b=Bn(a,r,e-1/3)}return En.toWorkingColorSpace(this,i),this}},{key:"setStyle",value:function(e){var t,n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:zt;function i(t){void 0!==t&&parseFloat(t)<1&&console.warn("THREE.Color: Alpha component of "+e+" will be ignored.")}if(t=/^((?:rgb|hsl)a?)\(([^\)]*)\)/.exec(e)){var r,a=t[1],o=t[2];switch(a){case"rgb":case"rgba":if(r=/^\s*(\d+)\s*,\s*(\d+)\s*,\s*(\d+)\s*(?:,\s*(\d*\.?\d+)\s*)?$/.exec(o))return this.r=Math.min(255,parseInt(r[1],10))/255,this.g=Math.min(255,parseInt(r[2],10))/255,this.b=Math.min(255,parseInt(r[3],10))/255,En.toWorkingColorSpace(this,n),i(r[4]),this;if(r=/^\s*(\d+)\%\s*,\s*(\d+)\%\s*,\s*(\d+)\%\s*(?:,\s*(\d*\.?\d+)\s*)?$/.exec(o))return this.r=Math.min(100,parseInt(r[1],10))/100,this.g=Math.min(100,parseInt(r[2],10))/100,this.b=Math.min(100,parseInt(r[3],10))/100,En.toWorkingColorSpace(this,n),i(r[4]),this;break;case"hsl":case"hsla":if(r=/^\s*(\d*\.?\d+)\s*,\s*(\d*\.?\d+)\%\s*,\s*(\d*\.?\d+)\%\s*(?:,\s*(\d*\.?\d+)\s*)?$/.exec(o)){var s=parseFloat(r[1])/360,l=parseFloat(r[2])/100,u=parseFloat(r[3])/100;return i(r[4]),this.setHSL(s,l,u,n)}}}else if(t=/^\#([A-Fa-f\d]+)$/.exec(e)){var c=t[1],h=c.length;if(3===h)return this.r=parseInt(c.charAt(0)+c.charAt(0),16)/255,this.g=parseInt(c.charAt(1)+c.charAt(1),16)/255,this.b=parseInt(c.charAt(2)+c.charAt(2),16)/255,En.toWorkingColorSpace(this,n),this;if(6===h)return this.r=parseInt(c.charAt(0)+c.charAt(1),16)/255,this.g=parseInt(c.charAt(2)+c.charAt(3),16)/255,this.b=parseInt(c.charAt(4)+c.charAt(5),16)/255,En.toWorkingColorSpace(this,n),this}return e&&e.length>0?this.setColorName(e,n):this}},{key:"setColorName",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:zt,n=Mn[e.toLowerCase()];return void 0!==n?this.setHex(n,t):console.warn("THREE.Color: Unknown color "+e),this}},{key:"clone",value:function(){return new this.constructor(this.r,this.g,this.b)}},{key:"copy",value:function(e){return this.r=e.r,this.g=e.g,this.b=e.b,this}},{key:"copySRGBToLinear",value:function(e){return this.r=Cn(e.r),this.g=Cn(e.g),this.b=Cn(e.b),this}},{key:"copyLinearToSRGB",value:function(e){return this.r=bn(e.r),this.g=bn(e.g),this.b=bn(e.b),this}},{key:"convertSRGBToLinear",value:function(){return this.copySRGBToLinear(this),this}},{key:"convertLinearToSRGB",value:function(){return this.copyLinearToSRGB(this),this}},{key:"getHex",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:zt;return En.fromWorkingColorSpace(Tn(this,In),e),on(255*In.r,0,255)<<16^on(255*In.g,0,255)<<8^on(255*In.b,0,255)<<0}},{key:"getHexString",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:zt;return("000000"+this.getHex(e).toString(16)).slice(-6)}},{key:"getHSL",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:En.workingColorSpace;En.fromWorkingColorSpace(Tn(this,In),t);var n,i,r=In.r,a=In.g,o=In.b,s=Math.max(r,a,o),l=Math.min(r,a,o),u=(l+s)/2;if(l===s)n=0,i=0;else{var c=s-l;switch(i=u<=.5?c/(s+l):c/(2-s-l),s){case r:n=(a-o)/c+(a<o?6:0);break;case a:n=(o-r)/c+2;break;case o:n=(r-a)/c+4}n/=6}return e.h=n,e.s=i,e.l=u,e}},{key:"getRGB",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:En.workingColorSpace;return En.fromWorkingColorSpace(Tn(this,In),t),e.r=In.r,e.g=In.g,e.b=In.b,e}},{key:"getStyle",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:zt;return En.fromWorkingColorSpace(Tn(this,In),e),e!==zt?"color(".concat(e," ").concat(In.r," ").concat(In.g," ").concat(In.b,")"):"rgb(".concat(255*In.r|0,",").concat(255*In.g|0,",").concat(255*In.b|0,")")}},{key:"offsetHSL",value:function(e,t,n){return this.getHSL(Sn),Sn.h+=e,Sn.s+=t,Sn.l+=n,this.setHSL(Sn.h,Sn.s,Sn.l),this}},{key:"add",value:function(e){return this.r+=e.r,this.g+=e.g,this.b+=e.b,this}},{key:"addColors",value:function(e,t){return this.r=e.r+t.r,this.g=e.g+t.g,this.b=e.b+t.b,this}},{key:"addScalar",value:function(e){return this.r+=e,this.g+=e,this.b+=e,this}},{key:"sub",value:function(e){return this.r=Math.max(0,this.r-e.r),this.g=Math.max(0,this.g-e.g),this.b=Math.max(0,this.b-e.b),this}},{key:"multiply",value:function(e){return this.r*=e.r,this.g*=e.g,this.b*=e.b,this}},{key:"multiplyScalar",value:function(e){return this.r*=e,this.g*=e,this.b*=e,this}},{key:"lerp",value:function(e,t){return this.r+=(e.r-this.r)*t,this.g+=(e.g-this.g)*t,this.b+=(e.b-this.b)*t,this}},{key:"lerpColors",value:function(e,t,n){return this.r=e.r+(t.r-e.r)*n,this.g=e.g+(t.g-e.g)*n,this.b=e.b+(t.b-e.b)*n,this}},{key:"lerpHSL",value:function(e,t){this.getHSL(Sn),e.getHSL(kn);var n=ln(Sn.h,kn.h,t),i=ln(Sn.s,kn.s,t),r=ln(Sn.l,kn.l,t);return this.setHSL(n,i,r),this}},{key:"equals",value:function(e){return e.r===this.r&&e.g===this.g&&e.b===this.b}},{key:"fromArray",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;return this.r=e[t],this.g=e[t+1],this.b=e[t+2],this}},{key:"toArray",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[],t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;return e[t]=this.r,e[t+1]=this.g,e[t+2]=this.b,e}},{key:"fromBufferAttribute",value:function(e,t){return this.r=e.getX(t),this.g=e.getY(t),this.b=e.getZ(t),this}},{key:"toJSON",value:function(){return this.getHex()}},{key:e,value:(0,A.Z)().mark((function e(){return(0,A.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.r;case 2:return e.next=4,this.g;case 4:return e.next=6,this.b;case 6:case"end":return e.stop()}}),e,this)}))}]),t}(Symbol.iterator);Rn.NAMES=Mn;var Pn=function(){function e(){(0,v.Z)(this,e)}return(0,g.Z)(e,null,[{key:"getDataURL",value:function(e){if(/^data:/i.test(e.src))return e.src;if("undefined"==typeof HTMLCanvasElement)return e.src;var t;if(e instanceof HTMLCanvasElement)t=e;else{void 0===Dn&&(Dn=wn("canvas")),Dn.width=e.width,Dn.height=e.height;var n=Dn.getContext("2d");e instanceof ImageData?n.putImageData(e,0,0):n.drawImage(e,0,0,e.width,e.height),t=Dn}return t.width>2048||t.height>2048?(console.warn("THREE.ImageUtils.getDataURL: Image converted to jpg for performance reasons",e),t.toDataURL("image/jpeg",.6)):t.toDataURL("image/png")}},{key:"sRGBToLinear",value:function(e){if("undefined"!==typeof HTMLImageElement&&e instanceof HTMLImageElement||"undefined"!==typeof HTMLCanvasElement&&e instanceof HTMLCanvasElement||"undefined"!==typeof ImageBitmap&&e instanceof ImageBitmap){var t=wn("canvas");t.width=e.width,t.height=e.height;var n=t.getContext("2d");n.drawImage(e,0,0,e.width,e.height);for(var i=n.getImageData(0,0,e.width,e.height),r=i.data,a=0;a<r.length;a++)r[a]=255*Cn(r[a]/255);return n.putImageData(i,0,0),t}if(e.data){for(var o=e.data.slice(0),s=0;s<o.length;s++)o instanceof Uint8Array||o instanceof Uint8ClampedArray?o[s]=Math.floor(255*Cn(o[s]/255)):o[s]=Cn(o[s]);return{data:o,width:e.width,height:e.height}}return console.warn("THREE.ImageUtils.sRGBToLinear(): Unsupported image type. No color space conversion applied."),e}}]),e}(),Ln=function(){function e(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null;(0,v.Z)(this,e),this.isSource=!0,this.uuid=an(),this.data=t,this.version=0}return(0,g.Z)(e,[{key:"needsUpdate",set:function(e){!0===e&&this.version++}},{key:"toJSON",value:function(e){var t=void 0===e||"string"===typeof e;if(!t&&void 0!==e.images[this.uuid])return e.images[this.uuid];var n={uuid:this.uuid,url:""},i=this.data;if(null!==i){var r;if(Array.isArray(i)){r=[];for(var a=0,o=i.length;a<o;a++)i[a].isDataTexture?r.push(Qn(i[a].image)):r.push(Qn(i[a]))}else r=Qn(i);n.url=r}return t||(e.images[this.uuid]=n),n}}]),e}();function Qn(e){return"undefined"!==typeof HTMLImageElement&&e instanceof HTMLImageElement||"undefined"!==typeof HTMLCanvasElement&&e instanceof HTMLCanvasElement||"undefined"!==typeof ImageBitmap&&e instanceof ImageBitmap?Pn.getDataURL(e):e.data?{data:Array.from(e.data),width:e.width,height:e.height,type:e.data.constructor.name}:(console.warn("THREE.Texture: Unable to serialize Texture."),{})}var Zn=0,Nn=function(e){(0,d.Z)(n,e);var t=(0,f.Z)(n);function n(){var e,i=arguments.length>0&&void 0!==arguments[0]?arguments[0]:n.DEFAULT_IMAGE,r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:n.DEFAULT_MAPPING,a=arguments.length>2&&void 0!==arguments[2]?arguments[2]:we,o=arguments.length>3&&void 0!==arguments[3]?arguments[3]:we,s=arguments.length>4&&void 0!==arguments[4]?arguments[4]:Me,l=arguments.length>5&&void 0!==arguments[5]?arguments[5]:Se,u=arguments.length>6&&void 0!==arguments[6]?arguments[6]:je,c=arguments.length>7&&void 0!==arguments[7]?arguments[7]:ke,d=arguments.length>8&&void 0!==arguments[8]?arguments[8]:n.DEFAULT_ANISOTROPY,f=arguments.length>9&&void 0!==arguments[9]?arguments[9]:Nt;return(0,v.Z)(this,n),(e=t.call(this)).isTexture=!0,Object.defineProperty((0,h.Z)(e),"id",{value:Zn++}),e.uuid=an(),e.name="",e.source=new Ln(i),e.mipmaps=[],e.mapping=r,e.wrapS=a,e.wrapT=o,e.magFilter=s,e.minFilter=l,e.anisotropy=d,e.format=u,e.internalFormat=null,e.type=c,e.offset=new An(0,0),e.repeat=new An(1,1),e.center=new An(0,0),e.rotation=0,e.matrixAutoUpdate=!0,e.matrix=new vn,e.generateMipmaps=!0,e.premultiplyAlpha=!1,e.flipY=!0,e.unpackAlignment=4,e.encoding=f,e.userData={},e.version=0,e.onUpdate=null,e.isRenderTargetTexture=!1,e.needsPMREMUpdate=!1,e}return(0,g.Z)(n,[{key:"image",get:function(){return this.source.data},set:function(e){this.source.data=e}},{key:"updateMatrix",value:function(){this.matrix.setUvTransform(this.offset.x,this.offset.y,this.repeat.x,this.repeat.y,this.rotation,this.center.x,this.center.y)}},{key:"clone",value:function(){return(new this.constructor).copy(this)}},{key:"copy",value:function(e){return this.name=e.name,this.source=e.source,this.mipmaps=e.mipmaps.slice(0),this.mapping=e.mapping,this.wrapS=e.wrapS,this.wrapT=e.wrapT,this.magFilter=e.magFilter,this.minFilter=e.minFilter,this.anisotropy=e.anisotropy,this.format=e.format,this.internalFormat=e.internalFormat,this.type=e.type,this.offset.copy(e.offset),this.repeat.copy(e.repeat),this.center.copy(e.center),this.rotation=e.rotation,this.matrixAutoUpdate=e.matrixAutoUpdate,this.matrix.copy(e.matrix),this.generateMipmaps=e.generateMipmaps,this.premultiplyAlpha=e.premultiplyAlpha,this.flipY=e.flipY,this.unpackAlignment=e.unpackAlignment,this.encoding=e.encoding,this.userData=JSON.parse(JSON.stringify(e.userData)),this.needsUpdate=!0,this}},{key:"toJSON",value:function(e){var t=void 0===e||"string"===typeof e;if(!t&&void 0!==e.textures[this.uuid])return e.textures[this.uuid];var n={metadata:{version:4.5,type:"Texture",generator:"Texture.toJSON"},uuid:this.uuid,name:this.name,image:this.source.toJSON(e).uuid,mapping:this.mapping,repeat:[this.repeat.x,this.repeat.y],offset:[this.offset.x,this.offset.y],center:[this.center.x,this.center.y],rotation:this.rotation,wrap:[this.wrapS,this.wrapT],format:this.format,type:this.type,encoding:this.encoding,minFilter:this.minFilter,magFilter:this.magFilter,anisotropy:this.anisotropy,flipY:this.flipY,generateMipmaps:this.generateMipmaps,premultiplyAlpha:this.premultiplyAlpha,unpackAlignment:this.unpackAlignment};return Object.keys(this.userData).length>0&&(n.userData=this.userData),t||(e.textures[this.uuid]=n),n}},{key:"dispose",value:function(){this.dispatchEvent({type:"dispose"})}},{key:"transformUv",value:function(e){if(300!==this.mapping)return e;if(e.applyMatrix3(this.matrix),e.x<0||e.x>1)switch(this.wrapS){case xe:e.x=e.x-Math.floor(e.x);break;case we:e.x=e.x<0?0:1;break;case Ce:1===Math.abs(Math.floor(e.x)%2)?e.x=Math.ceil(e.x)-e.x:e.x=e.x-Math.floor(e.x)}if(e.y<0||e.y>1)switch(this.wrapT){case xe:e.y=e.y-Math.floor(e.y);break;case we:e.y=e.y<0?0:1;break;case Ce:1===Math.abs(Math.floor(e.y)%2)?e.y=Math.ceil(e.y)-e.y:e.y=e.y-Math.floor(e.y)}return this.flipY&&(e.y=1-e.y),e}},{key:"needsUpdate",set:function(e){!0===e&&(this.version++,this.source.needsUpdate=!0)}}]),n}($t);Nn.DEFAULT_IMAGE=null,Nn.DEFAULT_MAPPING=300,Nn.DEFAULT_ANISOTROPY=1;var Fn=function(e){function t(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0,r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:1;(0,v.Z)(this,t),t.prototype.isVector4=!0,this.x=e,this.y=n,this.z=i,this.w=r}return(0,g.Z)(t,[{key:"width",get:function(){return this.z},set:function(e){this.z=e}},{key:"height",get:function(){return this.w},set:function(e){this.w=e}},{key:"set",value:function(e,t,n,i){return this.x=e,this.y=t,this.z=n,this.w=i,this}},{key:"setScalar",value:function(e){return this.x=e,this.y=e,this.z=e,this.w=e,this}},{key:"setX",value:function(e){return this.x=e,this}},{key:"setY",value:function(e){return this.y=e,this}},{key:"setZ",value:function(e){return this.z=e,this}},{key:"setW",value:function(e){return this.w=e,this}},{key:"setComponent",value:function(e,t){switch(e){case 0:this.x=t;break;case 1:this.y=t;break;case 2:this.z=t;break;case 3:this.w=t;break;default:throw new Error("index is out of range: "+e)}return this}},{key:"getComponent",value:function(e){switch(e){case 0:return this.x;case 1:return this.y;case 2:return this.z;case 3:return this.w;default:throw new Error("index is out of range: "+e)}}},{key:"clone",value:function(){return new this.constructor(this.x,this.y,this.z,this.w)}},{key:"copy",value:function(e){return this.x=e.x,this.y=e.y,this.z=e.z,this.w=void 0!==e.w?e.w:1,this}},{key:"add",value:function(e){return this.x+=e.x,this.y+=e.y,this.z+=e.z,this.w+=e.w,this}},{key:"addScalar",value:function(e){return this.x+=e,this.y+=e,this.z+=e,this.w+=e,this}},{key:"addVectors",value:function(e,t){return this.x=e.x+t.x,this.y=e.y+t.y,this.z=e.z+t.z,this.w=e.w+t.w,this}},{key:"addScaledVector",value:function(e,t){return this.x+=e.x*t,this.y+=e.y*t,this.z+=e.z*t,this.w+=e.w*t,this}},{key:"sub",value:function(e){return this.x-=e.x,this.y-=e.y,this.z-=e.z,this.w-=e.w,this}},{key:"subScalar",value:function(e){return this.x-=e,this.y-=e,this.z-=e,this.w-=e,this}},{key:"subVectors",value:function(e,t){return this.x=e.x-t.x,this.y=e.y-t.y,this.z=e.z-t.z,this.w=e.w-t.w,this}},{key:"multiply",value:function(e){return this.x*=e.x,this.y*=e.y,this.z*=e.z,this.w*=e.w,this}},{key:"multiplyScalar",value:function(e){return this.x*=e,this.y*=e,this.z*=e,this.w*=e,this}},{key:"applyMatrix4",value:function(e){var t=this.x,n=this.y,i=this.z,r=this.w,a=e.elements;return this.x=a[0]*t+a[4]*n+a[8]*i+a[12]*r,this.y=a[1]*t+a[5]*n+a[9]*i+a[13]*r,this.z=a[2]*t+a[6]*n+a[10]*i+a[14]*r,this.w=a[3]*t+a[7]*n+a[11]*i+a[15]*r,this}},{key:"divideScalar",value:function(e){return this.multiplyScalar(1/e)}},{key:"setAxisAngleFromQuaternion",value:function(e){this.w=2*Math.acos(e.w);var t=Math.sqrt(1-e.w*e.w);return t<1e-4?(this.x=1,this.y=0,this.z=0):(this.x=e.x/t,this.y=e.y/t,this.z=e.z/t),this}},{key:"setAxisAngleFromRotationMatrix",value:function(e){var t,n,i,r,a=.01,o=.1,s=e.elements,l=s[0],u=s[4],c=s[8],h=s[1],d=s[5],f=s[9],p=s[2],A=s[6],v=s[10];if(Math.abs(u-h)<a&&Math.abs(c-p)<a&&Math.abs(f-A)<a){if(Math.abs(u+h)<o&&Math.abs(c+p)<o&&Math.abs(f+A)<o&&Math.abs(l+d+v-3)<o)return this.set(1,0,0,0),this;t=Math.PI;var g=(l+1)/2,m=(d+1)/2,y=(v+1)/2,x=(u+h)/4,w=(c+p)/4,C=(f+A)/4;return g>m&&g>y?g<a?(n=0,i=.707106781,r=.707106781):(i=x/(n=Math.sqrt(g)),r=w/n):m>y?m<a?(n=.707106781,i=0,r=.707106781):(n=x/(i=Math.sqrt(m)),r=C/i):y<a?(n=.707106781,i=.707106781,r=0):(n=w/(r=Math.sqrt(y)),i=C/r),this.set(n,i,r,t),this}var b=Math.sqrt((A-f)*(A-f)+(c-p)*(c-p)+(h-u)*(h-u));return Math.abs(b)<.001&&(b=1),this.x=(A-f)/b,this.y=(c-p)/b,this.z=(h-u)/b,this.w=Math.acos((l+d+v-1)/2),this}},{key:"min",value:function(e){return this.x=Math.min(this.x,e.x),this.y=Math.min(this.y,e.y),this.z=Math.min(this.z,e.z),this.w=Math.min(this.w,e.w),this}},{key:"max",value:function(e){return this.x=Math.max(this.x,e.x),this.y=Math.max(this.y,e.y),this.z=Math.max(this.z,e.z),this.w=Math.max(this.w,e.w),this}},{key:"clamp",value:function(e,t){return this.x=Math.max(e.x,Math.min(t.x,this.x)),this.y=Math.max(e.y,Math.min(t.y,this.y)),this.z=Math.max(e.z,Math.min(t.z,this.z)),this.w=Math.max(e.w,Math.min(t.w,this.w)),this}},{key:"clampScalar",value:function(e,t){return this.x=Math.max(e,Math.min(t,this.x)),this.y=Math.max(e,Math.min(t,this.y)),this.z=Math.max(e,Math.min(t,this.z)),this.w=Math.max(e,Math.min(t,this.w)),this}},{key:"clampLength",value:function(e,t){var n=this.length();return this.divideScalar(n||1).multiplyScalar(Math.max(e,Math.min(t,n)))}},{key:"floor",value:function(){return this.x=Math.floor(this.x),this.y=Math.floor(this.y),this.z=Math.floor(this.z),this.w=Math.floor(this.w),this}},{key:"ceil",value:function(){return this.x=Math.ceil(this.x),this.y=Math.ceil(this.y),this.z=Math.ceil(this.z),this.w=Math.ceil(this.w),this}},{key:"round",value:function(){return this.x=Math.round(this.x),this.y=Math.round(this.y),this.z=Math.round(this.z),this.w=Math.round(this.w),this}},{key:"roundToZero",value:function(){return this.x=this.x<0?Math.ceil(this.x):Math.floor(this.x),this.y=this.y<0?Math.ceil(this.y):Math.floor(this.y),this.z=this.z<0?Math.ceil(this.z):Math.floor(this.z),this.w=this.w<0?Math.ceil(this.w):Math.floor(this.w),this}},{key:"negate",value:function(){return this.x=-this.x,this.y=-this.y,this.z=-this.z,this.w=-this.w,this}},{key:"dot",value:function(e){return this.x*e.x+this.y*e.y+this.z*e.z+this.w*e.w}},{key:"lengthSq",value:function(){return this.x*this.x+this.y*this.y+this.z*this.z+this.w*this.w}},{key:"length",value:function(){return Math.sqrt(this.x*this.x+this.y*this.y+this.z*this.z+this.w*this.w)}},{key:"manhattanLength",value:function(){return Math.abs(this.x)+Math.abs(this.y)+Math.abs(this.z)+Math.abs(this.w)}},{key:"normalize",value:function(){return this.divideScalar(this.length()||1)}},{key:"setLength",value:function(e){return this.normalize().multiplyScalar(e)}},{key:"lerp",value:function(e,t){return this.x+=(e.x-this.x)*t,this.y+=(e.y-this.y)*t,this.z+=(e.z-this.z)*t,this.w+=(e.w-this.w)*t,this}},{key:"lerpVectors",value:function(e,t,n){return this.x=e.x+(t.x-e.x)*n,this.y=e.y+(t.y-e.y)*n,this.z=e.z+(t.z-e.z)*n,this.w=e.w+(t.w-e.w)*n,this}},{key:"equals",value:function(e){return e.x===this.x&&e.y===this.y&&e.z===this.z&&e.w===this.w}},{key:"fromArray",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;return this.x=e[t],this.y=e[t+1],this.z=e[t+2],this.w=e[t+3],this}},{key:"toArray",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[],t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;return e[t]=this.x,e[t+1]=this.y,e[t+2]=this.z,e[t+3]=this.w,e}},{key:"fromBufferAttribute",value:function(e,t){return this.x=e.getX(t),this.y=e.getY(t),this.z=e.getZ(t),this.w=e.getW(t),this}},{key:"random",value:function(){return this.x=Math.random(),this.y=Math.random(),this.z=Math.random(),this.w=Math.random(),this}},{key:e,value:(0,A.Z)().mark((function e(){return(0,A.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.x;case 2:return e.next=4,this.y;case 4:return e.next=6,this.z;case 6:return e.next=8,this.w;case 8:case"end":return e.stop()}}),e,this)}))}]),t}(Symbol.iterator),Un=function(e){(0,d.Z)(n,e);var t=(0,f.Z)(n);function n(){var e,i=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1,a=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{};(0,v.Z)(this,n),(e=t.call(this)).isWebGLRenderTarget=!0,e.width=i,e.height=r,e.depth=1,e.scissor=new Fn(0,0,i,r),e.scissorTest=!1,e.viewport=new Fn(0,0,i,r);var o={width:i,height:r,depth:1};return e.texture=new Nn(o,a.mapping,a.wrapS,a.wrapT,a.magFilter,a.minFilter,a.format,a.type,a.anisotropy,a.encoding),e.texture.isRenderTargetTexture=!0,e.texture.flipY=!1,e.texture.generateMipmaps=void 0!==a.generateMipmaps&&a.generateMipmaps,e.texture.internalFormat=void 0!==a.internalFormat?a.internalFormat:null,e.texture.minFilter=void 0!==a.minFilter?a.minFilter:Me,e.depthBuffer=void 0===a.depthBuffer||a.depthBuffer,e.stencilBuffer=void 0!==a.stencilBuffer&&a.stencilBuffer,e.depthTexture=void 0!==a.depthTexture?a.depthTexture:null,e.samples=void 0!==a.samples?a.samples:0,e}return(0,g.Z)(n,[{key:"setSize",value:function(e,t){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:1;this.width===e&&this.height===t&&this.depth===n||(this.width=e,this.height=t,this.depth=n,this.texture.image.width=e,this.texture.image.height=t,this.texture.image.depth=n,this.dispose()),this.viewport.set(0,0,e,t),this.scissor.set(0,0,e,t)}},{key:"clone",value:function(){return(new this.constructor).copy(this)}},{key:"copy",value:function(e){this.width=e.width,this.height=e.height,this.depth=e.depth,this.viewport.copy(e.viewport),this.texture=e.texture.clone(),this.texture.isRenderTargetTexture=!0;var t=Object.assign({},e.texture.image);return this.texture.source=new Ln(t),this.depthBuffer=e.depthBuffer,this.stencilBuffer=e.stencilBuffer,null!==e.depthTexture&&(this.depthTexture=e.depthTexture.clone()),this.samples=e.samples,this}},{key:"dispose",value:function(){this.dispatchEvent({type:"dispose"})}}]),n}($t),jn=function(e){(0,d.Z)(n,e);var t=(0,f.Z)(n);function n(){var e,i=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null,r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1,a=arguments.length>2&&void 0!==arguments[2]?arguments[2]:1,o=arguments.length>3&&void 0!==arguments[3]?arguments[3]:1;return(0,v.Z)(this,n),(e=t.call(this,null)).isDataArrayTexture=!0,e.image={data:i,width:r,height:a,depth:o},e.magFilter=be,e.minFilter=be,e.wrapR=we,e.generateMipmaps=!1,e.flipY=!1,e.unpackAlignment=1,e}return(0,g.Z)(n)}(Nn),On=function(e){(0,d.Z)(n,e);var t=(0,f.Z)(n);function n(){var e,i=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null,r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1,a=arguments.length>2&&void 0!==arguments[2]?arguments[2]:1,o=arguments.length>3&&void 0!==arguments[3]?arguments[3]:1;return(0,v.Z)(this,n),(e=t.call(this,null)).isData3DTexture=!0,e.image={data:i,width:r,height:a,depth:o},e.magFilter=be,e.minFilter=be,e.wrapR=we,e.generateMipmaps=!1,e.flipY=!1,e.unpackAlignment=1,e}return(0,g.Z)(n)}(Nn),zn=function(e){function t(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0,r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:1;(0,v.Z)(this,t),this.isQuaternion=!0,this._x=e,this._y=n,this._z=i,this._w=r}return(0,g.Z)(t,[{key:"x",get:function(){return this._x},set:function(e){this._x=e,this._onChangeCallback()}},{key:"y",get:function(){return this._y},set:function(e){this._y=e,this._onChangeCallback()}},{key:"z",get:function(){return this._z},set:function(e){this._z=e,this._onChangeCallback()}},{key:"w",get:function(){return this._w},set:function(e){this._w=e,this._onChangeCallback()}},{key:"set",value:function(e,t,n,i){return this._x=e,this._y=t,this._z=n,this._w=i,this._onChangeCallback(),this}},{key:"clone",value:function(){return new this.constructor(this._x,this._y,this._z,this._w)}},{key:"copy",value:function(e){return this._x=e.x,this._y=e.y,this._z=e.z,this._w=e.w,this._onChangeCallback(),this}},{key:"setFromEuler",value:function(e,t){var n=e._x,i=e._y,r=e._z,a=e._order,o=Math.cos,s=Math.sin,l=o(n/2),u=o(i/2),c=o(r/2),h=s(n/2),d=s(i/2),f=s(r/2);switch(a){case"XYZ":this._x=h*u*c+l*d*f,this._y=l*d*c-h*u*f,this._z=l*u*f+h*d*c,this._w=l*u*c-h*d*f;break;case"YXZ":this._x=h*u*c+l*d*f,this._y=l*d*c-h*u*f,this._z=l*u*f-h*d*c,this._w=l*u*c+h*d*f;break;case"ZXY":this._x=h*u*c-l*d*f,this._y=l*d*c+h*u*f,this._z=l*u*f+h*d*c,this._w=l*u*c-h*d*f;break;case"ZYX":this._x=h*u*c-l*d*f,this._y=l*d*c+h*u*f,this._z=l*u*f-h*d*c,this._w=l*u*c+h*d*f;break;case"YZX":this._x=h*u*c+l*d*f,this._y=l*d*c+h*u*f,this._z=l*u*f-h*d*c,this._w=l*u*c-h*d*f;break;case"XZY":this._x=h*u*c-l*d*f,this._y=l*d*c-h*u*f,this._z=l*u*f+h*d*c,this._w=l*u*c+h*d*f;break;default:console.warn("THREE.Quaternion: .setFromEuler() encountered an unknown order: "+a)}return!1!==t&&this._onChangeCallback(),this}},{key:"setFromAxisAngle",value:function(e,t){var n=t/2,i=Math.sin(n);return this._x=e.x*i,this._y=e.y*i,this._z=e.z*i,this._w=Math.cos(n),this._onChangeCallback(),this}},{key:"setFromRotationMatrix",value:function(e){var t=e.elements,n=t[0],i=t[4],r=t[8],a=t[1],o=t[5],s=t[9],l=t[2],u=t[6],c=t[10],h=n+o+c;if(h>0){var d=.5/Math.sqrt(h+1);this._w=.25/d,this._x=(u-s)*d,this._y=(r-l)*d,this._z=(a-i)*d}else if(n>o&&n>c){var f=2*Math.sqrt(1+n-o-c);this._w=(u-s)/f,this._x=.25*f,this._y=(i+a)/f,this._z=(r+l)/f}else if(o>c){var p=2*Math.sqrt(1+o-n-c);this._w=(r-l)/p,this._x=(i+a)/p,this._y=.25*p,this._z=(s+u)/p}else{var A=2*Math.sqrt(1+c-n-o);this._w=(a-i)/A,this._x=(r+l)/A,this._y=(s+u)/A,this._z=.25*A}return this._onChangeCallback(),this}},{key:"setFromUnitVectors",value:function(e,t){var n=e.dot(t)+1;return n<Number.EPSILON?(n=0,Math.abs(e.x)>Math.abs(e.z)?(this._x=-e.y,this._y=e.x,this._z=0,this._w=n):(this._x=0,this._y=-e.z,this._z=e.y,this._w=n)):(this._x=e.y*t.z-e.z*t.y,this._y=e.z*t.x-e.x*t.z,this._z=e.x*t.y-e.y*t.x,this._w=n),this.normalize()}},{key:"angleTo",value:function(e){return 2*Math.acos(Math.abs(on(this.dot(e),-1,1)))}},{key:"rotateTowards",value:function(e,t){var n=this.angleTo(e);if(0===n)return this;var i=Math.min(1,t/n);return this.slerp(e,i),this}},{key:"identity",value:function(){return this.set(0,0,0,1)}},{key:"invert",value:function(){return this.conjugate()}},{key:"conjugate",value:function(){return this._x*=-1,this._y*=-1,this._z*=-1,this._onChangeCallback(),this}},{key:"dot",value:function(e){return this._x*e._x+this._y*e._y+this._z*e._z+this._w*e._w}},{key:"lengthSq",value:function(){return this._x*this._x+this._y*this._y+this._z*this._z+this._w*this._w}},{key:"length",value:function(){return Math.sqrt(this._x*this._x+this._y*this._y+this._z*this._z+this._w*this._w)}},{key:"normalize",value:function(){var e=this.length();return 0===e?(this._x=0,this._y=0,this._z=0,this._w=1):(e=1/e,this._x=this._x*e,this._y=this._y*e,this._z=this._z*e,this._w=this._w*e),this._onChangeCallback(),this}},{key:"multiply",value:function(e){return this.multiplyQuaternions(this,e)}},{key:"premultiply",value:function(e){return this.multiplyQuaternions(e,this)}},{key:"multiplyQuaternions",value:function(e,t){var n=e._x,i=e._y,r=e._z,a=e._w,o=t._x,s=t._y,l=t._z,u=t._w;return this._x=n*u+a*o+i*l-r*s,this._y=i*u+a*s+r*o-n*l,this._z=r*u+a*l+n*s-i*o,this._w=a*u-n*o-i*s-r*l,this._onChangeCallback(),this}},{key:"slerp",value:function(e,t){if(0===t)return this;if(1===t)return this.copy(e);var n=this._x,i=this._y,r=this._z,a=this._w,o=a*e._w+n*e._x+i*e._y+r*e._z;if(o<0?(this._w=-e._w,this._x=-e._x,this._y=-e._y,this._z=-e._z,o=-o):this.copy(e),o>=1)return this._w=a,this._x=n,this._y=i,this._z=r,this;var s=1-o*o;if(s<=Number.EPSILON){var l=1-t;return this._w=l*a+t*this._w,this._x=l*n+t*this._x,this._y=l*i+t*this._y,this._z=l*r+t*this._z,this.normalize(),this._onChangeCallback(),this}var u=Math.sqrt(s),c=Math.atan2(u,o),h=Math.sin((1-t)*c)/u,d=Math.sin(t*c)/u;return this._w=a*h+this._w*d,this._x=n*h+this._x*d,this._y=i*h+this._y*d,this._z=r*h+this._z*d,this._onChangeCallback(),this}},{key:"slerpQuaternions",value:function(e,t,n){return this.copy(e).slerp(t,n)}},{key:"random",value:function(){var e=Math.random(),t=Math.sqrt(1-e),n=Math.sqrt(e),i=2*Math.PI*Math.random(),r=2*Math.PI*Math.random();return this.set(t*Math.cos(i),n*Math.sin(r),n*Math.cos(r),t*Math.sin(i))}},{key:"equals",value:function(e){return e._x===this._x&&e._y===this._y&&e._z===this._z&&e._w===this._w}},{key:"fromArray",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;return this._x=e[t],this._y=e[t+1],this._z=e[t+2],this._w=e[t+3],this._onChangeCallback(),this}},{key:"toArray",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[],t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;return e[t]=this._x,e[t+1]=this._y,e[t+2]=this._z,e[t+3]=this._w,e}},{key:"fromBufferAttribute",value:function(e,t){return this._x=e.getX(t),this._y=e.getY(t),this._z=e.getZ(t),this._w=e.getW(t),this}},{key:"_onChange",value:function(e){return this._onChangeCallback=e,this}},{key:"_onChangeCallback",value:function(){}},{key:e,value:(0,A.Z)().mark((function e(){return(0,A.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this._x;case 2:return e.next=4,this._y;case 4:return e.next=6,this._z;case 6:return e.next=8,this._w;case 8:case"end":return e.stop()}}),e,this)}))}],[{key:"slerpFlat",value:function(e,t,n,i,r,a,o){var s=n[i+0],l=n[i+1],u=n[i+2],c=n[i+3],h=r[a+0],d=r[a+1],f=r[a+2],p=r[a+3];if(0===o)return e[t+0]=s,e[t+1]=l,e[t+2]=u,void(e[t+3]=c);if(1===o)return e[t+0]=h,e[t+1]=d,e[t+2]=f,void(e[t+3]=p);if(c!==p||s!==h||l!==d||u!==f){var A=1-o,v=s*h+l*d+u*f+c*p,g=v>=0?1:-1,m=1-v*v;if(m>Number.EPSILON){var y=Math.sqrt(m),x=Math.atan2(y,v*g);A=Math.sin(A*x)/y,o=Math.sin(o*x)/y}var w=o*g;if(s=s*A+h*w,l=l*A+d*w,u=u*A+f*w,c=c*A+p*w,A===1-o){var C=1/Math.sqrt(s*s+l*l+u*u+c*c);s*=C,l*=C,u*=C,c*=C}}e[t]=s,e[t+1]=l,e[t+2]=u,e[t+3]=c}},{key:"multiplyQuaternionsFlat",value:function(e,t,n,i,r,a){var o=n[i],s=n[i+1],l=n[i+2],u=n[i+3],c=r[a],h=r[a+1],d=r[a+2],f=r[a+3];return e[t]=o*f+u*c+s*d-l*h,e[t+1]=s*f+u*h+l*c-o*d,e[t+2]=l*f+u*d+o*h-s*c,e[t+3]=u*f-o*c-s*h-l*d,e}}]),t}(Symbol.iterator),Gn=function(e){function t(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0;(0,v.Z)(this,t),t.prototype.isVector3=!0,this.x=e,this.y=n,this.z=i}return(0,g.Z)(t,[{key:"set",value:function(e,t,n){return void 0===n&&(n=this.z),this.x=e,this.y=t,this.z=n,this}},{key:"setScalar",value:function(e){return this.x=e,this.y=e,this.z=e,this}},{key:"setX",value:function(e){return this.x=e,this}},{key:"setY",value:function(e){return this.y=e,this}},{key:"setZ",value:function(e){return this.z=e,this}},{key:"setComponent",value:function(e,t){switch(e){case 0:this.x=t;break;case 1:this.y=t;break;case 2:this.z=t;break;default:throw new Error("index is out of range: "+e)}return this}},{key:"getComponent",value:function(e){switch(e){case 0:return this.x;case 1:return this.y;case 2:return this.z;default:throw new Error("index is out of range: "+e)}}},{key:"clone",value:function(){return new this.constructor(this.x,this.y,this.z)}},{key:"copy",value:function(e){return this.x=e.x,this.y=e.y,this.z=e.z,this}},{key:"add",value:function(e){return this.x+=e.x,this.y+=e.y,this.z+=e.z,this}},{key:"addScalar",value:function(e){return this.x+=e,this.y+=e,this.z+=e,this}},{key:"addVectors",value:function(e,t){return this.x=e.x+t.x,this.y=e.y+t.y,this.z=e.z+t.z,this}},{key:"addScaledVector",value:function(e,t){return this.x+=e.x*t,this.y+=e.y*t,this.z+=e.z*t,this}},{key:"sub",value:function(e){return this.x-=e.x,this.y-=e.y,this.z-=e.z,this}},{key:"subScalar",value:function(e){return this.x-=e,this.y-=e,this.z-=e,this}},{key:"subVectors",value:function(e,t){return this.x=e.x-t.x,this.y=e.y-t.y,this.z=e.z-t.z,this}},{key:"multiply",value:function(e){return this.x*=e.x,this.y*=e.y,this.z*=e.z,this}},{key:"multiplyScalar",value:function(e){return this.x*=e,this.y*=e,this.z*=e,this}},{key:"multiplyVectors",value:function(e,t){return this.x=e.x*t.x,this.y=e.y*t.y,this.z=e.z*t.z,this}},{key:"applyEuler",value:function(e){return this.applyQuaternion(Vn.setFromEuler(e))}},{key:"applyAxisAngle",value:function(e,t){return this.applyQuaternion(Vn.setFromAxisAngle(e,t))}},{key:"applyMatrix3",value:function(e){var t=this.x,n=this.y,i=this.z,r=e.elements;return this.x=r[0]*t+r[3]*n+r[6]*i,this.y=r[1]*t+r[4]*n+r[7]*i,this.z=r[2]*t+r[5]*n+r[8]*i,this}},{key:"applyNormalMatrix",value:function(e){return this.applyMatrix3(e).normalize()}},{key:"applyMatrix4",value:function(e){var t=this.x,n=this.y,i=this.z,r=e.elements,a=1/(r[3]*t+r[7]*n+r[11]*i+r[15]);return this.x=(r[0]*t+r[4]*n+r[8]*i+r[12])*a,this.y=(r[1]*t+r[5]*n+r[9]*i+r[13])*a,this.z=(r[2]*t+r[6]*n+r[10]*i+r[14])*a,this}},{key:"applyQuaternion",value:function(e){var t=this.x,n=this.y,i=this.z,r=e.x,a=e.y,o=e.z,s=e.w,l=s*t+a*i-o*n,u=s*n+o*t-r*i,c=s*i+r*n-a*t,h=-r*t-a*n-o*i;return this.x=l*s+h*-r+u*-o-c*-a,this.y=u*s+h*-a+c*-r-l*-o,this.z=c*s+h*-o+l*-a-u*-r,this}},{key:"project",value:function(e){return this.applyMatrix4(e.matrixWorldInverse).applyMatrix4(e.projectionMatrix)}},{key:"unproject",value:function(e){return this.applyMatrix4(e.projectionMatrixInverse).applyMatrix4(e.matrixWorld)}},{key:"transformDirection",value:function(e){var t=this.x,n=this.y,i=this.z,r=e.elements;return this.x=r[0]*t+r[4]*n+r[8]*i,this.y=r[1]*t+r[5]*n+r[9]*i,this.z=r[2]*t+r[6]*n+r[10]*i,this.normalize()}},{key:"divide",value:function(e){return this.x/=e.x,this.y/=e.y,this.z/=e.z,this}},{key:"divideScalar",value:function(e){return this.multiplyScalar(1/e)}},{key:"min",value:function(e){return this.x=Math.min(this.x,e.x),this.y=Math.min(this.y,e.y),this.z=Math.min(this.z,e.z),this}},{key:"max",value:function(e){return this.x=Math.max(this.x,e.x),this.y=Math.max(this.y,e.y),this.z=Math.max(this.z,e.z),this}},{key:"clamp",value:function(e,t){return this.x=Math.max(e.x,Math.min(t.x,this.x)),this.y=Math.max(e.y,Math.min(t.y,this.y)),this.z=Math.max(e.z,Math.min(t.z,this.z)),this}},{key:"clampScalar",value:function(e,t){return this.x=Math.max(e,Math.min(t,this.x)),this.y=Math.max(e,Math.min(t,this.y)),this.z=Math.max(e,Math.min(t,this.z)),this}},{key:"clampLength",value:function(e,t){var n=this.length();return this.divideScalar(n||1).multiplyScalar(Math.max(e,Math.min(t,n)))}},{key:"floor",value:function(){return this.x=Math.floor(this.x),this.y=Math.floor(this.y),this.z=Math.floor(this.z),this}},{key:"ceil",value:function(){return this.x=Math.ceil(this.x),this.y=Math.ceil(this.y),this.z=Math.ceil(this.z),this}},{key:"round",value:function(){return this.x=Math.round(this.x),this.y=Math.round(this.y),this.z=Math.round(this.z),this}},{key:"roundToZero",value:function(){return this.x=this.x<0?Math.ceil(this.x):Math.floor(this.x),this.y=this.y<0?Math.ceil(this.y):Math.floor(this.y),this.z=this.z<0?Math.ceil(this.z):Math.floor(this.z),this}},{key:"negate",value:function(){return this.x=-this.x,this.y=-this.y,this.z=-this.z,this}},{key:"dot",value:function(e){return this.x*e.x+this.y*e.y+this.z*e.z}},{key:"lengthSq",value:function(){return this.x*this.x+this.y*this.y+this.z*this.z}},{key:"length",value:function(){return Math.sqrt(this.x*this.x+this.y*this.y+this.z*this.z)}},{key:"manhattanLength",value:function(){return Math.abs(this.x)+Math.abs(this.y)+Math.abs(this.z)}},{key:"normalize",value:function(){return this.divideScalar(this.length()||1)}},{key:"setLength",value:function(e){return this.normalize().multiplyScalar(e)}},{key:"lerp",value:function(e,t){return this.x+=(e.x-this.x)*t,this.y+=(e.y-this.y)*t,this.z+=(e.z-this.z)*t,this}},{key:"lerpVectors",value:function(e,t,n){return this.x=e.x+(t.x-e.x)*n,this.y=e.y+(t.y-e.y)*n,this.z=e.z+(t.z-e.z)*n,this}},{key:"cross",value:function(e){return this.crossVectors(this,e)}},{key:"crossVectors",value:function(e,t){var n=e.x,i=e.y,r=e.z,a=t.x,o=t.y,s=t.z;return this.x=i*s-r*o,this.y=r*a-n*s,this.z=n*o-i*a,this}},{key:"projectOnVector",value:function(e){var t=e.lengthSq();if(0===t)return this.set(0,0,0);var n=e.dot(this)/t;return this.copy(e).multiplyScalar(n)}},{key:"projectOnPlane",value:function(e){return Hn.copy(this).projectOnVector(e),this.sub(Hn)}},{key:"reflect",value:function(e){return this.sub(Hn.copy(e).multiplyScalar(2*this.dot(e)))}},{key:"angleTo",value:function(e){var t=Math.sqrt(this.lengthSq()*e.lengthSq());if(0===t)return Math.PI/2;var n=this.dot(e)/t;return Math.acos(on(n,-1,1))}},{key:"distanceTo",value:function(e){return Math.sqrt(this.distanceToSquared(e))}},{key:"distanceToSquared",value:function(e){var t=this.x-e.x,n=this.y-e.y,i=this.z-e.z;return t*t+n*n+i*i}},{key:"manhattanDistanceTo",value:function(e){return Math.abs(this.x-e.x)+Math.abs(this.y-e.y)+Math.abs(this.z-e.z)}},{key:"setFromSpherical",value:function(e){return this.setFromSphericalCoords(e.radius,e.phi,e.theta)}},{key:"setFromSphericalCoords",value:function(e,t,n){var i=Math.sin(t)*e;return this.x=i*Math.sin(n),this.y=Math.cos(t)*e,this.z=i*Math.cos(n),this}},{key:"setFromCylindrical",value:function(e){return this.setFromCylindricalCoords(e.radius,e.theta,e.y)}},{key:"setFromCylindricalCoords",value:function(e,t,n){return this.x=e*Math.sin(t),this.y=n,this.z=e*Math.cos(t),this}},{key:"setFromMatrixPosition",value:function(e){var t=e.elements;return this.x=t[12],this.y=t[13],this.z=t[14],this}},{key:"setFromMatrixScale",value:function(e){var t=this.setFromMatrixColumn(e,0).length(),n=this.setFromMatrixColumn(e,1).length(),i=this.setFromMatrixColumn(e,2).length();return this.x=t,this.y=n,this.z=i,this}},{key:"setFromMatrixColumn",value:function(e,t){return this.fromArray(e.elements,4*t)}},{key:"setFromMatrix3Column",value:function(e,t){return this.fromArray(e.elements,3*t)}},{key:"setFromEuler",value:function(e){return this.x=e._x,this.y=e._y,this.z=e._z,this}},{key:"equals",value:function(e){return e.x===this.x&&e.y===this.y&&e.z===this.z}},{key:"fromArray",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;return this.x=e[t],this.y=e[t+1],this.z=e[t+2],this}},{key:"toArray",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[],t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;return e[t]=this.x,e[t+1]=this.y,e[t+2]=this.z,e}},{key:"fromBufferAttribute",value:function(e,t){return this.x=e.getX(t),this.y=e.getY(t),this.z=e.getZ(t),this}},{key:"random",value:function(){return this.x=Math.random(),this.y=Math.random(),this.z=Math.random(),this}},{key:"randomDirection",value:function(){var e=2*(Math.random()-.5),t=Math.random()*Math.PI*2,n=Math.sqrt(1-Math.pow(e,2));return this.x=n*Math.cos(t),this.y=n*Math.sin(t),this.z=e,this}},{key:e,value:(0,A.Z)().mark((function e(){return(0,A.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.x;case 2:return e.next=4,this.y;case 4:return e.next=6,this.z;case 6:case"end":return e.stop()}}),e,this)}))}]),t}(Symbol.iterator),Hn=new Gn,Vn=new zn,Wn=function(){function e(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:new Gn(1/0,1/0,1/0),n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:new Gn(-1/0,-1/0,-1/0);(0,v.Z)(this,e),this.isBox3=!0,this.min=t,this.max=n}return(0,g.Z)(e,[{key:"set",value:function(e,t){return this.min.copy(e),this.max.copy(t),this}},{key:"setFromArray",value:function(e){for(var t=1/0,n=1/0,i=1/0,r=-1/0,a=-1/0,o=-1/0,s=0,l=e.length;s<l;s+=3){var u=e[s],c=e[s+1],h=e[s+2];u<t&&(t=u),c<n&&(n=c),h<i&&(i=h),u>r&&(r=u),c>a&&(a=c),h>o&&(o=h)}return this.min.set(t,n,i),this.max.set(r,a,o),this}},{key:"setFromBufferAttribute",value:function(e){for(var t=1/0,n=1/0,i=1/0,r=-1/0,a=-1/0,o=-1/0,s=0,l=e.count;s<l;s++){var u=e.getX(s),c=e.getY(s),h=e.getZ(s);u<t&&(t=u),c<n&&(n=c),h<i&&(i=h),u>r&&(r=u),c>a&&(a=c),h>o&&(o=h)}return this.min.set(t,n,i),this.max.set(r,a,o),this}},{key:"setFromPoints",value:function(e){this.makeEmpty();for(var t=0,n=e.length;t<n;t++)this.expandByPoint(e[t]);return this}},{key:"setFromCenterAndSize",value:function(e,t){var n=Yn.copy(t).multiplyScalar(.5);return this.min.copy(e).sub(n),this.max.copy(e).add(n),this}},{key:"setFromObject",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]&&arguments[1];return this.makeEmpty(),this.expandByObject(e,t)}},{key:"clone",value:function(){return(new this.constructor).copy(this)}},{key:"copy",value:function(e){return this.min.copy(e.min),this.max.copy(e.max),this}},{key:"makeEmpty",value:function(){return this.min.x=this.min.y=this.min.z=1/0,this.max.x=this.max.y=this.max.z=-1/0,this}},{key:"isEmpty",value:function(){return this.max.x<this.min.x||this.max.y<this.min.y||this.max.z<this.min.z}},{key:"getCenter",value:function(e){return this.isEmpty()?e.set(0,0,0):e.addVectors(this.min,this.max).multiplyScalar(.5)}},{key:"getSize",value:function(e){return this.isEmpty()?e.set(0,0,0):e.subVectors(this.max,this.min)}},{key:"expandByPoint",value:function(e){return this.min.min(e),this.max.max(e),this}},{key:"expandByVector",value:function(e){return this.min.sub(e),this.max.add(e),this}},{key:"expandByScalar",value:function(e){return this.min.addScalar(-e),this.max.addScalar(e),this}},{key:"expandByObject",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]&&arguments[1];e.updateWorldMatrix(!1,!1);var n=e.geometry;if(void 0!==n)if(t&&void 0!=n.attributes&&void 0!==n.attributes.position)for(var i=n.attributes.position,r=0,a=i.count;r<a;r++)Yn.fromBufferAttribute(i,r).applyMatrix4(e.matrixWorld),this.expandByPoint(Yn);else null===n.boundingBox&&n.computeBoundingBox(),Jn.copy(n.boundingBox),Jn.applyMatrix4(e.matrixWorld),this.union(Jn);for(var o=e.children,s=0,l=o.length;s<l;s++)this.expandByObject(o[s],t);return this}},{key:"containsPoint",value:function(e){return!(e.x<this.min.x||e.x>this.max.x||e.y<this.min.y||e.y>this.max.y||e.z<this.min.z||e.z>this.max.z)}},{key:"containsBox",value:function(e){return this.min.x<=e.min.x&&e.max.x<=this.max.x&&this.min.y<=e.min.y&&e.max.y<=this.max.y&&this.min.z<=e.min.z&&e.max.z<=this.max.z}},{key:"getParameter",value:function(e,t){return t.set((e.x-this.min.x)/(this.max.x-this.min.x),(e.y-this.min.y)/(this.max.y-this.min.y),(e.z-this.min.z)/(this.max.z-this.min.z))}},{key:"intersectsBox",value:function(e){return!(e.max.x<this.min.x||e.min.x>this.max.x||e.max.y<this.min.y||e.min.y>this.max.y||e.max.z<this.min.z||e.min.z>this.max.z)}},{key:"intersectsSphere",value:function(e){return this.clampPoint(e.center,Yn),Yn.distanceToSquared(e.center)<=e.radius*e.radius}},{key:"intersectsPlane",value:function(e){var t,n;return e.normal.x>0?(t=e.normal.x*this.min.x,n=e.normal.x*this.max.x):(t=e.normal.x*this.max.x,n=e.normal.x*this.min.x),e.normal.y>0?(t+=e.normal.y*this.min.y,n+=e.normal.y*this.max.y):(t+=e.normal.y*this.max.y,n+=e.normal.y*this.min.y),e.normal.z>0?(t+=e.normal.z*this.min.z,n+=e.normal.z*this.max.z):(t+=e.normal.z*this.max.z,n+=e.normal.z*this.min.z),t<=-e.constant&&n>=-e.constant}},{key:"intersectsTriangle",value:function(e){if(this.isEmpty())return!1;this.getCenter(ii),ri.subVectors(this.max,ii),Xn.subVectors(e.a,ii),Kn.subVectors(e.b,ii),$n.subVectors(e.c,ii),ei.subVectors(Kn,Xn),ti.subVectors($n,Kn),ni.subVectors(Xn,$n);var t=[0,-ei.z,ei.y,0,-ti.z,ti.y,0,-ni.z,ni.y,ei.z,0,-ei.x,ti.z,0,-ti.x,ni.z,0,-ni.x,-ei.y,ei.x,0,-ti.y,ti.x,0,-ni.y,ni.x,0];return!!si(t,Xn,Kn,$n,ri)&&(!!si(t=[1,0,0,0,1,0,0,0,1],Xn,Kn,$n,ri)&&(ai.crossVectors(ei,ti),si(t=[ai.x,ai.y,ai.z],Xn,Kn,$n,ri)))}},{key:"clampPoint",value:function(e,t){return t.copy(e).clamp(this.min,this.max)}},{key:"distanceToPoint",value:function(e){return Yn.copy(e).clamp(this.min,this.max).sub(e).length()}},{key:"getBoundingSphere",value:function(e){return this.getCenter(e.center),e.radius=.5*this.getSize(Yn).length(),e}},{key:"intersect",value:function(e){return this.min.max(e.min),this.max.min(e.max),this.isEmpty()&&this.makeEmpty(),this}},{key:"union",value:function(e){return this.min.min(e.min),this.max.max(e.max),this}},{key:"applyMatrix4",value:function(e){return this.isEmpty()||(qn[0].set(this.min.x,this.min.y,this.min.z).applyMatrix4(e),qn[1].set(this.min.x,this.min.y,this.max.z).applyMatrix4(e),qn[2].set(this.min.x,this.max.y,this.min.z).applyMatrix4(e),qn[3].set(this.min.x,this.max.y,this.max.z).applyMatrix4(e),qn[4].set(this.max.x,this.min.y,this.min.z).applyMatrix4(e),qn[5].set(this.max.x,this.min.y,this.max.z).applyMatrix4(e),qn[6].set(this.max.x,this.max.y,this.min.z).applyMatrix4(e),qn[7].set(this.max.x,this.max.y,this.max.z).applyMatrix4(e),this.setFromPoints(qn)),this}},{key:"translate",value:function(e){return this.min.add(e),this.max.add(e),this}},{key:"equals",value:function(e){return e.min.equals(this.min)&&e.max.equals(this.max)}}]),e}(),qn=[new Gn,new Gn,new Gn,new Gn,new Gn,new Gn,new Gn,new Gn],Yn=new Gn,Jn=new Wn,Xn=new Gn,Kn=new Gn,$n=new Gn,ei=new Gn,ti=new Gn,ni=new Gn,ii=new Gn,ri=new Gn,ai=new Gn,oi=new Gn;function si(e,t,n,i,r){for(var a=0,o=e.length-3;a<=o;a+=3){oi.fromArray(e,a);var s=r.x*Math.abs(oi.x)+r.y*Math.abs(oi.y)+r.z*Math.abs(oi.z),l=t.dot(oi),u=n.dot(oi),c=i.dot(oi);if(Math.max(-Math.max(l,u,c),Math.min(l,u,c))>s)return!1}return!0}var li=new Wn,ui=new Gn,ci=new Gn,hi=function(){function e(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:new Gn,n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:-1;(0,v.Z)(this,e),this.center=t,this.radius=n}return(0,g.Z)(e,[{key:"set",value:function(e,t){return this.center.copy(e),this.radius=t,this}},{key:"setFromPoints",value:function(e,t){var n=this.center;void 0!==t?n.copy(t):li.setFromPoints(e).getCenter(n);for(var i=0,r=0,a=e.length;r<a;r++)i=Math.max(i,n.distanceToSquared(e[r]));return this.radius=Math.sqrt(i),this}},{key:"copy",value:function(e){return this.center.copy(e.center),this.radius=e.radius,this}},{key:"isEmpty",value:function(){return this.radius<0}},{key:"makeEmpty",value:function(){return this.center.set(0,0,0),this.radius=-1,this}},{key:"containsPoint",value:function(e){return e.distanceToSquared(this.center)<=this.radius*this.radius}},{key:"distanceToPoint",value:function(e){return e.distanceTo(this.center)-this.radius}},{key:"intersectsSphere",value:function(e){var t=this.radius+e.radius;return e.center.distanceToSquared(this.center)<=t*t}},{key:"intersectsBox",value:function(e){return e.intersectsSphere(this)}},{key:"intersectsPlane",value:function(e){return Math.abs(e.distanceToPoint(this.center))<=this.radius}},{key:"clampPoint",value:function(e,t){var n=this.center.distanceToSquared(e);return t.copy(e),n>this.radius*this.radius&&(t.sub(this.center).normalize(),t.multiplyScalar(this.radius).add(this.center)),t}},{key:"getBoundingBox",value:function(e){return this.isEmpty()?(e.makeEmpty(),e):(e.set(this.center,this.center),e.expandByScalar(this.radius),e)}},{key:"applyMatrix4",value:function(e){return this.center.applyMatrix4(e),this.radius=this.radius*e.getMaxScaleOnAxis(),this}},{key:"translate",value:function(e){return this.center.add(e),this}},{key:"expandByPoint",value:function(e){if(this.isEmpty())return this.center.copy(e),this.radius=0,this;ui.subVectors(e,this.center);var t=ui.lengthSq();if(t>this.radius*this.radius){var n=Math.sqrt(t),i=.5*(n-this.radius);this.center.addScaledVector(ui,i/n),this.radius+=i}return this}},{key:"union",value:function(e){return e.isEmpty()?this:this.isEmpty()?(this.copy(e),this):(!0===this.center.equals(e.center)?this.radius=Math.max(this.radius,e.radius):(ci.subVectors(e.center,this.center).setLength(e.radius),this.expandByPoint(ui.copy(e.center).add(ci)),this.expandByPoint(ui.copy(e.center).sub(ci))),this)}},{key:"equals",value:function(e){return e.center.equals(this.center)&&e.radius===this.radius}},{key:"clone",value:function(){return(new this.constructor).copy(this)}}]),e}(),di=new Gn,fi=new Gn,pi=new Gn,Ai=new Gn,vi=new Gn,gi=new Gn,mi=new Gn,yi=function(){function e(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:new Gn,n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:new Gn(0,0,-1);(0,v.Z)(this,e),this.origin=t,this.direction=n}return(0,g.Z)(e,[{key:"set",value:function(e,t){return this.origin.copy(e),this.direction.copy(t),this}},{key:"copy",value:function(e){return this.origin.copy(e.origin),this.direction.copy(e.direction),this}},{key:"at",value:function(e,t){return t.copy(this.direction).multiplyScalar(e).add(this.origin)}},{key:"lookAt",value:function(e){return this.direction.copy(e).sub(this.origin).normalize(),this}},{key:"recast",value:function(e){return this.origin.copy(this.at(e,di)),this}},{key:"closestPointToPoint",value:function(e,t){t.subVectors(e,this.origin);var n=t.dot(this.direction);return n<0?t.copy(this.origin):t.copy(this.direction).multiplyScalar(n).add(this.origin)}},{key:"distanceToPoint",value:function(e){return Math.sqrt(this.distanceSqToPoint(e))}},{key:"distanceSqToPoint",value:function(e){var t=di.subVectors(e,this.origin).dot(this.direction);return t<0?this.origin.distanceToSquared(e):(di.copy(this.direction).multiplyScalar(t).add(this.origin),di.distanceToSquared(e))}},{key:"distanceSqToSegment",value:function(e,t,n,i){fi.copy(e).add(t).multiplyScalar(.5),pi.copy(t).sub(e).normalize(),Ai.copy(this.origin).sub(fi);var r,a,o,s,l=.5*e.distanceTo(t),u=-this.direction.dot(pi),c=Ai.dot(this.direction),h=-Ai.dot(pi),d=Ai.lengthSq(),f=Math.abs(1-u*u);if(f>0)if(a=u*c-h,s=l*f,(r=u*h-c)>=0)if(a>=-s)if(a<=s){var p=1/f;o=(r*=p)*(r+u*(a*=p)+2*c)+a*(u*r+a+2*h)+d}else a=l,o=-(r=Math.max(0,-(u*a+c)))*r+a*(a+2*h)+d;else a=-l,o=-(r=Math.max(0,-(u*a+c)))*r+a*(a+2*h)+d;else a<=-s?o=-(r=Math.max(0,-(-u*l+c)))*r+(a=r>0?-l:Math.min(Math.max(-l,-h),l))*(a+2*h)+d:a<=s?(r=0,o=(a=Math.min(Math.max(-l,-h),l))*(a+2*h)+d):o=-(r=Math.max(0,-(u*l+c)))*r+(a=r>0?l:Math.min(Math.max(-l,-h),l))*(a+2*h)+d;else a=u>0?-l:l,o=-(r=Math.max(0,-(u*a+c)))*r+a*(a+2*h)+d;return n&&n.copy(this.direction).multiplyScalar(r).add(this.origin),i&&i.copy(pi).multiplyScalar(a).add(fi),o}},{key:"intersectSphere",value:function(e,t){di.subVectors(e.center,this.origin);var n=di.dot(this.direction),i=di.dot(di)-n*n,r=e.radius*e.radius;if(i>r)return null;var a=Math.sqrt(r-i),o=n-a,s=n+a;return o<0&&s<0?null:o<0?this.at(s,t):this.at(o,t)}},{key:"intersectsSphere",value:function(e){return this.distanceSqToPoint(e.center)<=e.radius*e.radius}},{key:"distanceToPlane",value:function(e){var t=e.normal.dot(this.direction);if(0===t)return 0===e.distanceToPoint(this.origin)?0:null;var n=-(this.origin.dot(e.normal)+e.constant)/t;return n>=0?n:null}},{key:"intersectPlane",value:function(e,t){var n=this.distanceToPlane(e);return null===n?null:this.at(n,t)}},{key:"intersectsPlane",value:function(e){var t=e.distanceToPoint(this.origin);return 0===t||e.normal.dot(this.direction)*t<0}},{key:"intersectBox",value:function(e,t){var n,i,r,a,o,s,l=1/this.direction.x,u=1/this.direction.y,c=1/this.direction.z,h=this.origin;return l>=0?(n=(e.min.x-h.x)*l,i=(e.max.x-h.x)*l):(n=(e.max.x-h.x)*l,i=(e.min.x-h.x)*l),u>=0?(r=(e.min.y-h.y)*u,a=(e.max.y-h.y)*u):(r=(e.max.y-h.y)*u,a=(e.min.y-h.y)*u),n>a||r>i?null:((r>n||isNaN(n))&&(n=r),(a<i||isNaN(i))&&(i=a),c>=0?(o=(e.min.z-h.z)*c,s=(e.max.z-h.z)*c):(o=(e.max.z-h.z)*c,s=(e.min.z-h.z)*c),n>s||o>i?null:((o>n||n!==n)&&(n=o),(s<i||i!==i)&&(i=s),i<0?null:this.at(n>=0?n:i,t)))}},{key:"intersectsBox",value:function(e){return null!==this.intersectBox(e,di)}},{key:"intersectTriangle",value:function(e,t,n,i,r){vi.subVectors(t,e),gi.subVectors(n,e),mi.crossVectors(vi,gi);var a,o=this.direction.dot(mi);if(o>0){if(i)return null;a=1}else{if(!(o<0))return null;a=-1,o=-o}Ai.subVectors(this.origin,e);var s=a*this.direction.dot(gi.crossVectors(Ai,gi));if(s<0)return null;var l=a*this.direction.dot(vi.cross(Ai));if(l<0)return null;if(s+l>o)return null;var u=-a*Ai.dot(mi);return u<0?null:this.at(u/o,r)}},{key:"applyMatrix4",value:function(e){return this.origin.applyMatrix4(e),this.direction.transformDirection(e),this}},{key:"equals",value:function(e){return e.origin.equals(this.origin)&&e.direction.equals(this.direction)}},{key:"clone",value:function(){return(new this.constructor).copy(this)}}]),e}(),xi=function(){function e(){(0,v.Z)(this,e),e.prototype.isMatrix4=!0,this.elements=[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1]}return(0,g.Z)(e,[{key:"set",value:function(e,t,n,i,r,a,o,s,l,u,c,h,d,f,p,A){var v=this.elements;return v[0]=e,v[4]=t,v[8]=n,v[12]=i,v[1]=r,v[5]=a,v[9]=o,v[13]=s,v[2]=l,v[6]=u,v[10]=c,v[14]=h,v[3]=d,v[7]=f,v[11]=p,v[15]=A,this}},{key:"identity",value:function(){return this.set(1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1),this}},{key:"clone",value:function(){return(new e).fromArray(this.elements)}},{key:"copy",value:function(e){var t=this.elements,n=e.elements;return t[0]=n[0],t[1]=n[1],t[2]=n[2],t[3]=n[3],t[4]=n[4],t[5]=n[5],t[6]=n[6],t[7]=n[7],t[8]=n[8],t[9]=n[9],t[10]=n[10],t[11]=n[11],t[12]=n[12],t[13]=n[13],t[14]=n[14],t[15]=n[15],this}},{key:"copyPosition",value:function(e){var t=this.elements,n=e.elements;return t[12]=n[12],t[13]=n[13],t[14]=n[14],this}},{key:"setFromMatrix3",value:function(e){var t=e.elements;return this.set(t[0],t[3],t[6],0,t[1],t[4],t[7],0,t[2],t[5],t[8],0,0,0,0,1),this}},{key:"extractBasis",value:function(e,t,n){return e.setFromMatrixColumn(this,0),t.setFromMatrixColumn(this,1),n.setFromMatrixColumn(this,2),this}},{key:"makeBasis",value:function(e,t,n){return this.set(e.x,t.x,n.x,0,e.y,t.y,n.y,0,e.z,t.z,n.z,0,0,0,0,1),this}},{key:"extractRotation",value:function(e){var t=this.elements,n=e.elements,i=1/wi.setFromMatrixColumn(e,0).length(),r=1/wi.setFromMatrixColumn(e,1).length(),a=1/wi.setFromMatrixColumn(e,2).length();return t[0]=n[0]*i,t[1]=n[1]*i,t[2]=n[2]*i,t[3]=0,t[4]=n[4]*r,t[5]=n[5]*r,t[6]=n[6]*r,t[7]=0,t[8]=n[8]*a,t[9]=n[9]*a,t[10]=n[10]*a,t[11]=0,t[12]=0,t[13]=0,t[14]=0,t[15]=1,this}},{key:"makeRotationFromEuler",value:function(e){var t=this.elements,n=e.x,i=e.y,r=e.z,a=Math.cos(n),o=Math.sin(n),s=Math.cos(i),l=Math.sin(i),u=Math.cos(r),c=Math.sin(r);if("XYZ"===e.order){var h=a*u,d=a*c,f=o*u,p=o*c;t[0]=s*u,t[4]=-s*c,t[8]=l,t[1]=d+f*l,t[5]=h-p*l,t[9]=-o*s,t[2]=p-h*l,t[6]=f+d*l,t[10]=a*s}else if("YXZ"===e.order){var A=s*u,v=s*c,g=l*u,m=l*c;t[0]=A+m*o,t[4]=g*o-v,t[8]=a*l,t[1]=a*c,t[5]=a*u,t[9]=-o,t[2]=v*o-g,t[6]=m+A*o,t[10]=a*s}else if("ZXY"===e.order){var y=s*u,x=s*c,w=l*u,C=l*c;t[0]=y-C*o,t[4]=-a*c,t[8]=w+x*o,t[1]=x+w*o,t[5]=a*u,t[9]=C-y*o,t[2]=-a*l,t[6]=o,t[10]=a*s}else if("ZYX"===e.order){var b=a*u,_=a*c,E=o*u,M=o*c;t[0]=s*u,t[4]=E*l-_,t[8]=b*l+M,t[1]=s*c,t[5]=M*l+b,t[9]=_*l-E,t[2]=-l,t[6]=o*s,t[10]=a*s}else if("YZX"===e.order){var I=a*s,S=a*l,k=o*s,B=o*l;t[0]=s*u,t[4]=B-I*c,t[8]=k*c+S,t[1]=c,t[5]=a*u,t[9]=-o*u,t[2]=-l*u,t[6]=S*c+k,t[10]=I-B*c}else if("XZY"===e.order){var T=a*s,D=a*l,R=o*s,P=o*l;t[0]=s*u,t[4]=-c,t[8]=l*u,t[1]=T*c+P,t[5]=a*u,t[9]=D*c-R,t[2]=R*c-D,t[6]=o*u,t[10]=P*c+T}return t[3]=0,t[7]=0,t[11]=0,t[12]=0,t[13]=0,t[14]=0,t[15]=1,this}},{key:"makeRotationFromQuaternion",value:function(e){return this.compose(bi,e,_i)}},{key:"lookAt",value:function(e,t,n){var i=this.elements;return Ii.subVectors(e,t),0===Ii.lengthSq()&&(Ii.z=1),Ii.normalize(),Ei.crossVectors(n,Ii),0===Ei.lengthSq()&&(1===Math.abs(n.z)?Ii.x+=1e-4:Ii.z+=1e-4,Ii.normalize(),Ei.crossVectors(n,Ii)),Ei.normalize(),Mi.crossVectors(Ii,Ei),i[0]=Ei.x,i[4]=Mi.x,i[8]=Ii.x,i[1]=Ei.y,i[5]=Mi.y,i[9]=Ii.y,i[2]=Ei.z,i[6]=Mi.z,i[10]=Ii.z,this}},{key:"multiply",value:function(e){return this.multiplyMatrices(this,e)}},{key:"premultiply",value:function(e){return this.multiplyMatrices(e,this)}},{key:"multiplyMatrices",value:function(e,t){var n=e.elements,i=t.elements,r=this.elements,a=n[0],o=n[4],s=n[8],l=n[12],u=n[1],c=n[5],h=n[9],d=n[13],f=n[2],p=n[6],A=n[10],v=n[14],g=n[3],m=n[7],y=n[11],x=n[15],w=i[0],C=i[4],b=i[8],_=i[12],E=i[1],M=i[5],I=i[9],S=i[13],k=i[2],B=i[6],T=i[10],D=i[14],R=i[3],P=i[7],L=i[11],Q=i[15];return r[0]=a*w+o*E+s*k+l*R,r[4]=a*C+o*M+s*B+l*P,r[8]=a*b+o*I+s*T+l*L,r[12]=a*_+o*S+s*D+l*Q,r[1]=u*w+c*E+h*k+d*R,r[5]=u*C+c*M+h*B+d*P,r[9]=u*b+c*I+h*T+d*L,r[13]=u*_+c*S+h*D+d*Q,r[2]=f*w+p*E+A*k+v*R,r[6]=f*C+p*M+A*B+v*P,r[10]=f*b+p*I+A*T+v*L,r[14]=f*_+p*S+A*D+v*Q,r[3]=g*w+m*E+y*k+x*R,r[7]=g*C+m*M+y*B+x*P,r[11]=g*b+m*I+y*T+x*L,r[15]=g*_+m*S+y*D+x*Q,this}},{key:"multiplyScalar",value:function(e){var t=this.elements;return t[0]*=e,t[4]*=e,t[8]*=e,t[12]*=e,t[1]*=e,t[5]*=e,t[9]*=e,t[13]*=e,t[2]*=e,t[6]*=e,t[10]*=e,t[14]*=e,t[3]*=e,t[7]*=e,t[11]*=e,t[15]*=e,this}},{key:"determinant",value:function(){var e=this.elements,t=e[0],n=e[4],i=e[8],r=e[12],a=e[1],o=e[5],s=e[9],l=e[13],u=e[2],c=e[6],h=e[10],d=e[14];return e[3]*(+r*s*c-i*l*c-r*o*h+n*l*h+i*o*d-n*s*d)+e[7]*(+t*s*d-t*l*h+r*a*h-i*a*d+i*l*u-r*s*u)+e[11]*(+t*l*c-t*o*d-r*a*c+n*a*d+r*o*u-n*l*u)+e[15]*(-i*o*u-t*s*c+t*o*h+i*a*c-n*a*h+n*s*u)}},{key:"transpose",value:function(){var e,t=this.elements;return e=t[1],t[1]=t[4],t[4]=e,e=t[2],t[2]=t[8],t[8]=e,e=t[6],t[6]=t[9],t[9]=e,e=t[3],t[3]=t[12],t[12]=e,e=t[7],t[7]=t[13],t[13]=e,e=t[11],t[11]=t[14],t[14]=e,this}},{key:"setPosition",value:function(e,t,n){var i=this.elements;return e.isVector3?(i[12]=e.x,i[13]=e.y,i[14]=e.z):(i[12]=e,i[13]=t,i[14]=n),this}},{key:"invert",value:function(){var e=this.elements,t=e[0],n=e[1],i=e[2],r=e[3],a=e[4],o=e[5],s=e[6],l=e[7],u=e[8],c=e[9],h=e[10],d=e[11],f=e[12],p=e[13],A=e[14],v=e[15],g=c*A*l-p*h*l+p*s*d-o*A*d-c*s*v+o*h*v,m=f*h*l-u*A*l-f*s*d+a*A*d+u*s*v-a*h*v,y=u*p*l-f*c*l+f*o*d-a*p*d-u*o*v+a*c*v,x=f*c*s-u*p*s-f*o*h+a*p*h+u*o*A-a*c*A,w=t*g+n*m+i*y+r*x;if(0===w)return this.set(0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0);var C=1/w;return e[0]=g*C,e[1]=(p*h*r-c*A*r-p*i*d+n*A*d+c*i*v-n*h*v)*C,e[2]=(o*A*r-p*s*r+p*i*l-n*A*l-o*i*v+n*s*v)*C,e[3]=(c*s*r-o*h*r-c*i*l+n*h*l+o*i*d-n*s*d)*C,e[4]=m*C,e[5]=(u*A*r-f*h*r+f*i*d-t*A*d-u*i*v+t*h*v)*C,e[6]=(f*s*r-a*A*r-f*i*l+t*A*l+a*i*v-t*s*v)*C,e[7]=(a*h*r-u*s*r+u*i*l-t*h*l-a*i*d+t*s*d)*C,e[8]=y*C,e[9]=(f*c*r-u*p*r-f*n*d+t*p*d+u*n*v-t*c*v)*C,e[10]=(a*p*r-f*o*r+f*n*l-t*p*l-a*n*v+t*o*v)*C,e[11]=(u*o*r-a*c*r-u*n*l+t*c*l+a*n*d-t*o*d)*C,e[12]=x*C,e[13]=(u*p*i-f*c*i+f*n*h-t*p*h-u*n*A+t*c*A)*C,e[14]=(f*o*i-a*p*i-f*n*s+t*p*s+a*n*A-t*o*A)*C,e[15]=(a*c*i-u*o*i+u*n*s-t*c*s-a*n*h+t*o*h)*C,this}},{key:"scale",value:function(e){var t=this.elements,n=e.x,i=e.y,r=e.z;return t[0]*=n,t[4]*=i,t[8]*=r,t[1]*=n,t[5]*=i,t[9]*=r,t[2]*=n,t[6]*=i,t[10]*=r,t[3]*=n,t[7]*=i,t[11]*=r,this}},{key:"getMaxScaleOnAxis",value:function(){var e=this.elements,t=e[0]*e[0]+e[1]*e[1]+e[2]*e[2],n=e[4]*e[4]+e[5]*e[5]+e[6]*e[6],i=e[8]*e[8]+e[9]*e[9]+e[10]*e[10];return Math.sqrt(Math.max(t,n,i))}},{key:"makeTranslation",value:function(e,t,n){return this.set(1,0,0,e,0,1,0,t,0,0,1,n,0,0,0,1),this}},{key:"makeRotationX",value:function(e){var t=Math.cos(e),n=Math.sin(e);return this.set(1,0,0,0,0,t,-n,0,0,n,t,0,0,0,0,1),this}},{key:"makeRotationY",value:function(e){var t=Math.cos(e),n=Math.sin(e);return this.set(t,0,n,0,0,1,0,0,-n,0,t,0,0,0,0,1),this}},{key:"makeRotationZ",value:function(e){var t=Math.cos(e),n=Math.sin(e);return this.set(t,-n,0,0,n,t,0,0,0,0,1,0,0,0,0,1),this}},{key:"makeRotationAxis",value:function(e,t){var n=Math.cos(t),i=Math.sin(t),r=1-n,a=e.x,o=e.y,s=e.z,l=r*a,u=r*o;return this.set(l*a+n,l*o-i*s,l*s+i*o,0,l*o+i*s,u*o+n,u*s-i*a,0,l*s-i*o,u*s+i*a,r*s*s+n,0,0,0,0,1),this}},{key:"makeScale",value:function(e,t,n){return this.set(e,0,0,0,0,t,0,0,0,0,n,0,0,0,0,1),this}},{key:"makeShear",value:function(e,t,n,i,r,a){return this.set(1,n,r,0,e,1,a,0,t,i,1,0,0,0,0,1),this}},{key:"compose",value:function(e,t,n){var i=this.elements,r=t._x,a=t._y,o=t._z,s=t._w,l=r+r,u=a+a,c=o+o,h=r*l,d=r*u,f=r*c,p=a*u,A=a*c,v=o*c,g=s*l,m=s*u,y=s*c,x=n.x,w=n.y,C=n.z;return i[0]=(1-(p+v))*x,i[1]=(d+y)*x,i[2]=(f-m)*x,i[3]=0,i[4]=(d-y)*w,i[5]=(1-(h+v))*w,i[6]=(A+g)*w,i[7]=0,i[8]=(f+m)*C,i[9]=(A-g)*C,i[10]=(1-(h+p))*C,i[11]=0,i[12]=e.x,i[13]=e.y,i[14]=e.z,i[15]=1,this}},{key:"decompose",value:function(e,t,n){var i=this.elements,r=wi.set(i[0],i[1],i[2]).length(),a=wi.set(i[4],i[5],i[6]).length(),o=wi.set(i[8],i[9],i[10]).length();this.determinant()<0&&(r=-r),e.x=i[12],e.y=i[13],e.z=i[14],Ci.copy(this);var s=1/r,l=1/a,u=1/o;return Ci.elements[0]*=s,Ci.elements[1]*=s,Ci.elements[2]*=s,Ci.elements[4]*=l,Ci.elements[5]*=l,Ci.elements[6]*=l,Ci.elements[8]*=u,Ci.elements[9]*=u,Ci.elements[10]*=u,t.setFromRotationMatrix(Ci),n.x=r,n.y=a,n.z=o,this}},{key:"makePerspective",value:function(e,t,n,i,r,a){var o=this.elements,s=2*r/(t-e),l=2*r/(n-i),u=(t+e)/(t-e),c=(n+i)/(n-i),h=-(a+r)/(a-r),d=-2*a*r/(a-r);return o[0]=s,o[4]=0,o[8]=u,o[12]=0,o[1]=0,o[5]=l,o[9]=c,o[13]=0,o[2]=0,o[6]=0,o[10]=h,o[14]=d,o[3]=0,o[7]=0,o[11]=-1,o[15]=0,this}},{key:"makeOrthographic",value:function(e,t,n,i,r,a){var o=this.elements,s=1/(t-e),l=1/(n-i),u=1/(a-r),c=(t+e)*s,h=(n+i)*l,d=(a+r)*u;return o[0]=2*s,o[4]=0,o[8]=0,o[12]=-c,o[1]=0,o[5]=2*l,o[9]=0,o[13]=-h,o[2]=0,o[6]=0,o[10]=-2*u,o[14]=-d,o[3]=0,o[7]=0,o[11]=0,o[15]=1,this}},{key:"equals",value:function(e){for(var t=this.elements,n=e.elements,i=0;i<16;i++)if(t[i]!==n[i])return!1;return!0}},{key:"fromArray",value:function(e){for(var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,n=0;n<16;n++)this.elements[n]=e[n+t];return this}},{key:"toArray",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[],t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,n=this.elements;return e[t]=n[0],e[t+1]=n[1],e[t+2]=n[2],e[t+3]=n[3],e[t+4]=n[4],e[t+5]=n[5],e[t+6]=n[6],e[t+7]=n[7],e[t+8]=n[8],e[t+9]=n[9],e[t+10]=n[10],e[t+11]=n[11],e[t+12]=n[12],e[t+13]=n[13],e[t+14]=n[14],e[t+15]=n[15],e}}]),e}(),wi=new Gn,Ci=new xi,bi=new Gn(0,0,0),_i=new Gn(1,1,1),Ei=new Gn,Mi=new Gn,Ii=new Gn,Si=new xi,ki=new zn,Bi=function(e){function t(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0,r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:t.DEFAULT_ORDER;(0,v.Z)(this,t),this.isEuler=!0,this._x=e,this._y=n,this._z=i,this._order=r}return(0,g.Z)(t,[{key:"x",get:function(){return this._x},set:function(e){this._x=e,this._onChangeCallback()}},{key:"y",get:function(){return this._y},set:function(e){this._y=e,this._onChangeCallback()}},{key:"z",get:function(){return this._z},set:function(e){this._z=e,this._onChangeCallback()}},{key:"order",get:function(){return this._order},set:function(e){this._order=e,this._onChangeCallback()}},{key:"set",value:function(e,t,n){var i=arguments.length>3&&void 0!==arguments[3]?arguments[3]:this._order;return this._x=e,this._y=t,this._z=n,this._order=i,this._onChangeCallback(),this}},{key:"clone",value:function(){return new this.constructor(this._x,this._y,this._z,this._order)}},{key:"copy",value:function(e){return this._x=e._x,this._y=e._y,this._z=e._z,this._order=e._order,this._onChangeCallback(),this}},{key:"setFromRotationMatrix",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:this._order,n=!(arguments.length>2&&void 0!==arguments[2])||arguments[2],i=e.elements,r=i[0],a=i[4],o=i[8],s=i[1],l=i[5],u=i[9],c=i[2],h=i[6],d=i[10];switch(t){case"XYZ":this._y=Math.asin(on(o,-1,1)),Math.abs(o)<.9999999?(this._x=Math.atan2(-u,d),this._z=Math.atan2(-a,r)):(this._x=Math.atan2(h,l),this._z=0);break;case"YXZ":this._x=Math.asin(-on(u,-1,1)),Math.abs(u)<.9999999?(this._y=Math.atan2(o,d),this._z=Math.atan2(s,l)):(this._y=Math.atan2(-c,r),this._z=0);break;case"ZXY":this._x=Math.asin(on(h,-1,1)),Math.abs(h)<.9999999?(this._y=Math.atan2(-c,d),this._z=Math.atan2(-a,l)):(this._y=0,this._z=Math.atan2(s,r));break;case"ZYX":this._y=Math.asin(-on(c,-1,1)),Math.abs(c)<.9999999?(this._x=Math.atan2(h,d),this._z=Math.atan2(s,r)):(this._x=0,this._z=Math.atan2(-a,l));break;case"YZX":this._z=Math.asin(on(s,-1,1)),Math.abs(s)<.9999999?(this._x=Math.atan2(-u,l),this._y=Math.atan2(-c,r)):(this._x=0,this._y=Math.atan2(o,d));break;case"XZY":this._z=Math.asin(-on(a,-1,1)),Math.abs(a)<.9999999?(this._x=Math.atan2(h,l),this._y=Math.atan2(o,r)):(this._x=Math.atan2(-u,d),this._y=0);break;default:console.warn("THREE.Euler: .setFromRotationMatrix() encountered an unknown order: "+t)}return this._order=t,!0===n&&this._onChangeCallback(),this}},{key:"setFromQuaternion",value:function(e,t,n){return Si.makeRotationFromQuaternion(e),this.setFromRotationMatrix(Si,t,n)}},{key:"setFromVector3",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:this._order;return this.set(e.x,e.y,e.z,t)}},{key:"reorder",value:function(e){return ki.setFromEuler(this),this.setFromQuaternion(ki,e)}},{key:"equals",value:function(e){return e._x===this._x&&e._y===this._y&&e._z===this._z&&e._order===this._order}},{key:"fromArray",value:function(e){return this._x=e[0],this._y=e[1],this._z=e[2],void 0!==e[3]&&(this._order=e[3]),this._onChangeCallback(),this}},{key:"toArray",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[],t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;return e[t]=this._x,e[t+1]=this._y,e[t+2]=this._z,e[t+3]=this._order,e}},{key:"_onChange",value:function(e){return this._onChangeCallback=e,this}},{key:"_onChangeCallback",value:function(){}},{key:e,value:(0,A.Z)().mark((function e(){return(0,A.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this._x;case 2:return e.next=4,this._y;case 4:return e.next=6,this._z;case 6:return e.next=8,this._order;case 8:case"end":return e.stop()}}),e,this)}))}]),t}(Symbol.iterator);Bi.DEFAULT_ORDER="XYZ";var Ti=function(){function e(){(0,v.Z)(this,e),this.mask=1}return(0,g.Z)(e,[{key:"set",value:function(e){this.mask=(1<<e|0)>>>0}},{key:"enable",value:function(e){this.mask|=1<<e|0}},{key:"enableAll",value:function(){this.mask=-1}},{key:"toggle",value:function(e){this.mask^=1<<e|0}},{key:"disable",value:function(e){this.mask&=~(1<<e|0)}},{key:"disableAll",value:function(){this.mask=0}},{key:"test",value:function(e){return 0!==(this.mask&e.mask)}},{key:"isEnabled",value:function(e){return 0!==(this.mask&(1<<e|0))}}]),e}(),Di=0,Ri=new Gn,Pi=new zn,Li=new xi,Qi=new Gn,Zi=new Gn,Ni=new Gn,Fi=new zn,Ui=new Gn(1,0,0),ji=new Gn(0,1,0),Oi=new Gn(0,0,1),zi={type:"added"},Gi={type:"removed"},Hi=function(e){(0,d.Z)(n,e);var t=(0,f.Z)(n);function n(){var e;(0,v.Z)(this,n),(e=t.call(this)).isObject3D=!0,Object.defineProperty((0,h.Z)(e),"id",{value:Di++}),e.uuid=an(),e.name="",e.type="Object3D",e.parent=null,e.children=[],e.up=n.DEFAULT_UP.clone();var i=new Gn,r=new Bi,a=new zn,o=new Gn(1,1,1);return r._onChange((function(){a.setFromEuler(r,!1)})),a._onChange((function(){r.setFromQuaternion(a,void 0,!1)})),Object.defineProperties((0,h.Z)(e),{position:{configurable:!0,enumerable:!0,value:i},rotation:{configurable:!0,enumerable:!0,value:r},quaternion:{configurable:!0,enumerable:!0,value:a},scale:{configurable:!0,enumerable:!0,value:o},modelViewMatrix:{value:new xi},normalMatrix:{value:new vn}}),e.matrix=new xi,e.matrixWorld=new xi,e.matrixAutoUpdate=n.DEFAULT_MATRIX_AUTO_UPDATE,e.matrixWorldNeedsUpdate=!1,e.matrixWorldAutoUpdate=n.DEFAULT_MATRIX_WORLD_AUTO_UPDATE,e.layers=new Ti,e.visible=!0,e.castShadow=!1,e.receiveShadow=!1,e.frustumCulled=!0,e.renderOrder=0,e.animations=[],e.userData={},e}return(0,g.Z)(n,[{key:"onBeforeRender",value:function(){}},{key:"onAfterRender",value:function(){}},{key:"applyMatrix4",value:function(e){this.matrixAutoUpdate&&this.updateMatrix(),this.matrix.premultiply(e),this.matrix.decompose(this.position,this.quaternion,this.scale)}},{key:"applyQuaternion",value:function(e){return this.quaternion.premultiply(e),this}},{key:"setRotationFromAxisAngle",value:function(e,t){this.quaternion.setFromAxisAngle(e,t)}},{key:"setRotationFromEuler",value:function(e){this.quaternion.setFromEuler(e,!0)}},{key:"setRotationFromMatrix",value:function(e){this.quaternion.setFromRotationMatrix(e)}},{key:"setRotationFromQuaternion",value:function(e){this.quaternion.copy(e)}},{key:"rotateOnAxis",value:function(e,t){return Pi.setFromAxisAngle(e,t),this.quaternion.multiply(Pi),this}},{key:"rotateOnWorldAxis",value:function(e,t){return Pi.setFromAxisAngle(e,t),this.quaternion.premultiply(Pi),this}},{key:"rotateX",value:function(e){return this.rotateOnAxis(Ui,e)}},{key:"rotateY",value:function(e){return this.rotateOnAxis(ji,e)}},{key:"rotateZ",value:function(e){return this.rotateOnAxis(Oi,e)}},{key:"translateOnAxis",value:function(e,t){return Ri.copy(e).applyQuaternion(this.quaternion),this.position.add(Ri.multiplyScalar(t)),this}},{key:"translateX",value:function(e){return this.translateOnAxis(Ui,e)}},{key:"translateY",value:function(e){return this.translateOnAxis(ji,e)}},{key:"translateZ",value:function(e){return this.translateOnAxis(Oi,e)}},{key:"localToWorld",value:function(e){return this.updateWorldMatrix(!0,!1),e.applyMatrix4(this.matrixWorld)}},{key:"worldToLocal",value:function(e){return this.updateWorldMatrix(!0,!1),e.applyMatrix4(Li.copy(this.matrixWorld).invert())}},{key:"lookAt",value:function(e,t,n){e.isVector3?Qi.copy(e):Qi.set(e,t,n);var i=this.parent;this.updateWorldMatrix(!0,!1),Zi.setFromMatrixPosition(this.matrixWorld),this.isCamera||this.isLight?Li.lookAt(Zi,Qi,this.up):Li.lookAt(Qi,Zi,this.up),this.quaternion.setFromRotationMatrix(Li),i&&(Li.extractRotation(i.matrixWorld),Pi.setFromRotationMatrix(Li),this.quaternion.premultiply(Pi.invert()))}},{key:"add",value:function(e){if(arguments.length>1){for(var t=0;t<arguments.length;t++)this.add(arguments[t]);return this}return e===this?(console.error("THREE.Object3D.add: object can't be added as a child of itself.",e),this):(e&&e.isObject3D?(null!==e.parent&&e.parent.remove(e),e.parent=this,this.children.push(e),e.dispatchEvent(zi)):console.error("THREE.Object3D.add: object not an instance of THREE.Object3D.",e),this)}},{key:"remove",value:function(e){if(arguments.length>1){for(var t=0;t<arguments.length;t++)this.remove(arguments[t]);return this}var n=this.children.indexOf(e);return-1!==n&&(e.parent=null,this.children.splice(n,1),e.dispatchEvent(Gi)),this}},{key:"removeFromParent",value:function(){var e=this.parent;return null!==e&&e.remove(this),this}},{key:"clear",value:function(){for(var e=0;e<this.children.length;e++){var t=this.children[e];t.parent=null,t.dispatchEvent(Gi)}return this.children.length=0,this}},{key:"attach",value:function(e){return this.updateWorldMatrix(!0,!1),Li.copy(this.matrixWorld).invert(),null!==e.parent&&(e.parent.updateWorldMatrix(!0,!1),Li.multiply(e.parent.matrixWorld)),e.applyMatrix4(Li),this.add(e),e.updateWorldMatrix(!1,!0),this}},{key:"getObjectById",value:function(e){return this.getObjectByProperty("id",e)}},{key:"getObjectByName",value:function(e){return this.getObjectByProperty("name",e)}},{key:"getObjectByProperty",value:function(e,t){if(this[e]===t)return this;for(var n=0,i=this.children.length;n<i;n++){var r=this.children[n].getObjectByProperty(e,t);if(void 0!==r)return r}}},{key:"getObjectsByProperty",value:function(e,t){var n=[];this[e]===t&&n.push(this);for(var i=0,r=this.children.length;i<r;i++){var a=this.children[i].getObjectsByProperty(e,t);a.length>0&&(n=n.concat(a))}return n}},{key:"getWorldPosition",value:function(e){return this.updateWorldMatrix(!0,!1),e.setFromMatrixPosition(this.matrixWorld)}},{key:"getWorldQuaternion",value:function(e){return this.updateWorldMatrix(!0,!1),this.matrixWorld.decompose(Zi,e,Ni),e}},{key:"getWorldScale",value:function(e){return this.updateWorldMatrix(!0,!1),this.matrixWorld.decompose(Zi,Fi,e),e}},{key:"getWorldDirection",value:function(e){this.updateWorldMatrix(!0,!1);var t=this.matrixWorld.elements;return e.set(t[8],t[9],t[10]).normalize()}},{key:"raycast",value:function(){}},{key:"traverse",value:function(e){e(this);for(var t=this.children,n=0,i=t.length;n<i;n++)t[n].traverse(e)}},{key:"traverseVisible",value:function(e){if(!1!==this.visible){e(this);for(var t=this.children,n=0,i=t.length;n<i;n++)t[n].traverseVisible(e)}}},{key:"traverseAncestors",value:function(e){var t=this.parent;null!==t&&(e(t),t.traverseAncestors(e))}},{key:"updateMatrix",value:function(){this.matrix.compose(this.position,this.quaternion,this.scale),this.matrixWorldNeedsUpdate=!0}},{key:"updateMatrixWorld",value:function(e){this.matrixAutoUpdate&&this.updateMatrix(),(this.matrixWorldNeedsUpdate||e)&&(null===this.parent?this.matrixWorld.copy(this.matrix):this.matrixWorld.multiplyMatrices(this.parent.matrixWorld,this.matrix),this.matrixWorldNeedsUpdate=!1,e=!0);for(var t=this.children,n=0,i=t.length;n<i;n++){var r=t[n];!0!==r.matrixWorldAutoUpdate&&!0!==e||r.updateMatrixWorld(e)}}},{key:"updateWorldMatrix",value:function(e,t){var n=this.parent;if(!0===e&&null!==n&&!0===n.matrixWorldAutoUpdate&&n.updateWorldMatrix(!0,!1),this.matrixAutoUpdate&&this.updateMatrix(),null===this.parent?this.matrixWorld.copy(this.matrix):this.matrixWorld.multiplyMatrices(this.parent.matrixWorld,this.matrix),!0===t)for(var i=this.children,r=0,a=i.length;r<a;r++){var o=i[r];!0===o.matrixWorldAutoUpdate&&o.updateWorldMatrix(!1,!0)}}},{key:"toJSON",value:function(e){var t=void 0===e||"string"===typeof e,n={};t&&(e={geometries:{},materials:{},textures:{},images:{},shapes:{},skeletons:{},animations:{},nodes:{}},n.metadata={version:4.5,type:"Object",generator:"Object3D.toJSON"});var i={};function r(t,n){return void 0===t[n.uuid]&&(t[n.uuid]=n.toJSON(e)),n.uuid}if(i.uuid=this.uuid,i.type=this.type,""!==this.name&&(i.name=this.name),!0===this.castShadow&&(i.castShadow=!0),!0===this.receiveShadow&&(i.receiveShadow=!0),!1===this.visible&&(i.visible=!1),!1===this.frustumCulled&&(i.frustumCulled=!1),0!==this.renderOrder&&(i.renderOrder=this.renderOrder),Object.keys(this.userData).length>0&&(i.userData=this.userData),i.layers=this.layers.mask,i.matrix=this.matrix.toArray(),!1===this.matrixAutoUpdate&&(i.matrixAutoUpdate=!1),this.isInstancedMesh&&(i.type="InstancedMesh",i.count=this.count,i.instanceMatrix=this.instanceMatrix.toJSON(),null!==this.instanceColor&&(i.instanceColor=this.instanceColor.toJSON())),this.isScene)this.background&&(this.background.isColor?i.background=this.background.toJSON():this.background.isTexture&&(i.background=this.background.toJSON(e).uuid)),this.environment&&this.environment.isTexture&&!0!==this.environment.isRenderTargetTexture&&(i.environment=this.environment.toJSON(e).uuid);else if(this.isMesh||this.isLine||this.isPoints){i.geometry=r(e.geometries,this.geometry);var a=this.geometry.parameters;if(void 0!==a&&void 0!==a.shapes){var o=a.shapes;if(Array.isArray(o))for(var s=0,l=o.length;s<l;s++){var u=o[s];r(e.shapes,u)}else r(e.shapes,o)}}if(this.isSkinnedMesh&&(i.bindMode=this.bindMode,i.bindMatrix=this.bindMatrix.toArray(),void 0!==this.skeleton&&(r(e.skeletons,this.skeleton),i.skeleton=this.skeleton.uuid)),void 0!==this.material)if(Array.isArray(this.material)){for(var c=[],h=0,d=this.material.length;h<d;h++)c.push(r(e.materials,this.material[h]));i.material=c}else i.material=r(e.materials,this.material);if(this.children.length>0){i.children=[];for(var f=0;f<this.children.length;f++)i.children.push(this.children[f].toJSON(e).object)}if(this.animations.length>0){i.animations=[];for(var p=0;p<this.animations.length;p++){var A=this.animations[p];i.animations.push(r(e.animations,A))}}if(t){var v=_(e.geometries),g=_(e.materials),m=_(e.textures),y=_(e.images),x=_(e.shapes),w=_(e.skeletons),C=_(e.animations),b=_(e.nodes);v.length>0&&(n.geometries=v),g.length>0&&(n.materials=g),m.length>0&&(n.textures=m),y.length>0&&(n.images=y),x.length>0&&(n.shapes=x),w.length>0&&(n.skeletons=w),C.length>0&&(n.animations=C),b.length>0&&(n.nodes=b)}return n.object=i,n;function _(e){var t=[];for(var n in e){var i=e[n];delete i.metadata,t.push(i)}return t}}},{key:"clone",value:function(e){return(new this.constructor).copy(this,e)}},{key:"copy",value:function(e){var t=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];if(this.name=e.name,this.up.copy(e.up),this.position.copy(e.position),this.rotation.order=e.rotation.order,this.quaternion.copy(e.quaternion),this.scale.copy(e.scale),this.matrix.copy(e.matrix),this.matrixWorld.copy(e.matrixWorld),this.matrixAutoUpdate=e.matrixAutoUpdate,this.matrixWorldNeedsUpdate=e.matrixWorldNeedsUpdate,this.matrixWorldAutoUpdate=e.matrixWorldAutoUpdate,this.layers.mask=e.layers.mask,this.visible=e.visible,this.castShadow=e.castShadow,this.receiveShadow=e.receiveShadow,this.frustumCulled=e.frustumCulled,this.renderOrder=e.renderOrder,this.userData=JSON.parse(JSON.stringify(e.userData)),!0===t)for(var n=0;n<e.children.length;n++){var i=e.children[n];this.add(i.clone())}return this}}]),n}($t);Hi.DEFAULT_UP=new Gn(0,1,0),Hi.DEFAULT_MATRIX_AUTO_UPDATE=!0,Hi.DEFAULT_MATRIX_WORLD_AUTO_UPDATE=!0;var Vi=new Gn,Wi=new Gn,qi=new Gn,Yi=new Gn,Ji=new Gn,Xi=new Gn,Ki=new Gn,$i=new Gn,er=new Gn,tr=new Gn,nr=function(){function e(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:new Gn,n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:new Gn,i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:new Gn;(0,v.Z)(this,e),this.a=t,this.b=n,this.c=i}return(0,g.Z)(e,[{key:"set",value:function(e,t,n){return this.a.copy(e),this.b.copy(t),this.c.copy(n),this}},{key:"setFromPointsAndIndices",value:function(e,t,n,i){return this.a.copy(e[t]),this.b.copy(e[n]),this.c.copy(e[i]),this}},{key:"setFromAttributeAndIndices",value:function(e,t,n,i){return this.a.fromBufferAttribute(e,t),this.b.fromBufferAttribute(e,n),this.c.fromBufferAttribute(e,i),this}},{key:"clone",value:function(){return(new this.constructor).copy(this)}},{key:"copy",value:function(e){return this.a.copy(e.a),this.b.copy(e.b),this.c.copy(e.c),this}},{key:"getArea",value:function(){return Vi.subVectors(this.c,this.b),Wi.subVectors(this.a,this.b),.5*Vi.cross(Wi).length()}},{key:"getMidpoint",value:function(e){return e.addVectors(this.a,this.b).add(this.c).multiplyScalar(1/3)}},{key:"getNormal",value:function(t){return e.getNormal(this.a,this.b,this.c,t)}},{key:"getPlane",value:function(e){return e.setFromCoplanarPoints(this.a,this.b,this.c)}},{key:"getBarycoord",value:function(t,n){return e.getBarycoord(t,this.a,this.b,this.c,n)}},{key:"getUV",value:function(t,n,i,r,a){return e.getUV(t,this.a,this.b,this.c,n,i,r,a)}},{key:"containsPoint",value:function(t){return e.containsPoint(t,this.a,this.b,this.c)}},{key:"isFrontFacing",value:function(t){return e.isFrontFacing(this.a,this.b,this.c,t)}},{key:"intersectsBox",value:function(e){return e.intersectsTriangle(this)}},{key:"closestPointToPoint",value:function(e,t){var n,i,r=this.a,a=this.b,o=this.c;Ji.subVectors(a,r),Xi.subVectors(o,r),$i.subVectors(e,r);var s=Ji.dot($i),l=Xi.dot($i);if(s<=0&&l<=0)return t.copy(r);er.subVectors(e,a);var u=Ji.dot(er),c=Xi.dot(er);if(u>=0&&c<=u)return t.copy(a);var h=s*c-u*l;if(h<=0&&s>=0&&u<=0)return n=s/(s-u),t.copy(r).addScaledVector(Ji,n);tr.subVectors(e,o);var d=Ji.dot(tr),f=Xi.dot(tr);if(f>=0&&d<=f)return t.copy(o);var p=d*l-s*f;if(p<=0&&l>=0&&f<=0)return i=l/(l-f),t.copy(r).addScaledVector(Xi,i);var A=u*f-d*c;if(A<=0&&c-u>=0&&d-f>=0)return Ki.subVectors(o,a),i=(c-u)/(c-u+(d-f)),t.copy(a).addScaledVector(Ki,i);var v=1/(A+p+h);return n=p*v,i=h*v,t.copy(r).addScaledVector(Ji,n).addScaledVector(Xi,i)}},{key:"equals",value:function(e){return e.a.equals(this.a)&&e.b.equals(this.b)&&e.c.equals(this.c)}}],[{key:"getNormal",value:function(e,t,n,i){i.subVectors(n,t),Vi.subVectors(e,t),i.cross(Vi);var r=i.lengthSq();return r>0?i.multiplyScalar(1/Math.sqrt(r)):i.set(0,0,0)}},{key:"getBarycoord",value:function(e,t,n,i,r){Vi.subVectors(i,t),Wi.subVectors(n,t),qi.subVectors(e,t);var a=Vi.dot(Vi),o=Vi.dot(Wi),s=Vi.dot(qi),l=Wi.dot(Wi),u=Wi.dot(qi),c=a*l-o*o;if(0===c)return r.set(-2,-1,-1);var h=1/c,d=(l*s-o*u)*h,f=(a*u-o*s)*h;return r.set(1-d-f,f,d)}},{key:"containsPoint",value:function(e,t,n,i){return this.getBarycoord(e,t,n,i,Yi),Yi.x>=0&&Yi.y>=0&&Yi.x+Yi.y<=1}},{key:"getUV",value:function(e,t,n,i,r,a,o,s){return this.getBarycoord(e,t,n,i,Yi),s.set(0,0),s.addScaledVector(r,Yi.x),s.addScaledVector(a,Yi.y),s.addScaledVector(o,Yi.z),s}},{key:"isFrontFacing",value:function(e,t,n,i){return Vi.subVectors(n,t),Wi.subVectors(e,t),Vi.cross(Wi).dot(i)<0}}]),e}(),ir=0,rr=function(e){(0,d.Z)(n,e);var t=(0,f.Z)(n);function n(){var e;return(0,v.Z)(this,n),(e=t.call(this)).isMaterial=!0,Object.defineProperty((0,h.Z)(e),"id",{value:ir++}),e.uuid=an(),e.name="",e.type="Material",e.blending=T,e.side=I,e.vertexColors=!1,e.opacity=1,e.transparent=!1,e.blendSrc=H,e.blendDst=V,e.blendEquation=Q,e.blendSrcAlpha=null,e.blendDstAlpha=null,e.blendEquationAlpha=null,e.depthFunc=te,e.depthTest=!0,e.depthWrite=!0,e.stencilWriteMask=255,e.stencilFunc=519,e.stencilRef=0,e.stencilFuncMask=255,e.stencilFail=Ht,e.stencilZFail=Ht,e.stencilZPass=Ht,e.stencilWrite=!1,e.clippingPlanes=null,e.clipIntersection=!1,e.clipShadows=!1,e.shadowSide=null,e.colorWrite=!0,e.precision=null,e.polygonOffset=!1,e.polygonOffsetFactor=0,e.polygonOffsetUnits=0,e.dithering=!1,e.alphaToCoverage=!1,e.premultipliedAlpha=!1,e.forceSinglePass=!1,e.visible=!0,e.toneMapped=!0,e.userData={},e.version=0,e._alphaTest=0,e}return(0,g.Z)(n,[{key:"alphaTest",get:function(){return this._alphaTest},set:function(e){this._alphaTest>0!==e>0&&this.version++,this._alphaTest=e}},{key:"onBuild",value:function(){}},{key:"onBeforeRender",value:function(){}},{key:"onBeforeCompile",value:function(){}},{key:"customProgramCacheKey",value:function(){return this.onBeforeCompile.toString()}},{key:"setValues",value:function(e){if(void 0!==e)for(var t in e){var n=e[t];if(void 0!==n){var i=this[t];void 0!==i?i&&i.isColor?i.set(n):i&&i.isVector3&&n&&n.isVector3?i.copy(n):this[t]=n:console.warn("THREE."+this.type+": '"+t+"' is not a property of this material.")}else console.warn("THREE.Material: '"+t+"' parameter is undefined.")}}},{key:"toJSON",value:function(e){var t=void 0===e||"string"===typeof e;t&&(e={textures:{},images:{}});var n={metadata:{version:4.5,type:"Material",generator:"Material.toJSON"}};function i(e){var t=[];for(var n in e){var i=e[n];delete i.metadata,t.push(i)}return t}if(n.uuid=this.uuid,n.type=this.type,""!==this.name&&(n.name=this.name),this.color&&this.color.isColor&&(n.color=this.color.getHex()),void 0!==this.roughness&&(n.roughness=this.roughness),void 0!==this.metalness&&(n.metalness=this.metalness),void 0!==this.sheen&&(n.sheen=this.sheen),this.sheenColor&&this.sheenColor.isColor&&(n.sheenColor=this.sheenColor.getHex()),void 0!==this.sheenRoughness&&(n.sheenRoughness=this.sheenRoughness),this.emissive&&this.emissive.isColor&&(n.emissive=this.emissive.getHex()),this.emissiveIntensity&&1!==this.emissiveIntensity&&(n.emissiveIntensity=this.emissiveIntensity),this.specular&&this.specular.isColor&&(n.specular=this.specular.getHex()),void 0!==this.specularIntensity&&(n.specularIntensity=this.specularIntensity),this.specularColor&&this.specularColor.isColor&&(n.specularColor=this.specularColor.getHex()),void 0!==this.shininess&&(n.shininess=this.shininess),void 0!==this.clearcoat&&(n.clearcoat=this.clearcoat),void 0!==this.clearcoatRoughness&&(n.clearcoatRoughness=this.clearcoatRoughness),this.clearcoatMap&&this.clearcoatMap.isTexture&&(n.clearcoatMap=this.clearcoatMap.toJSON(e).uuid),this.clearcoatRoughnessMap&&this.clearcoatRoughnessMap.isTexture&&(n.clearcoatRoughnessMap=this.clearcoatRoughnessMap.toJSON(e).uuid),this.clearcoatNormalMap&&this.clearcoatNormalMap.isTexture&&(n.clearcoatNormalMap=this.clearcoatNormalMap.toJSON(e).uuid,n.clearcoatNormalScale=this.clearcoatNormalScale.toArray()),void 0!==this.iridescence&&(n.iridescence=this.iridescence),void 0!==this.iridescenceIOR&&(n.iridescenceIOR=this.iridescenceIOR),void 0!==this.iridescenceThicknessRange&&(n.iridescenceThicknessRange=this.iridescenceThicknessRange),this.iridescenceMap&&this.iridescenceMap.isTexture&&(n.iridescenceMap=this.iridescenceMap.toJSON(e).uuid),this.iridescenceThicknessMap&&this.iridescenceThicknessMap.isTexture&&(n.iridescenceThicknessMap=this.iridescenceThicknessMap.toJSON(e).uuid),this.map&&this.map.isTexture&&(n.map=this.map.toJSON(e).uuid),this.matcap&&this.matcap.isTexture&&(n.matcap=this.matcap.toJSON(e).uuid),this.alphaMap&&this.alphaMap.isTexture&&(n.alphaMap=this.alphaMap.toJSON(e).uuid),this.lightMap&&this.lightMap.isTexture&&(n.lightMap=this.lightMap.toJSON(e).uuid,n.lightMapIntensity=this.lightMapIntensity),this.aoMap&&this.aoMap.isTexture&&(n.aoMap=this.aoMap.toJSON(e).uuid,n.aoMapIntensity=this.aoMapIntensity),this.bumpMap&&this.bumpMap.isTexture&&(n.bumpMap=this.bumpMap.toJSON(e).uuid,n.bumpScale=this.bumpScale),this.normalMap&&this.normalMap.isTexture&&(n.normalMap=this.normalMap.toJSON(e).uuid,n.normalMapType=this.normalMapType,n.normalScale=this.normalScale.toArray()),this.displacementMap&&this.displacementMap.isTexture&&(n.displacementMap=this.displacementMap.toJSON(e).uuid,n.displacementScale=this.displacementScale,n.displacementBias=this.displacementBias),this.roughnessMap&&this.roughnessMap.isTexture&&(n.roughnessMap=this.roughnessMap.toJSON(e).uuid),this.metalnessMap&&this.metalnessMap.isTexture&&(n.metalnessMap=this.metalnessMap.toJSON(e).uuid),this.emissiveMap&&this.emissiveMap.isTexture&&(n.emissiveMap=this.emissiveMap.toJSON(e).uuid),this.specularMap&&this.specularMap.isTexture&&(n.specularMap=this.specularMap.toJSON(e).uuid),this.specularIntensityMap&&this.specularIntensityMap.isTexture&&(n.specularIntensityMap=this.specularIntensityMap.toJSON(e).uuid),this.specularColorMap&&this.specularColorMap.isTexture&&(n.specularColorMap=this.specularColorMap.toJSON(e).uuid),this.envMap&&this.envMap.isTexture&&(n.envMap=this.envMap.toJSON(e).uuid,void 0!==this.combine&&(n.combine=this.combine)),void 0!==this.envMapIntensity&&(n.envMapIntensity=this.envMapIntensity),void 0!==this.reflectivity&&(n.reflectivity=this.reflectivity),void 0!==this.refractionRatio&&(n.refractionRatio=this.refractionRatio),this.gradientMap&&this.gradientMap.isTexture&&(n.gradientMap=this.gradientMap.toJSON(e).uuid),void 0!==this.transmission&&(n.transmission=this.transmission),this.transmissionMap&&this.transmissionMap.isTexture&&(n.transmissionMap=this.transmissionMap.toJSON(e).uuid),void 0!==this.thickness&&(n.thickness=this.thickness),this.thicknessMap&&this.thicknessMap.isTexture&&(n.thicknessMap=this.thicknessMap.toJSON(e).uuid),void 0!==this.attenuationDistance&&this.attenuationDistance!==1/0&&(n.attenuationDistance=this.attenuationDistance),void 0!==this.attenuationColor&&(n.attenuationColor=this.attenuationColor.getHex()),void 0!==this.size&&(n.size=this.size),null!==this.shadowSide&&(n.shadowSide=this.shadowSide),void 0!==this.sizeAttenuation&&(n.sizeAttenuation=this.sizeAttenuation),this.blending!==T&&(n.blending=this.blending),this.side!==I&&(n.side=this.side),this.vertexColors&&(n.vertexColors=!0),this.opacity<1&&(n.opacity=this.opacity),!0===this.transparent&&(n.transparent=this.transparent),n.depthFunc=this.depthFunc,n.depthTest=this.depthTest,n.depthWrite=this.depthWrite,n.colorWrite=this.colorWrite,n.stencilWrite=this.stencilWrite,n.stencilWriteMask=this.stencilWriteMask,n.stencilFunc=this.stencilFunc,n.stencilRef=this.stencilRef,n.stencilFuncMask=this.stencilFuncMask,n.stencilFail=this.stencilFail,n.stencilZFail=this.stencilZFail,n.stencilZPass=this.stencilZPass,void 0!==this.rotation&&0!==this.rotation&&(n.rotation=this.rotation),!0===this.polygonOffset&&(n.polygonOffset=!0),0!==this.polygonOffsetFactor&&(n.polygonOffsetFactor=this.polygonOffsetFactor),0!==this.polygonOffsetUnits&&(n.polygonOffsetUnits=this.polygonOffsetUnits),void 0!==this.linewidth&&1!==this.linewidth&&(n.linewidth=this.linewidth),void 0!==this.dashSize&&(n.dashSize=this.dashSize),void 0!==this.gapSize&&(n.gapSize=this.gapSize),void 0!==this.scale&&(n.scale=this.scale),!0===this.dithering&&(n.dithering=!0),this.alphaTest>0&&(n.alphaTest=this.alphaTest),!0===this.alphaToCoverage&&(n.alphaToCoverage=this.alphaToCoverage),!0===this.premultipliedAlpha&&(n.premultipliedAlpha=this.premultipliedAlpha),!0===this.forceSinglePass&&(n.forceSinglePass=this.forceSinglePass),!0===this.wireframe&&(n.wireframe=this.wireframe),this.wireframeLinewidth>1&&(n.wireframeLinewidth=this.wireframeLinewidth),"round"!==this.wireframeLinecap&&(n.wireframeLinecap=this.wireframeLinecap),"round"!==this.wireframeLinejoin&&(n.wireframeLinejoin=this.wireframeLinejoin),!0===this.flatShading&&(n.flatShading=this.flatShading),!1===this.visible&&(n.visible=!1),!1===this.toneMapped&&(n.toneMapped=!1),!1===this.fog&&(n.fog=!1),Object.keys(this.userData).length>0&&(n.userData=this.userData),t){var r=i(e.textures),a=i(e.images);r.length>0&&(n.textures=r),a.length>0&&(n.images=a)}return n}},{key:"clone",value:function(){return(new this.constructor).copy(this)}},{key:"copy",value:function(e){this.name=e.name,this.blending=e.blending,this.side=e.side,this.vertexColors=e.vertexColors,this.opacity=e.opacity,this.transparent=e.transparent,this.blendSrc=e.blendSrc,this.blendDst=e.blendDst,this.blendEquation=e.blendEquation,this.blendSrcAlpha=e.blendSrcAlpha,this.blendDstAlpha=e.blendDstAlpha,this.blendEquationAlpha=e.blendEquationAlpha,this.depthFunc=e.depthFunc,this.depthTest=e.depthTest,this.depthWrite=e.depthWrite,this.stencilWriteMask=e.stencilWriteMask,this.stencilFunc=e.stencilFunc,this.stencilRef=e.stencilRef,this.stencilFuncMask=e.stencilFuncMask,this.stencilFail=e.stencilFail,this.stencilZFail=e.stencilZFail,this.stencilZPass=e.stencilZPass,this.stencilWrite=e.stencilWrite;var t=e.clippingPlanes,n=null;if(null!==t){var i=t.length;n=new Array(i);for(var r=0;r!==i;++r)n[r]=t[r].clone()}return this.clippingPlanes=n,this.clipIntersection=e.clipIntersection,this.clipShadows=e.clipShadows,this.shadowSide=e.shadowSide,this.colorWrite=e.colorWrite,this.precision=e.precision,this.polygonOffset=e.polygonOffset,this.polygonOffsetFactor=e.polygonOffsetFactor,this.polygonOffsetUnits=e.polygonOffsetUnits,this.dithering=e.dithering,this.alphaTest=e.alphaTest,this.alphaToCoverage=e.alphaToCoverage,this.premultipliedAlpha=e.premultipliedAlpha,this.forceSinglePass=e.forceSinglePass,this.visible=e.visible,this.toneMapped=e.toneMapped,this.userData=JSON.parse(JSON.stringify(e.userData)),this}},{key:"dispose",value:function(){this.dispatchEvent({type:"dispose"})}},{key:"needsUpdate",set:function(e){!0===e&&this.version++}}]),n}($t),ar=function(e){(0,d.Z)(n,e);var t=(0,f.Z)(n);function n(e){var i;return(0,v.Z)(this,n),(i=t.call(this)).isMeshBasicMaterial=!0,i.type="MeshBasicMaterial",i.color=new Rn(16777215),i.map=null,i.lightMap=null,i.lightMapIntensity=1,i.aoMap=null,i.aoMapIntensity=1,i.specularMap=null,i.alphaMap=null,i.envMap=null,i.combine=oe,i.reflectivity=1,i.refractionRatio=.98,i.wireframe=!1,i.wireframeLinewidth=1,i.wireframeLinecap="round",i.wireframeLinejoin="round",i.fog=!0,i.setValues(e),i}return(0,g.Z)(n,[{key:"copy",value:function(e){return(0,u.Z)((0,c.Z)(n.prototype),"copy",this).call(this,e),this.color.copy(e.color),this.map=e.map,this.lightMap=e.lightMap,this.lightMapIntensity=e.lightMapIntensity,this.aoMap=e.aoMap,this.aoMapIntensity=e.aoMapIntensity,this.specularMap=e.specularMap,this.alphaMap=e.alphaMap,this.envMap=e.envMap,this.combine=e.combine,this.reflectivity=e.reflectivity,this.refractionRatio=e.refractionRatio,this.wireframe=e.wireframe,this.wireframeLinewidth=e.wireframeLinewidth,this.wireframeLinecap=e.wireframeLinecap,this.wireframeLinejoin=e.wireframeLinejoin,this.fog=e.fog,this}}]),n}(rr),or=new Gn,sr=new An,lr=function(){function e(t,n){var i=arguments.length>2&&void 0!==arguments[2]&&arguments[2];if((0,v.Z)(this,e),Array.isArray(t))throw new TypeError("THREE.BufferAttribute: array should be a Typed Array.");this.isBufferAttribute=!0,this.name="",this.array=t,this.itemSize=n,this.count=void 0!==t?t.length/n:0,this.normalized=i,this.usage=Vt,this.updateRange={offset:0,count:-1},this.version=0}return(0,g.Z)(e,[{key:"onUploadCallback",value:function(){}},{key:"needsUpdate",set:function(e){!0===e&&this.version++}},{key:"setUsage",value:function(e){return this.usage=e,this}},{key:"copy",value:function(e){return this.name=e.name,this.array=new e.array.constructor(e.array),this.itemSize=e.itemSize,this.count=e.count,this.normalized=e.normalized,this.usage=e.usage,this}},{key:"copyAt",value:function(e,t,n){e*=this.itemSize,n*=t.itemSize;for(var i=0,r=this.itemSize;i<r;i++)this.array[e+i]=t.array[n+i];return this}},{key:"copyArray",value:function(e){return this.array.set(e),this}},{key:"applyMatrix3",value:function(e){if(2===this.itemSize)for(var t=0,n=this.count;t<n;t++)sr.fromBufferAttribute(this,t),sr.applyMatrix3(e),this.setXY(t,sr.x,sr.y);else if(3===this.itemSize)for(var i=0,r=this.count;i<r;i++)or.fromBufferAttribute(this,i),or.applyMatrix3(e),this.setXYZ(i,or.x,or.y,or.z);return this}},{key:"applyMatrix4",value:function(e){for(var t=0,n=this.count;t<n;t++)or.fromBufferAttribute(this,t),or.applyMatrix4(e),this.setXYZ(t,or.x,or.y,or.z);return this}},{key:"applyNormalMatrix",value:function(e){for(var t=0,n=this.count;t<n;t++)or.fromBufferAttribute(this,t),or.applyNormalMatrix(e),this.setXYZ(t,or.x,or.y,or.z);return this}},{key:"transformDirection",value:function(e){for(var t=0,n=this.count;t<n;t++)or.fromBufferAttribute(this,t),or.transformDirection(e),this.setXYZ(t,or.x,or.y,or.z);return this}},{key:"set",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;return this.array.set(e,t),this}},{key:"getX",value:function(e){var t=this.array[e*this.itemSize];return this.normalized&&(t=dn(t,this.array)),t}},{key:"setX",value:function(e,t){return this.normalized&&(t=fn(t,this.array)),this.array[e*this.itemSize]=t,this}},{key:"getY",value:function(e){var t=this.array[e*this.itemSize+1];return this.normalized&&(t=dn(t,this.array)),t}},{key:"setY",value:function(e,t){return this.normalized&&(t=fn(t,this.array)),this.array[e*this.itemSize+1]=t,this}},{key:"getZ",value:function(e){var t=this.array[e*this.itemSize+2];return this.normalized&&(t=dn(t,this.array)),t}},{key:"setZ",value:function(e,t){return this.normalized&&(t=fn(t,this.array)),this.array[e*this.itemSize+2]=t,this}},{key:"getW",value:function(e){var t=this.array[e*this.itemSize+3];return this.normalized&&(t=dn(t,this.array)),t}},{key:"setW",value:function(e,t){return this.normalized&&(t=fn(t,this.array)),this.array[e*this.itemSize+3]=t,this}},{key:"setXY",value:function(e,t,n){return e*=this.itemSize,this.normalized&&(t=fn(t,this.array),n=fn(n,this.array)),this.array[e+0]=t,this.array[e+1]=n,this}},{key:"setXYZ",value:function(e,t,n,i){return e*=this.itemSize,this.normalized&&(t=fn(t,this.array),n=fn(n,this.array),i=fn(i,this.array)),this.array[e+0]=t,this.array[e+1]=n,this.array[e+2]=i,this}},{key:"setXYZW",value:function(e,t,n,i,r){return e*=this.itemSize,this.normalized&&(t=fn(t,this.array),n=fn(n,this.array),i=fn(i,this.array),r=fn(r,this.array)),this.array[e+0]=t,this.array[e+1]=n,this.array[e+2]=i,this.array[e+3]=r,this}},{key:"onUpload",value:function(e){return this.onUploadCallback=e,this}},{key:"clone",value:function(){return new this.constructor(this.array,this.itemSize).copy(this)}},{key:"toJSON",value:function(){var e={itemSize:this.itemSize,type:this.array.constructor.name,array:Array.from(this.array),normalized:this.normalized};return""!==this.name&&(e.name=this.name),this.usage!==Vt&&(e.usage=this.usage),0===this.updateRange.offset&&-1===this.updateRange.count||(e.updateRange=this.updateRange),e}},{key:"copyColorsArray",value:function(){console.error("THREE.BufferAttribute: copyColorsArray() was removed in r144.")}},{key:"copyVector2sArray",value:function(){console.error("THREE.BufferAttribute: copyVector2sArray() was removed in r144.")}},{key:"copyVector3sArray",value:function(){console.error("THREE.BufferAttribute: copyVector3sArray() was removed in r144.")}},{key:"copyVector4sArray",value:function(){console.error("THREE.BufferAttribute: copyVector4sArray() was removed in r144.")}}]),e}(),ur=function(e){(0,d.Z)(n,e);var t=(0,f.Z)(n);function n(e,i,r){return(0,v.Z)(this,n),t.call(this,new Uint16Array(e),i,r)}return(0,g.Z)(n)}(lr),cr=function(e){(0,d.Z)(n,e);var t=(0,f.Z)(n);function n(e,i,r){return(0,v.Z)(this,n),t.call(this,new Int32Array(e),i,r)}return(0,g.Z)(n)}(lr),hr=function(e){(0,d.Z)(n,e);var t=(0,f.Z)(n);function n(e,i,r){return(0,v.Z)(this,n),t.call(this,new Uint32Array(e),i,r)}return(0,g.Z)(n)}(lr),dr=function(e){(0,d.Z)(n,e);var t=(0,f.Z)(n);function n(e,i,r){return(0,v.Z)(this,n),t.call(this,new Float32Array(e),i,r)}return(0,g.Z)(n)}(lr),fr=0,pr=new xi,Ar=new Hi,vr=new Gn,gr=new Wn,mr=new Wn,yr=new Gn,xr=function(e){(0,d.Z)(n,e);var t=(0,f.Z)(n);function n(){var e;return(0,v.Z)(this,n),(e=t.call(this)).isBufferGeometry=!0,Object.defineProperty((0,h.Z)(e),"id",{value:fr++}),e.uuid=an(),e.name="",e.type="BufferGeometry",e.index=null,e.attributes={},e.morphAttributes={},e.morphTargetsRelative=!1,e.groups=[],e.boundingBox=null,e.boundingSphere=null,e.drawRange={start:0,count:1/0},e.userData={},e}return(0,g.Z)(n,[{key:"getIndex",value:function(){return this.index}},{key:"setIndex",value:function(e){return Array.isArray(e)?this.index=new(mn(e)?hr:ur)(e,1):this.index=e,this}},{key:"getAttribute",value:function(e){return this.attributes[e]}},{key:"setAttribute",value:function(e,t){return this.attributes[e]=t,this}},{key:"deleteAttribute",value:function(e){return delete this.attributes[e],this}},{key:"hasAttribute",value:function(e){return void 0!==this.attributes[e]}},{key:"addGroup",value:function(e,t){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0;this.groups.push({start:e,count:t,materialIndex:n})}},{key:"clearGroups",value:function(){this.groups=[]}},{key:"setDrawRange",value:function(e,t){this.drawRange.start=e,this.drawRange.count=t}},{key:"applyMatrix4",value:function(e){var t=this.attributes.position;void 0!==t&&(t.applyMatrix4(e),t.needsUpdate=!0);var n=this.attributes.normal;if(void 0!==n){var i=(new vn).getNormalMatrix(e);n.applyNormalMatrix(i),n.needsUpdate=!0}var r=this.attributes.tangent;return void 0!==r&&(r.transformDirection(e),r.needsUpdate=!0),null!==this.boundingBox&&this.computeBoundingBox(),null!==this.boundingSphere&&this.computeBoundingSphere(),this}},{key:"applyQuaternion",value:function(e){return pr.makeRotationFromQuaternion(e),this.applyMatrix4(pr),this}},{key:"rotateX",value:function(e){return pr.makeRotationX(e),this.applyMatrix4(pr),this}},{key:"rotateY",value:function(e){return pr.makeRotationY(e),this.applyMatrix4(pr),this}},{key:"rotateZ",value:function(e){return pr.makeRotationZ(e),this.applyMatrix4(pr),this}},{key:"translate",value:function(e,t,n){return pr.makeTranslation(e,t,n),this.applyMatrix4(pr),this}},{key:"scale",value:function(e,t,n){return pr.makeScale(e,t,n),this.applyMatrix4(pr),this}},{key:"lookAt",value:function(e){return Ar.lookAt(e),Ar.updateMatrix(),this.applyMatrix4(Ar.matrix),this}},{key:"center",value:function(){return this.computeBoundingBox(),this.boundingBox.getCenter(vr).negate(),this.translate(vr.x,vr.y,vr.z),this}},{key:"setFromPoints",value:function(e){for(var t=[],n=0,i=e.length;n<i;n++){var r=e[n];t.push(r.x,r.y,r.z||0)}return this.setAttribute("position",new dr(t,3)),this}},{key:"computeBoundingBox",value:function(){null===this.boundingBox&&(this.boundingBox=new Wn);var e=this.attributes.position,t=this.morphAttributes.position;if(e&&e.isGLBufferAttribute)return console.error('THREE.BufferGeometry.computeBoundingBox(): GLBufferAttribute requires a manual bounding box. Alternatively set "mesh.frustumCulled" to "false".',this),void this.boundingBox.set(new Gn(-1/0,-1/0,-1/0),new Gn(1/0,1/0,1/0));if(void 0!==e){if(this.boundingBox.setFromBufferAttribute(e),t)for(var n=0,i=t.length;n<i;n++){var r=t[n];gr.setFromBufferAttribute(r),this.morphTargetsRelative?(yr.addVectors(this.boundingBox.min,gr.min),this.boundingBox.expandByPoint(yr),yr.addVectors(this.boundingBox.max,gr.max),this.boundingBox.expandByPoint(yr)):(this.boundingBox.expandByPoint(gr.min),this.boundingBox.expandByPoint(gr.max))}}else this.boundingBox.makeEmpty();(isNaN(this.boundingBox.min.x)||isNaN(this.boundingBox.min.y)||isNaN(this.boundingBox.min.z))&&console.error('THREE.BufferGeometry.computeBoundingBox(): Computed min/max have NaN values. The "position" attribute is likely to have NaN values.',this)}},{key:"computeBoundingSphere",value:function(){null===this.boundingSphere&&(this.boundingSphere=new hi);var e=this.attributes.position,t=this.morphAttributes.position;if(e&&e.isGLBufferAttribute)return console.error('THREE.BufferGeometry.computeBoundingSphere(): GLBufferAttribute requires a manual bounding sphere. Alternatively set "mesh.frustumCulled" to "false".',this),void this.boundingSphere.set(new Gn,1/0);if(e){var n=this.boundingSphere.center;if(gr.setFromBufferAttribute(e),t)for(var i=0,r=t.length;i<r;i++){var a=t[i];mr.setFromBufferAttribute(a),this.morphTargetsRelative?(yr.addVectors(gr.min,mr.min),gr.expandByPoint(yr),yr.addVectors(gr.max,mr.max),gr.expandByPoint(yr)):(gr.expandByPoint(mr.min),gr.expandByPoint(mr.max))}gr.getCenter(n);for(var o=0,s=0,l=e.count;s<l;s++)yr.fromBufferAttribute(e,s),o=Math.max(o,n.distanceToSquared(yr));if(t)for(var u=0,c=t.length;u<c;u++)for(var h=t[u],d=this.morphTargetsRelative,f=0,p=h.count;f<p;f++)yr.fromBufferAttribute(h,f),d&&(vr.fromBufferAttribute(e,f),yr.add(vr)),o=Math.max(o,n.distanceToSquared(yr));this.boundingSphere.radius=Math.sqrt(o),isNaN(this.boundingSphere.radius)&&console.error('THREE.BufferGeometry.computeBoundingSphere(): Computed radius is NaN. The "position" attribute is likely to have NaN values.',this)}}},{key:"computeTangents",value:function(){var e=this.index,t=this.attributes;if(null!==e&&void 0!==t.position&&void 0!==t.normal&&void 0!==t.uv){var n=e.array,i=t.position.array,r=t.normal.array,a=t.uv.array,o=i.length/3;!1===this.hasAttribute("tangent")&&this.setAttribute("tangent",new lr(new Float32Array(4*o),4));for(var s=this.getAttribute("tangent").array,l=[],u=[],c=0;c<o;c++)l[c]=new Gn,u[c]=new Gn;var h=new Gn,d=new Gn,f=new Gn,p=new An,A=new An,v=new An,g=new Gn,m=new Gn,y=this.groups;0===y.length&&(y=[{start:0,count:n.length}]);for(var x=0,w=y.length;x<w;++x)for(var C=y[x],b=C.start,_=b,E=b+C.count;_<E;_+=3)Q(n[_+0],n[_+1],n[_+2]);for(var M=new Gn,I=new Gn,S=new Gn,k=new Gn,B=0,T=y.length;B<T;++B)for(var D=y[B],R=D.start,P=R,L=R+D.count;P<L;P+=3)Z(n[P+0]),Z(n[P+1]),Z(n[P+2])}else console.error("THREE.BufferGeometry: .computeTangents() failed. Missing required attributes (index, position, normal or uv)");function Q(e,t,n){h.fromArray(i,3*e),d.fromArray(i,3*t),f.fromArray(i,3*n),p.fromArray(a,2*e),A.fromArray(a,2*t),v.fromArray(a,2*n),d.sub(h),f.sub(h),A.sub(p),v.sub(p);var r=1/(A.x*v.y-v.x*A.y);isFinite(r)&&(g.copy(d).multiplyScalar(v.y).addScaledVector(f,-A.y).multiplyScalar(r),m.copy(f).multiplyScalar(A.x).addScaledVector(d,-v.x).multiplyScalar(r),l[e].add(g),l[t].add(g),l[n].add(g),u[e].add(m),u[t].add(m),u[n].add(m))}function Z(e){S.fromArray(r,3*e),k.copy(S);var t=l[e];M.copy(t),M.sub(S.multiplyScalar(S.dot(t))).normalize(),I.crossVectors(k,t);var n=I.dot(u[e])<0?-1:1;s[4*e]=M.x,s[4*e+1]=M.y,s[4*e+2]=M.z,s[4*e+3]=n}}},{key:"computeVertexNormals",value:function(){var e=this.index,t=this.getAttribute("position");if(void 0!==t){var n=this.getAttribute("normal");if(void 0===n)n=new lr(new Float32Array(3*t.count),3),this.setAttribute("normal",n);else for(var i=0,r=n.count;i<r;i++)n.setXYZ(i,0,0,0);var a=new Gn,o=new Gn,s=new Gn,l=new Gn,u=new Gn,c=new Gn,h=new Gn,d=new Gn;if(e)for(var f=0,p=e.count;f<p;f+=3){var A=e.getX(f+0),v=e.getX(f+1),g=e.getX(f+2);a.fromBufferAttribute(t,A),o.fromBufferAttribute(t,v),s.fromBufferAttribute(t,g),h.subVectors(s,o),d.subVectors(a,o),h.cross(d),l.fromBufferAttribute(n,A),u.fromBufferAttribute(n,v),c.fromBufferAttribute(n,g),l.add(h),u.add(h),c.add(h),n.setXYZ(A,l.x,l.y,l.z),n.setXYZ(v,u.x,u.y,u.z),n.setXYZ(g,c.x,c.y,c.z)}else for(var m=0,y=t.count;m<y;m+=3)a.fromBufferAttribute(t,m+0),o.fromBufferAttribute(t,m+1),s.fromBufferAttribute(t,m+2),h.subVectors(s,o),d.subVectors(a,o),h.cross(d),n.setXYZ(m+0,h.x,h.y,h.z),n.setXYZ(m+1,h.x,h.y,h.z),n.setXYZ(m+2,h.x,h.y,h.z);this.normalizeNormals(),n.needsUpdate=!0}}},{key:"merge",value:function(){return console.error("THREE.BufferGeometry.merge() has been removed. Use THREE.BufferGeometryUtils.mergeBufferGeometries() instead."),this}},{key:"normalizeNormals",value:function(){for(var e=this.attributes.normal,t=0,n=e.count;t<n;t++)yr.fromBufferAttribute(e,t),yr.normalize(),e.setXYZ(t,yr.x,yr.y,yr.z)}},{key:"toNonIndexed",value:function(){function e(e,t){for(var n=e.array,i=e.itemSize,r=e.normalized,a=new n.constructor(t.length*i),o=0,s=0,l=0,u=t.length;l<u;l++){o=e.isInterleavedBufferAttribute?t[l]*e.data.stride+e.offset:t[l]*i;for(var c=0;c<i;c++)a[s++]=n[o++]}return new lr(a,i,r)}if(null===this.index)return console.warn("THREE.BufferGeometry.toNonIndexed(): BufferGeometry is already non-indexed."),this;var t=new n,i=this.index.array,r=this.attributes;for(var a in r){var o=e(r[a],i);t.setAttribute(a,o)}var s=this.morphAttributes;for(var l in s){for(var u=[],c=s[l],h=0,d=c.length;h<d;h++){var f=e(c[h],i);u.push(f)}t.morphAttributes[l]=u}t.morphTargetsRelative=this.morphTargetsRelative;for(var p=this.groups,A=0,v=p.length;A<v;A++){var g=p[A];t.addGroup(g.start,g.count,g.materialIndex)}return t}},{key:"toJSON",value:function(){var e={metadata:{version:4.5,type:"BufferGeometry",generator:"BufferGeometry.toJSON"}};if(e.uuid=this.uuid,e.type=this.type,""!==this.name&&(e.name=this.name),Object.keys(this.userData).length>0&&(e.userData=this.userData),void 0!==this.parameters){var t=this.parameters;for(var n in t)void 0!==t[n]&&(e[n]=t[n]);return e}e.data={attributes:{}};var i=this.index;null!==i&&(e.data.index={type:i.array.constructor.name,array:Array.prototype.slice.call(i.array)});var r=this.attributes;for(var a in r){var o=r[a];e.data.attributes[a]=o.toJSON(e.data)}var s={},l=!1;for(var u in this.morphAttributes){for(var c=this.morphAttributes[u],h=[],d=0,f=c.length;d<f;d++){var p=c[d];h.push(p.toJSON(e.data))}h.length>0&&(s[u]=h,l=!0)}l&&(e.data.morphAttributes=s,e.data.morphTargetsRelative=this.morphTargetsRelative);var A=this.groups;A.length>0&&(e.data.groups=JSON.parse(JSON.stringify(A)));var v=this.boundingSphere;return null!==v&&(e.data.boundingSphere={center:v.center.toArray(),radius:v.radius}),e}},{key:"clone",value:function(){return(new this.constructor).copy(this)}},{key:"copy",value:function(e){this.index=null,this.attributes={},this.morphAttributes={},this.groups=[],this.boundingBox=null,this.boundingSphere=null;var t={};this.name=e.name;var n=e.index;null!==n&&this.setIndex(n.clone(t));var i=e.attributes;for(var r in i){var a=i[r];this.setAttribute(r,a.clone(t))}var o=e.morphAttributes;for(var s in o){for(var l=[],u=o[s],c=0,h=u.length;c<h;c++)l.push(u[c].clone(t));this.morphAttributes[s]=l}this.morphTargetsRelative=e.morphTargetsRelative;for(var d=e.groups,f=0,p=d.length;f<p;f++){var A=d[f];this.addGroup(A.start,A.count,A.materialIndex)}var v=e.boundingBox;null!==v&&(this.boundingBox=v.clone());var g=e.boundingSphere;return null!==g&&(this.boundingSphere=g.clone()),this.drawRange.start=e.drawRange.start,this.drawRange.count=e.drawRange.count,this.userData=e.userData,void 0!==e.parameters&&(this.parameters=Object.assign({},e.parameters)),this}},{key:"dispose",value:function(){this.dispatchEvent({type:"dispose"})}}]),n}($t),wr=new xi,Cr=new yi,br=new hi,_r=new Gn,Er=new Gn,Mr=new Gn,Ir=new Gn,Sr=new Gn,kr=new An,Br=new An,Tr=new An,Dr=new Gn,Rr=new Gn,Pr=function(e){(0,d.Z)(n,e);var t=(0,f.Z)(n);function n(){var e,i=arguments.length>0&&void 0!==arguments[0]?arguments[0]:new xr,r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:new ar;return(0,v.Z)(this,n),(e=t.call(this)).isMesh=!0,e.type="Mesh",e.geometry=i,e.material=r,e.updateMorphTargets(),e}return(0,g.Z)(n,[{key:"copy",value:function(e,t){return(0,u.Z)((0,c.Z)(n.prototype),"copy",this).call(this,e,t),void 0!==e.morphTargetInfluences&&(this.morphTargetInfluences=e.morphTargetInfluences.slice()),void 0!==e.morphTargetDictionary&&(this.morphTargetDictionary=Object.assign({},e.morphTargetDictionary)),this.material=e.material,this.geometry=e.geometry,this}},{key:"updateMorphTargets",value:function(){var e=this.geometry.morphAttributes,t=Object.keys(e);if(t.length>0){var n=e[t[0]];if(void 0!==n){this.morphTargetInfluences=[],this.morphTargetDictionary={};for(var i=0,r=n.length;i<r;i++){var a=n[i].name||String(i);this.morphTargetInfluences.push(0),this.morphTargetDictionary[a]=i}}}}},{key:"getVertexPosition",value:function(e,t){var n=this.geometry,i=n.attributes.position,r=n.morphAttributes.position,a=n.morphTargetsRelative;t.fromBufferAttribute(i,e);var o=this.morphTargetInfluences;if(r&&o){Sr.set(0,0,0);for(var s=0,l=r.length;s<l;s++){var u=o[s],c=r[s];0!==u&&(Ir.fromBufferAttribute(c,e),a?Sr.addScaledVector(Ir,u):Sr.addScaledVector(Ir.sub(t),u))}t.add(Sr)}return this.isSkinnedMesh&&this.boneTransform(e,t),t}},{key:"raycast",value:function(e,t){var n=this.geometry,i=this.material,r=this.matrixWorld;if(void 0!==i&&(null===n.boundingSphere&&n.computeBoundingSphere(),br.copy(n.boundingSphere),br.applyMatrix4(r),!1!==e.ray.intersectsSphere(br)&&(wr.copy(r).invert(),Cr.copy(e.ray).applyMatrix4(wr),null===n.boundingBox||!1!==Cr.intersectsBox(n.boundingBox)))){var a,o=n.index,s=n.attributes.position,l=n.attributes.uv,u=n.attributes.uv2,c=n.groups,h=n.drawRange;if(null!==o)if(Array.isArray(i))for(var d=0,f=c.length;d<f;d++)for(var p=c[d],A=i[p.materialIndex],v=Math.max(p.start,h.start),g=Math.min(o.count,Math.min(p.start+p.count,h.start+h.count));v<g;v+=3){var m=o.getX(v),y=o.getX(v+1),x=o.getX(v+2);(a=Lr(this,A,e,Cr,l,u,m,y,x))&&(a.faceIndex=Math.floor(v/3),a.face.materialIndex=p.materialIndex,t.push(a))}else for(var w=Math.max(0,h.start),C=Math.min(o.count,h.start+h.count);w<C;w+=3){var b=o.getX(w),_=o.getX(w+1),E=o.getX(w+2);(a=Lr(this,i,e,Cr,l,u,b,_,E))&&(a.faceIndex=Math.floor(w/3),t.push(a))}else if(void 0!==s)if(Array.isArray(i))for(var M=0,I=c.length;M<I;M++)for(var S=c[M],k=i[S.materialIndex],B=Math.max(S.start,h.start),T=Math.min(s.count,Math.min(S.start+S.count,h.start+h.count));B<T;B+=3){(a=Lr(this,k,e,Cr,l,u,B,B+1,B+2))&&(a.faceIndex=Math.floor(B/3),a.face.materialIndex=S.materialIndex,t.push(a))}else for(var D=Math.max(0,h.start),R=Math.min(s.count,h.start+h.count);D<R;D+=3){(a=Lr(this,i,e,Cr,l,u,D,D+1,D+2))&&(a.faceIndex=Math.floor(D/3),t.push(a))}}}}]),n}(Hi);function Lr(e,t,n,i,r,a,o,s,l){e.getVertexPosition(o,_r),e.getVertexPosition(s,Er),e.getVertexPosition(l,Mr);var u=function(e,t,n,i,r,a,o,s){if(null===(t.side===S?i.intersectTriangle(o,a,r,!0,s):i.intersectTriangle(r,a,o,t.side===I,s)))return null;Rr.copy(s),Rr.applyMatrix4(e.matrixWorld);var l=n.ray.origin.distanceTo(Rr);return l<n.near||l>n.far?null:{distance:l,point:Rr.clone(),object:e}}(e,t,n,i,_r,Er,Mr,Dr);if(u){r&&(kr.fromBufferAttribute(r,o),Br.fromBufferAttribute(r,s),Tr.fromBufferAttribute(r,l),u.uv=nr.getUV(Dr,_r,Er,Mr,kr,Br,Tr,new An)),a&&(kr.fromBufferAttribute(a,o),Br.fromBufferAttribute(a,s),Tr.fromBufferAttribute(a,l),u.uv2=nr.getUV(Dr,_r,Er,Mr,kr,Br,Tr,new An));var c={a:o,b:s,c:l,normal:new Gn,materialIndex:0};nr.getNormal(_r,Er,Mr,c.normal),u.face=c}return u}var Qr=function(e){(0,d.Z)(n,e);var t=(0,f.Z)(n);function n(){var e,i=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1,a=arguments.length>2&&void 0!==arguments[2]?arguments[2]:1,o=arguments.length>3&&void 0!==arguments[3]?arguments[3]:1,s=arguments.length>4&&void 0!==arguments[4]?arguments[4]:1,l=arguments.length>5&&void 0!==arguments[5]?arguments[5]:1;(0,v.Z)(this,n),(e=t.call(this)).type="BoxGeometry",e.parameters={width:i,height:r,depth:a,widthSegments:o,heightSegments:s,depthSegments:l};var u=(0,h.Z)(e);o=Math.floor(o),s=Math.floor(s),l=Math.floor(l);var c=[],d=[],f=[],p=[],A=0,g=0;function m(e,t,n,i,r,a,o,s,l,h,v){for(var m=a/l,y=o/h,x=a/2,w=o/2,C=s/2,b=l+1,_=h+1,E=0,M=0,I=new Gn,S=0;S<_;S++)for(var k=S*y-w,B=0;B<b;B++){var T=B*m-x;I[e]=T*i,I[t]=k*r,I[n]=C,d.push(I.x,I.y,I.z),I[e]=0,I[t]=0,I[n]=s>0?1:-1,f.push(I.x,I.y,I.z),p.push(B/l),p.push(1-S/h),E+=1}for(var D=0;D<h;D++)for(var R=0;R<l;R++){var P=A+R+b*D,L=A+R+b*(D+1),Q=A+(R+1)+b*(D+1),Z=A+(R+1)+b*D;c.push(P,L,Z),c.push(L,Q,Z),M+=6}u.addGroup(g,M,v),g+=M,A+=E}return m("z","y","x",-1,-1,a,r,i,l,s,0),m("z","y","x",1,-1,a,r,-i,l,s,1),m("x","z","y",1,1,i,a,r,o,l,2),m("x","z","y",1,-1,i,a,-r,o,l,3),m("x","y","z",1,-1,i,r,a,o,s,4),m("x","y","z",-1,-1,i,r,-a,o,s,5),e.setIndex(c),e.setAttribute("position",new dr(d,3)),e.setAttribute("normal",new dr(f,3)),e.setAttribute("uv",new dr(p,2)),e}return(0,g.Z)(n,null,[{key:"fromJSON",value:function(e){return new n(e.width,e.height,e.depth,e.widthSegments,e.heightSegments,e.depthSegments)}}]),n}(xr);function Zr(e){var t={};for(var n in e)for(var i in t[n]={},e[n]){var r=e[n][i];r&&(r.isColor||r.isMatrix3||r.isMatrix4||r.isVector2||r.isVector3||r.isVector4||r.isTexture||r.isQuaternion)?t[n][i]=r.clone():Array.isArray(r)?t[n][i]=r.slice():t[n][i]=r}return t}function Nr(e){for(var t={},n=0;n<e.length;n++){var i=Zr(e[n]);for(var r in i)t[r]=i[r]}return t}function Fr(e){return null===e.getRenderTarget()&&e.outputEncoding===Ft?zt:Gt}var Ur={clone:Zr,merge:Nr},jr=function(e){(0,d.Z)(n,e);var t=(0,f.Z)(n);function n(e){var i;return(0,v.Z)(this,n),(i=t.call(this)).isShaderMaterial=!0,i.type="ShaderMaterial",i.defines={},i.uniforms={},i.uniformsGroups=[],i.vertexShader="void main() {\n\tgl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );\n}",i.fragmentShader="void main() {\n\tgl_FragColor = vec4( 1.0, 0.0, 0.0, 1.0 );\n}",i.linewidth=1,i.wireframe=!1,i.wireframeLinewidth=1,i.fog=!1,i.lights=!1,i.clipping=!1,i.extensions={derivatives:!1,fragDepth:!1,drawBuffers:!1,shaderTextureLOD:!1},i.defaultAttributeValues={color:[1,1,1],uv:[0,0],uv2:[0,0]},i.index0AttributeName=void 0,i.uniformsNeedUpdate=!1,i.glslVersion=null,void 0!==e&&i.setValues(e),i}return(0,g.Z)(n,[{key:"copy",value:function(e){return(0,u.Z)((0,c.Z)(n.prototype),"copy",this).call(this,e),this.fragmentShader=e.fragmentShader,this.vertexShader=e.vertexShader,this.uniforms=Zr(e.uniforms),this.uniformsGroups=function(e){for(var t=[],n=0;n<e.length;n++)t.push(e[n].clone());return t}(e.uniformsGroups),this.defines=Object.assign({},e.defines),this.wireframe=e.wireframe,this.wireframeLinewidth=e.wireframeLinewidth,this.fog=e.fog,this.lights=e.lights,this.clipping=e.clipping,this.extensions=Object.assign({},e.extensions),this.glslVersion=e.glslVersion,this}},{key:"toJSON",value:function(e){var t=(0,u.Z)((0,c.Z)(n.prototype),"toJSON",this).call(this,e);for(var i in t.glslVersion=this.glslVersion,t.uniforms={},this.uniforms){var r=this.uniforms[i].value;r&&r.isTexture?t.uniforms[i]={type:"t",value:r.toJSON(e).uuid}:r&&r.isColor?t.uniforms[i]={type:"c",value:r.getHex()}:r&&r.isVector2?t.uniforms[i]={type:"v2",value:r.toArray()}:r&&r.isVector3?t.uniforms[i]={type:"v3",value:r.toArray()}:r&&r.isVector4?t.uniforms[i]={type:"v4",value:r.toArray()}:r&&r.isMatrix3?t.uniforms[i]={type:"m3",value:r.toArray()}:r&&r.isMatrix4?t.uniforms[i]={type:"m4",value:r.toArray()}:t.uniforms[i]={value:r}}Object.keys(this.defines).length>0&&(t.defines=this.defines),t.vertexShader=this.vertexShader,t.fragmentShader=this.fragmentShader;var a={};for(var o in this.extensions)!0===this.extensions[o]&&(a[o]=!0);return Object.keys(a).length>0&&(t.extensions=a),t}}]),n}(rr),Or=function(e){(0,d.Z)(n,e);var t=(0,f.Z)(n);function n(){var e;return(0,v.Z)(this,n),(e=t.call(this)).isCamera=!0,e.type="Camera",e.matrixWorldInverse=new xi,e.projectionMatrix=new xi,e.projectionMatrixInverse=new xi,e}return(0,g.Z)(n,[{key:"copy",value:function(e,t){return(0,u.Z)((0,c.Z)(n.prototype),"copy",this).call(this,e,t),this.matrixWorldInverse.copy(e.matrixWorldInverse),this.projectionMatrix.copy(e.projectionMatrix),this.projectionMatrixInverse.copy(e.projectionMatrixInverse),this}},{key:"getWorldDirection",value:function(e){this.updateWorldMatrix(!0,!1);var t=this.matrixWorld.elements;return e.set(-t[8],-t[9],-t[10]).normalize()}},{key:"updateMatrixWorld",value:function(e){(0,u.Z)((0,c.Z)(n.prototype),"updateMatrixWorld",this).call(this,e),this.matrixWorldInverse.copy(this.matrixWorld).invert()}},{key:"updateWorldMatrix",value:function(e,t){(0,u.Z)((0,c.Z)(n.prototype),"updateWorldMatrix",this).call(this,e,t),this.matrixWorldInverse.copy(this.matrixWorld).invert()}},{key:"clone",value:function(){return(new this.constructor).copy(this)}}]),n}(Hi),zr=function(e){(0,d.Z)(n,e);var t=(0,f.Z)(n);function n(){var e,i=arguments.length>0&&void 0!==arguments[0]?arguments[0]:50,r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1,a=arguments.length>2&&void 0!==arguments[2]?arguments[2]:.1,o=arguments.length>3&&void 0!==arguments[3]?arguments[3]:2e3;return(0,v.Z)(this,n),(e=t.call(this)).isPerspectiveCamera=!0,e.type="PerspectiveCamera",e.fov=i,e.zoom=1,e.near=a,e.far=o,e.focus=10,e.aspect=r,e.view=null,e.filmGauge=35,e.filmOffset=0,e.updateProjectionMatrix(),e}return(0,g.Z)(n,[{key:"copy",value:function(e,t){return(0,u.Z)((0,c.Z)(n.prototype),"copy",this).call(this,e,t),this.fov=e.fov,this.zoom=e.zoom,this.near=e.near,this.far=e.far,this.focus=e.focus,this.aspect=e.aspect,this.view=null===e.view?null:Object.assign({},e.view),this.filmGauge=e.filmGauge,this.filmOffset=e.filmOffset,this}},{key:"setFocalLength",value:function(e){var t=.5*this.getFilmHeight()/e;this.fov=2*rn*Math.atan(t),this.updateProjectionMatrix()}},{key:"getFocalLength",value:function(){var e=Math.tan(.5*nn*this.fov);return.5*this.getFilmHeight()/e}},{key:"getEffectiveFOV",value:function(){return 2*rn*Math.atan(Math.tan(.5*nn*this.fov)/this.zoom)}},{key:"getFilmWidth",value:function(){return this.filmGauge*Math.min(this.aspect,1)}},{key:"getFilmHeight",value:function(){return this.filmGauge/Math.max(this.aspect,1)}},{key:"setViewOffset",value:function(e,t,n,i,r,a){this.aspect=e/t,null===this.view&&(this.view={enabled:!0,fullWidth:1,fullHeight:1,offsetX:0,offsetY:0,width:1,height:1}),this.view.enabled=!0,this.view.fullWidth=e,this.view.fullHeight=t,this.view.offsetX=n,this.view.offsetY=i,this.view.width=r,this.view.height=a,this.updateProjectionMatrix()}},{key:"clearViewOffset",value:function(){null!==this.view&&(this.view.enabled=!1),this.updateProjectionMatrix()}},{key:"updateProjectionMatrix",value:function(){var e=this.near,t=e*Math.tan(.5*nn*this.fov)/this.zoom,n=2*t,i=this.aspect*n,r=-.5*i,a=this.view;if(null!==this.view&&this.view.enabled){var o=a.fullWidth,s=a.fullHeight;r+=a.offsetX*i/o,t-=a.offsetY*n/s,i*=a.width/o,n*=a.height/s}var l=this.filmOffset;0!==l&&(r+=e*l/this.getFilmWidth()),this.projectionMatrix.makePerspective(r,r+i,t,t-n,e,this.far),this.projectionMatrixInverse.copy(this.projectionMatrix).invert()}},{key:"toJSON",value:function(e){var t=(0,u.Z)((0,c.Z)(n.prototype),"toJSON",this).call(this,e);return t.object.fov=this.fov,t.object.zoom=this.zoom,t.object.near=this.near,t.object.far=this.far,t.object.focus=this.focus,t.object.aspect=this.aspect,null!==this.view&&(t.object.view=Object.assign({},this.view)),t.object.filmGauge=this.filmGauge,t.object.filmOffset=this.filmOffset,t}}]),n}(Or),Gr=-90,Hr=function(e){(0,d.Z)(n,e);var t=(0,f.Z)(n);function n(e,i,r){var a;(0,v.Z)(this,n),(a=t.call(this)).type="CubeCamera",a.renderTarget=r;var o=new zr(Gr,1,e,i);o.layers=a.layers,o.up.set(0,1,0),o.lookAt(1,0,0),a.add(o);var s=new zr(Gr,1,e,i);s.layers=a.layers,s.up.set(0,1,0),s.lookAt(-1,0,0),a.add(s);var l=new zr(Gr,1,e,i);l.layers=a.layers,l.up.set(0,0,-1),l.lookAt(0,1,0),a.add(l);var u=new zr(Gr,1,e,i);u.layers=a.layers,u.up.set(0,0,1),u.lookAt(0,-1,0),a.add(u);var c=new zr(Gr,1,e,i);c.layers=a.layers,c.up.set(0,1,0),c.lookAt(0,0,1),a.add(c);var h=new zr(Gr,1,e,i);return h.layers=a.layers,h.up.set(0,1,0),h.lookAt(0,0,-1),a.add(h),a}return(0,g.Z)(n,[{key:"update",value:function(e,t){null===this.parent&&this.updateMatrixWorld();var n=this.renderTarget,i=(0,l.Z)(this.children,6),r=i[0],a=i[1],o=i[2],s=i[3],u=i[4],c=i[5],h=e.getRenderTarget(),d=e.toneMapping,f=e.xr.enabled;e.toneMapping=ue,e.xr.enabled=!1;var p=n.texture.generateMipmaps;n.texture.generateMipmaps=!1,e.setRenderTarget(n,0),e.render(t,r),e.setRenderTarget(n,1),e.render(t,a),e.setRenderTarget(n,2),e.render(t,o),e.setRenderTarget(n,3),e.render(t,s),e.setRenderTarget(n,4),e.render(t,u),n.texture.generateMipmaps=p,e.setRenderTarget(n,5),e.render(t,c),e.setRenderTarget(h),e.toneMapping=d,e.xr.enabled=f,n.texture.needsPMREMUpdate=!0}}]),n}(Hi),Vr=function(e){(0,d.Z)(n,e);var t=(0,f.Z)(n);function n(e,i,r,a,o,s,l,u,c,h){var d;return(0,v.Z)(this,n),e=void 0!==e?e:[],i=void 0!==i?i:Ae,(d=t.call(this,e,i,r,a,o,s,l,u,c,h)).isCubeTexture=!0,d.flipY=!1,d}return(0,g.Z)(n,[{key:"images",get:function(){return this.image},set:function(e){this.image=e}}]),n}(Nn),Wr=function(e){(0,d.Z)(n,e);var t=(0,f.Z)(n);function n(){var e,i=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};(0,v.Z)(this,n),(e=t.call(this,i,i,r)).isWebGLCubeRenderTarget=!0;var a={width:i,height:i,depth:1},o=[a,a,a,a,a,a];return e.texture=new Vr(o,r.mapping,r.wrapS,r.wrapT,r.magFilter,r.minFilter,r.format,r.type,r.anisotropy,r.encoding),e.texture.isRenderTargetTexture=!0,e.texture.generateMipmaps=void 0!==r.generateMipmaps&&r.generateMipmaps,e.texture.minFilter=void 0!==r.minFilter?r.minFilter:Me,e}return(0,g.Z)(n,[{key:"fromEquirectangularTexture",value:function(e,t){this.texture.type=t.type,this.texture.encoding=t.encoding,this.texture.generateMipmaps=t.generateMipmaps,this.texture.minFilter=t.minFilter,this.texture.magFilter=t.magFilter;var n={tEquirect:{value:null}},i="\n\n\t\t\t\tvarying vec3 vWorldDirection;\n\n\t\t\t\tvec3 transformDirection( in vec3 dir, in mat4 matrix ) {\n\n\t\t\t\t\treturn normalize( ( matrix * vec4( dir, 0.0 ) ).xyz );\n\n\t\t\t\t}\n\n\t\t\t\tvoid main() {\n\n\t\t\t\t\tvWorldDirection = transformDirection( position, modelMatrix );\n\n\t\t\t\t\t#include <begin_vertex>\n\t\t\t\t\t#include <project_vertex>\n\n\t\t\t\t}\n\t\t\t",r="\n\n\t\t\t\tuniform sampler2D tEquirect;\n\n\t\t\t\tvarying vec3 vWorldDirection;\n\n\t\t\t\t#include <common>\n\n\t\t\t\tvoid main() {\n\n\t\t\t\t\tvec3 direction = normalize( vWorldDirection );\n\n\t\t\t\t\tvec2 sampleUV = equirectUv( direction );\n\n\t\t\t\t\tgl_FragColor = texture2D( tEquirect, sampleUV );\n\n\t\t\t\t}\n\t\t\t",a=new Qr(5,5,5),o=new jr({name:"CubemapFromEquirect",uniforms:Zr(n),vertexShader:i,fragmentShader:r,side:S,blending:B});o.uniforms.tEquirect.value=t;var s=new Pr(a,o),l=t.minFilter;return t.minFilter===Se&&(t.minFilter=Me),new Hr(1,10,this).update(e,s),t.minFilter=l,s.geometry.dispose(),s.material.dispose(),this}},{key:"clear",value:function(e,t,n,i){for(var r=e.getRenderTarget(),a=0;a<6;a++)e.setRenderTarget(this,a),e.clear(t,n,i);e.setRenderTarget(r)}}]),n}(Un),qr=new Gn,Yr=new Gn,Jr=new vn,Xr=function(){function e(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:new Gn(1,0,0),n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;(0,v.Z)(this,e),this.isPlane=!0,this.normal=t,this.constant=n}return(0,g.Z)(e,[{key:"set",value:function(e,t){return this.normal.copy(e),this.constant=t,this}},{key:"setComponents",value:function(e,t,n,i){return this.normal.set(e,t,n),this.constant=i,this}},{key:"setFromNormalAndCoplanarPoint",value:function(e,t){return this.normal.copy(e),this.constant=-t.dot(this.normal),this}},{key:"setFromCoplanarPoints",value:function(e,t,n){var i=qr.subVectors(n,t).cross(Yr.subVectors(e,t)).normalize();return this.setFromNormalAndCoplanarPoint(i,e),this}},{key:"copy",value:function(e){return this.normal.copy(e.normal),this.constant=e.constant,this}},{key:"normalize",value:function(){var e=1/this.normal.length();return this.normal.multiplyScalar(e),this.constant*=e,this}},{key:"negate",value:function(){return this.constant*=-1,this.normal.negate(),this}},{key:"distanceToPoint",value:function(e){return this.normal.dot(e)+this.constant}},{key:"distanceToSphere",value:function(e){return this.distanceToPoint(e.center)-e.radius}},{key:"projectPoint",value:function(e,t){return t.copy(this.normal).multiplyScalar(-this.distanceToPoint(e)).add(e)}},{key:"intersectLine",value:function(e,t){var n=e.delta(qr),i=this.normal.dot(n);if(0===i)return 0===this.distanceToPoint(e.start)?t.copy(e.start):null;var r=-(e.start.dot(this.normal)+this.constant)/i;return r<0||r>1?null:t.copy(n).multiplyScalar(r).add(e.start)}},{key:"intersectsLine",value:function(e){var t=this.distanceToPoint(e.start),n=this.distanceToPoint(e.end);return t<0&&n>0||n<0&&t>0}},{key:"intersectsBox",value:function(e){return e.intersectsPlane(this)}},{key:"intersectsSphere",value:function(e){return e.intersectsPlane(this)}},{key:"coplanarPoint",value:function(e){return e.copy(this.normal).multiplyScalar(-this.constant)}},{key:"applyMatrix4",value:function(e,t){var n=t||Jr.getNormalMatrix(e),i=this.coplanarPoint(qr).applyMatrix4(e),r=this.normal.applyMatrix3(n).normalize();return this.constant=-i.dot(r),this}},{key:"translate",value:function(e){return this.constant-=e.dot(this.normal),this}},{key:"equals",value:function(e){return e.normal.equals(this.normal)&&e.constant===this.constant}},{key:"clone",value:function(){return(new this.constructor).copy(this)}}]),e}(),Kr=new hi,$r=new Gn,ea=function(){function e(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:new Xr,n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:new Xr,i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:new Xr,r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:new Xr,a=arguments.length>4&&void 0!==arguments[4]?arguments[4]:new Xr,o=arguments.length>5&&void 0!==arguments[5]?arguments[5]:new Xr;(0,v.Z)(this,e),this.planes=[t,n,i,r,a,o]}return(0,g.Z)(e,[{key:"set",value:function(e,t,n,i,r,a){var o=this.planes;return o[0].copy(e),o[1].copy(t),o[2].copy(n),o[3].copy(i),o[4].copy(r),o[5].copy(a),this}},{key:"copy",value:function(e){for(var t=this.planes,n=0;n<6;n++)t[n].copy(e.planes[n]);return this}},{key:"setFromProjectionMatrix",value:function(e){var t=this.planes,n=e.elements,i=n[0],r=n[1],a=n[2],o=n[3],s=n[4],l=n[5],u=n[6],c=n[7],h=n[8],d=n[9],f=n[10],p=n[11],A=n[12],v=n[13],g=n[14],m=n[15];return t[0].setComponents(o-i,c-s,p-h,m-A).normalize(),t[1].setComponents(o+i,c+s,p+h,m+A).normalize(),t[2].setComponents(o+r,c+l,p+d,m+v).normalize(),t[3].setComponents(o-r,c-l,p-d,m-v).normalize(),t[4].setComponents(o-a,c-u,p-f,m-g).normalize(),t[5].setComponents(o+a,c+u,p+f,m+g).normalize(),this}},{key:"intersectsObject",value:function(e){var t=e.geometry;return null===t.boundingSphere&&t.computeBoundingSphere(),Kr.copy(t.boundingSphere).applyMatrix4(e.matrixWorld),this.intersectsSphere(Kr)}},{key:"intersectsSprite",value:function(e){return Kr.center.set(0,0,0),Kr.radius=.7071067811865476,Kr.applyMatrix4(e.matrixWorld),this.intersectsSphere(Kr)}},{key:"intersectsSphere",value:function(e){for(var t=this.planes,n=e.center,i=-e.radius,r=0;r<6;r++){if(t[r].distanceToPoint(n)<i)return!1}return!0}},{key:"intersectsBox",value:function(e){for(var t=this.planes,n=0;n<6;n++){var i=t[n];if($r.x=i.normal.x>0?e.max.x:e.min.x,$r.y=i.normal.y>0?e.max.y:e.min.y,$r.z=i.normal.z>0?e.max.z:e.min.z,i.distanceToPoint($r)<0)return!1}return!0}},{key:"containsPoint",value:function(e){for(var t=this.planes,n=0;n<6;n++)if(t[n].distanceToPoint(e)<0)return!1;return!0}},{key:"clone",value:function(){return(new this.constructor).copy(this)}}]),e}();function ta(){var e=null,t=!1,n=null,i=null;function r(t,a){n(t,a),i=e.requestAnimationFrame(r)}return{start:function(){!0!==t&&null!==n&&(i=e.requestAnimationFrame(r),t=!0)},stop:function(){e.cancelAnimationFrame(i),t=!1},setAnimationLoop:function(e){n=e},setContext:function(t){e=t}}}function na(e,t){var n=t.isWebGL2,i=new WeakMap;return{get:function(e){return e.isInterleavedBufferAttribute&&(e=e.data),i.get(e)},remove:function(t){t.isInterleavedBufferAttribute&&(t=t.data);var n=i.get(t);n&&(e.deleteBuffer(n.buffer),i.delete(t))},update:function(t,r){if(t.isGLBufferAttribute){var a=i.get(t);(!a||a.version<t.version)&&i.set(t,{buffer:t.buffer,type:t.type,bytesPerElement:t.elementSize,version:t.version})}else{t.isInterleavedBufferAttribute&&(t=t.data);var o=i.get(t);void 0===o?i.set(t,function(t,i){var r,a=t.array,o=t.usage,s=e.createBuffer();if(e.bindBuffer(i,s),e.bufferData(i,a,o),t.onUploadCallback(),a instanceof Float32Array)r=5126;else if(a instanceof Uint16Array)if(t.isFloat16BufferAttribute){if(!n)throw new Error("THREE.WebGLAttributes: Usage of Float16BufferAttribute requires WebGL2.");r=5131}else r=5123;else if(a instanceof Int16Array)r=5122;else if(a instanceof Uint32Array)r=5125;else if(a instanceof Int32Array)r=5124;else if(a instanceof Int8Array)r=5120;else if(a instanceof Uint8Array)r=5121;else{if(!(a instanceof Uint8ClampedArray))throw new Error("THREE.WebGLAttributes: Unsupported buffer data format: "+a);r=5121}return{buffer:s,type:r,bytesPerElement:a.BYTES_PER_ELEMENT,version:t.version}}(t,r)):o.version<t.version&&(!function(t,i,r){var a=i.array,o=i.updateRange;e.bindBuffer(r,t),-1===o.count?e.bufferSubData(r,0,a):(n?e.bufferSubData(r,o.offset*a.BYTES_PER_ELEMENT,a,o.offset,o.count):e.bufferSubData(r,o.offset*a.BYTES_PER_ELEMENT,a.subarray(o.offset,o.offset+o.count)),o.count=-1),i.onUploadCallback()}(o.buffer,t,r),o.version=t.version)}}}}var ia=function(e){(0,d.Z)(n,e);var t=(0,f.Z)(n);function n(){var e,i=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1,a=arguments.length>2&&void 0!==arguments[2]?arguments[2]:1,o=arguments.length>3&&void 0!==arguments[3]?arguments[3]:1;(0,v.Z)(this,n),(e=t.call(this)).type="PlaneGeometry",e.parameters={width:i,height:r,widthSegments:a,heightSegments:o};for(var s=i/2,l=r/2,u=Math.floor(a),c=Math.floor(o),h=u+1,d=c+1,f=i/u,p=r/c,A=[],g=[],m=[],y=[],x=0;x<d;x++)for(var w=x*p-l,C=0;C<h;C++){var b=C*f-s;g.push(b,-w,0),m.push(0,0,1),y.push(C/u),y.push(1-x/c)}for(var _=0;_<c;_++)for(var E=0;E<u;E++){var M=E+h*_,I=E+h*(_+1),S=E+1+h*(_+1),k=E+1+h*_;A.push(M,I,k),A.push(I,S,k)}return e.setIndex(A),e.setAttribute("position",new dr(g,3)),e.setAttribute("normal",new dr(m,3)),e.setAttribute("uv",new dr(y,2)),e}return(0,g.Z)(n,null,[{key:"fromJSON",value:function(e){return new n(e.width,e.height,e.widthSegments,e.heightSegments)}}]),n}(xr),ra={alphamap_fragment:"#ifdef USE_ALPHAMAP\n\tdiffuseColor.a *= texture2D( alphaMap, vUv ).g;\n#endif",alphamap_pars_fragment:"#ifdef USE_ALPHAMAP\n\tuniform sampler2D alphaMap;\n#endif",alphatest_fragment:"#ifdef USE_ALPHATEST\n\tif ( diffuseColor.a < alphaTest ) discard;\n#endif",alphatest_pars_fragment:"#ifdef USE_ALPHATEST\n\tuniform float alphaTest;\n#endif",aomap_fragment:"#ifdef USE_AOMAP\n\tfloat ambientOcclusion = ( texture2D( aoMap, vUv2 ).r - 1.0 ) * aoMapIntensity + 1.0;\n\treflectedLight.indirectDiffuse *= ambientOcclusion;\n\t#if defined( USE_ENVMAP ) && defined( STANDARD )\n\t\tfloat dotNV = saturate( dot( geometry.normal, geometry.viewDir ) );\n\t\treflectedLight.indirectSpecular *= computeSpecularOcclusion( dotNV, ambientOcclusion, material.roughness );\n\t#endif\n#endif",aomap_pars_fragment:"#ifdef USE_AOMAP\n\tuniform sampler2D aoMap;\n\tuniform float aoMapIntensity;\n#endif",begin_vertex:"vec3 transformed = vec3( position );",beginnormal_vertex:"vec3 objectNormal = vec3( normal );\n#ifdef USE_TANGENT\n\tvec3 objectTangent = vec3( tangent.xyz );\n#endif",bsdfs:"vec3 BRDF_Lambert( const in vec3 diffuseColor ) {\n\treturn RECIPROCAL_PI * diffuseColor;\n}\nvec3 F_Schlick( const in vec3 f0, const in float f90, const in float dotVH ) {\n\tfloat fresnel = exp2( ( - 5.55473 * dotVH - 6.98316 ) * dotVH );\n\treturn f0 * ( 1.0 - fresnel ) + ( f90 * fresnel );\n}\nfloat F_Schlick( const in float f0, const in float f90, const in float dotVH ) {\n\tfloat fresnel = exp2( ( - 5.55473 * dotVH - 6.98316 ) * dotVH );\n\treturn f0 * ( 1.0 - fresnel ) + ( f90 * fresnel );\n}\nvec3 Schlick_to_F0( const in vec3 f, const in float f90, const in float dotVH ) {\n    float x = clamp( 1.0 - dotVH, 0.0, 1.0 );\n    float x2 = x * x;\n    float x5 = clamp( x * x2 * x2, 0.0, 0.9999 );\n    return ( f - vec3( f90 ) * x5 ) / ( 1.0 - x5 );\n}\nfloat V_GGX_SmithCorrelated( const in float alpha, const in float dotNL, const in float dotNV ) {\n\tfloat a2 = pow2( alpha );\n\tfloat gv = dotNL * sqrt( a2 + ( 1.0 - a2 ) * pow2( dotNV ) );\n\tfloat gl = dotNV * sqrt( a2 + ( 1.0 - a2 ) * pow2( dotNL ) );\n\treturn 0.5 / max( gv + gl, EPSILON );\n}\nfloat D_GGX( const in float alpha, const in float dotNH ) {\n\tfloat a2 = pow2( alpha );\n\tfloat denom = pow2( dotNH ) * ( a2 - 1.0 ) + 1.0;\n\treturn RECIPROCAL_PI * a2 / pow2( denom );\n}\nvec3 BRDF_GGX( const in vec3 lightDir, const in vec3 viewDir, const in vec3 normal, const in vec3 f0, const in float f90, const in float roughness ) {\n\tfloat alpha = pow2( roughness );\n\tvec3 halfDir = normalize( lightDir + viewDir );\n\tfloat dotNL = saturate( dot( normal, lightDir ) );\n\tfloat dotNV = saturate( dot( normal, viewDir ) );\n\tfloat dotNH = saturate( dot( normal, halfDir ) );\n\tfloat dotVH = saturate( dot( viewDir, halfDir ) );\n\tvec3 F = F_Schlick( f0, f90, dotVH );\n\tfloat V = V_GGX_SmithCorrelated( alpha, dotNL, dotNV );\n\tfloat D = D_GGX( alpha, dotNH );\n\treturn F * ( V * D );\n}\n#ifdef USE_IRIDESCENCE\n\tvec3 BRDF_GGX_Iridescence( const in vec3 lightDir, const in vec3 viewDir, const in vec3 normal, const in vec3 f0, const in float f90, const in float iridescence, const in vec3 iridescenceFresnel, const in float roughness ) {\n\t\tfloat alpha = pow2( roughness );\n\t\tvec3 halfDir = normalize( lightDir + viewDir );\n\t\tfloat dotNL = saturate( dot( normal, lightDir ) );\n\t\tfloat dotNV = saturate( dot( normal, viewDir ) );\n\t\tfloat dotNH = saturate( dot( normal, halfDir ) );\n\t\tfloat dotVH = saturate( dot( viewDir, halfDir ) );\n\t\tvec3 F = mix( F_Schlick( f0, f90, dotVH ), iridescenceFresnel, iridescence );\n\t\tfloat V = V_GGX_SmithCorrelated( alpha, dotNL, dotNV );\n\t\tfloat D = D_GGX( alpha, dotNH );\n\t\treturn F * ( V * D );\n\t}\n#endif\nvec2 LTC_Uv( const in vec3 N, const in vec3 V, const in float roughness ) {\n\tconst float LUT_SIZE = 64.0;\n\tconst float LUT_SCALE = ( LUT_SIZE - 1.0 ) / LUT_SIZE;\n\tconst float LUT_BIAS = 0.5 / LUT_SIZE;\n\tfloat dotNV = saturate( dot( N, V ) );\n\tvec2 uv = vec2( roughness, sqrt( 1.0 - dotNV ) );\n\tuv = uv * LUT_SCALE + LUT_BIAS;\n\treturn uv;\n}\nfloat LTC_ClippedSphereFormFactor( const in vec3 f ) {\n\tfloat l = length( f );\n\treturn max( ( l * l + f.z ) / ( l + 1.0 ), 0.0 );\n}\nvec3 LTC_EdgeVectorFormFactor( const in vec3 v1, const in vec3 v2 ) {\n\tfloat x = dot( v1, v2 );\n\tfloat y = abs( x );\n\tfloat a = 0.8543985 + ( 0.4965155 + 0.0145206 * y ) * y;\n\tfloat b = 3.4175940 + ( 4.1616724 + y ) * y;\n\tfloat v = a / b;\n\tfloat theta_sintheta = ( x > 0.0 ) ? v : 0.5 * inversesqrt( max( 1.0 - x * x, 1e-7 ) ) - v;\n\treturn cross( v1, v2 ) * theta_sintheta;\n}\nvec3 LTC_Evaluate( const in vec3 N, const in vec3 V, const in vec3 P, const in mat3 mInv, const in vec3 rectCoords[ 4 ] ) {\n\tvec3 v1 = rectCoords[ 1 ] - rectCoords[ 0 ];\n\tvec3 v2 = rectCoords[ 3 ] - rectCoords[ 0 ];\n\tvec3 lightNormal = cross( v1, v2 );\n\tif( dot( lightNormal, P - rectCoords[ 0 ] ) < 0.0 ) return vec3( 0.0 );\n\tvec3 T1, T2;\n\tT1 = normalize( V - N * dot( V, N ) );\n\tT2 = - cross( N, T1 );\n\tmat3 mat = mInv * transposeMat3( mat3( T1, T2, N ) );\n\tvec3 coords[ 4 ];\n\tcoords[ 0 ] = mat * ( rectCoords[ 0 ] - P );\n\tcoords[ 1 ] = mat * ( rectCoords[ 1 ] - P );\n\tcoords[ 2 ] = mat * ( rectCoords[ 2 ] - P );\n\tcoords[ 3 ] = mat * ( rectCoords[ 3 ] - P );\n\tcoords[ 0 ] = normalize( coords[ 0 ] );\n\tcoords[ 1 ] = normalize( coords[ 1 ] );\n\tcoords[ 2 ] = normalize( coords[ 2 ] );\n\tcoords[ 3 ] = normalize( coords[ 3 ] );\n\tvec3 vectorFormFactor = vec3( 0.0 );\n\tvectorFormFactor += LTC_EdgeVectorFormFactor( coords[ 0 ], coords[ 1 ] );\n\tvectorFormFactor += LTC_EdgeVectorFormFactor( coords[ 1 ], coords[ 2 ] );\n\tvectorFormFactor += LTC_EdgeVectorFormFactor( coords[ 2 ], coords[ 3 ] );\n\tvectorFormFactor += LTC_EdgeVectorFormFactor( coords[ 3 ], coords[ 0 ] );\n\tfloat result = LTC_ClippedSphereFormFactor( vectorFormFactor );\n\treturn vec3( result );\n}\nfloat G_BlinnPhong_Implicit( ) {\n\treturn 0.25;\n}\nfloat D_BlinnPhong( const in float shininess, const in float dotNH ) {\n\treturn RECIPROCAL_PI * ( shininess * 0.5 + 1.0 ) * pow( dotNH, shininess );\n}\nvec3 BRDF_BlinnPhong( const in vec3 lightDir, const in vec3 viewDir, const in vec3 normal, const in vec3 specularColor, const in float shininess ) {\n\tvec3 halfDir = normalize( lightDir + viewDir );\n\tfloat dotNH = saturate( dot( normal, halfDir ) );\n\tfloat dotVH = saturate( dot( viewDir, halfDir ) );\n\tvec3 F = F_Schlick( specularColor, 1.0, dotVH );\n\tfloat G = G_BlinnPhong_Implicit( );\n\tfloat D = D_BlinnPhong( shininess, dotNH );\n\treturn F * ( G * D );\n}\n#if defined( USE_SHEEN )\nfloat D_Charlie( float roughness, float dotNH ) {\n\tfloat alpha = pow2( roughness );\n\tfloat invAlpha = 1.0 / alpha;\n\tfloat cos2h = dotNH * dotNH;\n\tfloat sin2h = max( 1.0 - cos2h, 0.0078125 );\n\treturn ( 2.0 + invAlpha ) * pow( sin2h, invAlpha * 0.5 ) / ( 2.0 * PI );\n}\nfloat V_Neubelt( float dotNV, float dotNL ) {\n\treturn saturate( 1.0 / ( 4.0 * ( dotNL + dotNV - dotNL * dotNV ) ) );\n}\nvec3 BRDF_Sheen( const in vec3 lightDir, const in vec3 viewDir, const in vec3 normal, vec3 sheenColor, const in float sheenRoughness ) {\n\tvec3 halfDir = normalize( lightDir + viewDir );\n\tfloat dotNL = saturate( dot( normal, lightDir ) );\n\tfloat dotNV = saturate( dot( normal, viewDir ) );\n\tfloat dotNH = saturate( dot( normal, halfDir ) );\n\tfloat D = D_Charlie( sheenRoughness, dotNH );\n\tfloat V = V_Neubelt( dotNV, dotNL );\n\treturn sheenColor * ( D * V );\n}\n#endif",iridescence_fragment:"#ifdef USE_IRIDESCENCE\n\tconst mat3 XYZ_TO_REC709 = mat3(\n\t\t 3.2404542, -0.9692660,  0.0556434,\n\t\t-1.5371385,  1.8760108, -0.2040259,\n\t\t-0.4985314,  0.0415560,  1.0572252\n\t);\n\tvec3 Fresnel0ToIor( vec3 fresnel0 ) {\n\t\tvec3 sqrtF0 = sqrt( fresnel0 );\n\t\treturn ( vec3( 1.0 ) + sqrtF0 ) / ( vec3( 1.0 ) - sqrtF0 );\n\t}\n\tvec3 IorToFresnel0( vec3 transmittedIor, float incidentIor ) {\n\t\treturn pow2( ( transmittedIor - vec3( incidentIor ) ) / ( transmittedIor + vec3( incidentIor ) ) );\n\t}\n\tfloat IorToFresnel0( float transmittedIor, float incidentIor ) {\n\t\treturn pow2( ( transmittedIor - incidentIor ) / ( transmittedIor + incidentIor ));\n\t}\n\tvec3 evalSensitivity( float OPD, vec3 shift ) {\n\t\tfloat phase = 2.0 * PI * OPD * 1.0e-9;\n\t\tvec3 val = vec3( 5.4856e-13, 4.4201e-13, 5.2481e-13 );\n\t\tvec3 pos = vec3( 1.6810e+06, 1.7953e+06, 2.2084e+06 );\n\t\tvec3 var = vec3( 4.3278e+09, 9.3046e+09, 6.6121e+09 );\n\t\tvec3 xyz = val * sqrt( 2.0 * PI * var ) * cos( pos * phase + shift ) * exp( - pow2( phase ) * var );\n\t\txyz.x += 9.7470e-14 * sqrt( 2.0 * PI * 4.5282e+09 ) * cos( 2.2399e+06 * phase + shift[ 0 ] ) * exp( - 4.5282e+09 * pow2( phase ) );\n\t\txyz /= 1.0685e-7;\n\t\tvec3 rgb = XYZ_TO_REC709 * xyz;\n\t\treturn rgb;\n\t}\n\tvec3 evalIridescence( float outsideIOR, float eta2, float cosTheta1, float thinFilmThickness, vec3 baseF0 ) {\n\t\tvec3 I;\n\t\tfloat iridescenceIOR = mix( outsideIOR, eta2, smoothstep( 0.0, 0.03, thinFilmThickness ) );\n\t\tfloat sinTheta2Sq = pow2( outsideIOR / iridescenceIOR ) * ( 1.0 - pow2( cosTheta1 ) );\n\t\tfloat cosTheta2Sq = 1.0 - sinTheta2Sq;\n\t\tif ( cosTheta2Sq < 0.0 ) {\n\t\t\t return vec3( 1.0 );\n\t\t}\n\t\tfloat cosTheta2 = sqrt( cosTheta2Sq );\n\t\tfloat R0 = IorToFresnel0( iridescenceIOR, outsideIOR );\n\t\tfloat R12 = F_Schlick( R0, 1.0, cosTheta1 );\n\t\tfloat R21 = R12;\n\t\tfloat T121 = 1.0 - R12;\n\t\tfloat phi12 = 0.0;\n\t\tif ( iridescenceIOR < outsideIOR ) phi12 = PI;\n\t\tfloat phi21 = PI - phi12;\n\t\tvec3 baseIOR = Fresnel0ToIor( clamp( baseF0, 0.0, 0.9999 ) );\t\tvec3 R1 = IorToFresnel0( baseIOR, iridescenceIOR );\n\t\tvec3 R23 = F_Schlick( R1, 1.0, cosTheta2 );\n\t\tvec3 phi23 = vec3( 0.0 );\n\t\tif ( baseIOR[ 0 ] < iridescenceIOR ) phi23[ 0 ] = PI;\n\t\tif ( baseIOR[ 1 ] < iridescenceIOR ) phi23[ 1 ] = PI;\n\t\tif ( baseIOR[ 2 ] < iridescenceIOR ) phi23[ 2 ] = PI;\n\t\tfloat OPD = 2.0 * iridescenceIOR * thinFilmThickness * cosTheta2;\n\t\tvec3 phi = vec3( phi21 ) + phi23;\n\t\tvec3 R123 = clamp( R12 * R23, 1e-5, 0.9999 );\n\t\tvec3 r123 = sqrt( R123 );\n\t\tvec3 Rs = pow2( T121 ) * R23 / ( vec3( 1.0 ) - R123 );\n\t\tvec3 C0 = R12 + Rs;\n\t\tI = C0;\n\t\tvec3 Cm = Rs - T121;\n\t\tfor ( int m = 1; m <= 2; ++ m ) {\n\t\t\tCm *= r123;\n\t\t\tvec3 Sm = 2.0 * evalSensitivity( float( m ) * OPD, float( m ) * phi );\n\t\t\tI += Cm * Sm;\n\t\t}\n\t\treturn max( I, vec3( 0.0 ) );\n\t}\n#endif",bumpmap_pars_fragment:"#ifdef USE_BUMPMAP\n\tuniform sampler2D bumpMap;\n\tuniform float bumpScale;\n\tvec2 dHdxy_fwd() {\n\t\tvec2 dSTdx = dFdx( vUv );\n\t\tvec2 dSTdy = dFdy( vUv );\n\t\tfloat Hll = bumpScale * texture2D( bumpMap, vUv ).x;\n\t\tfloat dBx = bumpScale * texture2D( bumpMap, vUv + dSTdx ).x - Hll;\n\t\tfloat dBy = bumpScale * texture2D( bumpMap, vUv + dSTdy ).x - Hll;\n\t\treturn vec2( dBx, dBy );\n\t}\n\tvec3 perturbNormalArb( vec3 surf_pos, vec3 surf_norm, vec2 dHdxy, float faceDirection ) {\n\t\tvec3 vSigmaX = dFdx( surf_pos.xyz );\n\t\tvec3 vSigmaY = dFdy( surf_pos.xyz );\n\t\tvec3 vN = surf_norm;\n\t\tvec3 R1 = cross( vSigmaY, vN );\n\t\tvec3 R2 = cross( vN, vSigmaX );\n\t\tfloat fDet = dot( vSigmaX, R1 ) * faceDirection;\n\t\tvec3 vGrad = sign( fDet ) * ( dHdxy.x * R1 + dHdxy.y * R2 );\n\t\treturn normalize( abs( fDet ) * surf_norm - vGrad );\n\t}\n#endif",clipping_planes_fragment:"#if NUM_CLIPPING_PLANES > 0\n\tvec4 plane;\n\t#pragma unroll_loop_start\n\tfor ( int i = 0; i < UNION_CLIPPING_PLANES; i ++ ) {\n\t\tplane = clippingPlanes[ i ];\n\t\tif ( dot( vClipPosition, plane.xyz ) > plane.w ) discard;\n\t}\n\t#pragma unroll_loop_end\n\t#if UNION_CLIPPING_PLANES < NUM_CLIPPING_PLANES\n\t\tbool clipped = true;\n\t\t#pragma unroll_loop_start\n\t\tfor ( int i = UNION_CLIPPING_PLANES; i < NUM_CLIPPING_PLANES; i ++ ) {\n\t\t\tplane = clippingPlanes[ i ];\n\t\t\tclipped = ( dot( vClipPosition, plane.xyz ) > plane.w ) && clipped;\n\t\t}\n\t\t#pragma unroll_loop_end\n\t\tif ( clipped ) discard;\n\t#endif\n#endif",clipping_planes_pars_fragment:"#if NUM_CLIPPING_PLANES > 0\n\tvarying vec3 vClipPosition;\n\tuniform vec4 clippingPlanes[ NUM_CLIPPING_PLANES ];\n#endif",clipping_planes_pars_vertex:"#if NUM_CLIPPING_PLANES > 0\n\tvarying vec3 vClipPosition;\n#endif",clipping_planes_vertex:"#if NUM_CLIPPING_PLANES > 0\n\tvClipPosition = - mvPosition.xyz;\n#endif",color_fragment:"#if defined( USE_COLOR_ALPHA )\n\tdiffuseColor *= vColor;\n#elif defined( USE_COLOR )\n\tdiffuseColor.rgb *= vColor;\n#endif",color_pars_fragment:"#if defined( USE_COLOR_ALPHA )\n\tvarying vec4 vColor;\n#elif defined( USE_COLOR )\n\tvarying vec3 vColor;\n#endif",color_pars_vertex:"#if defined( USE_COLOR_ALPHA )\n\tvarying vec4 vColor;\n#elif defined( USE_COLOR ) || defined( USE_INSTANCING_COLOR )\n\tvarying vec3 vColor;\n#endif",color_vertex:"#if defined( USE_COLOR_ALPHA )\n\tvColor = vec4( 1.0 );\n#elif defined( USE_COLOR ) || defined( USE_INSTANCING_COLOR )\n\tvColor = vec3( 1.0 );\n#endif\n#ifdef USE_COLOR\n\tvColor *= color;\n#endif\n#ifdef USE_INSTANCING_COLOR\n\tvColor.xyz *= instanceColor.xyz;\n#endif",common:"#define PI 3.141592653589793\n#define PI2 6.283185307179586\n#define PI_HALF 1.5707963267948966\n#define RECIPROCAL_PI 0.3183098861837907\n#define RECIPROCAL_PI2 0.15915494309189535\n#define EPSILON 1e-6\n#ifndef saturate\n#define saturate( a ) clamp( a, 0.0, 1.0 )\n#endif\n#define whiteComplement( a ) ( 1.0 - saturate( a ) )\nfloat pow2( const in float x ) { return x*x; }\nvec3 pow2( const in vec3 x ) { return x*x; }\nfloat pow3( const in float x ) { return x*x*x; }\nfloat pow4( const in float x ) { float x2 = x*x; return x2*x2; }\nfloat max3( const in vec3 v ) { return max( max( v.x, v.y ), v.z ); }\nfloat average( const in vec3 v ) { return dot( v, vec3( 0.3333333 ) ); }\nhighp float rand( const in vec2 uv ) {\n\tconst highp float a = 12.9898, b = 78.233, c = 43758.5453;\n\thighp float dt = dot( uv.xy, vec2( a,b ) ), sn = mod( dt, PI );\n\treturn fract( sin( sn ) * c );\n}\n#ifdef HIGH_PRECISION\n\tfloat precisionSafeLength( vec3 v ) { return length( v ); }\n#else\n\tfloat precisionSafeLength( vec3 v ) {\n\t\tfloat maxComponent = max3( abs( v ) );\n\t\treturn length( v / maxComponent ) * maxComponent;\n\t}\n#endif\nstruct IncidentLight {\n\tvec3 color;\n\tvec3 direction;\n\tbool visible;\n};\nstruct ReflectedLight {\n\tvec3 directDiffuse;\n\tvec3 directSpecular;\n\tvec3 indirectDiffuse;\n\tvec3 indirectSpecular;\n};\nstruct GeometricContext {\n\tvec3 position;\n\tvec3 normal;\n\tvec3 viewDir;\n#ifdef USE_CLEARCOAT\n\tvec3 clearcoatNormal;\n#endif\n};\nvec3 transformDirection( in vec3 dir, in mat4 matrix ) {\n\treturn normalize( ( matrix * vec4( dir, 0.0 ) ).xyz );\n}\nvec3 inverseTransformDirection( in vec3 dir, in mat4 matrix ) {\n\treturn normalize( ( vec4( dir, 0.0 ) * matrix ).xyz );\n}\nmat3 transposeMat3( const in mat3 m ) {\n\tmat3 tmp;\n\ttmp[ 0 ] = vec3( m[ 0 ].x, m[ 1 ].x, m[ 2 ].x );\n\ttmp[ 1 ] = vec3( m[ 0 ].y, m[ 1 ].y, m[ 2 ].y );\n\ttmp[ 2 ] = vec3( m[ 0 ].z, m[ 1 ].z, m[ 2 ].z );\n\treturn tmp;\n}\nfloat luminance( const in vec3 rgb ) {\n\tconst vec3 weights = vec3( 0.2126729, 0.7151522, 0.0721750 );\n\treturn dot( weights, rgb );\n}\nbool isPerspectiveMatrix( mat4 m ) {\n\treturn m[ 2 ][ 3 ] == - 1.0;\n}\nvec2 equirectUv( in vec3 dir ) {\n\tfloat u = atan( dir.z, dir.x ) * RECIPROCAL_PI2 + 0.5;\n\tfloat v = asin( clamp( dir.y, - 1.0, 1.0 ) ) * RECIPROCAL_PI + 0.5;\n\treturn vec2( u, v );\n}",cube_uv_reflection_fragment:"#ifdef ENVMAP_TYPE_CUBE_UV\n\t#define cubeUV_minMipLevel 4.0\n\t#define cubeUV_minTileSize 16.0\n\tfloat getFace( vec3 direction ) {\n\t\tvec3 absDirection = abs( direction );\n\t\tfloat face = - 1.0;\n\t\tif ( absDirection.x > absDirection.z ) {\n\t\t\tif ( absDirection.x > absDirection.y )\n\t\t\t\tface = direction.x > 0.0 ? 0.0 : 3.0;\n\t\t\telse\n\t\t\t\tface = direction.y > 0.0 ? 1.0 : 4.0;\n\t\t} else {\n\t\t\tif ( absDirection.z > absDirection.y )\n\t\t\t\tface = direction.z > 0.0 ? 2.0 : 5.0;\n\t\t\telse\n\t\t\t\tface = direction.y > 0.0 ? 1.0 : 4.0;\n\t\t}\n\t\treturn face;\n\t}\n\tvec2 getUV( vec3 direction, float face ) {\n\t\tvec2 uv;\n\t\tif ( face == 0.0 ) {\n\t\t\tuv = vec2( direction.z, direction.y ) / abs( direction.x );\n\t\t} else if ( face == 1.0 ) {\n\t\t\tuv = vec2( - direction.x, - direction.z ) / abs( direction.y );\n\t\t} else if ( face == 2.0 ) {\n\t\t\tuv = vec2( - direction.x, direction.y ) / abs( direction.z );\n\t\t} else if ( face == 3.0 ) {\n\t\t\tuv = vec2( - direction.z, direction.y ) / abs( direction.x );\n\t\t} else if ( face == 4.0 ) {\n\t\t\tuv = vec2( - direction.x, direction.z ) / abs( direction.y );\n\t\t} else {\n\t\t\tuv = vec2( direction.x, direction.y ) / abs( direction.z );\n\t\t}\n\t\treturn 0.5 * ( uv + 1.0 );\n\t}\n\tvec3 bilinearCubeUV( sampler2D envMap, vec3 direction, float mipInt ) {\n\t\tfloat face = getFace( direction );\n\t\tfloat filterInt = max( cubeUV_minMipLevel - mipInt, 0.0 );\n\t\tmipInt = max( mipInt, cubeUV_minMipLevel );\n\t\tfloat faceSize = exp2( mipInt );\n\t\thighp vec2 uv = getUV( direction, face ) * ( faceSize - 2.0 ) + 1.0;\n\t\tif ( face > 2.0 ) {\n\t\t\tuv.y += faceSize;\n\t\t\tface -= 3.0;\n\t\t}\n\t\tuv.x += face * faceSize;\n\t\tuv.x += filterInt * 3.0 * cubeUV_minTileSize;\n\t\tuv.y += 4.0 * ( exp2( CUBEUV_MAX_MIP ) - faceSize );\n\t\tuv.x *= CUBEUV_TEXEL_WIDTH;\n\t\tuv.y *= CUBEUV_TEXEL_HEIGHT;\n\t\t#ifdef texture2DGradEXT\n\t\t\treturn texture2DGradEXT( envMap, uv, vec2( 0.0 ), vec2( 0.0 ) ).rgb;\n\t\t#else\n\t\t\treturn texture2D( envMap, uv ).rgb;\n\t\t#endif\n\t}\n\t#define cubeUV_r0 1.0\n\t#define cubeUV_v0 0.339\n\t#define cubeUV_m0 - 2.0\n\t#define cubeUV_r1 0.8\n\t#define cubeUV_v1 0.276\n\t#define cubeUV_m1 - 1.0\n\t#define cubeUV_r4 0.4\n\t#define cubeUV_v4 0.046\n\t#define cubeUV_m4 2.0\n\t#define cubeUV_r5 0.305\n\t#define cubeUV_v5 0.016\n\t#define cubeUV_m5 3.0\n\t#define cubeUV_r6 0.21\n\t#define cubeUV_v6 0.0038\n\t#define cubeUV_m6 4.0\n\tfloat roughnessToMip( float roughness ) {\n\t\tfloat mip = 0.0;\n\t\tif ( roughness >= cubeUV_r1 ) {\n\t\t\tmip = ( cubeUV_r0 - roughness ) * ( cubeUV_m1 - cubeUV_m0 ) / ( cubeUV_r0 - cubeUV_r1 ) + cubeUV_m0;\n\t\t} else if ( roughness >= cubeUV_r4 ) {\n\t\t\tmip = ( cubeUV_r1 - roughness ) * ( cubeUV_m4 - cubeUV_m1 ) / ( cubeUV_r1 - cubeUV_r4 ) + cubeUV_m1;\n\t\t} else if ( roughness >= cubeUV_r5 ) {\n\t\t\tmip = ( cubeUV_r4 - roughness ) * ( cubeUV_m5 - cubeUV_m4 ) / ( cubeUV_r4 - cubeUV_r5 ) + cubeUV_m4;\n\t\t} else if ( roughness >= cubeUV_r6 ) {\n\t\t\tmip = ( cubeUV_r5 - roughness ) * ( cubeUV_m6 - cubeUV_m5 ) / ( cubeUV_r5 - cubeUV_r6 ) + cubeUV_m5;\n\t\t} else {\n\t\t\tmip = - 2.0 * log2( 1.16 * roughness );\t\t}\n\t\treturn mip;\n\t}\n\tvec4 textureCubeUV( sampler2D envMap, vec3 sampleDir, float roughness ) {\n\t\tfloat mip = clamp( roughnessToMip( roughness ), cubeUV_m0, CUBEUV_MAX_MIP );\n\t\tfloat mipF = fract( mip );\n\t\tfloat mipInt = floor( mip );\n\t\tvec3 color0 = bilinearCubeUV( envMap, sampleDir, mipInt );\n\t\tif ( mipF == 0.0 ) {\n\t\t\treturn vec4( color0, 1.0 );\n\t\t} else {\n\t\t\tvec3 color1 = bilinearCubeUV( envMap, sampleDir, mipInt + 1.0 );\n\t\t\treturn vec4( mix( color0, color1, mipF ), 1.0 );\n\t\t}\n\t}\n#endif",defaultnormal_vertex:"vec3 transformedNormal = objectNormal;\n#ifdef USE_INSTANCING\n\tmat3 m = mat3( instanceMatrix );\n\ttransformedNormal /= vec3( dot( m[ 0 ], m[ 0 ] ), dot( m[ 1 ], m[ 1 ] ), dot( m[ 2 ], m[ 2 ] ) );\n\ttransformedNormal = m * transformedNormal;\n#endif\ntransformedNormal = normalMatrix * transformedNormal;\n#ifdef FLIP_SIDED\n\ttransformedNormal = - transformedNormal;\n#endif\n#ifdef USE_TANGENT\n\tvec3 transformedTangent = ( modelViewMatrix * vec4( objectTangent, 0.0 ) ).xyz;\n\t#ifdef FLIP_SIDED\n\t\ttransformedTangent = - transformedTangent;\n\t#endif\n#endif",displacementmap_pars_vertex:"#ifdef USE_DISPLACEMENTMAP\n\tuniform sampler2D displacementMap;\n\tuniform float displacementScale;\n\tuniform float displacementBias;\n#endif",displacementmap_vertex:"#ifdef USE_DISPLACEMENTMAP\n\ttransformed += normalize( objectNormal ) * ( texture2D( displacementMap, vUv ).x * displacementScale + displacementBias );\n#endif",emissivemap_fragment:"#ifdef USE_EMISSIVEMAP\n\tvec4 emissiveColor = texture2D( emissiveMap, vUv );\n\ttotalEmissiveRadiance *= emissiveColor.rgb;\n#endif",emissivemap_pars_fragment:"#ifdef USE_EMISSIVEMAP\n\tuniform sampler2D emissiveMap;\n#endif",encodings_fragment:"gl_FragColor = linearToOutputTexel( gl_FragColor );",encodings_pars_fragment:"vec4 LinearToLinear( in vec4 value ) {\n\treturn value;\n}\nvec4 LinearTosRGB( in vec4 value ) {\n\treturn vec4( mix( pow( value.rgb, vec3( 0.41666 ) ) * 1.055 - vec3( 0.055 ), value.rgb * 12.92, vec3( lessThanEqual( value.rgb, vec3( 0.0031308 ) ) ) ), value.a );\n}",envmap_fragment:"#ifdef USE_ENVMAP\n\t#ifdef ENV_WORLDPOS\n\t\tvec3 cameraToFrag;\n\t\tif ( isOrthographic ) {\n\t\t\tcameraToFrag = normalize( vec3( - viewMatrix[ 0 ][ 2 ], - viewMatrix[ 1 ][ 2 ], - viewMatrix[ 2 ][ 2 ] ) );\n\t\t} else {\n\t\t\tcameraToFrag = normalize( vWorldPosition - cameraPosition );\n\t\t}\n\t\tvec3 worldNormal = inverseTransformDirection( normal, viewMatrix );\n\t\t#ifdef ENVMAP_MODE_REFLECTION\n\t\t\tvec3 reflectVec = reflect( cameraToFrag, worldNormal );\n\t\t#else\n\t\t\tvec3 reflectVec = refract( cameraToFrag, worldNormal, refractionRatio );\n\t\t#endif\n\t#else\n\t\tvec3 reflectVec = vReflect;\n\t#endif\n\t#ifdef ENVMAP_TYPE_CUBE\n\t\tvec4 envColor = textureCube( envMap, vec3( flipEnvMap * reflectVec.x, reflectVec.yz ) );\n\t#else\n\t\tvec4 envColor = vec4( 0.0 );\n\t#endif\n\t#ifdef ENVMAP_BLENDING_MULTIPLY\n\t\toutgoingLight = mix( outgoingLight, outgoingLight * envColor.xyz, specularStrength * reflectivity );\n\t#elif defined( ENVMAP_BLENDING_MIX )\n\t\toutgoingLight = mix( outgoingLight, envColor.xyz, specularStrength * reflectivity );\n\t#elif defined( ENVMAP_BLENDING_ADD )\n\t\toutgoingLight += envColor.xyz * specularStrength * reflectivity;\n\t#endif\n#endif",envmap_common_pars_fragment:"#ifdef USE_ENVMAP\n\tuniform float envMapIntensity;\n\tuniform float flipEnvMap;\n\t#ifdef ENVMAP_TYPE_CUBE\n\t\tuniform samplerCube envMap;\n\t#else\n\t\tuniform sampler2D envMap;\n\t#endif\n\t\n#endif",envmap_pars_fragment:"#ifdef USE_ENVMAP\n\tuniform float reflectivity;\n\t#if defined( USE_BUMPMAP ) || defined( USE_NORMALMAP ) || defined( PHONG ) || defined( LAMBERT )\n\t\t#define ENV_WORLDPOS\n\t#endif\n\t#ifdef ENV_WORLDPOS\n\t\tvarying vec3 vWorldPosition;\n\t\tuniform float refractionRatio;\n\t#else\n\t\tvarying vec3 vReflect;\n\t#endif\n#endif",envmap_pars_vertex:"#ifdef USE_ENVMAP\n\t#if defined( USE_BUMPMAP ) || defined( USE_NORMALMAP ) || defined( PHONG ) || defined( LAMBERT )\n\t\t#define ENV_WORLDPOS\n\t#endif\n\t#ifdef ENV_WORLDPOS\n\t\t\n\t\tvarying vec3 vWorldPosition;\n\t#else\n\t\tvarying vec3 vReflect;\n\t\tuniform float refractionRatio;\n\t#endif\n#endif",envmap_physical_pars_fragment:"#if defined( USE_ENVMAP )\n\tvec3 getIBLIrradiance( const in vec3 normal ) {\n\t\t#if defined( ENVMAP_TYPE_CUBE_UV )\n\t\t\tvec3 worldNormal = inverseTransformDirection( normal, viewMatrix );\n\t\t\tvec4 envMapColor = textureCubeUV( envMap, worldNormal, 1.0 );\n\t\t\treturn PI * envMapColor.rgb * envMapIntensity;\n\t\t#else\n\t\t\treturn vec3( 0.0 );\n\t\t#endif\n\t}\n\tvec3 getIBLRadiance( const in vec3 viewDir, const in vec3 normal, const in float roughness ) {\n\t\t#if defined( ENVMAP_TYPE_CUBE_UV )\n\t\t\tvec3 reflectVec = reflect( - viewDir, normal );\n\t\t\treflectVec = normalize( mix( reflectVec, normal, roughness * roughness) );\n\t\t\treflectVec = inverseTransformDirection( reflectVec, viewMatrix );\n\t\t\tvec4 envMapColor = textureCubeUV( envMap, reflectVec, roughness );\n\t\t\treturn envMapColor.rgb * envMapIntensity;\n\t\t#else\n\t\t\treturn vec3( 0.0 );\n\t\t#endif\n\t}\n#endif",envmap_vertex:"#ifdef USE_ENVMAP\n\t#ifdef ENV_WORLDPOS\n\t\tvWorldPosition = worldPosition.xyz;\n\t#else\n\t\tvec3 cameraToVertex;\n\t\tif ( isOrthographic ) {\n\t\t\tcameraToVertex = normalize( vec3( - viewMatrix[ 0 ][ 2 ], - viewMatrix[ 1 ][ 2 ], - viewMatrix[ 2 ][ 2 ] ) );\n\t\t} else {\n\t\t\tcameraToVertex = normalize( worldPosition.xyz - cameraPosition );\n\t\t}\n\t\tvec3 worldNormal = inverseTransformDirection( transformedNormal, viewMatrix );\n\t\t#ifdef ENVMAP_MODE_REFLECTION\n\t\t\tvReflect = reflect( cameraToVertex, worldNormal );\n\t\t#else\n\t\t\tvReflect = refract( cameraToVertex, worldNormal, refractionRatio );\n\t\t#endif\n\t#endif\n#endif",fog_vertex:"#ifdef USE_FOG\n\tvFogDepth = - mvPosition.z;\n#endif",fog_pars_vertex:"#ifdef USE_FOG\n\tvarying float vFogDepth;\n#endif",fog_fragment:"#ifdef USE_FOG\n\t#ifdef FOG_EXP2\n\t\tfloat fogFactor = 1.0 - exp( - fogDensity * fogDensity * vFogDepth * vFogDepth );\n\t#else\n\t\tfloat fogFactor = smoothstep( fogNear, fogFar, vFogDepth );\n\t#endif\n\tgl_FragColor.rgb = mix( gl_FragColor.rgb, fogColor, fogFactor );\n#endif",fog_pars_fragment:"#ifdef USE_FOG\n\tuniform vec3 fogColor;\n\tvarying float vFogDepth;\n\t#ifdef FOG_EXP2\n\t\tuniform float fogDensity;\n\t#else\n\t\tuniform float fogNear;\n\t\tuniform float fogFar;\n\t#endif\n#endif",gradientmap_pars_fragment:"#ifdef USE_GRADIENTMAP\n\tuniform sampler2D gradientMap;\n#endif\nvec3 getGradientIrradiance( vec3 normal, vec3 lightDirection ) {\n\tfloat dotNL = dot( normal, lightDirection );\n\tvec2 coord = vec2( dotNL * 0.5 + 0.5, 0.0 );\n\t#ifdef USE_GRADIENTMAP\n\t\treturn vec3( texture2D( gradientMap, coord ).r );\n\t#else\n\t\tvec2 fw = fwidth( coord ) * 0.5;\n\t\treturn mix( vec3( 0.7 ), vec3( 1.0 ), smoothstep( 0.7 - fw.x, 0.7 + fw.x, coord.x ) );\n\t#endif\n}",lightmap_fragment:"#ifdef USE_LIGHTMAP\n\tvec4 lightMapTexel = texture2D( lightMap, vUv2 );\n\tvec3 lightMapIrradiance = lightMapTexel.rgb * lightMapIntensity;\n\treflectedLight.indirectDiffuse += lightMapIrradiance;\n#endif",lightmap_pars_fragment:"#ifdef USE_LIGHTMAP\n\tuniform sampler2D lightMap;\n\tuniform float lightMapIntensity;\n#endif",lights_lambert_fragment:"LambertMaterial material;\nmaterial.diffuseColor = diffuseColor.rgb;\nmaterial.specularStrength = specularStrength;",lights_lambert_pars_fragment:"varying vec3 vViewPosition;\nstruct LambertMaterial {\n\tvec3 diffuseColor;\n\tfloat specularStrength;\n};\nvoid RE_Direct_Lambert( const in IncidentLight directLight, const in GeometricContext geometry, const in LambertMaterial material, inout ReflectedLight reflectedLight ) {\n\tfloat dotNL = saturate( dot( geometry.normal, directLight.direction ) );\n\tvec3 irradiance = dotNL * directLight.color;\n\treflectedLight.directDiffuse += irradiance * BRDF_Lambert( material.diffuseColor );\n}\nvoid RE_IndirectDiffuse_Lambert( const in vec3 irradiance, const in GeometricContext geometry, const in LambertMaterial material, inout ReflectedLight reflectedLight ) {\n\treflectedLight.indirectDiffuse += irradiance * BRDF_Lambert( material.diffuseColor );\n}\n#define RE_Direct\t\t\t\tRE_Direct_Lambert\n#define RE_IndirectDiffuse\t\tRE_IndirectDiffuse_Lambert",lights_pars_begin:"uniform bool receiveShadow;\nuniform vec3 ambientLightColor;\nuniform vec3 lightProbe[ 9 ];\nvec3 shGetIrradianceAt( in vec3 normal, in vec3 shCoefficients[ 9 ] ) {\n\tfloat x = normal.x, y = normal.y, z = normal.z;\n\tvec3 result = shCoefficients[ 0 ] * 0.886227;\n\tresult += shCoefficients[ 1 ] * 2.0 * 0.511664 * y;\n\tresult += shCoefficients[ 2 ] * 2.0 * 0.511664 * z;\n\tresult += shCoefficients[ 3 ] * 2.0 * 0.511664 * x;\n\tresult += shCoefficients[ 4 ] * 2.0 * 0.429043 * x * y;\n\tresult += shCoefficients[ 5 ] * 2.0 * 0.429043 * y * z;\n\tresult += shCoefficients[ 6 ] * ( 0.743125 * z * z - 0.247708 );\n\tresult += shCoefficients[ 7 ] * 2.0 * 0.429043 * x * z;\n\tresult += shCoefficients[ 8 ] * 0.429043 * ( x * x - y * y );\n\treturn result;\n}\nvec3 getLightProbeIrradiance( const in vec3 lightProbe[ 9 ], const in vec3 normal ) {\n\tvec3 worldNormal = inverseTransformDirection( normal, viewMatrix );\n\tvec3 irradiance = shGetIrradianceAt( worldNormal, lightProbe );\n\treturn irradiance;\n}\nvec3 getAmbientLightIrradiance( const in vec3 ambientLightColor ) {\n\tvec3 irradiance = ambientLightColor;\n\treturn irradiance;\n}\nfloat getDistanceAttenuation( const in float lightDistance, const in float cutoffDistance, const in float decayExponent ) {\n\t#if defined ( PHYSICALLY_CORRECT_LIGHTS )\n\t\tfloat distanceFalloff = 1.0 / max( pow( lightDistance, decayExponent ), 0.01 );\n\t\tif ( cutoffDistance > 0.0 ) {\n\t\t\tdistanceFalloff *= pow2( saturate( 1.0 - pow4( lightDistance / cutoffDistance ) ) );\n\t\t}\n\t\treturn distanceFalloff;\n\t#else\n\t\tif ( cutoffDistance > 0.0 && decayExponent > 0.0 ) {\n\t\t\treturn pow( saturate( - lightDistance / cutoffDistance + 1.0 ), decayExponent );\n\t\t}\n\t\treturn 1.0;\n\t#endif\n}\nfloat getSpotAttenuation( const in float coneCosine, const in float penumbraCosine, const in float angleCosine ) {\n\treturn smoothstep( coneCosine, penumbraCosine, angleCosine );\n}\n#if NUM_DIR_LIGHTS > 0\n\tstruct DirectionalLight {\n\t\tvec3 direction;\n\t\tvec3 color;\n\t};\n\tuniform DirectionalLight directionalLights[ NUM_DIR_LIGHTS ];\n\tvoid getDirectionalLightInfo( const in DirectionalLight directionalLight, const in GeometricContext geometry, out IncidentLight light ) {\n\t\tlight.color = directionalLight.color;\n\t\tlight.direction = directionalLight.direction;\n\t\tlight.visible = true;\n\t}\n#endif\n#if NUM_POINT_LIGHTS > 0\n\tstruct PointLight {\n\t\tvec3 position;\n\t\tvec3 color;\n\t\tfloat distance;\n\t\tfloat decay;\n\t};\n\tuniform PointLight pointLights[ NUM_POINT_LIGHTS ];\n\tvoid getPointLightInfo( const in PointLight pointLight, const in GeometricContext geometry, out IncidentLight light ) {\n\t\tvec3 lVector = pointLight.position - geometry.position;\n\t\tlight.direction = normalize( lVector );\n\t\tfloat lightDistance = length( lVector );\n\t\tlight.color = pointLight.color;\n\t\tlight.color *= getDistanceAttenuation( lightDistance, pointLight.distance, pointLight.decay );\n\t\tlight.visible = ( light.color != vec3( 0.0 ) );\n\t}\n#endif\n#if NUM_SPOT_LIGHTS > 0\n\tstruct SpotLight {\n\t\tvec3 position;\n\t\tvec3 direction;\n\t\tvec3 color;\n\t\tfloat distance;\n\t\tfloat decay;\n\t\tfloat coneCos;\n\t\tfloat penumbraCos;\n\t};\n\tuniform SpotLight spotLights[ NUM_SPOT_LIGHTS ];\n\tvoid getSpotLightInfo( const in SpotLight spotLight, const in GeometricContext geometry, out IncidentLight light ) {\n\t\tvec3 lVector = spotLight.position - geometry.position;\n\t\tlight.direction = normalize( lVector );\n\t\tfloat angleCos = dot( light.direction, spotLight.direction );\n\t\tfloat spotAttenuation = getSpotAttenuation( spotLight.coneCos, spotLight.penumbraCos, angleCos );\n\t\tif ( spotAttenuation > 0.0 ) {\n\t\t\tfloat lightDistance = length( lVector );\n\t\t\tlight.color = spotLight.color * spotAttenuation;\n\t\t\tlight.color *= getDistanceAttenuation( lightDistance, spotLight.distance, spotLight.decay );\n\t\t\tlight.visible = ( light.color != vec3( 0.0 ) );\n\t\t} else {\n\t\t\tlight.color = vec3( 0.0 );\n\t\t\tlight.visible = false;\n\t\t}\n\t}\n#endif\n#if NUM_RECT_AREA_LIGHTS > 0\n\tstruct RectAreaLight {\n\t\tvec3 color;\n\t\tvec3 position;\n\t\tvec3 halfWidth;\n\t\tvec3 halfHeight;\n\t};\n\tuniform sampler2D ltc_1;\tuniform sampler2D ltc_2;\n\tuniform RectAreaLight rectAreaLights[ NUM_RECT_AREA_LIGHTS ];\n#endif\n#if NUM_HEMI_LIGHTS > 0\n\tstruct HemisphereLight {\n\t\tvec3 direction;\n\t\tvec3 skyColor;\n\t\tvec3 groundColor;\n\t};\n\tuniform HemisphereLight hemisphereLights[ NUM_HEMI_LIGHTS ];\n\tvec3 getHemisphereLightIrradiance( const in HemisphereLight hemiLight, const in vec3 normal ) {\n\t\tfloat dotNL = dot( normal, hemiLight.direction );\n\t\tfloat hemiDiffuseWeight = 0.5 * dotNL + 0.5;\n\t\tvec3 irradiance = mix( hemiLight.groundColor, hemiLight.skyColor, hemiDiffuseWeight );\n\t\treturn irradiance;\n\t}\n#endif",lights_toon_fragment:"ToonMaterial material;\nmaterial.diffuseColor = diffuseColor.rgb;",lights_toon_pars_fragment:"varying vec3 vViewPosition;\nstruct ToonMaterial {\n\tvec3 diffuseColor;\n};\nvoid RE_Direct_Toon( const in IncidentLight directLight, const in GeometricContext geometry, const in ToonMaterial material, inout ReflectedLight reflectedLight ) {\n\tvec3 irradiance = getGradientIrradiance( geometry.normal, directLight.direction ) * directLight.color;\n\treflectedLight.directDiffuse += irradiance * BRDF_Lambert( material.diffuseColor );\n}\nvoid RE_IndirectDiffuse_Toon( const in vec3 irradiance, const in GeometricContext geometry, const in ToonMaterial material, inout ReflectedLight reflectedLight ) {\n\treflectedLight.indirectDiffuse += irradiance * BRDF_Lambert( material.diffuseColor );\n}\n#define RE_Direct\t\t\t\tRE_Direct_Toon\n#define RE_IndirectDiffuse\t\tRE_IndirectDiffuse_Toon",lights_phong_fragment:"BlinnPhongMaterial material;\nmaterial.diffuseColor = diffuseColor.rgb;\nmaterial.specularColor = specular;\nmaterial.specularShininess = shininess;\nmaterial.specularStrength = specularStrength;",lights_phong_pars_fragment:"varying vec3 vViewPosition;\nstruct BlinnPhongMaterial {\n\tvec3 diffuseColor;\n\tvec3 specularColor;\n\tfloat specularShininess;\n\tfloat specularStrength;\n};\nvoid RE_Direct_BlinnPhong( const in IncidentLight directLight, const in GeometricContext geometry, const in BlinnPhongMaterial material, inout ReflectedLight reflectedLight ) {\n\tfloat dotNL = saturate( dot( geometry.normal, directLight.direction ) );\n\tvec3 irradiance = dotNL * directLight.color;\n\treflectedLight.directDiffuse += irradiance * BRDF_Lambert( material.diffuseColor );\n\treflectedLight.directSpecular += irradiance * BRDF_BlinnPhong( directLight.direction, geometry.viewDir, geometry.normal, material.specularColor, material.specularShininess ) * material.specularStrength;\n}\nvoid RE_IndirectDiffuse_BlinnPhong( const in vec3 irradiance, const in GeometricContext geometry, const in BlinnPhongMaterial material, inout ReflectedLight reflectedLight ) {\n\treflectedLight.indirectDiffuse += irradiance * BRDF_Lambert( material.diffuseColor );\n}\n#define RE_Direct\t\t\t\tRE_Direct_BlinnPhong\n#define RE_IndirectDiffuse\t\tRE_IndirectDiffuse_BlinnPhong",lights_physical_fragment:"PhysicalMaterial material;\nmaterial.diffuseColor = diffuseColor.rgb * ( 1.0 - metalnessFactor );\nvec3 dxy = max( abs( dFdx( geometryNormal ) ), abs( dFdy( geometryNormal ) ) );\nfloat geometryRoughness = max( max( dxy.x, dxy.y ), dxy.z );\nmaterial.roughness = max( roughnessFactor, 0.0525 );material.roughness += geometryRoughness;\nmaterial.roughness = min( material.roughness, 1.0 );\n#ifdef IOR\n\tmaterial.ior = ior;\n\t#ifdef SPECULAR\n\t\tfloat specularIntensityFactor = specularIntensity;\n\t\tvec3 specularColorFactor = specularColor;\n\t\t#ifdef USE_SPECULARINTENSITYMAP\n\t\t\tspecularIntensityFactor *= texture2D( specularIntensityMap, vUv ).a;\n\t\t#endif\n\t\t#ifdef USE_SPECULARCOLORMAP\n\t\t\tspecularColorFactor *= texture2D( specularColorMap, vUv ).rgb;\n\t\t#endif\n\t\tmaterial.specularF90 = mix( specularIntensityFactor, 1.0, metalnessFactor );\n\t#else\n\t\tfloat specularIntensityFactor = 1.0;\n\t\tvec3 specularColorFactor = vec3( 1.0 );\n\t\tmaterial.specularF90 = 1.0;\n\t#endif\n\tmaterial.specularColor = mix( min( pow2( ( material.ior - 1.0 ) / ( material.ior + 1.0 ) ) * specularColorFactor, vec3( 1.0 ) ) * specularIntensityFactor, diffuseColor.rgb, metalnessFactor );\n#else\n\tmaterial.specularColor = mix( vec3( 0.04 ), diffuseColor.rgb, metalnessFactor );\n\tmaterial.specularF90 = 1.0;\n#endif\n#ifdef USE_CLEARCOAT\n\tmaterial.clearcoat = clearcoat;\n\tmaterial.clearcoatRoughness = clearcoatRoughness;\n\tmaterial.clearcoatF0 = vec3( 0.04 );\n\tmaterial.clearcoatF90 = 1.0;\n\t#ifdef USE_CLEARCOATMAP\n\t\tmaterial.clearcoat *= texture2D( clearcoatMap, vUv ).x;\n\t#endif\n\t#ifdef USE_CLEARCOAT_ROUGHNESSMAP\n\t\tmaterial.clearcoatRoughness *= texture2D( clearcoatRoughnessMap, vUv ).y;\n\t#endif\n\tmaterial.clearcoat = saturate( material.clearcoat );\tmaterial.clearcoatRoughness = max( material.clearcoatRoughness, 0.0525 );\n\tmaterial.clearcoatRoughness += geometryRoughness;\n\tmaterial.clearcoatRoughness = min( material.clearcoatRoughness, 1.0 );\n#endif\n#ifdef USE_IRIDESCENCE\n\tmaterial.iridescence = iridescence;\n\tmaterial.iridescenceIOR = iridescenceIOR;\n\t#ifdef USE_IRIDESCENCEMAP\n\t\tmaterial.iridescence *= texture2D( iridescenceMap, vUv ).r;\n\t#endif\n\t#ifdef USE_IRIDESCENCE_THICKNESSMAP\n\t\tmaterial.iridescenceThickness = (iridescenceThicknessMaximum - iridescenceThicknessMinimum) * texture2D( iridescenceThicknessMap, vUv ).g + iridescenceThicknessMinimum;\n\t#else\n\t\tmaterial.iridescenceThickness = iridescenceThicknessMaximum;\n\t#endif\n#endif\n#ifdef USE_SHEEN\n\tmaterial.sheenColor = sheenColor;\n\t#ifdef USE_SHEENCOLORMAP\n\t\tmaterial.sheenColor *= texture2D( sheenColorMap, vUv ).rgb;\n\t#endif\n\tmaterial.sheenRoughness = clamp( sheenRoughness, 0.07, 1.0 );\n\t#ifdef USE_SHEENROUGHNESSMAP\n\t\tmaterial.sheenRoughness *= texture2D( sheenRoughnessMap, vUv ).a;\n\t#endif\n#endif",lights_physical_pars_fragment:"struct PhysicalMaterial {\n\tvec3 diffuseColor;\n\tfloat roughness;\n\tvec3 specularColor;\n\tfloat specularF90;\n\t#ifdef USE_CLEARCOAT\n\t\tfloat clearcoat;\n\t\tfloat clearcoatRoughness;\n\t\tvec3 clearcoatF0;\n\t\tfloat clearcoatF90;\n\t#endif\n\t#ifdef USE_IRIDESCENCE\n\t\tfloat iridescence;\n\t\tfloat iridescenceIOR;\n\t\tfloat iridescenceThickness;\n\t\tvec3 iridescenceFresnel;\n\t\tvec3 iridescenceF0;\n\t#endif\n\t#ifdef USE_SHEEN\n\t\tvec3 sheenColor;\n\t\tfloat sheenRoughness;\n\t#endif\n\t#ifdef IOR\n\t\tfloat ior;\n\t#endif\n\t#ifdef USE_TRANSMISSION\n\t\tfloat transmission;\n\t\tfloat transmissionAlpha;\n\t\tfloat thickness;\n\t\tfloat attenuationDistance;\n\t\tvec3 attenuationColor;\n\t#endif\n};\nvec3 clearcoatSpecular = vec3( 0.0 );\nvec3 sheenSpecular = vec3( 0.0 );\nfloat IBLSheenBRDF( const in vec3 normal, const in vec3 viewDir, const in float roughness ) {\n\tfloat dotNV = saturate( dot( normal, viewDir ) );\n\tfloat r2 = roughness * roughness;\n\tfloat a = roughness < 0.25 ? -339.2 * r2 + 161.4 * roughness - 25.9 : -8.48 * r2 + 14.3 * roughness - 9.95;\n\tfloat b = roughness < 0.25 ? 44.0 * r2 - 23.7 * roughness + 3.26 : 1.97 * r2 - 3.27 * roughness + 0.72;\n\tfloat DG = exp( a * dotNV + b ) + ( roughness < 0.25 ? 0.0 : 0.1 * ( roughness - 0.25 ) );\n\treturn saturate( DG * RECIPROCAL_PI );\n}\nvec2 DFGApprox( const in vec3 normal, const in vec3 viewDir, const in float roughness ) {\n\tfloat dotNV = saturate( dot( normal, viewDir ) );\n\tconst vec4 c0 = vec4( - 1, - 0.0275, - 0.572, 0.022 );\n\tconst vec4 c1 = vec4( 1, 0.0425, 1.04, - 0.04 );\n\tvec4 r = roughness * c0 + c1;\n\tfloat a004 = min( r.x * r.x, exp2( - 9.28 * dotNV ) ) * r.x + r.y;\n\tvec2 fab = vec2( - 1.04, 1.04 ) * a004 + r.zw;\n\treturn fab;\n}\nvec3 EnvironmentBRDF( const in vec3 normal, const in vec3 viewDir, const in vec3 specularColor, const in float specularF90, const in float roughness ) {\n\tvec2 fab = DFGApprox( normal, viewDir, roughness );\n\treturn specularColor * fab.x + specularF90 * fab.y;\n}\n#ifdef USE_IRIDESCENCE\nvoid computeMultiscatteringIridescence( const in vec3 normal, const in vec3 viewDir, const in vec3 specularColor, const in float specularF90, const in float iridescence, const in vec3 iridescenceF0, const in float roughness, inout vec3 singleScatter, inout vec3 multiScatter ) {\n#else\nvoid computeMultiscattering( const in vec3 normal, const in vec3 viewDir, const in vec3 specularColor, const in float specularF90, const in float roughness, inout vec3 singleScatter, inout vec3 multiScatter ) {\n#endif\n\tvec2 fab = DFGApprox( normal, viewDir, roughness );\n\t#ifdef USE_IRIDESCENCE\n\t\tvec3 Fr = mix( specularColor, iridescenceF0, iridescence );\n\t#else\n\t\tvec3 Fr = specularColor;\n\t#endif\n\tvec3 FssEss = Fr * fab.x + specularF90 * fab.y;\n\tfloat Ess = fab.x + fab.y;\n\tfloat Ems = 1.0 - Ess;\n\tvec3 Favg = Fr + ( 1.0 - Fr ) * 0.047619;\tvec3 Fms = FssEss * Favg / ( 1.0 - Ems * Favg );\n\tsingleScatter += FssEss;\n\tmultiScatter += Fms * Ems;\n}\n#if NUM_RECT_AREA_LIGHTS > 0\n\tvoid RE_Direct_RectArea_Physical( const in RectAreaLight rectAreaLight, const in GeometricContext geometry, const in PhysicalMaterial material, inout ReflectedLight reflectedLight ) {\n\t\tvec3 normal = geometry.normal;\n\t\tvec3 viewDir = geometry.viewDir;\n\t\tvec3 position = geometry.position;\n\t\tvec3 lightPos = rectAreaLight.position;\n\t\tvec3 halfWidth = rectAreaLight.halfWidth;\n\t\tvec3 halfHeight = rectAreaLight.halfHeight;\n\t\tvec3 lightColor = rectAreaLight.color;\n\t\tfloat roughness = material.roughness;\n\t\tvec3 rectCoords[ 4 ];\n\t\trectCoords[ 0 ] = lightPos + halfWidth - halfHeight;\t\trectCoords[ 1 ] = lightPos - halfWidth - halfHeight;\n\t\trectCoords[ 2 ] = lightPos - halfWidth + halfHeight;\n\t\trectCoords[ 3 ] = lightPos + halfWidth + halfHeight;\n\t\tvec2 uv = LTC_Uv( normal, viewDir, roughness );\n\t\tvec4 t1 = texture2D( ltc_1, uv );\n\t\tvec4 t2 = texture2D( ltc_2, uv );\n\t\tmat3 mInv = mat3(\n\t\t\tvec3( t1.x, 0, t1.y ),\n\t\t\tvec3(    0, 1,    0 ),\n\t\t\tvec3( t1.z, 0, t1.w )\n\t\t);\n\t\tvec3 fresnel = ( material.specularColor * t2.x + ( vec3( 1.0 ) - material.specularColor ) * t2.y );\n\t\treflectedLight.directSpecular += lightColor * fresnel * LTC_Evaluate( normal, viewDir, position, mInv, rectCoords );\n\t\treflectedLight.directDiffuse += lightColor * material.diffuseColor * LTC_Evaluate( normal, viewDir, position, mat3( 1.0 ), rectCoords );\n\t}\n#endif\nvoid RE_Direct_Physical( const in IncidentLight directLight, const in GeometricContext geometry, const in PhysicalMaterial material, inout ReflectedLight reflectedLight ) {\n\tfloat dotNL = saturate( dot( geometry.normal, directLight.direction ) );\n\tvec3 irradiance = dotNL * directLight.color;\n\t#ifdef USE_CLEARCOAT\n\t\tfloat dotNLcc = saturate( dot( geometry.clearcoatNormal, directLight.direction ) );\n\t\tvec3 ccIrradiance = dotNLcc * directLight.color;\n\t\tclearcoatSpecular += ccIrradiance * BRDF_GGX( directLight.direction, geometry.viewDir, geometry.clearcoatNormal, material.clearcoatF0, material.clearcoatF90, material.clearcoatRoughness );\n\t#endif\n\t#ifdef USE_SHEEN\n\t\tsheenSpecular += irradiance * BRDF_Sheen( directLight.direction, geometry.viewDir, geometry.normal, material.sheenColor, material.sheenRoughness );\n\t#endif\n\t#ifdef USE_IRIDESCENCE\n\t\treflectedLight.directSpecular += irradiance * BRDF_GGX_Iridescence( directLight.direction, geometry.viewDir, geometry.normal, material.specularColor, material.specularF90, material.iridescence, material.iridescenceFresnel, material.roughness );\n\t#else\n\t\treflectedLight.directSpecular += irradiance * BRDF_GGX( directLight.direction, geometry.viewDir, geometry.normal, material.specularColor, material.specularF90, material.roughness );\n\t#endif\n\treflectedLight.directDiffuse += irradiance * BRDF_Lambert( material.diffuseColor );\n}\nvoid RE_IndirectDiffuse_Physical( const in vec3 irradiance, const in GeometricContext geometry, const in PhysicalMaterial material, inout ReflectedLight reflectedLight ) {\n\treflectedLight.indirectDiffuse += irradiance * BRDF_Lambert( material.diffuseColor );\n}\nvoid RE_IndirectSpecular_Physical( const in vec3 radiance, const in vec3 irradiance, const in vec3 clearcoatRadiance, const in GeometricContext geometry, const in PhysicalMaterial material, inout ReflectedLight reflectedLight) {\n\t#ifdef USE_CLEARCOAT\n\t\tclearcoatSpecular += clearcoatRadiance * EnvironmentBRDF( geometry.clearcoatNormal, geometry.viewDir, material.clearcoatF0, material.clearcoatF90, material.clearcoatRoughness );\n\t#endif\n\t#ifdef USE_SHEEN\n\t\tsheenSpecular += irradiance * material.sheenColor * IBLSheenBRDF( geometry.normal, geometry.viewDir, material.sheenRoughness );\n\t#endif\n\tvec3 singleScattering = vec3( 0.0 );\n\tvec3 multiScattering = vec3( 0.0 );\n\tvec3 cosineWeightedIrradiance = irradiance * RECIPROCAL_PI;\n\t#ifdef USE_IRIDESCENCE\n\t\tcomputeMultiscatteringIridescence( geometry.normal, geometry.viewDir, material.specularColor, material.specularF90, material.iridescence, material.iridescenceFresnel, material.roughness, singleScattering, multiScattering );\n\t#else\n\t\tcomputeMultiscattering( geometry.normal, geometry.viewDir, material.specularColor, material.specularF90, material.roughness, singleScattering, multiScattering );\n\t#endif\n\tvec3 totalScattering = singleScattering + multiScattering;\n\tvec3 diffuse = material.diffuseColor * ( 1.0 - max( max( totalScattering.r, totalScattering.g ), totalScattering.b ) );\n\treflectedLight.indirectSpecular += radiance * singleScattering;\n\treflectedLight.indirectSpecular += multiScattering * cosineWeightedIrradiance;\n\treflectedLight.indirectDiffuse += diffuse * cosineWeightedIrradiance;\n}\n#define RE_Direct\t\t\t\tRE_Direct_Physical\n#define RE_Direct_RectArea\t\tRE_Direct_RectArea_Physical\n#define RE_IndirectDiffuse\t\tRE_IndirectDiffuse_Physical\n#define RE_IndirectSpecular\t\tRE_IndirectSpecular_Physical\nfloat computeSpecularOcclusion( const in float dotNV, const in float ambientOcclusion, const in float roughness ) {\n\treturn saturate( pow( dotNV + ambientOcclusion, exp2( - 16.0 * roughness - 1.0 ) ) - 1.0 + ambientOcclusion );\n}",lights_fragment_begin:"\nGeometricContext geometry;\ngeometry.position = - vViewPosition;\ngeometry.normal = normal;\ngeometry.viewDir = ( isOrthographic ) ? vec3( 0, 0, 1 ) : normalize( vViewPosition );\n#ifdef USE_CLEARCOAT\n\tgeometry.clearcoatNormal = clearcoatNormal;\n#endif\n#ifdef USE_IRIDESCENCE\n\tfloat dotNVi = saturate( dot( normal, geometry.viewDir ) );\n\tif ( material.iridescenceThickness == 0.0 ) {\n\t\tmaterial.iridescence = 0.0;\n\t} else {\n\t\tmaterial.iridescence = saturate( material.iridescence );\n\t}\n\tif ( material.iridescence > 0.0 ) {\n\t\tmaterial.iridescenceFresnel = evalIridescence( 1.0, material.iridescenceIOR, dotNVi, material.iridescenceThickness, material.specularColor );\n\t\tmaterial.iridescenceF0 = Schlick_to_F0( material.iridescenceFresnel, 1.0, dotNVi );\n\t}\n#endif\nIncidentLight directLight;\n#if ( NUM_POINT_LIGHTS > 0 ) && defined( RE_Direct )\n\tPointLight pointLight;\n\t#if defined( USE_SHADOWMAP ) && NUM_POINT_LIGHT_SHADOWS > 0\n\tPointLightShadow pointLightShadow;\n\t#endif\n\t#pragma unroll_loop_start\n\tfor ( int i = 0; i < NUM_POINT_LIGHTS; i ++ ) {\n\t\tpointLight = pointLights[ i ];\n\t\tgetPointLightInfo( pointLight, geometry, directLight );\n\t\t#if defined( USE_SHADOWMAP ) && ( UNROLLED_LOOP_INDEX < NUM_POINT_LIGHT_SHADOWS )\n\t\tpointLightShadow = pointLightShadows[ i ];\n\t\tdirectLight.color *= ( directLight.visible && receiveShadow ) ? getPointShadow( pointShadowMap[ i ], pointLightShadow.shadowMapSize, pointLightShadow.shadowBias, pointLightShadow.shadowRadius, vPointShadowCoord[ i ], pointLightShadow.shadowCameraNear, pointLightShadow.shadowCameraFar ) : 1.0;\n\t\t#endif\n\t\tRE_Direct( directLight, geometry, material, reflectedLight );\n\t}\n\t#pragma unroll_loop_end\n#endif\n#if ( NUM_SPOT_LIGHTS > 0 ) && defined( RE_Direct )\n\tSpotLight spotLight;\n\tvec4 spotColor;\n\tvec3 spotLightCoord;\n\tbool inSpotLightMap;\n\t#if defined( USE_SHADOWMAP ) && NUM_SPOT_LIGHT_SHADOWS > 0\n\tSpotLightShadow spotLightShadow;\n\t#endif\n\t#pragma unroll_loop_start\n\tfor ( int i = 0; i < NUM_SPOT_LIGHTS; i ++ ) {\n\t\tspotLight = spotLights[ i ];\n\t\tgetSpotLightInfo( spotLight, geometry, directLight );\n\t\t#if ( UNROLLED_LOOP_INDEX < NUM_SPOT_LIGHT_SHADOWS_WITH_MAPS )\n\t\t#define SPOT_LIGHT_MAP_INDEX UNROLLED_LOOP_INDEX\n\t\t#elif ( UNROLLED_LOOP_INDEX < NUM_SPOT_LIGHT_SHADOWS )\n\t\t#define SPOT_LIGHT_MAP_INDEX NUM_SPOT_LIGHT_MAPS\n\t\t#else\n\t\t#define SPOT_LIGHT_MAP_INDEX ( UNROLLED_LOOP_INDEX - NUM_SPOT_LIGHT_SHADOWS + NUM_SPOT_LIGHT_SHADOWS_WITH_MAPS )\n\t\t#endif\n\t\t#if ( SPOT_LIGHT_MAP_INDEX < NUM_SPOT_LIGHT_MAPS )\n\t\t\tspotLightCoord = vSpotLightCoord[ i ].xyz / vSpotLightCoord[ i ].w;\n\t\t\tinSpotLightMap = all( lessThan( abs( spotLightCoord * 2. - 1. ), vec3( 1.0 ) ) );\n\t\t\tspotColor = texture2D( spotLightMap[ SPOT_LIGHT_MAP_INDEX ], spotLightCoord.xy );\n\t\t\tdirectLight.color = inSpotLightMap ? directLight.color * spotColor.rgb : directLight.color;\n\t\t#endif\n\t\t#undef SPOT_LIGHT_MAP_INDEX\n\t\t#if defined( USE_SHADOWMAP ) && ( UNROLLED_LOOP_INDEX < NUM_SPOT_LIGHT_SHADOWS )\n\t\tspotLightShadow = spotLightShadows[ i ];\n\t\tdirectLight.color *= ( directLight.visible && receiveShadow ) ? getShadow( spotShadowMap[ i ], spotLightShadow.shadowMapSize, spotLightShadow.shadowBias, spotLightShadow.shadowRadius, vSpotLightCoord[ i ] ) : 1.0;\n\t\t#endif\n\t\tRE_Direct( directLight, geometry, material, reflectedLight );\n\t}\n\t#pragma unroll_loop_end\n#endif\n#if ( NUM_DIR_LIGHTS > 0 ) && defined( RE_Direct )\n\tDirectionalLight directionalLight;\n\t#if defined( USE_SHADOWMAP ) && NUM_DIR_LIGHT_SHADOWS > 0\n\tDirectionalLightShadow directionalLightShadow;\n\t#endif\n\t#pragma unroll_loop_start\n\tfor ( int i = 0; i < NUM_DIR_LIGHTS; i ++ ) {\n\t\tdirectionalLight = directionalLights[ i ];\n\t\tgetDirectionalLightInfo( directionalLight, geometry, directLight );\n\t\t#if defined( USE_SHADOWMAP ) && ( UNROLLED_LOOP_INDEX < NUM_DIR_LIGHT_SHADOWS )\n\t\tdirectionalLightShadow = directionalLightShadows[ i ];\n\t\tdirectLight.color *= ( directLight.visible && receiveShadow ) ? getShadow( directionalShadowMap[ i ], directionalLightShadow.shadowMapSize, directionalLightShadow.shadowBias, directionalLightShadow.shadowRadius, vDirectionalShadowCoord[ i ] ) : 1.0;\n\t\t#endif\n\t\tRE_Direct( directLight, geometry, material, reflectedLight );\n\t}\n\t#pragma unroll_loop_end\n#endif\n#if ( NUM_RECT_AREA_LIGHTS > 0 ) && defined( RE_Direct_RectArea )\n\tRectAreaLight rectAreaLight;\n\t#pragma unroll_loop_start\n\tfor ( int i = 0; i < NUM_RECT_AREA_LIGHTS; i ++ ) {\n\t\trectAreaLight = rectAreaLights[ i ];\n\t\tRE_Direct_RectArea( rectAreaLight, geometry, material, reflectedLight );\n\t}\n\t#pragma unroll_loop_end\n#endif\n#if defined( RE_IndirectDiffuse )\n\tvec3 iblIrradiance = vec3( 0.0 );\n\tvec3 irradiance = getAmbientLightIrradiance( ambientLightColor );\n\tirradiance += getLightProbeIrradiance( lightProbe, geometry.normal );\n\t#if ( NUM_HEMI_LIGHTS > 0 )\n\t\t#pragma unroll_loop_start\n\t\tfor ( int i = 0; i < NUM_HEMI_LIGHTS; i ++ ) {\n\t\t\tirradiance += getHemisphereLightIrradiance( hemisphereLights[ i ], geometry.normal );\n\t\t}\n\t\t#pragma unroll_loop_end\n\t#endif\n#endif\n#if defined( RE_IndirectSpecular )\n\tvec3 radiance = vec3( 0.0 );\n\tvec3 clearcoatRadiance = vec3( 0.0 );\n#endif",lights_fragment_maps:"#if defined( RE_IndirectDiffuse )\n\t#ifdef USE_LIGHTMAP\n\t\tvec4 lightMapTexel = texture2D( lightMap, vUv2 );\n\t\tvec3 lightMapIrradiance = lightMapTexel.rgb * lightMapIntensity;\n\t\tirradiance += lightMapIrradiance;\n\t#endif\n\t#if defined( USE_ENVMAP ) && defined( STANDARD ) && defined( ENVMAP_TYPE_CUBE_UV )\n\t\tiblIrradiance += getIBLIrradiance( geometry.normal );\n\t#endif\n#endif\n#if defined( USE_ENVMAP ) && defined( RE_IndirectSpecular )\n\tradiance += getIBLRadiance( geometry.viewDir, geometry.normal, material.roughness );\n\t#ifdef USE_CLEARCOAT\n\t\tclearcoatRadiance += getIBLRadiance( geometry.viewDir, geometry.clearcoatNormal, material.clearcoatRoughness );\n\t#endif\n#endif",lights_fragment_end:"#if defined( RE_IndirectDiffuse )\n\tRE_IndirectDiffuse( irradiance, geometry, material, reflectedLight );\n#endif\n#if defined( RE_IndirectSpecular )\n\tRE_IndirectSpecular( radiance, iblIrradiance, clearcoatRadiance, geometry, material, reflectedLight );\n#endif",logdepthbuf_fragment:"#if defined( USE_LOGDEPTHBUF ) && defined( USE_LOGDEPTHBUF_EXT )\n\tgl_FragDepthEXT = vIsPerspective == 0.0 ? gl_FragCoord.z : log2( vFragDepth ) * logDepthBufFC * 0.5;\n#endif",logdepthbuf_pars_fragment:"#if defined( USE_LOGDEPTHBUF ) && defined( USE_LOGDEPTHBUF_EXT )\n\tuniform float logDepthBufFC;\n\tvarying float vFragDepth;\n\tvarying float vIsPerspective;\n#endif",logdepthbuf_pars_vertex:"#ifdef USE_LOGDEPTHBUF\n\t#ifdef USE_LOGDEPTHBUF_EXT\n\t\tvarying float vFragDepth;\n\t\tvarying float vIsPerspective;\n\t#else\n\t\tuniform float logDepthBufFC;\n\t#endif\n#endif",logdepthbuf_vertex:"#ifdef USE_LOGDEPTHBUF\n\t#ifdef USE_LOGDEPTHBUF_EXT\n\t\tvFragDepth = 1.0 + gl_Position.w;\n\t\tvIsPerspective = float( isPerspectiveMatrix( projectionMatrix ) );\n\t#else\n\t\tif ( isPerspectiveMatrix( projectionMatrix ) ) {\n\t\t\tgl_Position.z = log2( max( EPSILON, gl_Position.w + 1.0 ) ) * logDepthBufFC - 1.0;\n\t\t\tgl_Position.z *= gl_Position.w;\n\t\t}\n\t#endif\n#endif",map_fragment:"#ifdef USE_MAP\n\tvec4 sampledDiffuseColor = texture2D( map, vUv );\n\t#ifdef DECODE_VIDEO_TEXTURE\n\t\tsampledDiffuseColor = vec4( mix( pow( sampledDiffuseColor.rgb * 0.9478672986 + vec3( 0.0521327014 ), vec3( 2.4 ) ), sampledDiffuseColor.rgb * 0.0773993808, vec3( lessThanEqual( sampledDiffuseColor.rgb, vec3( 0.04045 ) ) ) ), sampledDiffuseColor.w );\n\t#endif\n\tdiffuseColor *= sampledDiffuseColor;\n#endif",map_pars_fragment:"#ifdef USE_MAP\n\tuniform sampler2D map;\n#endif",map_particle_fragment:"#if defined( USE_MAP ) || defined( USE_ALPHAMAP )\n\tvec2 uv = ( uvTransform * vec3( gl_PointCoord.x, 1.0 - gl_PointCoord.y, 1 ) ).xy;\n#endif\n#ifdef USE_MAP\n\tdiffuseColor *= texture2D( map, uv );\n#endif\n#ifdef USE_ALPHAMAP\n\tdiffuseColor.a *= texture2D( alphaMap, uv ).g;\n#endif",map_particle_pars_fragment:"#if defined( USE_MAP ) || defined( USE_ALPHAMAP )\n\tuniform mat3 uvTransform;\n#endif\n#ifdef USE_MAP\n\tuniform sampler2D map;\n#endif\n#ifdef USE_ALPHAMAP\n\tuniform sampler2D alphaMap;\n#endif",metalnessmap_fragment:"float metalnessFactor = metalness;\n#ifdef USE_METALNESSMAP\n\tvec4 texelMetalness = texture2D( metalnessMap, vUv );\n\tmetalnessFactor *= texelMetalness.b;\n#endif",metalnessmap_pars_fragment:"#ifdef USE_METALNESSMAP\n\tuniform sampler2D metalnessMap;\n#endif",morphcolor_vertex:"#if defined( USE_MORPHCOLORS ) && defined( MORPHTARGETS_TEXTURE )\n\tvColor *= morphTargetBaseInfluence;\n\tfor ( int i = 0; i < MORPHTARGETS_COUNT; i ++ ) {\n\t\t#if defined( USE_COLOR_ALPHA )\n\t\t\tif ( morphTargetInfluences[ i ] != 0.0 ) vColor += getMorph( gl_VertexID, i, 2 ) * morphTargetInfluences[ i ];\n\t\t#elif defined( USE_COLOR )\n\t\t\tif ( morphTargetInfluences[ i ] != 0.0 ) vColor += getMorph( gl_VertexID, i, 2 ).rgb * morphTargetInfluences[ i ];\n\t\t#endif\n\t}\n#endif",morphnormal_vertex:"#ifdef USE_MORPHNORMALS\n\tobjectNormal *= morphTargetBaseInfluence;\n\t#ifdef MORPHTARGETS_TEXTURE\n\t\tfor ( int i = 0; i < MORPHTARGETS_COUNT; i ++ ) {\n\t\t\tif ( morphTargetInfluences[ i ] != 0.0 ) objectNormal += getMorph( gl_VertexID, i, 1 ).xyz * morphTargetInfluences[ i ];\n\t\t}\n\t#else\n\t\tobjectNormal += morphNormal0 * morphTargetInfluences[ 0 ];\n\t\tobjectNormal += morphNormal1 * morphTargetInfluences[ 1 ];\n\t\tobjectNormal += morphNormal2 * morphTargetInfluences[ 2 ];\n\t\tobjectNormal += morphNormal3 * morphTargetInfluences[ 3 ];\n\t#endif\n#endif",morphtarget_pars_vertex:"#ifdef USE_MORPHTARGETS\n\tuniform float morphTargetBaseInfluence;\n\t#ifdef MORPHTARGETS_TEXTURE\n\t\tuniform float morphTargetInfluences[ MORPHTARGETS_COUNT ];\n\t\tuniform sampler2DArray morphTargetsTexture;\n\t\tuniform ivec2 morphTargetsTextureSize;\n\t\tvec4 getMorph( const in int vertexIndex, const in int morphTargetIndex, const in int offset ) {\n\t\t\tint texelIndex = vertexIndex * MORPHTARGETS_TEXTURE_STRIDE + offset;\n\t\t\tint y = texelIndex / morphTargetsTextureSize.x;\n\t\t\tint x = texelIndex - y * morphTargetsTextureSize.x;\n\t\t\tivec3 morphUV = ivec3( x, y, morphTargetIndex );\n\t\t\treturn texelFetch( morphTargetsTexture, morphUV, 0 );\n\t\t}\n\t#else\n\t\t#ifndef USE_MORPHNORMALS\n\t\t\tuniform float morphTargetInfluences[ 8 ];\n\t\t#else\n\t\t\tuniform float morphTargetInfluences[ 4 ];\n\t\t#endif\n\t#endif\n#endif",morphtarget_vertex:"#ifdef USE_MORPHTARGETS\n\ttransformed *= morphTargetBaseInfluence;\n\t#ifdef MORPHTARGETS_TEXTURE\n\t\tfor ( int i = 0; i < MORPHTARGETS_COUNT; i ++ ) {\n\t\t\tif ( morphTargetInfluences[ i ] != 0.0 ) transformed += getMorph( gl_VertexID, i, 0 ).xyz * morphTargetInfluences[ i ];\n\t\t}\n\t#else\n\t\ttransformed += morphTarget0 * morphTargetInfluences[ 0 ];\n\t\ttransformed += morphTarget1 * morphTargetInfluences[ 1 ];\n\t\ttransformed += morphTarget2 * morphTargetInfluences[ 2 ];\n\t\ttransformed += morphTarget3 * morphTargetInfluences[ 3 ];\n\t\t#ifndef USE_MORPHNORMALS\n\t\t\ttransformed += morphTarget4 * morphTargetInfluences[ 4 ];\n\t\t\ttransformed += morphTarget5 * morphTargetInfluences[ 5 ];\n\t\t\ttransformed += morphTarget6 * morphTargetInfluences[ 6 ];\n\t\t\ttransformed += morphTarget7 * morphTargetInfluences[ 7 ];\n\t\t#endif\n\t#endif\n#endif",normal_fragment_begin:"float faceDirection = gl_FrontFacing ? 1.0 : - 1.0;\n#ifdef FLAT_SHADED\n\tvec3 fdx = dFdx( vViewPosition );\n\tvec3 fdy = dFdy( vViewPosition );\n\tvec3 normal = normalize( cross( fdx, fdy ) );\n#else\n\tvec3 normal = normalize( vNormal );\n\t#ifdef DOUBLE_SIDED\n\t\tnormal = normal * faceDirection;\n\t#endif\n\t#ifdef USE_TANGENT\n\t\tvec3 tangent = normalize( vTangent );\n\t\tvec3 bitangent = normalize( vBitangent );\n\t\t#ifdef DOUBLE_SIDED\n\t\t\ttangent = tangent * faceDirection;\n\t\t\tbitangent = bitangent * faceDirection;\n\t\t#endif\n\t\t#if defined( TANGENTSPACE_NORMALMAP ) || defined( USE_CLEARCOAT_NORMALMAP )\n\t\t\tmat3 vTBN = mat3( tangent, bitangent, normal );\n\t\t#endif\n\t#endif\n#endif\nvec3 geometryNormal = normal;",normal_fragment_maps:"#ifdef OBJECTSPACE_NORMALMAP\n\tnormal = texture2D( normalMap, vUv ).xyz * 2.0 - 1.0;\n\t#ifdef FLIP_SIDED\n\t\tnormal = - normal;\n\t#endif\n\t#ifdef DOUBLE_SIDED\n\t\tnormal = normal * faceDirection;\n\t#endif\n\tnormal = normalize( normalMatrix * normal );\n#elif defined( TANGENTSPACE_NORMALMAP )\n\tvec3 mapN = texture2D( normalMap, vUv ).xyz * 2.0 - 1.0;\n\tmapN.xy *= normalScale;\n\t#ifdef USE_TANGENT\n\t\tnormal = normalize( vTBN * mapN );\n\t#else\n\t\tnormal = perturbNormal2Arb( - vViewPosition, normal, mapN, faceDirection );\n\t#endif\n#elif defined( USE_BUMPMAP )\n\tnormal = perturbNormalArb( - vViewPosition, normal, dHdxy_fwd(), faceDirection );\n#endif",normal_pars_fragment:"#ifndef FLAT_SHADED\n\tvarying vec3 vNormal;\n\t#ifdef USE_TANGENT\n\t\tvarying vec3 vTangent;\n\t\tvarying vec3 vBitangent;\n\t#endif\n#endif",normal_pars_vertex:"#ifndef FLAT_SHADED\n\tvarying vec3 vNormal;\n\t#ifdef USE_TANGENT\n\t\tvarying vec3 vTangent;\n\t\tvarying vec3 vBitangent;\n\t#endif\n#endif",normal_vertex:"#ifndef FLAT_SHADED\n\tvNormal = normalize( transformedNormal );\n\t#ifdef USE_TANGENT\n\t\tvTangent = normalize( transformedTangent );\n\t\tvBitangent = normalize( cross( vNormal, vTangent ) * tangent.w );\n\t#endif\n#endif",normalmap_pars_fragment:"#ifdef USE_NORMALMAP\n\tuniform sampler2D normalMap;\n\tuniform vec2 normalScale;\n#endif\n#ifdef OBJECTSPACE_NORMALMAP\n\tuniform mat3 normalMatrix;\n#endif\n#if ! defined ( USE_TANGENT ) && ( defined ( TANGENTSPACE_NORMALMAP ) || defined ( USE_CLEARCOAT_NORMALMAP ) )\n\tvec3 perturbNormal2Arb( vec3 eye_pos, vec3 surf_norm, vec3 mapN, float faceDirection ) {\n\t\tvec3 q0 = dFdx( eye_pos.xyz );\n\t\tvec3 q1 = dFdy( eye_pos.xyz );\n\t\tvec2 st0 = dFdx( vUv.st );\n\t\tvec2 st1 = dFdy( vUv.st );\n\t\tvec3 N = surf_norm;\n\t\tvec3 q1perp = cross( q1, N );\n\t\tvec3 q0perp = cross( N, q0 );\n\t\tvec3 T = q1perp * st0.x + q0perp * st1.x;\n\t\tvec3 B = q1perp * st0.y + q0perp * st1.y;\n\t\tfloat det = max( dot( T, T ), dot( B, B ) );\n\t\tfloat scale = ( det == 0.0 ) ? 0.0 : faceDirection * inversesqrt( det );\n\t\treturn normalize( T * ( mapN.x * scale ) + B * ( mapN.y * scale ) + N * mapN.z );\n\t}\n#endif",clearcoat_normal_fragment_begin:"#ifdef USE_CLEARCOAT\n\tvec3 clearcoatNormal = geometryNormal;\n#endif",clearcoat_normal_fragment_maps:"#ifdef USE_CLEARCOAT_NORMALMAP\n\tvec3 clearcoatMapN = texture2D( clearcoatNormalMap, vUv ).xyz * 2.0 - 1.0;\n\tclearcoatMapN.xy *= clearcoatNormalScale;\n\t#ifdef USE_TANGENT\n\t\tclearcoatNormal = normalize( vTBN * clearcoatMapN );\n\t#else\n\t\tclearcoatNormal = perturbNormal2Arb( - vViewPosition, clearcoatNormal, clearcoatMapN, faceDirection );\n\t#endif\n#endif",clearcoat_pars_fragment:"#ifdef USE_CLEARCOATMAP\n\tuniform sampler2D clearcoatMap;\n#endif\n#ifdef USE_CLEARCOAT_ROUGHNESSMAP\n\tuniform sampler2D clearcoatRoughnessMap;\n#endif\n#ifdef USE_CLEARCOAT_NORMALMAP\n\tuniform sampler2D clearcoatNormalMap;\n\tuniform vec2 clearcoatNormalScale;\n#endif",iridescence_pars_fragment:"#ifdef USE_IRIDESCENCEMAP\n\tuniform sampler2D iridescenceMap;\n#endif\n#ifdef USE_IRIDESCENCE_THICKNESSMAP\n\tuniform sampler2D iridescenceThicknessMap;\n#endif",output_fragment:"#ifdef OPAQUE\ndiffuseColor.a = 1.0;\n#endif\n#ifdef USE_TRANSMISSION\ndiffuseColor.a *= material.transmissionAlpha + 0.1;\n#endif\ngl_FragColor = vec4( outgoingLight, diffuseColor.a );",packing:"vec3 packNormalToRGB( const in vec3 normal ) {\n\treturn normalize( normal ) * 0.5 + 0.5;\n}\nvec3 unpackRGBToNormal( const in vec3 rgb ) {\n\treturn 2.0 * rgb.xyz - 1.0;\n}\nconst float PackUpscale = 256. / 255.;const float UnpackDownscale = 255. / 256.;\nconst vec3 PackFactors = vec3( 256. * 256. * 256., 256. * 256., 256. );\nconst vec4 UnpackFactors = UnpackDownscale / vec4( PackFactors, 1. );\nconst float ShiftRight8 = 1. / 256.;\nvec4 packDepthToRGBA( const in float v ) {\n\tvec4 r = vec4( fract( v * PackFactors ), v );\n\tr.yzw -= r.xyz * ShiftRight8;\treturn r * PackUpscale;\n}\nfloat unpackRGBAToDepth( const in vec4 v ) {\n\treturn dot( v, UnpackFactors );\n}\nvec2 packDepthToRG( in highp float v ) {\n\treturn packDepthToRGBA( v ).yx;\n}\nfloat unpackRGToDepth( const in highp vec2 v ) {\n\treturn unpackRGBAToDepth( vec4( v.xy, 0.0, 0.0 ) );\n}\nvec4 pack2HalfToRGBA( vec2 v ) {\n\tvec4 r = vec4( v.x, fract( v.x * 255.0 ), v.y, fract( v.y * 255.0 ) );\n\treturn vec4( r.x - r.y / 255.0, r.y, r.z - r.w / 255.0, r.w );\n}\nvec2 unpackRGBATo2Half( vec4 v ) {\n\treturn vec2( v.x + ( v.y / 255.0 ), v.z + ( v.w / 255.0 ) );\n}\nfloat viewZToOrthographicDepth( const in float viewZ, const in float near, const in float far ) {\n\treturn ( viewZ + near ) / ( near - far );\n}\nfloat orthographicDepthToViewZ( const in float linearClipZ, const in float near, const in float far ) {\n\treturn linearClipZ * ( near - far ) - near;\n}\nfloat viewZToPerspectiveDepth( const in float viewZ, const in float near, const in float far ) {\n\treturn ( ( near + viewZ ) * far ) / ( ( far - near ) * viewZ );\n}\nfloat perspectiveDepthToViewZ( const in float invClipZ, const in float near, const in float far ) {\n\treturn ( near * far ) / ( ( far - near ) * invClipZ - far );\n}",premultiplied_alpha_fragment:"#ifdef PREMULTIPLIED_ALPHA\n\tgl_FragColor.rgb *= gl_FragColor.a;\n#endif",project_vertex:"vec4 mvPosition = vec4( transformed, 1.0 );\n#ifdef USE_INSTANCING\n\tmvPosition = instanceMatrix * mvPosition;\n#endif\nmvPosition = modelViewMatrix * mvPosition;\ngl_Position = projectionMatrix * mvPosition;",dithering_fragment:"#ifdef DITHERING\n\tgl_FragColor.rgb = dithering( gl_FragColor.rgb );\n#endif",dithering_pars_fragment:"#ifdef DITHERING\n\tvec3 dithering( vec3 color ) {\n\t\tfloat grid_position = rand( gl_FragCoord.xy );\n\t\tvec3 dither_shift_RGB = vec3( 0.25 / 255.0, -0.25 / 255.0, 0.25 / 255.0 );\n\t\tdither_shift_RGB = mix( 2.0 * dither_shift_RGB, -2.0 * dither_shift_RGB, grid_position );\n\t\treturn color + dither_shift_RGB;\n\t}\n#endif",roughnessmap_fragment:"float roughnessFactor = roughness;\n#ifdef USE_ROUGHNESSMAP\n\tvec4 texelRoughness = texture2D( roughnessMap, vUv );\n\troughnessFactor *= texelRoughness.g;\n#endif",roughnessmap_pars_fragment:"#ifdef USE_ROUGHNESSMAP\n\tuniform sampler2D roughnessMap;\n#endif",shadowmap_pars_fragment:"#if NUM_SPOT_LIGHT_COORDS > 0\n  varying vec4 vSpotLightCoord[ NUM_SPOT_LIGHT_COORDS ];\n#endif\n#if NUM_SPOT_LIGHT_MAPS > 0\n  uniform sampler2D spotLightMap[ NUM_SPOT_LIGHT_MAPS ];\n#endif\n#ifdef USE_SHADOWMAP\n\t#if NUM_DIR_LIGHT_SHADOWS > 0\n\t\tuniform sampler2D directionalShadowMap[ NUM_DIR_LIGHT_SHADOWS ];\n\t\tvarying vec4 vDirectionalShadowCoord[ NUM_DIR_LIGHT_SHADOWS ];\n\t\tstruct DirectionalLightShadow {\n\t\t\tfloat shadowBias;\n\t\t\tfloat shadowNormalBias;\n\t\t\tfloat shadowRadius;\n\t\t\tvec2 shadowMapSize;\n\t\t};\n\t\tuniform DirectionalLightShadow directionalLightShadows[ NUM_DIR_LIGHT_SHADOWS ];\n\t#endif\n\t#if NUM_SPOT_LIGHT_SHADOWS > 0\n\t\tuniform sampler2D spotShadowMap[ NUM_SPOT_LIGHT_SHADOWS ];\n\t\tstruct SpotLightShadow {\n\t\t\tfloat shadowBias;\n\t\t\tfloat shadowNormalBias;\n\t\t\tfloat shadowRadius;\n\t\t\tvec2 shadowMapSize;\n\t\t};\n\t\tuniform SpotLightShadow spotLightShadows[ NUM_SPOT_LIGHT_SHADOWS ];\n\t#endif\n\t#if NUM_POINT_LIGHT_SHADOWS > 0\n\t\tuniform sampler2D pointShadowMap[ NUM_POINT_LIGHT_SHADOWS ];\n\t\tvarying vec4 vPointShadowCoord[ NUM_POINT_LIGHT_SHADOWS ];\n\t\tstruct PointLightShadow {\n\t\t\tfloat shadowBias;\n\t\t\tfloat shadowNormalBias;\n\t\t\tfloat shadowRadius;\n\t\t\tvec2 shadowMapSize;\n\t\t\tfloat shadowCameraNear;\n\t\t\tfloat shadowCameraFar;\n\t\t};\n\t\tuniform PointLightShadow pointLightShadows[ NUM_POINT_LIGHT_SHADOWS ];\n\t#endif\n\tfloat texture2DCompare( sampler2D depths, vec2 uv, float compare ) {\n\t\treturn step( compare, unpackRGBAToDepth( texture2D( depths, uv ) ) );\n\t}\n\tvec2 texture2DDistribution( sampler2D shadow, vec2 uv ) {\n\t\treturn unpackRGBATo2Half( texture2D( shadow, uv ) );\n\t}\n\tfloat VSMShadow (sampler2D shadow, vec2 uv, float compare ){\n\t\tfloat occlusion = 1.0;\n\t\tvec2 distribution = texture2DDistribution( shadow, uv );\n\t\tfloat hard_shadow = step( compare , distribution.x );\n\t\tif (hard_shadow != 1.0 ) {\n\t\t\tfloat distance = compare - distribution.x ;\n\t\t\tfloat variance = max( 0.00000, distribution.y * distribution.y );\n\t\t\tfloat softness_probability = variance / (variance + distance * distance );\t\t\tsoftness_probability = clamp( ( softness_probability - 0.3 ) / ( 0.95 - 0.3 ), 0.0, 1.0 );\t\t\tocclusion = clamp( max( hard_shadow, softness_probability ), 0.0, 1.0 );\n\t\t}\n\t\treturn occlusion;\n\t}\n\tfloat getShadow( sampler2D shadowMap, vec2 shadowMapSize, float shadowBias, float shadowRadius, vec4 shadowCoord ) {\n\t\tfloat shadow = 1.0;\n\t\tshadowCoord.xyz /= shadowCoord.w;\n\t\tshadowCoord.z += shadowBias;\n\t\tbool inFrustum = shadowCoord.x >= 0.0 && shadowCoord.x <= 1.0 && shadowCoord.y >= 0.0 && shadowCoord.y <= 1.0;\n\t\tbool frustumTest = inFrustum && shadowCoord.z <= 1.0;\n\t\tif ( frustumTest ) {\n\t\t#if defined( SHADOWMAP_TYPE_PCF )\n\t\t\tvec2 texelSize = vec2( 1.0 ) / shadowMapSize;\n\t\t\tfloat dx0 = - texelSize.x * shadowRadius;\n\t\t\tfloat dy0 = - texelSize.y * shadowRadius;\n\t\t\tfloat dx1 = + texelSize.x * shadowRadius;\n\t\t\tfloat dy1 = + texelSize.y * shadowRadius;\n\t\t\tfloat dx2 = dx0 / 2.0;\n\t\t\tfloat dy2 = dy0 / 2.0;\n\t\t\tfloat dx3 = dx1 / 2.0;\n\t\t\tfloat dy3 = dy1 / 2.0;\n\t\t\tshadow = (\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( dx0, dy0 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( 0.0, dy0 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( dx1, dy0 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( dx2, dy2 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( 0.0, dy2 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( dx3, dy2 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( dx0, 0.0 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( dx2, 0.0 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy, shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( dx3, 0.0 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( dx1, 0.0 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( dx2, dy3 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( 0.0, dy3 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( dx3, dy3 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( dx0, dy1 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( 0.0, dy1 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( dx1, dy1 ), shadowCoord.z )\n\t\t\t) * ( 1.0 / 17.0 );\n\t\t#elif defined( SHADOWMAP_TYPE_PCF_SOFT )\n\t\t\tvec2 texelSize = vec2( 1.0 ) / shadowMapSize;\n\t\t\tfloat dx = texelSize.x;\n\t\t\tfloat dy = texelSize.y;\n\t\t\tvec2 uv = shadowCoord.xy;\n\t\t\tvec2 f = fract( uv * shadowMapSize + 0.5 );\n\t\t\tuv -= f * texelSize;\n\t\t\tshadow = (\n\t\t\t\ttexture2DCompare( shadowMap, uv, shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, uv + vec2( dx, 0.0 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, uv + vec2( 0.0, dy ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, uv + texelSize, shadowCoord.z ) +\n\t\t\t\tmix( texture2DCompare( shadowMap, uv + vec2( -dx, 0.0 ), shadowCoord.z ),\n\t\t\t\t\t texture2DCompare( shadowMap, uv + vec2( 2.0 * dx, 0.0 ), shadowCoord.z ),\n\t\t\t\t\t f.x ) +\n\t\t\t\tmix( texture2DCompare( shadowMap, uv + vec2( -dx, dy ), shadowCoord.z ),\n\t\t\t\t\t texture2DCompare( shadowMap, uv + vec2( 2.0 * dx, dy ), shadowCoord.z ),\n\t\t\t\t\t f.x ) +\n\t\t\t\tmix( texture2DCompare( shadowMap, uv + vec2( 0.0, -dy ), shadowCoord.z ),\n\t\t\t\t\t texture2DCompare( shadowMap, uv + vec2( 0.0, 2.0 * dy ), shadowCoord.z ),\n\t\t\t\t\t f.y ) +\n\t\t\t\tmix( texture2DCompare( shadowMap, uv + vec2( dx, -dy ), shadowCoord.z ),\n\t\t\t\t\t texture2DCompare( shadowMap, uv + vec2( dx, 2.0 * dy ), shadowCoord.z ),\n\t\t\t\t\t f.y ) +\n\t\t\t\tmix( mix( texture2DCompare( shadowMap, uv + vec2( -dx, -dy ), shadowCoord.z ),\n\t\t\t\t\t\t  texture2DCompare( shadowMap, uv + vec2( 2.0 * dx, -dy ), shadowCoord.z ),\n\t\t\t\t\t\t  f.x ),\n\t\t\t\t\t mix( texture2DCompare( shadowMap, uv + vec2( -dx, 2.0 * dy ), shadowCoord.z ),\n\t\t\t\t\t\t  texture2DCompare( shadowMap, uv + vec2( 2.0 * dx, 2.0 * dy ), shadowCoord.z ),\n\t\t\t\t\t\t  f.x ),\n\t\t\t\t\t f.y )\n\t\t\t) * ( 1.0 / 9.0 );\n\t\t#elif defined( SHADOWMAP_TYPE_VSM )\n\t\t\tshadow = VSMShadow( shadowMap, shadowCoord.xy, shadowCoord.z );\n\t\t#else\n\t\t\tshadow = texture2DCompare( shadowMap, shadowCoord.xy, shadowCoord.z );\n\t\t#endif\n\t\t}\n\t\treturn shadow;\n\t}\n\tvec2 cubeToUV( vec3 v, float texelSizeY ) {\n\t\tvec3 absV = abs( v );\n\t\tfloat scaleToCube = 1.0 / max( absV.x, max( absV.y, absV.z ) );\n\t\tabsV *= scaleToCube;\n\t\tv *= scaleToCube * ( 1.0 - 2.0 * texelSizeY );\n\t\tvec2 planar = v.xy;\n\t\tfloat almostATexel = 1.5 * texelSizeY;\n\t\tfloat almostOne = 1.0 - almostATexel;\n\t\tif ( absV.z >= almostOne ) {\n\t\t\tif ( v.z > 0.0 )\n\t\t\t\tplanar.x = 4.0 - v.x;\n\t\t} else if ( absV.x >= almostOne ) {\n\t\t\tfloat signX = sign( v.x );\n\t\t\tplanar.x = v.z * signX + 2.0 * signX;\n\t\t} else if ( absV.y >= almostOne ) {\n\t\t\tfloat signY = sign( v.y );\n\t\t\tplanar.x = v.x + 2.0 * signY + 2.0;\n\t\t\tplanar.y = v.z * signY - 2.0;\n\t\t}\n\t\treturn vec2( 0.125, 0.25 ) * planar + vec2( 0.375, 0.75 );\n\t}\n\tfloat getPointShadow( sampler2D shadowMap, vec2 shadowMapSize, float shadowBias, float shadowRadius, vec4 shadowCoord, float shadowCameraNear, float shadowCameraFar ) {\n\t\tvec2 texelSize = vec2( 1.0 ) / ( shadowMapSize * vec2( 4.0, 2.0 ) );\n\t\tvec3 lightToPosition = shadowCoord.xyz;\n\t\tfloat dp = ( length( lightToPosition ) - shadowCameraNear ) / ( shadowCameraFar - shadowCameraNear );\t\tdp += shadowBias;\n\t\tvec3 bd3D = normalize( lightToPosition );\n\t\t#if defined( SHADOWMAP_TYPE_PCF ) || defined( SHADOWMAP_TYPE_PCF_SOFT ) || defined( SHADOWMAP_TYPE_VSM )\n\t\t\tvec2 offset = vec2( - 1, 1 ) * shadowRadius * texelSize.y;\n\t\t\treturn (\n\t\t\t\ttexture2DCompare( shadowMap, cubeToUV( bd3D + offset.xyy, texelSize.y ), dp ) +\n\t\t\t\ttexture2DCompare( shadowMap, cubeToUV( bd3D + offset.yyy, texelSize.y ), dp ) +\n\t\t\t\ttexture2DCompare( shadowMap, cubeToUV( bd3D + offset.xyx, texelSize.y ), dp ) +\n\t\t\t\ttexture2DCompare( shadowMap, cubeToUV( bd3D + offset.yyx, texelSize.y ), dp ) +\n\t\t\t\ttexture2DCompare( shadowMap, cubeToUV( bd3D, texelSize.y ), dp ) +\n\t\t\t\ttexture2DCompare( shadowMap, cubeToUV( bd3D + offset.xxy, texelSize.y ), dp ) +\n\t\t\t\ttexture2DCompare( shadowMap, cubeToUV( bd3D + offset.yxy, texelSize.y ), dp ) +\n\t\t\t\ttexture2DCompare( shadowMap, cubeToUV( bd3D + offset.xxx, texelSize.y ), dp ) +\n\t\t\t\ttexture2DCompare( shadowMap, cubeToUV( bd3D + offset.yxx, texelSize.y ), dp )\n\t\t\t) * ( 1.0 / 9.0 );\n\t\t#else\n\t\t\treturn texture2DCompare( shadowMap, cubeToUV( bd3D, texelSize.y ), dp );\n\t\t#endif\n\t}\n#endif",shadowmap_pars_vertex:"#if NUM_SPOT_LIGHT_COORDS > 0\n  uniform mat4 spotLightMatrix[ NUM_SPOT_LIGHT_COORDS ];\n  varying vec4 vSpotLightCoord[ NUM_SPOT_LIGHT_COORDS ];\n#endif\n#ifdef USE_SHADOWMAP\n\t#if NUM_DIR_LIGHT_SHADOWS > 0\n\t\tuniform mat4 directionalShadowMatrix[ NUM_DIR_LIGHT_SHADOWS ];\n\t\tvarying vec4 vDirectionalShadowCoord[ NUM_DIR_LIGHT_SHADOWS ];\n\t\tstruct DirectionalLightShadow {\n\t\t\tfloat shadowBias;\n\t\t\tfloat shadowNormalBias;\n\t\t\tfloat shadowRadius;\n\t\t\tvec2 shadowMapSize;\n\t\t};\n\t\tuniform DirectionalLightShadow directionalLightShadows[ NUM_DIR_LIGHT_SHADOWS ];\n\t#endif\n\t#if NUM_SPOT_LIGHT_SHADOWS > 0\n\t\tstruct SpotLightShadow {\n\t\t\tfloat shadowBias;\n\t\t\tfloat shadowNormalBias;\n\t\t\tfloat shadowRadius;\n\t\t\tvec2 shadowMapSize;\n\t\t};\n\t\tuniform SpotLightShadow spotLightShadows[ NUM_SPOT_LIGHT_SHADOWS ];\n\t#endif\n\t#if NUM_POINT_LIGHT_SHADOWS > 0\n\t\tuniform mat4 pointShadowMatrix[ NUM_POINT_LIGHT_SHADOWS ];\n\t\tvarying vec4 vPointShadowCoord[ NUM_POINT_LIGHT_SHADOWS ];\n\t\tstruct PointLightShadow {\n\t\t\tfloat shadowBias;\n\t\t\tfloat shadowNormalBias;\n\t\t\tfloat shadowRadius;\n\t\t\tvec2 shadowMapSize;\n\t\t\tfloat shadowCameraNear;\n\t\t\tfloat shadowCameraFar;\n\t\t};\n\t\tuniform PointLightShadow pointLightShadows[ NUM_POINT_LIGHT_SHADOWS ];\n\t#endif\n#endif",shadowmap_vertex:"#if ( defined( USE_SHADOWMAP ) && ( NUM_DIR_LIGHT_SHADOWS > 0 || NUM_POINT_LIGHT_SHADOWS > 0 ) ) || ( NUM_SPOT_LIGHT_COORDS > 0 )\n\tvec3 shadowWorldNormal = inverseTransformDirection( transformedNormal, viewMatrix );\n\tvec4 shadowWorldPosition;\n#endif\n#if defined( USE_SHADOWMAP )\n\t#if NUM_DIR_LIGHT_SHADOWS > 0\n\t\t#pragma unroll_loop_start\n\t\tfor ( int i = 0; i < NUM_DIR_LIGHT_SHADOWS; i ++ ) {\n\t\t\tshadowWorldPosition = worldPosition + vec4( shadowWorldNormal * directionalLightShadows[ i ].shadowNormalBias, 0 );\n\t\t\tvDirectionalShadowCoord[ i ] = directionalShadowMatrix[ i ] * shadowWorldPosition;\n\t\t}\n\t\t#pragma unroll_loop_end\n\t#endif\n\t#if NUM_POINT_LIGHT_SHADOWS > 0\n\t\t#pragma unroll_loop_start\n\t\tfor ( int i = 0; i < NUM_POINT_LIGHT_SHADOWS; i ++ ) {\n\t\t\tshadowWorldPosition = worldPosition + vec4( shadowWorldNormal * pointLightShadows[ i ].shadowNormalBias, 0 );\n\t\t\tvPointShadowCoord[ i ] = pointShadowMatrix[ i ] * shadowWorldPosition;\n\t\t}\n\t\t#pragma unroll_loop_end\n\t#endif\n#endif\n#if NUM_SPOT_LIGHT_COORDS > 0\n\t#pragma unroll_loop_start\n\tfor ( int i = 0; i < NUM_SPOT_LIGHT_COORDS; i ++ ) {\n\t\tshadowWorldPosition = worldPosition;\n\t\t#if ( defined( USE_SHADOWMAP ) && UNROLLED_LOOP_INDEX < NUM_SPOT_LIGHT_SHADOWS )\n\t\t\tshadowWorldPosition.xyz += shadowWorldNormal * spotLightShadows[ i ].shadowNormalBias;\n\t\t#endif\n\t\tvSpotLightCoord[ i ] = spotLightMatrix[ i ] * shadowWorldPosition;\n\t}\n\t#pragma unroll_loop_end\n#endif",shadowmask_pars_fragment:"float getShadowMask() {\n\tfloat shadow = 1.0;\n\t#ifdef USE_SHADOWMAP\n\t#if NUM_DIR_LIGHT_SHADOWS > 0\n\tDirectionalLightShadow directionalLight;\n\t#pragma unroll_loop_start\n\tfor ( int i = 0; i < NUM_DIR_LIGHT_SHADOWS; i ++ ) {\n\t\tdirectionalLight = directionalLightShadows[ i ];\n\t\tshadow *= receiveShadow ? getShadow( directionalShadowMap[ i ], directionalLight.shadowMapSize, directionalLight.shadowBias, directionalLight.shadowRadius, vDirectionalShadowCoord[ i ] ) : 1.0;\n\t}\n\t#pragma unroll_loop_end\n\t#endif\n\t#if NUM_SPOT_LIGHT_SHADOWS > 0\n\tSpotLightShadow spotLight;\n\t#pragma unroll_loop_start\n\tfor ( int i = 0; i < NUM_SPOT_LIGHT_SHADOWS; i ++ ) {\n\t\tspotLight = spotLightShadows[ i ];\n\t\tshadow *= receiveShadow ? getShadow( spotShadowMap[ i ], spotLight.shadowMapSize, spotLight.shadowBias, spotLight.shadowRadius, vSpotLightCoord[ i ] ) : 1.0;\n\t}\n\t#pragma unroll_loop_end\n\t#endif\n\t#if NUM_POINT_LIGHT_SHADOWS > 0\n\tPointLightShadow pointLight;\n\t#pragma unroll_loop_start\n\tfor ( int i = 0; i < NUM_POINT_LIGHT_SHADOWS; i ++ ) {\n\t\tpointLight = pointLightShadows[ i ];\n\t\tshadow *= receiveShadow ? getPointShadow( pointShadowMap[ i ], pointLight.shadowMapSize, pointLight.shadowBias, pointLight.shadowRadius, vPointShadowCoord[ i ], pointLight.shadowCameraNear, pointLight.shadowCameraFar ) : 1.0;\n\t}\n\t#pragma unroll_loop_end\n\t#endif\n\t#endif\n\treturn shadow;\n}",skinbase_vertex:"#ifdef USE_SKINNING\n\tmat4 boneMatX = getBoneMatrix( skinIndex.x );\n\tmat4 boneMatY = getBoneMatrix( skinIndex.y );\n\tmat4 boneMatZ = getBoneMatrix( skinIndex.z );\n\tmat4 boneMatW = getBoneMatrix( skinIndex.w );\n#endif",skinning_pars_vertex:"#ifdef USE_SKINNING\n\tuniform mat4 bindMatrix;\n\tuniform mat4 bindMatrixInverse;\n\tuniform highp sampler2D boneTexture;\n\tuniform int boneTextureSize;\n\tmat4 getBoneMatrix( const in float i ) {\n\t\tfloat j = i * 4.0;\n\t\tfloat x = mod( j, float( boneTextureSize ) );\n\t\tfloat y = floor( j / float( boneTextureSize ) );\n\t\tfloat dx = 1.0 / float( boneTextureSize );\n\t\tfloat dy = 1.0 / float( boneTextureSize );\n\t\ty = dy * ( y + 0.5 );\n\t\tvec4 v1 = texture2D( boneTexture, vec2( dx * ( x + 0.5 ), y ) );\n\t\tvec4 v2 = texture2D( boneTexture, vec2( dx * ( x + 1.5 ), y ) );\n\t\tvec4 v3 = texture2D( boneTexture, vec2( dx * ( x + 2.5 ), y ) );\n\t\tvec4 v4 = texture2D( boneTexture, vec2( dx * ( x + 3.5 ), y ) );\n\t\tmat4 bone = mat4( v1, v2, v3, v4 );\n\t\treturn bone;\n\t}\n#endif",skinning_vertex:"#ifdef USE_SKINNING\n\tvec4 skinVertex = bindMatrix * vec4( transformed, 1.0 );\n\tvec4 skinned = vec4( 0.0 );\n\tskinned += boneMatX * skinVertex * skinWeight.x;\n\tskinned += boneMatY * skinVertex * skinWeight.y;\n\tskinned += boneMatZ * skinVertex * skinWeight.z;\n\tskinned += boneMatW * skinVertex * skinWeight.w;\n\ttransformed = ( bindMatrixInverse * skinned ).xyz;\n#endif",skinnormal_vertex:"#ifdef USE_SKINNING\n\tmat4 skinMatrix = mat4( 0.0 );\n\tskinMatrix += skinWeight.x * boneMatX;\n\tskinMatrix += skinWeight.y * boneMatY;\n\tskinMatrix += skinWeight.z * boneMatZ;\n\tskinMatrix += skinWeight.w * boneMatW;\n\tskinMatrix = bindMatrixInverse * skinMatrix * bindMatrix;\n\tobjectNormal = vec4( skinMatrix * vec4( objectNormal, 0.0 ) ).xyz;\n\t#ifdef USE_TANGENT\n\t\tobjectTangent = vec4( skinMatrix * vec4( objectTangent, 0.0 ) ).xyz;\n\t#endif\n#endif",specularmap_fragment:"float specularStrength;\n#ifdef USE_SPECULARMAP\n\tvec4 texelSpecular = texture2D( specularMap, vUv );\n\tspecularStrength = texelSpecular.r;\n#else\n\tspecularStrength = 1.0;\n#endif",specularmap_pars_fragment:"#ifdef USE_SPECULARMAP\n\tuniform sampler2D specularMap;\n#endif",tonemapping_fragment:"#if defined( TONE_MAPPING )\n\tgl_FragColor.rgb = toneMapping( gl_FragColor.rgb );\n#endif",tonemapping_pars_fragment:"#ifndef saturate\n#define saturate( a ) clamp( a, 0.0, 1.0 )\n#endif\nuniform float toneMappingExposure;\nvec3 LinearToneMapping( vec3 color ) {\n\treturn toneMappingExposure * color;\n}\nvec3 ReinhardToneMapping( vec3 color ) {\n\tcolor *= toneMappingExposure;\n\treturn saturate( color / ( vec3( 1.0 ) + color ) );\n}\nvec3 OptimizedCineonToneMapping( vec3 color ) {\n\tcolor *= toneMappingExposure;\n\tcolor = max( vec3( 0.0 ), color - 0.004 );\n\treturn pow( ( color * ( 6.2 * color + 0.5 ) ) / ( color * ( 6.2 * color + 1.7 ) + 0.06 ), vec3( 2.2 ) );\n}\nvec3 RRTAndODTFit( vec3 v ) {\n\tvec3 a = v * ( v + 0.0245786 ) - 0.000090537;\n\tvec3 b = v * ( 0.983729 * v + 0.4329510 ) + 0.238081;\n\treturn a / b;\n}\nvec3 ACESFilmicToneMapping( vec3 color ) {\n\tconst mat3 ACESInputMat = mat3(\n\t\tvec3( 0.59719, 0.07600, 0.02840 ),\t\tvec3( 0.35458, 0.90834, 0.13383 ),\n\t\tvec3( 0.04823, 0.01566, 0.83777 )\n\t);\n\tconst mat3 ACESOutputMat = mat3(\n\t\tvec3(  1.60475, -0.10208, -0.00327 ),\t\tvec3( -0.53108,  1.10813, -0.07276 ),\n\t\tvec3( -0.07367, -0.00605,  1.07602 )\n\t);\n\tcolor *= toneMappingExposure / 0.6;\n\tcolor = ACESInputMat * color;\n\tcolor = RRTAndODTFit( color );\n\tcolor = ACESOutputMat * color;\n\treturn saturate( color );\n}\nvec3 CustomToneMapping( vec3 color ) { return color; }",transmission_fragment:"#ifdef USE_TRANSMISSION\n\tmaterial.transmission = transmission;\n\tmaterial.transmissionAlpha = 1.0;\n\tmaterial.thickness = thickness;\n\tmaterial.attenuationDistance = attenuationDistance;\n\tmaterial.attenuationColor = attenuationColor;\n\t#ifdef USE_TRANSMISSIONMAP\n\t\tmaterial.transmission *= texture2D( transmissionMap, vUv ).r;\n\t#endif\n\t#ifdef USE_THICKNESSMAP\n\t\tmaterial.thickness *= texture2D( thicknessMap, vUv ).g;\n\t#endif\n\tvec3 pos = vWorldPosition;\n\tvec3 v = normalize( cameraPosition - pos );\n\tvec3 n = inverseTransformDirection( normal, viewMatrix );\n\tvec4 transmission = getIBLVolumeRefraction(\n\t\tn, v, material.roughness, material.diffuseColor, material.specularColor, material.specularF90,\n\t\tpos, modelMatrix, viewMatrix, projectionMatrix, material.ior, material.thickness,\n\t\tmaterial.attenuationColor, material.attenuationDistance );\n\tmaterial.transmissionAlpha = mix( material.transmissionAlpha, transmission.a, material.transmission );\n\ttotalDiffuse = mix( totalDiffuse, transmission.rgb, material.transmission );\n#endif",transmission_pars_fragment:"#ifdef USE_TRANSMISSION\n\tuniform float transmission;\n\tuniform float thickness;\n\tuniform float attenuationDistance;\n\tuniform vec3 attenuationColor;\n\t#ifdef USE_TRANSMISSIONMAP\n\t\tuniform sampler2D transmissionMap;\n\t#endif\n\t#ifdef USE_THICKNESSMAP\n\t\tuniform sampler2D thicknessMap;\n\t#endif\n\tuniform vec2 transmissionSamplerSize;\n\tuniform sampler2D transmissionSamplerMap;\n\tuniform mat4 modelMatrix;\n\tuniform mat4 projectionMatrix;\n\tvarying vec3 vWorldPosition;\n\tvec3 getVolumeTransmissionRay( const in vec3 n, const in vec3 v, const in float thickness, const in float ior, const in mat4 modelMatrix ) {\n\t\tvec3 refractionVector = refract( - v, normalize( n ), 1.0 / ior );\n\t\tvec3 modelScale;\n\t\tmodelScale.x = length( vec3( modelMatrix[ 0 ].xyz ) );\n\t\tmodelScale.y = length( vec3( modelMatrix[ 1 ].xyz ) );\n\t\tmodelScale.z = length( vec3( modelMatrix[ 2 ].xyz ) );\n\t\treturn normalize( refractionVector ) * thickness * modelScale;\n\t}\n\tfloat applyIorToRoughness( const in float roughness, const in float ior ) {\n\t\treturn roughness * clamp( ior * 2.0 - 2.0, 0.0, 1.0 );\n\t}\n\tvec4 getTransmissionSample( const in vec2 fragCoord, const in float roughness, const in float ior ) {\n\t\tfloat framebufferLod = log2( transmissionSamplerSize.x ) * applyIorToRoughness( roughness, ior );\n\t\t#ifdef texture2DLodEXT\n\t\t\treturn texture2DLodEXT( transmissionSamplerMap, fragCoord.xy, framebufferLod );\n\t\t#else\n\t\t\treturn texture2D( transmissionSamplerMap, fragCoord.xy, framebufferLod );\n\t\t#endif\n\t}\n\tvec3 applyVolumeAttenuation( const in vec3 radiance, const in float transmissionDistance, const in vec3 attenuationColor, const in float attenuationDistance ) {\n\t\tif ( isinf( attenuationDistance ) ) {\n\t\t\treturn radiance;\n\t\t} else {\n\t\t\tvec3 attenuationCoefficient = -log( attenuationColor ) / attenuationDistance;\n\t\t\tvec3 transmittance = exp( - attenuationCoefficient * transmissionDistance );\t\t\treturn transmittance * radiance;\n\t\t}\n\t}\n\tvec4 getIBLVolumeRefraction( const in vec3 n, const in vec3 v, const in float roughness, const in vec3 diffuseColor,\n\t\tconst in vec3 specularColor, const in float specularF90, const in vec3 position, const in mat4 modelMatrix,\n\t\tconst in mat4 viewMatrix, const in mat4 projMatrix, const in float ior, const in float thickness,\n\t\tconst in vec3 attenuationColor, const in float attenuationDistance ) {\n\t\tvec3 transmissionRay = getVolumeTransmissionRay( n, v, thickness, ior, modelMatrix );\n\t\tvec3 refractedRayExit = position + transmissionRay;\n\t\tvec4 ndcPos = projMatrix * viewMatrix * vec4( refractedRayExit, 1.0 );\n\t\tvec2 refractionCoords = ndcPos.xy / ndcPos.w;\n\t\trefractionCoords += 1.0;\n\t\trefractionCoords /= 2.0;\n\t\tvec4 transmittedLight = getTransmissionSample( refractionCoords, roughness, ior );\n\t\tvec3 attenuatedColor = applyVolumeAttenuation( transmittedLight.rgb, length( transmissionRay ), attenuationColor, attenuationDistance );\n\t\tvec3 F = EnvironmentBRDF( n, v, specularColor, specularF90, roughness );\n\t\treturn vec4( ( 1.0 - F ) * attenuatedColor * diffuseColor, transmittedLight.a );\n\t}\n#endif",uv_pars_fragment:"#if ( defined( USE_UV ) && ! defined( UVS_VERTEX_ONLY ) )\n\tvarying vec2 vUv;\n#endif",uv_pars_vertex:"#ifdef USE_UV\n\t#ifdef UVS_VERTEX_ONLY\n\t\tvec2 vUv;\n\t#else\n\t\tvarying vec2 vUv;\n\t#endif\n\tuniform mat3 uvTransform;\n#endif",uv_vertex:"#ifdef USE_UV\n\tvUv = ( uvTransform * vec3( uv, 1 ) ).xy;\n#endif",uv2_pars_fragment:"#if defined( USE_LIGHTMAP ) || defined( USE_AOMAP )\n\tvarying vec2 vUv2;\n#endif",uv2_pars_vertex:"#if defined( USE_LIGHTMAP ) || defined( USE_AOMAP )\n\tattribute vec2 uv2;\n\tvarying vec2 vUv2;\n\tuniform mat3 uv2Transform;\n#endif",uv2_vertex:"#if defined( USE_LIGHTMAP ) || defined( USE_AOMAP )\n\tvUv2 = ( uv2Transform * vec3( uv2, 1 ) ).xy;\n#endif",worldpos_vertex:"#if defined( USE_ENVMAP ) || defined( DISTANCE ) || defined ( USE_SHADOWMAP ) || defined ( USE_TRANSMISSION ) || NUM_SPOT_LIGHT_COORDS > 0\n\tvec4 worldPosition = vec4( transformed, 1.0 );\n\t#ifdef USE_INSTANCING\n\t\tworldPosition = instanceMatrix * worldPosition;\n\t#endif\n\tworldPosition = modelMatrix * worldPosition;\n#endif",background_vert:"varying vec2 vUv;\nuniform mat3 uvTransform;\nvoid main() {\n\tvUv = ( uvTransform * vec3( uv, 1 ) ).xy;\n\tgl_Position = vec4( position.xy, 1.0, 1.0 );\n}",background_frag:"uniform sampler2D t2D;\nuniform float backgroundIntensity;\nvarying vec2 vUv;\nvoid main() {\n\tvec4 texColor = texture2D( t2D, vUv );\n\t#ifdef DECODE_VIDEO_TEXTURE\n\t\ttexColor = vec4( mix( pow( texColor.rgb * 0.9478672986 + vec3( 0.0521327014 ), vec3( 2.4 ) ), texColor.rgb * 0.0773993808, vec3( lessThanEqual( texColor.rgb, vec3( 0.04045 ) ) ) ), texColor.w );\n\t#endif\n\ttexColor.rgb *= backgroundIntensity;\n\tgl_FragColor = texColor;\n\t#include <tonemapping_fragment>\n\t#include <encodings_fragment>\n}",backgroundCube_vert:"varying vec3 vWorldDirection;\n#include <common>\nvoid main() {\n\tvWorldDirection = transformDirection( position, modelMatrix );\n\t#include <begin_vertex>\n\t#include <project_vertex>\n\tgl_Position.z = gl_Position.w;\n}",backgroundCube_frag:"#ifdef ENVMAP_TYPE_CUBE\n\tuniform samplerCube envMap;\n#elif defined( ENVMAP_TYPE_CUBE_UV )\n\tuniform sampler2D envMap;\n#endif\nuniform float flipEnvMap;\nuniform float backgroundBlurriness;\nuniform float backgroundIntensity;\nvarying vec3 vWorldDirection;\n#include <cube_uv_reflection_fragment>\nvoid main() {\n\t#ifdef ENVMAP_TYPE_CUBE\n\t\tvec4 texColor = textureCube( envMap, vec3( flipEnvMap * vWorldDirection.x, vWorldDirection.yz ) );\n\t#elif defined( ENVMAP_TYPE_CUBE_UV )\n\t\tvec4 texColor = textureCubeUV( envMap, vWorldDirection, backgroundBlurriness );\n\t#else\n\t\tvec4 texColor = vec4( 0.0, 0.0, 0.0, 1.0 );\n\t#endif\n\ttexColor.rgb *= backgroundIntensity;\n\tgl_FragColor = texColor;\n\t#include <tonemapping_fragment>\n\t#include <encodings_fragment>\n}",cube_vert:"varying vec3 vWorldDirection;\n#include <common>\nvoid main() {\n\tvWorldDirection = transformDirection( position, modelMatrix );\n\t#include <begin_vertex>\n\t#include <project_vertex>\n\tgl_Position.z = gl_Position.w;\n}",cube_frag:"uniform samplerCube tCube;\nuniform float tFlip;\nuniform float opacity;\nvarying vec3 vWorldDirection;\nvoid main() {\n\tvec4 texColor = textureCube( tCube, vec3( tFlip * vWorldDirection.x, vWorldDirection.yz ) );\n\tgl_FragColor = texColor;\n\tgl_FragColor.a *= opacity;\n\t#include <tonemapping_fragment>\n\t#include <encodings_fragment>\n}",depth_vert:"#include <common>\n#include <uv_pars_vertex>\n#include <displacementmap_pars_vertex>\n#include <morphtarget_pars_vertex>\n#include <skinning_pars_vertex>\n#include <logdepthbuf_pars_vertex>\n#include <clipping_planes_pars_vertex>\nvarying vec2 vHighPrecisionZW;\nvoid main() {\n\t#include <uv_vertex>\n\t#include <skinbase_vertex>\n\t#ifdef USE_DISPLACEMENTMAP\n\t\t#include <beginnormal_vertex>\n\t\t#include <morphnormal_vertex>\n\t\t#include <skinnormal_vertex>\n\t#endif\n\t#include <begin_vertex>\n\t#include <morphtarget_vertex>\n\t#include <skinning_vertex>\n\t#include <displacementmap_vertex>\n\t#include <project_vertex>\n\t#include <logdepthbuf_vertex>\n\t#include <clipping_planes_vertex>\n\tvHighPrecisionZW = gl_Position.zw;\n}",depth_frag:"#if DEPTH_PACKING == 3200\n\tuniform float opacity;\n#endif\n#include <common>\n#include <packing>\n#include <uv_pars_fragment>\n#include <map_pars_fragment>\n#include <alphamap_pars_fragment>\n#include <alphatest_pars_fragment>\n#include <logdepthbuf_pars_fragment>\n#include <clipping_planes_pars_fragment>\nvarying vec2 vHighPrecisionZW;\nvoid main() {\n\t#include <clipping_planes_fragment>\n\tvec4 diffuseColor = vec4( 1.0 );\n\t#if DEPTH_PACKING == 3200\n\t\tdiffuseColor.a = opacity;\n\t#endif\n\t#include <map_fragment>\n\t#include <alphamap_fragment>\n\t#include <alphatest_fragment>\n\t#include <logdepthbuf_fragment>\n\tfloat fragCoordZ = 0.5 * vHighPrecisionZW[0] / vHighPrecisionZW[1] + 0.5;\n\t#if DEPTH_PACKING == 3200\n\t\tgl_FragColor = vec4( vec3( 1.0 - fragCoordZ ), opacity );\n\t#elif DEPTH_PACKING == 3201\n\t\tgl_FragColor = packDepthToRGBA( fragCoordZ );\n\t#endif\n}",distanceRGBA_vert:"#define DISTANCE\nvarying vec3 vWorldPosition;\n#include <common>\n#include <uv_pars_vertex>\n#include <displacementmap_pars_vertex>\n#include <morphtarget_pars_vertex>\n#include <skinning_pars_vertex>\n#include <clipping_planes_pars_vertex>\nvoid main() {\n\t#include <uv_vertex>\n\t#include <skinbase_vertex>\n\t#ifdef USE_DISPLACEMENTMAP\n\t\t#include <beginnormal_vertex>\n\t\t#include <morphnormal_vertex>\n\t\t#include <skinnormal_vertex>\n\t#endif\n\t#include <begin_vertex>\n\t#include <morphtarget_vertex>\n\t#include <skinning_vertex>\n\t#include <displacementmap_vertex>\n\t#include <project_vertex>\n\t#include <worldpos_vertex>\n\t#include <clipping_planes_vertex>\n\tvWorldPosition = worldPosition.xyz;\n}",distanceRGBA_frag:"#define DISTANCE\nuniform vec3 referencePosition;\nuniform float nearDistance;\nuniform float farDistance;\nvarying vec3 vWorldPosition;\n#include <common>\n#include <packing>\n#include <uv_pars_fragment>\n#include <map_pars_fragment>\n#include <alphamap_pars_fragment>\n#include <alphatest_pars_fragment>\n#include <clipping_planes_pars_fragment>\nvoid main () {\n\t#include <clipping_planes_fragment>\n\tvec4 diffuseColor = vec4( 1.0 );\n\t#include <map_fragment>\n\t#include <alphamap_fragment>\n\t#include <alphatest_fragment>\n\tfloat dist = length( vWorldPosition - referencePosition );\n\tdist = ( dist - nearDistance ) / ( farDistance - nearDistance );\n\tdist = saturate( dist );\n\tgl_FragColor = packDepthToRGBA( dist );\n}",equirect_vert:"varying vec3 vWorldDirection;\n#include <common>\nvoid main() {\n\tvWorldDirection = transformDirection( position, modelMatrix );\n\t#include <begin_vertex>\n\t#include <project_vertex>\n}",equirect_frag:"uniform sampler2D tEquirect;\nvarying vec3 vWorldDirection;\n#include <common>\nvoid main() {\n\tvec3 direction = normalize( vWorldDirection );\n\tvec2 sampleUV = equirectUv( direction );\n\tgl_FragColor = texture2D( tEquirect, sampleUV );\n\t#include <tonemapping_fragment>\n\t#include <encodings_fragment>\n}",linedashed_vert:"uniform float scale;\nattribute float lineDistance;\nvarying float vLineDistance;\n#include <common>\n#include <color_pars_vertex>\n#include <fog_pars_vertex>\n#include <morphtarget_pars_vertex>\n#include <logdepthbuf_pars_vertex>\n#include <clipping_planes_pars_vertex>\nvoid main() {\n\tvLineDistance = scale * lineDistance;\n\t#include <color_vertex>\n\t#include <morphcolor_vertex>\n\t#include <begin_vertex>\n\t#include <morphtarget_vertex>\n\t#include <project_vertex>\n\t#include <logdepthbuf_vertex>\n\t#include <clipping_planes_vertex>\n\t#include <fog_vertex>\n}",linedashed_frag:"uniform vec3 diffuse;\nuniform float opacity;\nuniform float dashSize;\nuniform float totalSize;\nvarying float vLineDistance;\n#include <common>\n#include <color_pars_fragment>\n#include <fog_pars_fragment>\n#include <logdepthbuf_pars_fragment>\n#include <clipping_planes_pars_fragment>\nvoid main() {\n\t#include <clipping_planes_fragment>\n\tif ( mod( vLineDistance, totalSize ) > dashSize ) {\n\t\tdiscard;\n\t}\n\tvec3 outgoingLight = vec3( 0.0 );\n\tvec4 diffuseColor = vec4( diffuse, opacity );\n\t#include <logdepthbuf_fragment>\n\t#include <color_fragment>\n\toutgoingLight = diffuseColor.rgb;\n\t#include <output_fragment>\n\t#include <tonemapping_fragment>\n\t#include <encodings_fragment>\n\t#include <fog_fragment>\n\t#include <premultiplied_alpha_fragment>\n}",meshbasic_vert:"#include <common>\n#include <uv_pars_vertex>\n#include <uv2_pars_vertex>\n#include <envmap_pars_vertex>\n#include <color_pars_vertex>\n#include <fog_pars_vertex>\n#include <morphtarget_pars_vertex>\n#include <skinning_pars_vertex>\n#include <logdepthbuf_pars_vertex>\n#include <clipping_planes_pars_vertex>\nvoid main() {\n\t#include <uv_vertex>\n\t#include <uv2_vertex>\n\t#include <color_vertex>\n\t#include <morphcolor_vertex>\n\t#if defined ( USE_ENVMAP ) || defined ( USE_SKINNING )\n\t\t#include <beginnormal_vertex>\n\t\t#include <morphnormal_vertex>\n\t\t#include <skinbase_vertex>\n\t\t#include <skinnormal_vertex>\n\t\t#include <defaultnormal_vertex>\n\t#endif\n\t#include <begin_vertex>\n\t#include <morphtarget_vertex>\n\t#include <skinning_vertex>\n\t#include <project_vertex>\n\t#include <logdepthbuf_vertex>\n\t#include <clipping_planes_vertex>\n\t#include <worldpos_vertex>\n\t#include <envmap_vertex>\n\t#include <fog_vertex>\n}",meshbasic_frag:"uniform vec3 diffuse;\nuniform float opacity;\n#ifndef FLAT_SHADED\n\tvarying vec3 vNormal;\n#endif\n#include <common>\n#include <dithering_pars_fragment>\n#include <color_pars_fragment>\n#include <uv_pars_fragment>\n#include <uv2_pars_fragment>\n#include <map_pars_fragment>\n#include <alphamap_pars_fragment>\n#include <alphatest_pars_fragment>\n#include <aomap_pars_fragment>\n#include <lightmap_pars_fragment>\n#include <envmap_common_pars_fragment>\n#include <envmap_pars_fragment>\n#include <fog_pars_fragment>\n#include <specularmap_pars_fragment>\n#include <logdepthbuf_pars_fragment>\n#include <clipping_planes_pars_fragment>\nvoid main() {\n\t#include <clipping_planes_fragment>\n\tvec4 diffuseColor = vec4( diffuse, opacity );\n\t#include <logdepthbuf_fragment>\n\t#include <map_fragment>\n\t#include <color_fragment>\n\t#include <alphamap_fragment>\n\t#include <alphatest_fragment>\n\t#include <specularmap_fragment>\n\tReflectedLight reflectedLight = ReflectedLight( vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ) );\n\t#ifdef USE_LIGHTMAP\n\t\tvec4 lightMapTexel = texture2D( lightMap, vUv2 );\n\t\treflectedLight.indirectDiffuse += lightMapTexel.rgb * lightMapIntensity * RECIPROCAL_PI;\n\t#else\n\t\treflectedLight.indirectDiffuse += vec3( 1.0 );\n\t#endif\n\t#include <aomap_fragment>\n\treflectedLight.indirectDiffuse *= diffuseColor.rgb;\n\tvec3 outgoingLight = reflectedLight.indirectDiffuse;\n\t#include <envmap_fragment>\n\t#include <output_fragment>\n\t#include <tonemapping_fragment>\n\t#include <encodings_fragment>\n\t#include <fog_fragment>\n\t#include <premultiplied_alpha_fragment>\n\t#include <dithering_fragment>\n}",meshlambert_vert:"#define LAMBERT\nvarying vec3 vViewPosition;\n#include <common>\n#include <uv_pars_vertex>\n#include <uv2_pars_vertex>\n#include <displacementmap_pars_vertex>\n#include <envmap_pars_vertex>\n#include <color_pars_vertex>\n#include <fog_pars_vertex>\n#include <normal_pars_vertex>\n#include <morphtarget_pars_vertex>\n#include <skinning_pars_vertex>\n#include <shadowmap_pars_vertex>\n#include <logdepthbuf_pars_vertex>\n#include <clipping_planes_pars_vertex>\nvoid main() {\n\t#include <uv_vertex>\n\t#include <uv2_vertex>\n\t#include <color_vertex>\n\t#include <morphcolor_vertex>\n\t#include <beginnormal_vertex>\n\t#include <morphnormal_vertex>\n\t#include <skinbase_vertex>\n\t#include <skinnormal_vertex>\n\t#include <defaultnormal_vertex>\n\t#include <normal_vertex>\n\t#include <begin_vertex>\n\t#include <morphtarget_vertex>\n\t#include <skinning_vertex>\n\t#include <displacementmap_vertex>\n\t#include <project_vertex>\n\t#include <logdepthbuf_vertex>\n\t#include <clipping_planes_vertex>\n\tvViewPosition = - mvPosition.xyz;\n\t#include <worldpos_vertex>\n\t#include <envmap_vertex>\n\t#include <shadowmap_vertex>\n\t#include <fog_vertex>\n}",meshlambert_frag:"#define LAMBERT\nuniform vec3 diffuse;\nuniform vec3 emissive;\nuniform float opacity;\n#include <common>\n#include <packing>\n#include <dithering_pars_fragment>\n#include <color_pars_fragment>\n#include <uv_pars_fragment>\n#include <uv2_pars_fragment>\n#include <map_pars_fragment>\n#include <alphamap_pars_fragment>\n#include <alphatest_pars_fragment>\n#include <aomap_pars_fragment>\n#include <lightmap_pars_fragment>\n#include <emissivemap_pars_fragment>\n#include <envmap_common_pars_fragment>\n#include <envmap_pars_fragment>\n#include <fog_pars_fragment>\n#include <bsdfs>\n#include <lights_pars_begin>\n#include <normal_pars_fragment>\n#include <lights_lambert_pars_fragment>\n#include <shadowmap_pars_fragment>\n#include <bumpmap_pars_fragment>\n#include <normalmap_pars_fragment>\n#include <specularmap_pars_fragment>\n#include <logdepthbuf_pars_fragment>\n#include <clipping_planes_pars_fragment>\nvoid main() {\n\t#include <clipping_planes_fragment>\n\tvec4 diffuseColor = vec4( diffuse, opacity );\n\tReflectedLight reflectedLight = ReflectedLight( vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ) );\n\tvec3 totalEmissiveRadiance = emissive;\n\t#include <logdepthbuf_fragment>\n\t#include <map_fragment>\n\t#include <color_fragment>\n\t#include <alphamap_fragment>\n\t#include <alphatest_fragment>\n\t#include <specularmap_fragment>\n\t#include <normal_fragment_begin>\n\t#include <normal_fragment_maps>\n\t#include <emissivemap_fragment>\n\t#include <lights_lambert_fragment>\n\t#include <lights_fragment_begin>\n\t#include <lights_fragment_maps>\n\t#include <lights_fragment_end>\n\t#include <aomap_fragment>\n\tvec3 outgoingLight = reflectedLight.directDiffuse + reflectedLight.indirectDiffuse + totalEmissiveRadiance;\n\t#include <envmap_fragment>\n\t#include <output_fragment>\n\t#include <tonemapping_fragment>\n\t#include <encodings_fragment>\n\t#include <fog_fragment>\n\t#include <premultiplied_alpha_fragment>\n\t#include <dithering_fragment>\n}",meshmatcap_vert:"#define MATCAP\nvarying vec3 vViewPosition;\n#include <common>\n#include <uv_pars_vertex>\n#include <color_pars_vertex>\n#include <displacementmap_pars_vertex>\n#include <fog_pars_vertex>\n#include <normal_pars_vertex>\n#include <morphtarget_pars_vertex>\n#include <skinning_pars_vertex>\n#include <logdepthbuf_pars_vertex>\n#include <clipping_planes_pars_vertex>\nvoid main() {\n\t#include <uv_vertex>\n\t#include <color_vertex>\n\t#include <morphcolor_vertex>\n\t#include <beginnormal_vertex>\n\t#include <morphnormal_vertex>\n\t#include <skinbase_vertex>\n\t#include <skinnormal_vertex>\n\t#include <defaultnormal_vertex>\n\t#include <normal_vertex>\n\t#include <begin_vertex>\n\t#include <morphtarget_vertex>\n\t#include <skinning_vertex>\n\t#include <displacementmap_vertex>\n\t#include <project_vertex>\n\t#include <logdepthbuf_vertex>\n\t#include <clipping_planes_vertex>\n\t#include <fog_vertex>\n\tvViewPosition = - mvPosition.xyz;\n}",meshmatcap_frag:"#define MATCAP\nuniform vec3 diffuse;\nuniform float opacity;\nuniform sampler2D matcap;\nvarying vec3 vViewPosition;\n#include <common>\n#include <dithering_pars_fragment>\n#include <color_pars_fragment>\n#include <uv_pars_fragment>\n#include <map_pars_fragment>\n#include <alphamap_pars_fragment>\n#include <alphatest_pars_fragment>\n#include <fog_pars_fragment>\n#include <normal_pars_fragment>\n#include <bumpmap_pars_fragment>\n#include <normalmap_pars_fragment>\n#include <logdepthbuf_pars_fragment>\n#include <clipping_planes_pars_fragment>\nvoid main() {\n\t#include <clipping_planes_fragment>\n\tvec4 diffuseColor = vec4( diffuse, opacity );\n\t#include <logdepthbuf_fragment>\n\t#include <map_fragment>\n\t#include <color_fragment>\n\t#include <alphamap_fragment>\n\t#include <alphatest_fragment>\n\t#include <normal_fragment_begin>\n\t#include <normal_fragment_maps>\n\tvec3 viewDir = normalize( vViewPosition );\n\tvec3 x = normalize( vec3( viewDir.z, 0.0, - viewDir.x ) );\n\tvec3 y = cross( viewDir, x );\n\tvec2 uv = vec2( dot( x, normal ), dot( y, normal ) ) * 0.495 + 0.5;\n\t#ifdef USE_MATCAP\n\t\tvec4 matcapColor = texture2D( matcap, uv );\n\t#else\n\t\tvec4 matcapColor = vec4( vec3( mix( 0.2, 0.8, uv.y ) ), 1.0 );\n\t#endif\n\tvec3 outgoingLight = diffuseColor.rgb * matcapColor.rgb;\n\t#include <output_fragment>\n\t#include <tonemapping_fragment>\n\t#include <encodings_fragment>\n\t#include <fog_fragment>\n\t#include <premultiplied_alpha_fragment>\n\t#include <dithering_fragment>\n}",meshnormal_vert:"#define NORMAL\n#if defined( FLAT_SHADED ) || defined( USE_BUMPMAP ) || defined( TANGENTSPACE_NORMALMAP )\n\tvarying vec3 vViewPosition;\n#endif\n#include <common>\n#include <uv_pars_vertex>\n#include <displacementmap_pars_vertex>\n#include <normal_pars_vertex>\n#include <morphtarget_pars_vertex>\n#include <skinning_pars_vertex>\n#include <logdepthbuf_pars_vertex>\n#include <clipping_planes_pars_vertex>\nvoid main() {\n\t#include <uv_vertex>\n\t#include <beginnormal_vertex>\n\t#include <morphnormal_vertex>\n\t#include <skinbase_vertex>\n\t#include <skinnormal_vertex>\n\t#include <defaultnormal_vertex>\n\t#include <normal_vertex>\n\t#include <begin_vertex>\n\t#include <morphtarget_vertex>\n\t#include <skinning_vertex>\n\t#include <displacementmap_vertex>\n\t#include <project_vertex>\n\t#include <logdepthbuf_vertex>\n\t#include <clipping_planes_vertex>\n#if defined( FLAT_SHADED ) || defined( USE_BUMPMAP ) || defined( TANGENTSPACE_NORMALMAP )\n\tvViewPosition = - mvPosition.xyz;\n#endif\n}",meshnormal_frag:"#define NORMAL\nuniform float opacity;\n#if defined( FLAT_SHADED ) || defined( USE_BUMPMAP ) || defined( TANGENTSPACE_NORMALMAP )\n\tvarying vec3 vViewPosition;\n#endif\n#include <packing>\n#include <uv_pars_fragment>\n#include <normal_pars_fragment>\n#include <bumpmap_pars_fragment>\n#include <normalmap_pars_fragment>\n#include <logdepthbuf_pars_fragment>\n#include <clipping_planes_pars_fragment>\nvoid main() {\n\t#include <clipping_planes_fragment>\n\t#include <logdepthbuf_fragment>\n\t#include <normal_fragment_begin>\n\t#include <normal_fragment_maps>\n\tgl_FragColor = vec4( packNormalToRGB( normal ), opacity );\n\t#ifdef OPAQUE\n\t\tgl_FragColor.a = 1.0;\n\t#endif\n}",meshphong_vert:"#define PHONG\nvarying vec3 vViewPosition;\n#include <common>\n#include <uv_pars_vertex>\n#include <uv2_pars_vertex>\n#include <displacementmap_pars_vertex>\n#include <envmap_pars_vertex>\n#include <color_pars_vertex>\n#include <fog_pars_vertex>\n#include <normal_pars_vertex>\n#include <morphtarget_pars_vertex>\n#include <skinning_pars_vertex>\n#include <shadowmap_pars_vertex>\n#include <logdepthbuf_pars_vertex>\n#include <clipping_planes_pars_vertex>\nvoid main() {\n\t#include <uv_vertex>\n\t#include <uv2_vertex>\n\t#include <color_vertex>\n\t#include <morphcolor_vertex>\n\t#include <beginnormal_vertex>\n\t#include <morphnormal_vertex>\n\t#include <skinbase_vertex>\n\t#include <skinnormal_vertex>\n\t#include <defaultnormal_vertex>\n\t#include <normal_vertex>\n\t#include <begin_vertex>\n\t#include <morphtarget_vertex>\n\t#include <skinning_vertex>\n\t#include <displacementmap_vertex>\n\t#include <project_vertex>\n\t#include <logdepthbuf_vertex>\n\t#include <clipping_planes_vertex>\n\tvViewPosition = - mvPosition.xyz;\n\t#include <worldpos_vertex>\n\t#include <envmap_vertex>\n\t#include <shadowmap_vertex>\n\t#include <fog_vertex>\n}",meshphong_frag:"#define PHONG\nuniform vec3 diffuse;\nuniform vec3 emissive;\nuniform vec3 specular;\nuniform float shininess;\nuniform float opacity;\n#include <common>\n#include <packing>\n#include <dithering_pars_fragment>\n#include <color_pars_fragment>\n#include <uv_pars_fragment>\n#include <uv2_pars_fragment>\n#include <map_pars_fragment>\n#include <alphamap_pars_fragment>\n#include <alphatest_pars_fragment>\n#include <aomap_pars_fragment>\n#include <lightmap_pars_fragment>\n#include <emissivemap_pars_fragment>\n#include <envmap_common_pars_fragment>\n#include <envmap_pars_fragment>\n#include <fog_pars_fragment>\n#include <bsdfs>\n#include <lights_pars_begin>\n#include <normal_pars_fragment>\n#include <lights_phong_pars_fragment>\n#include <shadowmap_pars_fragment>\n#include <bumpmap_pars_fragment>\n#include <normalmap_pars_fragment>\n#include <specularmap_pars_fragment>\n#include <logdepthbuf_pars_fragment>\n#include <clipping_planes_pars_fragment>\nvoid main() {\n\t#include <clipping_planes_fragment>\n\tvec4 diffuseColor = vec4( diffuse, opacity );\n\tReflectedLight reflectedLight = ReflectedLight( vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ) );\n\tvec3 totalEmissiveRadiance = emissive;\n\t#include <logdepthbuf_fragment>\n\t#include <map_fragment>\n\t#include <color_fragment>\n\t#include <alphamap_fragment>\n\t#include <alphatest_fragment>\n\t#include <specularmap_fragment>\n\t#include <normal_fragment_begin>\n\t#include <normal_fragment_maps>\n\t#include <emissivemap_fragment>\n\t#include <lights_phong_fragment>\n\t#include <lights_fragment_begin>\n\t#include <lights_fragment_maps>\n\t#include <lights_fragment_end>\n\t#include <aomap_fragment>\n\tvec3 outgoingLight = reflectedLight.directDiffuse + reflectedLight.indirectDiffuse + reflectedLight.directSpecular + reflectedLight.indirectSpecular + totalEmissiveRadiance;\n\t#include <envmap_fragment>\n\t#include <output_fragment>\n\t#include <tonemapping_fragment>\n\t#include <encodings_fragment>\n\t#include <fog_fragment>\n\t#include <premultiplied_alpha_fragment>\n\t#include <dithering_fragment>\n}",meshphysical_vert:"#define STANDARD\nvarying vec3 vViewPosition;\n#ifdef USE_TRANSMISSION\n\tvarying vec3 vWorldPosition;\n#endif\n#include <common>\n#include <uv_pars_vertex>\n#include <uv2_pars_vertex>\n#include <displacementmap_pars_vertex>\n#include <color_pars_vertex>\n#include <fog_pars_vertex>\n#include <normal_pars_vertex>\n#include <morphtarget_pars_vertex>\n#include <skinning_pars_vertex>\n#include <shadowmap_pars_vertex>\n#include <logdepthbuf_pars_vertex>\n#include <clipping_planes_pars_vertex>\nvoid main() {\n\t#include <uv_vertex>\n\t#include <uv2_vertex>\n\t#include <color_vertex>\n\t#include <morphcolor_vertex>\n\t#include <beginnormal_vertex>\n\t#include <morphnormal_vertex>\n\t#include <skinbase_vertex>\n\t#include <skinnormal_vertex>\n\t#include <defaultnormal_vertex>\n\t#include <normal_vertex>\n\t#include <begin_vertex>\n\t#include <morphtarget_vertex>\n\t#include <skinning_vertex>\n\t#include <displacementmap_vertex>\n\t#include <project_vertex>\n\t#include <logdepthbuf_vertex>\n\t#include <clipping_planes_vertex>\n\tvViewPosition = - mvPosition.xyz;\n\t#include <worldpos_vertex>\n\t#include <shadowmap_vertex>\n\t#include <fog_vertex>\n#ifdef USE_TRANSMISSION\n\tvWorldPosition = worldPosition.xyz;\n#endif\n}",meshphysical_frag:"#define STANDARD\n#ifdef PHYSICAL\n\t#define IOR\n\t#define SPECULAR\n#endif\nuniform vec3 diffuse;\nuniform vec3 emissive;\nuniform float roughness;\nuniform float metalness;\nuniform float opacity;\n#ifdef IOR\n\tuniform float ior;\n#endif\n#ifdef SPECULAR\n\tuniform float specularIntensity;\n\tuniform vec3 specularColor;\n\t#ifdef USE_SPECULARINTENSITYMAP\n\t\tuniform sampler2D specularIntensityMap;\n\t#endif\n\t#ifdef USE_SPECULARCOLORMAP\n\t\tuniform sampler2D specularColorMap;\n\t#endif\n#endif\n#ifdef USE_CLEARCOAT\n\tuniform float clearcoat;\n\tuniform float clearcoatRoughness;\n#endif\n#ifdef USE_IRIDESCENCE\n\tuniform float iridescence;\n\tuniform float iridescenceIOR;\n\tuniform float iridescenceThicknessMinimum;\n\tuniform float iridescenceThicknessMaximum;\n#endif\n#ifdef USE_SHEEN\n\tuniform vec3 sheenColor;\n\tuniform float sheenRoughness;\n\t#ifdef USE_SHEENCOLORMAP\n\t\tuniform sampler2D sheenColorMap;\n\t#endif\n\t#ifdef USE_SHEENROUGHNESSMAP\n\t\tuniform sampler2D sheenRoughnessMap;\n\t#endif\n#endif\nvarying vec3 vViewPosition;\n#include <common>\n#include <packing>\n#include <dithering_pars_fragment>\n#include <color_pars_fragment>\n#include <uv_pars_fragment>\n#include <uv2_pars_fragment>\n#include <map_pars_fragment>\n#include <alphamap_pars_fragment>\n#include <alphatest_pars_fragment>\n#include <aomap_pars_fragment>\n#include <lightmap_pars_fragment>\n#include <emissivemap_pars_fragment>\n#include <bsdfs>\n#include <iridescence_fragment>\n#include <cube_uv_reflection_fragment>\n#include <envmap_common_pars_fragment>\n#include <envmap_physical_pars_fragment>\n#include <fog_pars_fragment>\n#include <lights_pars_begin>\n#include <normal_pars_fragment>\n#include <lights_physical_pars_fragment>\n#include <transmission_pars_fragment>\n#include <shadowmap_pars_fragment>\n#include <bumpmap_pars_fragment>\n#include <normalmap_pars_fragment>\n#include <clearcoat_pars_fragment>\n#include <iridescence_pars_fragment>\n#include <roughnessmap_pars_fragment>\n#include <metalnessmap_pars_fragment>\n#include <logdepthbuf_pars_fragment>\n#include <clipping_planes_pars_fragment>\nvoid main() {\n\t#include <clipping_planes_fragment>\n\tvec4 diffuseColor = vec4( diffuse, opacity );\n\tReflectedLight reflectedLight = ReflectedLight( vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ) );\n\tvec3 totalEmissiveRadiance = emissive;\n\t#include <logdepthbuf_fragment>\n\t#include <map_fragment>\n\t#include <color_fragment>\n\t#include <alphamap_fragment>\n\t#include <alphatest_fragment>\n\t#include <roughnessmap_fragment>\n\t#include <metalnessmap_fragment>\n\t#include <normal_fragment_begin>\n\t#include <normal_fragment_maps>\n\t#include <clearcoat_normal_fragment_begin>\n\t#include <clearcoat_normal_fragment_maps>\n\t#include <emissivemap_fragment>\n\t#include <lights_physical_fragment>\n\t#include <lights_fragment_begin>\n\t#include <lights_fragment_maps>\n\t#include <lights_fragment_end>\n\t#include <aomap_fragment>\n\tvec3 totalDiffuse = reflectedLight.directDiffuse + reflectedLight.indirectDiffuse;\n\tvec3 totalSpecular = reflectedLight.directSpecular + reflectedLight.indirectSpecular;\n\t#include <transmission_fragment>\n\tvec3 outgoingLight = totalDiffuse + totalSpecular + totalEmissiveRadiance;\n\t#ifdef USE_SHEEN\n\t\tfloat sheenEnergyComp = 1.0 - 0.157 * max3( material.sheenColor );\n\t\toutgoingLight = outgoingLight * sheenEnergyComp + sheenSpecular;\n\t#endif\n\t#ifdef USE_CLEARCOAT\n\t\tfloat dotNVcc = saturate( dot( geometry.clearcoatNormal, geometry.viewDir ) );\n\t\tvec3 Fcc = F_Schlick( material.clearcoatF0, material.clearcoatF90, dotNVcc );\n\t\toutgoingLight = outgoingLight * ( 1.0 - material.clearcoat * Fcc ) + clearcoatSpecular * material.clearcoat;\n\t#endif\n\t#include <output_fragment>\n\t#include <tonemapping_fragment>\n\t#include <encodings_fragment>\n\t#include <fog_fragment>\n\t#include <premultiplied_alpha_fragment>\n\t#include <dithering_fragment>\n}",meshtoon_vert:"#define TOON\nvarying vec3 vViewPosition;\n#include <common>\n#include <uv_pars_vertex>\n#include <uv2_pars_vertex>\n#include <displacementmap_pars_vertex>\n#include <color_pars_vertex>\n#include <fog_pars_vertex>\n#include <normal_pars_vertex>\n#include <morphtarget_pars_vertex>\n#include <skinning_pars_vertex>\n#include <shadowmap_pars_vertex>\n#include <logdepthbuf_pars_vertex>\n#include <clipping_planes_pars_vertex>\nvoid main() {\n\t#include <uv_vertex>\n\t#include <uv2_vertex>\n\t#include <color_vertex>\n\t#include <morphcolor_vertex>\n\t#include <beginnormal_vertex>\n\t#include <morphnormal_vertex>\n\t#include <skinbase_vertex>\n\t#include <skinnormal_vertex>\n\t#include <defaultnormal_vertex>\n\t#include <normal_vertex>\n\t#include <begin_vertex>\n\t#include <morphtarget_vertex>\n\t#include <skinning_vertex>\n\t#include <displacementmap_vertex>\n\t#include <project_vertex>\n\t#include <logdepthbuf_vertex>\n\t#include <clipping_planes_vertex>\n\tvViewPosition = - mvPosition.xyz;\n\t#include <worldpos_vertex>\n\t#include <shadowmap_vertex>\n\t#include <fog_vertex>\n}",meshtoon_frag:"#define TOON\nuniform vec3 diffuse;\nuniform vec3 emissive;\nuniform float opacity;\n#include <common>\n#include <packing>\n#include <dithering_pars_fragment>\n#include <color_pars_fragment>\n#include <uv_pars_fragment>\n#include <uv2_pars_fragment>\n#include <map_pars_fragment>\n#include <alphamap_pars_fragment>\n#include <alphatest_pars_fragment>\n#include <aomap_pars_fragment>\n#include <lightmap_pars_fragment>\n#include <emissivemap_pars_fragment>\n#include <gradientmap_pars_fragment>\n#include <fog_pars_fragment>\n#include <bsdfs>\n#include <lights_pars_begin>\n#include <normal_pars_fragment>\n#include <lights_toon_pars_fragment>\n#include <shadowmap_pars_fragment>\n#include <bumpmap_pars_fragment>\n#include <normalmap_pars_fragment>\n#include <logdepthbuf_pars_fragment>\n#include <clipping_planes_pars_fragment>\nvoid main() {\n\t#include <clipping_planes_fragment>\n\tvec4 diffuseColor = vec4( diffuse, opacity );\n\tReflectedLight reflectedLight = ReflectedLight( vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ) );\n\tvec3 totalEmissiveRadiance = emissive;\n\t#include <logdepthbuf_fragment>\n\t#include <map_fragment>\n\t#include <color_fragment>\n\t#include <alphamap_fragment>\n\t#include <alphatest_fragment>\n\t#include <normal_fragment_begin>\n\t#include <normal_fragment_maps>\n\t#include <emissivemap_fragment>\n\t#include <lights_toon_fragment>\n\t#include <lights_fragment_begin>\n\t#include <lights_fragment_maps>\n\t#include <lights_fragment_end>\n\t#include <aomap_fragment>\n\tvec3 outgoingLight = reflectedLight.directDiffuse + reflectedLight.indirectDiffuse + totalEmissiveRadiance;\n\t#include <output_fragment>\n\t#include <tonemapping_fragment>\n\t#include <encodings_fragment>\n\t#include <fog_fragment>\n\t#include <premultiplied_alpha_fragment>\n\t#include <dithering_fragment>\n}",points_vert:"uniform float size;\nuniform float scale;\n#include <common>\n#include <color_pars_vertex>\n#include <fog_pars_vertex>\n#include <morphtarget_pars_vertex>\n#include <logdepthbuf_pars_vertex>\n#include <clipping_planes_pars_vertex>\nvoid main() {\n\t#include <color_vertex>\n\t#include <morphcolor_vertex>\n\t#include <begin_vertex>\n\t#include <morphtarget_vertex>\n\t#include <project_vertex>\n\tgl_PointSize = size;\n\t#ifdef USE_SIZEATTENUATION\n\t\tbool isPerspective = isPerspectiveMatrix( projectionMatrix );\n\t\tif ( isPerspective ) gl_PointSize *= ( scale / - mvPosition.z );\n\t#endif\n\t#include <logdepthbuf_vertex>\n\t#include <clipping_planes_vertex>\n\t#include <worldpos_vertex>\n\t#include <fog_vertex>\n}",points_frag:"uniform vec3 diffuse;\nuniform float opacity;\n#include <common>\n#include <color_pars_fragment>\n#include <map_particle_pars_fragment>\n#include <alphatest_pars_fragment>\n#include <fog_pars_fragment>\n#include <logdepthbuf_pars_fragment>\n#include <clipping_planes_pars_fragment>\nvoid main() {\n\t#include <clipping_planes_fragment>\n\tvec3 outgoingLight = vec3( 0.0 );\n\tvec4 diffuseColor = vec4( diffuse, opacity );\n\t#include <logdepthbuf_fragment>\n\t#include <map_particle_fragment>\n\t#include <color_fragment>\n\t#include <alphatest_fragment>\n\toutgoingLight = diffuseColor.rgb;\n\t#include <output_fragment>\n\t#include <tonemapping_fragment>\n\t#include <encodings_fragment>\n\t#include <fog_fragment>\n\t#include <premultiplied_alpha_fragment>\n}",shadow_vert:"#include <common>\n#include <fog_pars_vertex>\n#include <morphtarget_pars_vertex>\n#include <skinning_pars_vertex>\n#include <shadowmap_pars_vertex>\nvoid main() {\n\t#include <beginnormal_vertex>\n\t#include <morphnormal_vertex>\n\t#include <skinbase_vertex>\n\t#include <skinnormal_vertex>\n\t#include <defaultnormal_vertex>\n\t#include <begin_vertex>\n\t#include <morphtarget_vertex>\n\t#include <skinning_vertex>\n\t#include <project_vertex>\n\t#include <worldpos_vertex>\n\t#include <shadowmap_vertex>\n\t#include <fog_vertex>\n}",shadow_frag:"uniform vec3 color;\nuniform float opacity;\n#include <common>\n#include <packing>\n#include <fog_pars_fragment>\n#include <bsdfs>\n#include <lights_pars_begin>\n#include <shadowmap_pars_fragment>\n#include <shadowmask_pars_fragment>\nvoid main() {\n\tgl_FragColor = vec4( color, opacity * ( 1.0 - getShadowMask() ) );\n\t#include <tonemapping_fragment>\n\t#include <encodings_fragment>\n\t#include <fog_fragment>\n}",sprite_vert:"uniform float rotation;\nuniform vec2 center;\n#include <common>\n#include <uv_pars_vertex>\n#include <fog_pars_vertex>\n#include <logdepthbuf_pars_vertex>\n#include <clipping_planes_pars_vertex>\nvoid main() {\n\t#include <uv_vertex>\n\tvec4 mvPosition = modelViewMatrix * vec4( 0.0, 0.0, 0.0, 1.0 );\n\tvec2 scale;\n\tscale.x = length( vec3( modelMatrix[ 0 ].x, modelMatrix[ 0 ].y, modelMatrix[ 0 ].z ) );\n\tscale.y = length( vec3( modelMatrix[ 1 ].x, modelMatrix[ 1 ].y, modelMatrix[ 1 ].z ) );\n\t#ifndef USE_SIZEATTENUATION\n\t\tbool isPerspective = isPerspectiveMatrix( projectionMatrix );\n\t\tif ( isPerspective ) scale *= - mvPosition.z;\n\t#endif\n\tvec2 alignedPosition = ( position.xy - ( center - vec2( 0.5 ) ) ) * scale;\n\tvec2 rotatedPosition;\n\trotatedPosition.x = cos( rotation ) * alignedPosition.x - sin( rotation ) * alignedPosition.y;\n\trotatedPosition.y = sin( rotation ) * alignedPosition.x + cos( rotation ) * alignedPosition.y;\n\tmvPosition.xy += rotatedPosition;\n\tgl_Position = projectionMatrix * mvPosition;\n\t#include <logdepthbuf_vertex>\n\t#include <clipping_planes_vertex>\n\t#include <fog_vertex>\n}",sprite_frag:"uniform vec3 diffuse;\nuniform float opacity;\n#include <common>\n#include <uv_pars_fragment>\n#include <map_pars_fragment>\n#include <alphamap_pars_fragment>\n#include <alphatest_pars_fragment>\n#include <fog_pars_fragment>\n#include <logdepthbuf_pars_fragment>\n#include <clipping_planes_pars_fragment>\nvoid main() {\n\t#include <clipping_planes_fragment>\n\tvec3 outgoingLight = vec3( 0.0 );\n\tvec4 diffuseColor = vec4( diffuse, opacity );\n\t#include <logdepthbuf_fragment>\n\t#include <map_fragment>\n\t#include <alphamap_fragment>\n\t#include <alphatest_fragment>\n\toutgoingLight = diffuseColor.rgb;\n\t#include <output_fragment>\n\t#include <tonemapping_fragment>\n\t#include <encodings_fragment>\n\t#include <fog_fragment>\n}"},aa={common:{diffuse:{value:new Rn(16777215)},opacity:{value:1},map:{value:null},uvTransform:{value:new vn},uv2Transform:{value:new vn},alphaMap:{value:null},alphaTest:{value:0}},specularmap:{specularMap:{value:null}},envmap:{envMap:{value:null},flipEnvMap:{value:-1},reflectivity:{value:1},ior:{value:1.5},refractionRatio:{value:.98}},aomap:{aoMap:{value:null},aoMapIntensity:{value:1}},lightmap:{lightMap:{value:null},lightMapIntensity:{value:1}},emissivemap:{emissiveMap:{value:null}},bumpmap:{bumpMap:{value:null},bumpScale:{value:1}},normalmap:{normalMap:{value:null},normalScale:{value:new An(1,1)}},displacementmap:{displacementMap:{value:null},displacementScale:{value:1},displacementBias:{value:0}},roughnessmap:{roughnessMap:{value:null}},metalnessmap:{metalnessMap:{value:null}},gradientmap:{gradientMap:{value:null}},fog:{fogDensity:{value:25e-5},fogNear:{value:1},fogFar:{value:2e3},fogColor:{value:new Rn(16777215)}},lights:{ambientLightColor:{value:[]},lightProbe:{value:[]},directionalLights:{value:[],properties:{direction:{},color:{}}},directionalLightShadows:{value:[],properties:{shadowBias:{},shadowNormalBias:{},shadowRadius:{},shadowMapSize:{}}},directionalShadowMap:{value:[]},directionalShadowMatrix:{value:[]},spotLights:{value:[],properties:{color:{},position:{},direction:{},distance:{},coneCos:{},penumbraCos:{},decay:{}}},spotLightShadows:{value:[],properties:{shadowBias:{},shadowNormalBias:{},shadowRadius:{},shadowMapSize:{}}},spotLightMap:{value:[]},spotShadowMap:{value:[]},spotLightMatrix:{value:[]},pointLights:{value:[],properties:{color:{},position:{},decay:{},distance:{}}},pointLightShadows:{value:[],properties:{shadowBias:{},shadowNormalBias:{},shadowRadius:{},shadowMapSize:{},shadowCameraNear:{},shadowCameraFar:{}}},pointShadowMap:{value:[]},pointShadowMatrix:{value:[]},hemisphereLights:{value:[],properties:{direction:{},skyColor:{},groundColor:{}}},rectAreaLights:{value:[],properties:{color:{},position:{},width:{},height:{}}},ltc_1:{value:null},ltc_2:{value:null}},points:{diffuse:{value:new Rn(16777215)},opacity:{value:1},size:{value:1},scale:{value:1},map:{value:null},alphaMap:{value:null},alphaTest:{value:0},uvTransform:{value:new vn}},sprite:{diffuse:{value:new Rn(16777215)},opacity:{value:1},center:{value:new An(.5,.5)},rotation:{value:0},map:{value:null},alphaMap:{value:null},alphaTest:{value:0},uvTransform:{value:new vn}}},oa={basic:{uniforms:Nr([aa.common,aa.specularmap,aa.envmap,aa.aomap,aa.lightmap,aa.fog]),vertexShader:ra.meshbasic_vert,fragmentShader:ra.meshbasic_frag},lambert:{uniforms:Nr([aa.common,aa.specularmap,aa.envmap,aa.aomap,aa.lightmap,aa.emissivemap,aa.bumpmap,aa.normalmap,aa.displacementmap,aa.fog,aa.lights,{emissive:{value:new Rn(0)}}]),vertexShader:ra.meshlambert_vert,fragmentShader:ra.meshlambert_frag},phong:{uniforms:Nr([aa.common,aa.specularmap,aa.envmap,aa.aomap,aa.lightmap,aa.emissivemap,aa.bumpmap,aa.normalmap,aa.displacementmap,aa.fog,aa.lights,{emissive:{value:new Rn(0)},specular:{value:new Rn(1118481)},shininess:{value:30}}]),vertexShader:ra.meshphong_vert,fragmentShader:ra.meshphong_frag},standard:{uniforms:Nr([aa.common,aa.envmap,aa.aomap,aa.lightmap,aa.emissivemap,aa.bumpmap,aa.normalmap,aa.displacementmap,aa.roughnessmap,aa.metalnessmap,aa.fog,aa.lights,{emissive:{value:new Rn(0)},roughness:{value:1},metalness:{value:0},envMapIntensity:{value:1}}]),vertexShader:ra.meshphysical_vert,fragmentShader:ra.meshphysical_frag},toon:{uniforms:Nr([aa.common,aa.aomap,aa.lightmap,aa.emissivemap,aa.bumpmap,aa.normalmap,aa.displacementmap,aa.gradientmap,aa.fog,aa.lights,{emissive:{value:new Rn(0)}}]),vertexShader:ra.meshtoon_vert,fragmentShader:ra.meshtoon_frag},matcap:{uniforms:Nr([aa.common,aa.bumpmap,aa.normalmap,aa.displacementmap,aa.fog,{matcap:{value:null}}]),vertexShader:ra.meshmatcap_vert,fragmentShader:ra.meshmatcap_frag},points:{uniforms:Nr([aa.points,aa.fog]),vertexShader:ra.points_vert,fragmentShader:ra.points_frag},dashed:{uniforms:Nr([aa.common,aa.fog,{scale:{value:1},dashSize:{value:1},totalSize:{value:2}}]),vertexShader:ra.linedashed_vert,fragmentShader:ra.linedashed_frag},depth:{uniforms:Nr([aa.common,aa.displacementmap]),vertexShader:ra.depth_vert,fragmentShader:ra.depth_frag},normal:{uniforms:Nr([aa.common,aa.bumpmap,aa.normalmap,aa.displacementmap,{opacity:{value:1}}]),vertexShader:ra.meshnormal_vert,fragmentShader:ra.meshnormal_frag},sprite:{uniforms:Nr([aa.sprite,aa.fog]),vertexShader:ra.sprite_vert,fragmentShader:ra.sprite_frag},background:{uniforms:{uvTransform:{value:new vn},t2D:{value:null},backgroundIntensity:{value:1}},vertexShader:ra.background_vert,fragmentShader:ra.background_frag},backgroundCube:{uniforms:{envMap:{value:null},flipEnvMap:{value:-1},backgroundBlurriness:{value:0},backgroundIntensity:{value:1}},vertexShader:ra.backgroundCube_vert,fragmentShader:ra.backgroundCube_frag},cube:{uniforms:{tCube:{value:null},tFlip:{value:-1},opacity:{value:1}},vertexShader:ra.cube_vert,fragmentShader:ra.cube_frag},equirect:{uniforms:{tEquirect:{value:null}},vertexShader:ra.equirect_vert,fragmentShader:ra.equirect_frag},distanceRGBA:{uniforms:Nr([aa.common,aa.displacementmap,{referencePosition:{value:new Gn},nearDistance:{value:1},farDistance:{value:1e3}}]),vertexShader:ra.distanceRGBA_vert,fragmentShader:ra.distanceRGBA_frag},shadow:{uniforms:Nr([aa.lights,aa.fog,{color:{value:new Rn(0)},opacity:{value:1}}]),vertexShader:ra.shadow_vert,fragmentShader:ra.shadow_frag}};oa.physical={uniforms:Nr([oa.standard.uniforms,{clearcoat:{value:0},clearcoatMap:{value:null},clearcoatRoughness:{value:0},clearcoatRoughnessMap:{value:null},clearcoatNormalScale:{value:new An(1,1)},clearcoatNormalMap:{value:null},iridescence:{value:0},iridescenceMap:{value:null},iridescenceIOR:{value:1.3},iridescenceThicknessMinimum:{value:100},iridescenceThicknessMaximum:{value:400},iridescenceThicknessMap:{value:null},sheen:{value:0},sheenColor:{value:new Rn(0)},sheenColorMap:{value:null},sheenRoughness:{value:1},sheenRoughnessMap:{value:null},transmission:{value:0},transmissionMap:{value:null},transmissionSamplerSize:{value:new An},transmissionSamplerMap:{value:null},thickness:{value:0},thicknessMap:{value:null},attenuationDistance:{value:0},attenuationColor:{value:new Rn(0)},specularIntensity:{value:1},specularIntensityMap:{value:null},specularColor:{value:new Rn(1,1,1)},specularColorMap:{value:null}}]),vertexShader:ra.meshphysical_vert,fragmentShader:ra.meshphysical_frag};var sa={r:0,b:0,g:0};function la(e,t,n,i,r,a,o){var s,l,u=new Rn(0),c=!0===a?0:1,h=null,d=0,f=null;function p(t,n){t.getRGB(sa,Fr(e)),i.buffers.color.setClear(sa.r,sa.g,sa.b,n,o)}return{getClearColor:function(){return u},setClearColor:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1;u.set(e),p(u,c=t)},getClearAlpha:function(){return c},setClearAlpha:function(e){p(u,c=e)},render:function(i,a){var o=!1,A=!0===a.isScene?a.background:null;A&&A.isTexture&&(A=(a.backgroundBlurriness>0?n:t).get(A));var v=e.xr,g=v.getSession&&v.getSession();g&&"additive"===g.environmentBlendMode&&(A=null),null===A?p(u,c):A&&A.isColor&&(p(A,1),o=!0),(e.autoClear||o)&&e.clear(e.autoClearColor,e.autoClearDepth,e.autoClearStencil),A&&(A.isCubeTexture||A.mapping===ye)?(void 0===l&&((l=new Pr(new Qr(1,1,1),new jr({name:"BackgroundCubeMaterial",uniforms:Zr(oa.backgroundCube.uniforms),vertexShader:oa.backgroundCube.vertexShader,fragmentShader:oa.backgroundCube.fragmentShader,side:S,depthTest:!1,depthWrite:!1,fog:!1}))).geometry.deleteAttribute("normal"),l.geometry.deleteAttribute("uv"),l.onBeforeRender=function(e,t,n){this.matrixWorld.copyPosition(n.matrixWorld)},Object.defineProperty(l.material,"envMap",{get:function(){return this.uniforms.envMap.value}}),r.update(l)),l.material.uniforms.envMap.value=A,l.material.uniforms.flipEnvMap.value=A.isCubeTexture&&!1===A.isRenderTargetTexture?-1:1,l.material.uniforms.backgroundBlurriness.value=a.backgroundBlurriness,l.material.uniforms.backgroundIntensity.value=a.backgroundIntensity,l.material.toneMapped=A.encoding!==Ft,h===A&&d===A.version&&f===e.toneMapping||(l.material.needsUpdate=!0,h=A,d=A.version,f=e.toneMapping),l.layers.enableAll(),i.unshift(l,l.geometry,l.material,0,0,null)):A&&A.isTexture&&(void 0===s&&((s=new Pr(new ia(2,2),new jr({name:"BackgroundMaterial",uniforms:Zr(oa.background.uniforms),vertexShader:oa.background.vertexShader,fragmentShader:oa.background.fragmentShader,side:I,depthTest:!1,depthWrite:!1,fog:!1}))).geometry.deleteAttribute("normal"),Object.defineProperty(s.material,"map",{get:function(){return this.uniforms.t2D.value}}),r.update(s)),s.material.uniforms.t2D.value=A,s.material.uniforms.backgroundIntensity.value=a.backgroundIntensity,s.material.toneMapped=A.encoding!==Ft,!0===A.matrixAutoUpdate&&A.updateMatrix(),s.material.uniforms.uvTransform.value.copy(A.matrix),h===A&&d===A.version&&f===e.toneMapping||(s.material.needsUpdate=!0,h=A,d=A.version,f=e.toneMapping),s.layers.enableAll(),i.unshift(s,s.geometry,s.material,0,0,null))}}}function ua(e,t,n,i){var r=e.getParameter(34921),a=i.isWebGL2?null:t.get("OES_vertex_array_object"),o=i.isWebGL2||null!==a,s={},l=f(null),u=l,c=!1;function h(t){return i.isWebGL2?e.bindVertexArray(t):a.bindVertexArrayOES(t)}function d(t){return i.isWebGL2?e.deleteVertexArray(t):a.deleteVertexArrayOES(t)}function f(e){for(var t=[],n=[],i=[],a=0;a<r;a++)t[a]=0,n[a]=0,i[a]=0;return{geometry:null,program:null,wireframe:!1,newAttributes:t,enabledAttributes:n,attributeDivisors:i,object:e,attributes:{},index:null}}function p(){for(var e=u.newAttributes,t=0,n=e.length;t<n;t++)e[t]=0}function A(e){v(e,0)}function v(n,r){var a=u.newAttributes,o=u.enabledAttributes,s=u.attributeDivisors;(a[n]=1,0===o[n]&&(e.enableVertexAttribArray(n),o[n]=1),s[n]!==r)&&((i.isWebGL2?e:t.get("ANGLE_instanced_arrays"))[i.isWebGL2?"vertexAttribDivisor":"vertexAttribDivisorANGLE"](n,r),s[n]=r)}function g(){for(var t=u.newAttributes,n=u.enabledAttributes,i=0,r=n.length;i<r;i++)n[i]!==t[i]&&(e.disableVertexAttribArray(i),n[i]=0)}function m(t,n,r,a,o,s){!0!==i.isWebGL2||5124!==r&&5125!==r?e.vertexAttribPointer(t,n,r,a,o,s):e.vertexAttribIPointer(t,n,r,o,s)}function y(){x(),c=!0,u!==l&&h((u=l).object)}function x(){l.geometry=null,l.program=null,l.wireframe=!1}return{setup:function(r,l,d,y,x){var w=!1;if(o){var C=function(t,n,r){var o=!0===r.wireframe,l=s[t.id];void 0===l&&(l={},s[t.id]=l);var u=l[n.id];void 0===u&&(u={},l[n.id]=u);var c=u[o];void 0===c&&(c=f(i.isWebGL2?e.createVertexArray():a.createVertexArrayOES()),u[o]=c);return c}(y,d,l);u!==C&&h((u=C).object),w=function(e,t,n,i){var r=u.attributes,a=t.attributes,o=0,s=n.getAttributes();for(var l in s){if(s[l].location>=0){var c=r[l],h=a[l];if(void 0===h&&("instanceMatrix"===l&&e.instanceMatrix&&(h=e.instanceMatrix),"instanceColor"===l&&e.instanceColor&&(h=e.instanceColor)),void 0===c)return!0;if(c.attribute!==h)return!0;if(h&&c.data!==h.data)return!0;o++}}return u.attributesNum!==o||u.index!==i}(r,y,d,x),w&&function(e,t,n,i){var r={},a=t.attributes,o=0,s=n.getAttributes();for(var l in s){if(s[l].location>=0){var c=a[l];void 0===c&&("instanceMatrix"===l&&e.instanceMatrix&&(c=e.instanceMatrix),"instanceColor"===l&&e.instanceColor&&(c=e.instanceColor));var h={};h.attribute=c,c&&c.data&&(h.data=c.data),r[l]=h,o++}}u.attributes=r,u.attributesNum=o,u.index=i}(r,y,d,x)}else{var b=!0===l.wireframe;u.geometry===y.id&&u.program===d.id&&u.wireframe===b||(u.geometry=y.id,u.program=d.id,u.wireframe=b,w=!0)}null!==x&&n.update(x,34963),(w||c)&&(c=!1,function(r,a,o,s){if(!1===i.isWebGL2&&(r.isInstancedMesh||s.isInstancedBufferGeometry)&&null===t.get("ANGLE_instanced_arrays"))return;p();var l=s.attributes,u=o.getAttributes(),c=a.defaultAttributeValues;for(var h in u){var d=u[h];if(d.location>=0){var f=l[h];if(void 0===f&&("instanceMatrix"===h&&r.instanceMatrix&&(f=r.instanceMatrix),"instanceColor"===h&&r.instanceColor&&(f=r.instanceColor)),void 0!==f){var y=f.normalized,x=f.itemSize,w=n.get(f);if(void 0===w)continue;var C=w.buffer,b=w.type,_=w.bytesPerElement;if(f.isInterleavedBufferAttribute){var E=f.data,M=E.stride,I=f.offset;if(E.isInstancedInterleavedBuffer){for(var S=0;S<d.locationSize;S++)v(d.location+S,E.meshPerAttribute);!0!==r.isInstancedMesh&&void 0===s._maxInstanceCount&&(s._maxInstanceCount=E.meshPerAttribute*E.count)}else for(var k=0;k<d.locationSize;k++)A(d.location+k);e.bindBuffer(34962,C);for(var B=0;B<d.locationSize;B++)m(d.location+B,x/d.locationSize,b,y,M*_,(I+x/d.locationSize*B)*_)}else{if(f.isInstancedBufferAttribute){for(var T=0;T<d.locationSize;T++)v(d.location+T,f.meshPerAttribute);!0!==r.isInstancedMesh&&void 0===s._maxInstanceCount&&(s._maxInstanceCount=f.meshPerAttribute*f.count)}else for(var D=0;D<d.locationSize;D++)A(d.location+D);e.bindBuffer(34962,C);for(var R=0;R<d.locationSize;R++)m(d.location+R,x/d.locationSize,b,y,x*_,x/d.locationSize*R*_)}}else if(void 0!==c){var P=c[h];if(void 0!==P)switch(P.length){case 2:e.vertexAttrib2fv(d.location,P);break;case 3:e.vertexAttrib3fv(d.location,P);break;case 4:e.vertexAttrib4fv(d.location,P);break;default:e.vertexAttrib1fv(d.location,P)}}}}g()}(r,l,d,y),null!==x&&e.bindBuffer(34963,n.get(x).buffer))},reset:y,resetDefaultState:x,dispose:function(){for(var e in y(),s){var t=s[e];for(var n in t){var i=t[n];for(var r in i)d(i[r].object),delete i[r];delete t[n]}delete s[e]}},releaseStatesOfGeometry:function(e){if(void 0!==s[e.id]){var t=s[e.id];for(var n in t){var i=t[n];for(var r in i)d(i[r].object),delete i[r];delete t[n]}delete s[e.id]}},releaseStatesOfProgram:function(e){for(var t in s){var n=s[t];if(void 0!==n[e.id]){var i=n[e.id];for(var r in i)d(i[r].object),delete i[r];delete n[e.id]}}},initAttributes:p,enableAttribute:A,disableUnusedAttributes:g}}function ca(e,t,n,i){var r,a=i.isWebGL2;this.setMode=function(e){r=e},this.render=function(t,i){e.drawArrays(r,t,i),n.update(i,r,1)},this.renderInstances=function(i,o,s){if(0!==s){var l,u;if(a)l=e,u="drawArraysInstanced";else if(u="drawArraysInstancedANGLE",null===(l=t.get("ANGLE_instanced_arrays")))return void console.error("THREE.WebGLBufferRenderer: using THREE.InstancedBufferGeometry but hardware does not support extension ANGLE_instanced_arrays.");l[u](r,i,o,s),n.update(o,r,s)}}}function ha(e,t,n){var i;function r(t){if("highp"===t){if(e.getShaderPrecisionFormat(35633,36338).precision>0&&e.getShaderPrecisionFormat(35632,36338).precision>0)return"highp";t="mediump"}return"mediump"===t&&e.getShaderPrecisionFormat(35633,36337).precision>0&&e.getShaderPrecisionFormat(35632,36337).precision>0?"mediump":"lowp"}var a="undefined"!==typeof WebGL2RenderingContext&&e instanceof WebGL2RenderingContext,o=void 0!==n.precision?n.precision:"highp",s=r(o);s!==o&&(console.warn("THREE.WebGLRenderer:",o,"not supported, using",s,"instead."),o=s);var l=a||t.has("WEBGL_draw_buffers"),u=!0===n.logarithmicDepthBuffer,c=e.getParameter(34930),h=e.getParameter(35660),d=e.getParameter(3379),f=e.getParameter(34076),p=e.getParameter(34921),A=e.getParameter(36347),v=e.getParameter(36348),g=e.getParameter(36349),m=h>0,y=a||t.has("OES_texture_float");return{isWebGL2:a,drawBuffers:l,getMaxAnisotropy:function(){if(void 0!==i)return i;if(!0===t.has("EXT_texture_filter_anisotropic")){var n=t.get("EXT_texture_filter_anisotropic");i=e.getParameter(n.MAX_TEXTURE_MAX_ANISOTROPY_EXT)}else i=0;return i},getMaxPrecision:r,precision:o,logarithmicDepthBuffer:u,maxTextures:c,maxVertexTextures:h,maxTextureSize:d,maxCubemapSize:f,maxAttributes:p,maxVertexUniforms:A,maxVaryings:v,maxFragmentUniforms:g,vertexTextures:m,floatFragmentTextures:y,floatVertexTextures:m&&y,maxSamples:a?e.getParameter(36183):0}}function da(e){var t=this,n=null,i=0,r=!1,a=!1,o=new Xr,s=new vn,l={value:null,needsUpdate:!1};function u(e,n,i,r){var a=null!==e?e.length:0,u=null;if(0!==a){if(u=l.value,!0!==r||null===u){var c=i+4*a,h=n.matrixWorldInverse;s.getNormalMatrix(h),(null===u||u.length<c)&&(u=new Float32Array(c));for(var d=0,f=i;d!==a;++d,f+=4)o.copy(e[d]).applyMatrix4(h,s),o.normal.toArray(u,f),u[f+3]=o.constant}l.value=u,l.needsUpdate=!0}return t.numPlanes=a,t.numIntersection=0,u}this.uniform=l,this.numPlanes=0,this.numIntersection=0,this.init=function(e,t){var n=0!==e.length||t||0!==i||r;return r=t,i=e.length,n},this.beginShadows=function(){a=!0,u(null)},this.endShadows=function(){a=!1},this.setGlobalState=function(e,t){n=u(e,t,0)},this.setState=function(o,s,c){var h=o.clippingPlanes,d=o.clipIntersection,f=o.clipShadows,p=e.get(o);if(!r||null===h||0===h.length||a&&!f)a?u(null):function(){l.value!==n&&(l.value=n,l.needsUpdate=i>0);t.numPlanes=i,t.numIntersection=0}();else{var A=a?0:i,v=4*A,g=p.clippingState||null;l.value=g,g=u(h,s,v,c);for(var m=0;m!==v;++m)g[m]=n[m];p.clippingState=g,this.numIntersection=d?this.numPlanes:0,this.numPlanes+=A}}}function fa(e){var t=new WeakMap;function n(e,t){return t===ge?e.mapping=Ae:t===me&&(e.mapping=ve),e}function i(e){var n=e.target;n.removeEventListener("dispose",i);var r=t.get(n);void 0!==r&&(t.delete(n),r.dispose())}return{get:function(r){if(r&&r.isTexture&&!1===r.isRenderTargetTexture){var a=r.mapping;if(a===ge||a===me){if(t.has(r))return n(t.get(r).texture,r.mapping);var o=r.image;if(o&&o.height>0){var s=new Wr(o.height/2);return s.fromEquirectangularTexture(e,r),t.set(r,s),r.addEventListener("dispose",i),n(s.texture,r.mapping)}return null}}return r},dispose:function(){t=new WeakMap}}}var pa=function(e){(0,d.Z)(n,e);var t=(0,f.Z)(n);function n(){var e,i=arguments.length>0&&void 0!==arguments[0]?arguments[0]:-1,r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1,a=arguments.length>2&&void 0!==arguments[2]?arguments[2]:1,o=arguments.length>3&&void 0!==arguments[3]?arguments[3]:-1,s=arguments.length>4&&void 0!==arguments[4]?arguments[4]:.1,l=arguments.length>5&&void 0!==arguments[5]?arguments[5]:2e3;return(0,v.Z)(this,n),(e=t.call(this)).isOrthographicCamera=!0,e.type="OrthographicCamera",e.zoom=1,e.view=null,e.left=i,e.right=r,e.top=a,e.bottom=o,e.near=s,e.far=l,e.updateProjectionMatrix(),e}return(0,g.Z)(n,[{key:"copy",value:function(e,t){return(0,u.Z)((0,c.Z)(n.prototype),"copy",this).call(this,e,t),this.left=e.left,this.right=e.right,this.top=e.top,this.bottom=e.bottom,this.near=e.near,this.far=e.far,this.zoom=e.zoom,this.view=null===e.view?null:Object.assign({},e.view),this}},{key:"setViewOffset",value:function(e,t,n,i,r,a){null===this.view&&(this.view={enabled:!0,fullWidth:1,fullHeight:1,offsetX:0,offsetY:0,width:1,height:1}),this.view.enabled=!0,this.view.fullWidth=e,this.view.fullHeight=t,this.view.offsetX=n,this.view.offsetY=i,this.view.width=r,this.view.height=a,this.updateProjectionMatrix()}},{key:"clearViewOffset",value:function(){null!==this.view&&(this.view.enabled=!1),this.updateProjectionMatrix()}},{key:"updateProjectionMatrix",value:function(){var e=(this.right-this.left)/(2*this.zoom),t=(this.top-this.bottom)/(2*this.zoom),n=(this.right+this.left)/2,i=(this.top+this.bottom)/2,r=n-e,a=n+e,o=i+t,s=i-t;if(null!==this.view&&this.view.enabled){var l=(this.right-this.left)/this.view.fullWidth/this.zoom,u=(this.top-this.bottom)/this.view.fullHeight/this.zoom;a=(r+=l*this.view.offsetX)+l*this.view.width,s=(o-=u*this.view.offsetY)-u*this.view.height}this.projectionMatrix.makeOrthographic(r,a,o,s,this.near,this.far),this.projectionMatrixInverse.copy(this.projectionMatrix).invert()}},{key:"toJSON",value:function(e){var t=(0,u.Z)((0,c.Z)(n.prototype),"toJSON",this).call(this,e);return t.object.zoom=this.zoom,t.object.left=this.left,t.object.right=this.right,t.object.top=this.top,t.object.bottom=this.bottom,t.object.near=this.near,t.object.far=this.far,null!==this.view&&(t.object.view=Object.assign({},this.view)),t}}]),n}(Or),Aa=[.125,.215,.35,.446,.526,.582],va=20,ga=new pa,ma=new Rn,ya=null,xa=(1+Math.sqrt(5))/2,wa=1/xa,Ca=[new Gn(1,1,1),new Gn(-1,1,1),new Gn(1,1,-1),new Gn(-1,1,-1),new Gn(0,xa,wa),new Gn(0,xa,-wa),new Gn(wa,0,xa),new Gn(-wa,0,xa),new Gn(xa,wa,0),new Gn(-xa,wa,0)],ba=function(){function e(t){(0,v.Z)(this,e),this._renderer=t,this._pingPongRenderTarget=null,this._lodMax=0,this._cubeSize=0,this._lodPlanes=[],this._sizeLods=[],this._sigmas=[],this._blurMaterial=null,this._cubemapMaterial=null,this._equirectMaterial=null,this._compileMaterial(this._blurMaterial)}return(0,g.Z)(e,[{key:"fromScene",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:.1,i=arguments.length>3&&void 0!==arguments[3]?arguments[3]:100;ya=this._renderer.getRenderTarget(),this._setSize(256);var r=this._allocateTargets();return r.depthBuffer=!0,this._sceneToCubeUV(e,n,i,r),t>0&&this._blur(r,0,0,t),this._applyPMREM(r),this._cleanup(r),r}},{key:"fromEquirectangular",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;return this._fromTexture(e,t)}},{key:"fromCubemap",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;return this._fromTexture(e,t)}},{key:"compileCubemapShader",value:function(){null===this._cubemapMaterial&&(this._cubemapMaterial=Ia(),this._compileMaterial(this._cubemapMaterial))}},{key:"compileEquirectangularShader",value:function(){null===this._equirectMaterial&&(this._equirectMaterial=Ma(),this._compileMaterial(this._equirectMaterial))}},{key:"dispose",value:function(){this._dispose(),null!==this._cubemapMaterial&&this._cubemapMaterial.dispose(),null!==this._equirectMaterial&&this._equirectMaterial.dispose()}},{key:"_setSize",value:function(e){this._lodMax=Math.floor(Math.log2(e)),this._cubeSize=Math.pow(2,this._lodMax)}},{key:"_dispose",value:function(){null!==this._blurMaterial&&this._blurMaterial.dispose(),null!==this._pingPongRenderTarget&&this._pingPongRenderTarget.dispose();for(var e=0;e<this._lodPlanes.length;e++)this._lodPlanes[e].dispose()}},{key:"_cleanup",value:function(e){this._renderer.setRenderTarget(ya),e.scissorTest=!1,Ea(e,0,0,e.width,e.height)}},{key:"_fromTexture",value:function(e,t){e.mapping===Ae||e.mapping===ve?this._setSize(0===e.image.length?16:e.image[0].width||e.image[0].image.width):this._setSize(e.image.width/4),ya=this._renderer.getRenderTarget();var n=t||this._allocateTargets();return this._textureToCubeUV(e,n),this._applyPMREM(n),this._cleanup(n),n}},{key:"_allocateTargets",value:function(){var e=3*Math.max(this._cubeSize,112),t=4*this._cubeSize,n={magFilter:Me,minFilter:Me,generateMipmaps:!1,type:Qe,format:je,encoding:Nt,depthBuffer:!1},i=_a(e,t,n);if(null===this._pingPongRenderTarget||this._pingPongRenderTarget.width!==e||this._pingPongRenderTarget.height!==t){null!==this._pingPongRenderTarget&&this._dispose(),this._pingPongRenderTarget=_a(e,t,n);var r=this._lodMax,a=function(e){for(var t=[],n=[],i=[],r=e,a=e-4+1+Aa.length,o=0;o<a;o++){var s=Math.pow(2,r);n.push(s);var l=1/s;o>e-4?l=Aa[o-e+4-1]:0===o&&(l=0),i.push(l);for(var u=1/(s-2),c=-u,h=1+u,d=[c,c,h,c,h,h,c,c,h,h,c,h],f=6,p=6,A=3,v=2,g=1,m=new Float32Array(A*p*f),y=new Float32Array(v*p*f),x=new Float32Array(g*p*f),w=0;w<f;w++){var C=w%3*2/3-1,b=w>2?0:-1,_=[C,b,0,C+2/3,b,0,C+2/3,b+1,0,C,b,0,C+2/3,b+1,0,C,b+1,0];m.set(_,A*p*w),y.set(d,v*p*w);var E=[w,w,w,w,w,w];x.set(E,g*p*w)}var M=new xr;M.setAttribute("position",new lr(m,A)),M.setAttribute("uv",new lr(y,v)),M.setAttribute("faceIndex",new lr(x,g)),t.push(M),r>4&&r--}return{lodPlanes:t,sizeLods:n,sigmas:i}}(r);this._sizeLods=a.sizeLods,this._lodPlanes=a.lodPlanes,this._sigmas=a.sigmas,this._blurMaterial=function(e,t,n){var i=new Float32Array(va),r=new Gn(0,1,0),a=new jr({name:"SphericalGaussianBlur",defines:{n:va,CUBEUV_TEXEL_WIDTH:1/t,CUBEUV_TEXEL_HEIGHT:1/n,CUBEUV_MAX_MIP:"".concat(e,".0")},uniforms:{envMap:{value:null},samples:{value:1},weights:{value:i},latitudinal:{value:!1},dTheta:{value:0},mipInt:{value:0},poleAxis:{value:r}},vertexShader:"\n\n\t\tprecision mediump float;\n\t\tprecision mediump int;\n\n\t\tattribute float faceIndex;\n\n\t\tvarying vec3 vOutputDirection;\n\n\t\t// RH coordinate system; PMREM face-indexing convention\n\t\tvec3 getDirection( vec2 uv, float face ) {\n\n\t\t\tuv = 2.0 * uv - 1.0;\n\n\t\t\tvec3 direction = vec3( uv, 1.0 );\n\n\t\t\tif ( face == 0.0 ) {\n\n\t\t\t\tdirection = direction.zyx; // ( 1, v, u ) pos x\n\n\t\t\t} else if ( face == 1.0 ) {\n\n\t\t\t\tdirection = direction.xzy;\n\t\t\t\tdirection.xz *= -1.0; // ( -u, 1, -v ) pos y\n\n\t\t\t} else if ( face == 2.0 ) {\n\n\t\t\t\tdirection.x *= -1.0; // ( -u, v, 1 ) pos z\n\n\t\t\t} else if ( face == 3.0 ) {\n\n\t\t\t\tdirection = direction.zyx;\n\t\t\t\tdirection.xz *= -1.0; // ( -1, v, -u ) neg x\n\n\t\t\t} else if ( face == 4.0 ) {\n\n\t\t\t\tdirection = direction.xzy;\n\t\t\t\tdirection.xy *= -1.0; // ( -u, -1, v ) neg y\n\n\t\t\t} else if ( face == 5.0 ) {\n\n\t\t\t\tdirection.z *= -1.0; // ( u, v, -1 ) neg z\n\n\t\t\t}\n\n\t\t\treturn direction;\n\n\t\t}\n\n\t\tvoid main() {\n\n\t\t\tvOutputDirection = getDirection( uv, faceIndex );\n\t\t\tgl_Position = vec4( position, 1.0 );\n\n\t\t}\n\t",fragmentShader:"\n\n\t\t\tprecision mediump float;\n\t\t\tprecision mediump int;\n\n\t\t\tvarying vec3 vOutputDirection;\n\n\t\t\tuniform sampler2D envMap;\n\t\t\tuniform int samples;\n\t\t\tuniform float weights[ n ];\n\t\t\tuniform bool latitudinal;\n\t\t\tuniform float dTheta;\n\t\t\tuniform float mipInt;\n\t\t\tuniform vec3 poleAxis;\n\n\t\t\t#define ENVMAP_TYPE_CUBE_UV\n\t\t\t#include <cube_uv_reflection_fragment>\n\n\t\t\tvec3 getSample( float theta, vec3 axis ) {\n\n\t\t\t\tfloat cosTheta = cos( theta );\n\t\t\t\t// Rodrigues' axis-angle rotation\n\t\t\t\tvec3 sampleDirection = vOutputDirection * cosTheta\n\t\t\t\t\t+ cross( axis, vOutputDirection ) * sin( theta )\n\t\t\t\t\t+ axis * dot( axis, vOutputDirection ) * ( 1.0 - cosTheta );\n\n\t\t\t\treturn bilinearCubeUV( envMap, sampleDirection, mipInt );\n\n\t\t\t}\n\n\t\t\tvoid main() {\n\n\t\t\t\tvec3 axis = latitudinal ? poleAxis : cross( poleAxis, vOutputDirection );\n\n\t\t\t\tif ( all( equal( axis, vec3( 0.0 ) ) ) ) {\n\n\t\t\t\t\taxis = vec3( vOutputDirection.z, 0.0, - vOutputDirection.x );\n\n\t\t\t\t}\n\n\t\t\t\taxis = normalize( axis );\n\n\t\t\t\tgl_FragColor = vec4( 0.0, 0.0, 0.0, 1.0 );\n\t\t\t\tgl_FragColor.rgb += weights[ 0 ] * getSample( 0.0, axis );\n\n\t\t\t\tfor ( int i = 1; i < n; i++ ) {\n\n\t\t\t\t\tif ( i >= samples ) {\n\n\t\t\t\t\t\tbreak;\n\n\t\t\t\t\t}\n\n\t\t\t\t\tfloat theta = dTheta * float( i );\n\t\t\t\t\tgl_FragColor.rgb += weights[ i ] * getSample( -1.0 * theta, axis );\n\t\t\t\t\tgl_FragColor.rgb += weights[ i ] * getSample( theta, axis );\n\n\t\t\t\t}\n\n\t\t\t}\n\t\t",blending:B,depthTest:!1,depthWrite:!1});return a}(r,e,t)}return i}},{key:"_compileMaterial",value:function(e){var t=new Pr(this._lodPlanes[0],e);this._renderer.compile(t,ga)}},{key:"_sceneToCubeUV",value:function(e,t,n,i){var r=new zr(90,1,t,n),a=[1,-1,1,1,1,1],o=[1,1,1,-1,-1,-1],s=this._renderer,l=s.autoClear,u=s.toneMapping;s.getClearColor(ma),s.toneMapping=ue,s.autoClear=!1;var c=new ar({name:"PMREM.Background",side:S,depthWrite:!1,depthTest:!1}),h=new Pr(new Qr,c),d=!1,f=e.background;f?f.isColor&&(c.color.copy(f),e.background=null,d=!0):(c.color.copy(ma),d=!0);for(var p=0;p<6;p++){var A=p%3;0===A?(r.up.set(0,a[p],0),r.lookAt(o[p],0,0)):1===A?(r.up.set(0,0,a[p]),r.lookAt(0,o[p],0)):(r.up.set(0,a[p],0),r.lookAt(0,0,o[p]));var v=this._cubeSize;Ea(i,A*v,p>2?v:0,v,v),s.setRenderTarget(i),d&&s.render(h,r),s.render(e,r)}h.geometry.dispose(),h.material.dispose(),s.toneMapping=u,s.autoClear=l,e.background=f}},{key:"_textureToCubeUV",value:function(e,t){var n=this._renderer,i=e.mapping===Ae||e.mapping===ve;i?(null===this._cubemapMaterial&&(this._cubemapMaterial=Ia()),this._cubemapMaterial.uniforms.flipEnvMap.value=!1===e.isRenderTargetTexture?-1:1):null===this._equirectMaterial&&(this._equirectMaterial=Ma());var r=i?this._cubemapMaterial:this._equirectMaterial,a=new Pr(this._lodPlanes[0],r);r.uniforms.envMap.value=e;var o=this._cubeSize;Ea(t,0,0,3*o,2*o),n.setRenderTarget(t),n.render(a,ga)}},{key:"_applyPMREM",value:function(e){var t=this._renderer,n=t.autoClear;t.autoClear=!1;for(var i=1;i<this._lodPlanes.length;i++){var r=Math.sqrt(this._sigmas[i]*this._sigmas[i]-this._sigmas[i-1]*this._sigmas[i-1]),a=Ca[(i-1)%Ca.length];this._blur(e,i-1,i,r,a)}t.autoClear=n}},{key:"_blur",value:function(e,t,n,i,r){var a=this._pingPongRenderTarget;this._halfBlur(e,a,t,n,i,"latitudinal",r),this._halfBlur(a,e,n,n,i,"longitudinal",r)}},{key:"_halfBlur",value:function(e,t,n,i,r,a,o){var s=this._renderer,l=this._blurMaterial;"latitudinal"!==a&&"longitudinal"!==a&&console.error("blur direction must be either latitudinal or longitudinal!");var u=new Pr(this._lodPlanes[i],l),c=l.uniforms,h=this._sizeLods[n]-1,d=isFinite(r)?Math.PI/(2*h):2*Math.PI/39,f=r/d,p=isFinite(r)?1+Math.floor(3*f):va;p>va&&console.warn("sigmaRadians, ".concat(r,", is too large and will clip, as it requested ").concat(p," samples when the maximum is set to ").concat(va));for(var A=[],v=0,g=0;g<va;++g){var m=g/f,y=Math.exp(-m*m/2);A.push(y),0===g?v+=y:g<p&&(v+=2*y)}for(var x=0;x<A.length;x++)A[x]=A[x]/v;c.envMap.value=e.texture,c.samples.value=p,c.weights.value=A,c.latitudinal.value="latitudinal"===a,o&&(c.poleAxis.value=o);var w=this._lodMax;c.dTheta.value=d,c.mipInt.value=w-n;var C=this._sizeLods[i];Ea(t,3*C*(i>w-4?i-w+4:0),4*(this._cubeSize-C),3*C,2*C),s.setRenderTarget(t),s.render(u,ga)}}]),e}();function _a(e,t,n){var i=new Un(e,t,n);return i.texture.mapping=ye,i.texture.name="PMREM.cubeUv",i.scissorTest=!0,i}function Ea(e,t,n,i,r){e.viewport.set(t,n,i,r),e.scissor.set(t,n,i,r)}function Ma(){return new jr({name:"EquirectangularToCubeUV",uniforms:{envMap:{value:null}},vertexShader:"\n\n\t\tprecision mediump float;\n\t\tprecision mediump int;\n\n\t\tattribute float faceIndex;\n\n\t\tvarying vec3 vOutputDirection;\n\n\t\t// RH coordinate system; PMREM face-indexing convention\n\t\tvec3 getDirection( vec2 uv, float face ) {\n\n\t\t\tuv = 2.0 * uv - 1.0;\n\n\t\t\tvec3 direction = vec3( uv, 1.0 );\n\n\t\t\tif ( face == 0.0 ) {\n\n\t\t\t\tdirection = direction.zyx; // ( 1, v, u ) pos x\n\n\t\t\t} else if ( face == 1.0 ) {\n\n\t\t\t\tdirection = direction.xzy;\n\t\t\t\tdirection.xz *= -1.0; // ( -u, 1, -v ) pos y\n\n\t\t\t} else if ( face == 2.0 ) {\n\n\t\t\t\tdirection.x *= -1.0; // ( -u, v, 1 ) pos z\n\n\t\t\t} else if ( face == 3.0 ) {\n\n\t\t\t\tdirection = direction.zyx;\n\t\t\t\tdirection.xz *= -1.0; // ( -1, v, -u ) neg x\n\n\t\t\t} else if ( face == 4.0 ) {\n\n\t\t\t\tdirection = direction.xzy;\n\t\t\t\tdirection.xy *= -1.0; // ( -u, -1, v ) neg y\n\n\t\t\t} else if ( face == 5.0 ) {\n\n\t\t\t\tdirection.z *= -1.0; // ( u, v, -1 ) neg z\n\n\t\t\t}\n\n\t\t\treturn direction;\n\n\t\t}\n\n\t\tvoid main() {\n\n\t\t\tvOutputDirection = getDirection( uv, faceIndex );\n\t\t\tgl_Position = vec4( position, 1.0 );\n\n\t\t}\n\t",fragmentShader:"\n\n\t\t\tprecision mediump float;\n\t\t\tprecision mediump int;\n\n\t\t\tvarying vec3 vOutputDirection;\n\n\t\t\tuniform sampler2D envMap;\n\n\t\t\t#include <common>\n\n\t\t\tvoid main() {\n\n\t\t\t\tvec3 outputDirection = normalize( vOutputDirection );\n\t\t\t\tvec2 uv = equirectUv( outputDirection );\n\n\t\t\t\tgl_FragColor = vec4( texture2D ( envMap, uv ).rgb, 1.0 );\n\n\t\t\t}\n\t\t",blending:B,depthTest:!1,depthWrite:!1})}function Ia(){return new jr({name:"CubemapToCubeUV",uniforms:{envMap:{value:null},flipEnvMap:{value:-1}},vertexShader:"\n\n\t\tprecision mediump float;\n\t\tprecision mediump int;\n\n\t\tattribute float faceIndex;\n\n\t\tvarying vec3 vOutputDirection;\n\n\t\t// RH coordinate system; PMREM face-indexing convention\n\t\tvec3 getDirection( vec2 uv, float face ) {\n\n\t\t\tuv = 2.0 * uv - 1.0;\n\n\t\t\tvec3 direction = vec3( uv, 1.0 );\n\n\t\t\tif ( face == 0.0 ) {\n\n\t\t\t\tdirection = direction.zyx; // ( 1, v, u ) pos x\n\n\t\t\t} else if ( face == 1.0 ) {\n\n\t\t\t\tdirection = direction.xzy;\n\t\t\t\tdirection.xz *= -1.0; // ( -u, 1, -v ) pos y\n\n\t\t\t} else if ( face == 2.0 ) {\n\n\t\t\t\tdirection.x *= -1.0; // ( -u, v, 1 ) pos z\n\n\t\t\t} else if ( face == 3.0 ) {\n\n\t\t\t\tdirection = direction.zyx;\n\t\t\t\tdirection.xz *= -1.0; // ( -1, v, -u ) neg x\n\n\t\t\t} else if ( face == 4.0 ) {\n\n\t\t\t\tdirection = direction.xzy;\n\t\t\t\tdirection.xy *= -1.0; // ( -u, -1, v ) neg y\n\n\t\t\t} else if ( face == 5.0 ) {\n\n\t\t\t\tdirection.z *= -1.0; // ( u, v, -1 ) neg z\n\n\t\t\t}\n\n\t\t\treturn direction;\n\n\t\t}\n\n\t\tvoid main() {\n\n\t\t\tvOutputDirection = getDirection( uv, faceIndex );\n\t\t\tgl_Position = vec4( position, 1.0 );\n\n\t\t}\n\t",fragmentShader:"\n\n\t\t\tprecision mediump float;\n\t\t\tprecision mediump int;\n\n\t\t\tuniform float flipEnvMap;\n\n\t\t\tvarying vec3 vOutputDirection;\n\n\t\t\tuniform samplerCube envMap;\n\n\t\t\tvoid main() {\n\n\t\t\t\tgl_FragColor = textureCube( envMap, vec3( flipEnvMap * vOutputDirection.x, vOutputDirection.yz ) );\n\n\t\t\t}\n\t\t",blending:B,depthTest:!1,depthWrite:!1})}function Sa(e){var t=new WeakMap,n=null;function i(e){var n=e.target;n.removeEventListener("dispose",i);var r=t.get(n);void 0!==r&&(t.delete(n),r.dispose())}return{get:function(r){if(r&&r.isTexture){var a=r.mapping,o=a===ge||a===me,s=a===Ae||a===ve;if(o||s){if(r.isRenderTargetTexture&&!0===r.needsPMREMUpdate){r.needsPMREMUpdate=!1;var l=t.get(r);return null===n&&(n=new ba(e)),l=o?n.fromEquirectangular(r,l):n.fromCubemap(r,l),t.set(r,l),l.texture}if(t.has(r))return t.get(r).texture;var u=r.image;if(o&&u&&u.height>0||s&&u&&function(e){for(var t=0,n=6,i=0;i<n;i++)void 0!==e[i]&&t++;return t===n}(u)){null===n&&(n=new ba(e));var c=o?n.fromEquirectangular(r):n.fromCubemap(r);return t.set(r,c),r.addEventListener("dispose",i),c.texture}return null}}return r},dispose:function(){t=new WeakMap,null!==n&&(n.dispose(),n=null)}}}function ka(e){var t={};function n(n){if(void 0!==t[n])return t[n];var i;switch(n){case"WEBGL_depth_texture":i=e.getExtension("WEBGL_depth_texture")||e.getExtension("MOZ_WEBGL_depth_texture")||e.getExtension("WEBKIT_WEBGL_depth_texture");break;case"EXT_texture_filter_anisotropic":i=e.getExtension("EXT_texture_filter_anisotropic")||e.getExtension("MOZ_EXT_texture_filter_anisotropic")||e.getExtension("WEBKIT_EXT_texture_filter_anisotropic");break;case"WEBGL_compressed_texture_s3tc":i=e.getExtension("WEBGL_compressed_texture_s3tc")||e.getExtension("MOZ_WEBGL_compressed_texture_s3tc")||e.getExtension("WEBKIT_WEBGL_compressed_texture_s3tc");break;case"WEBGL_compressed_texture_pvrtc":i=e.getExtension("WEBGL_compressed_texture_pvrtc")||e.getExtension("WEBKIT_WEBGL_compressed_texture_pvrtc");break;default:i=e.getExtension(n)}return t[n]=i,i}return{has:function(e){return null!==n(e)},init:function(e){e.isWebGL2?n("EXT_color_buffer_float"):(n("WEBGL_depth_texture"),n("OES_texture_float"),n("OES_texture_half_float"),n("OES_texture_half_float_linear"),n("OES_standard_derivatives"),n("OES_element_index_uint"),n("OES_vertex_array_object"),n("ANGLE_instanced_arrays")),n("OES_texture_float_linear"),n("EXT_color_buffer_half_float"),n("WEBGL_multisampled_render_to_texture")},get:function(e){var t=n(e);return null===t&&console.warn("THREE.WebGLRenderer: "+e+" extension not supported."),t}}}function Ba(e,t,n,i){var r={},a=new WeakMap;function o(e){var s=e.target;for(var l in null!==s.index&&t.remove(s.index),s.attributes)t.remove(s.attributes[l]);s.removeEventListener("dispose",o),delete r[s.id];var u=a.get(s);u&&(t.remove(u),a.delete(s)),i.releaseStatesOfGeometry(s),!0===s.isInstancedBufferGeometry&&delete s._maxInstanceCount,n.memory.geometries--}function s(e){var n=[],i=e.index,r=e.attributes.position,o=0;if(null!==i){var s=i.array;o=i.version;for(var l=0,u=s.length;l<u;l+=3){var c=s[l+0],h=s[l+1],d=s[l+2];n.push(c,h,h,d,d,c)}}else{var f=r.array;o=r.version;for(var p=0,A=f.length/3-1;p<A;p+=3){var v=p+0,g=p+1,m=p+2;n.push(v,g,g,m,m,v)}}var y=new(mn(n)?hr:ur)(n,1);y.version=o;var x=a.get(e);x&&t.remove(x),a.set(e,y)}return{get:function(e,t){return!0===r[t.id]||(t.addEventListener("dispose",o),r[t.id]=!0,n.memory.geometries++),t},update:function(e){var n=e.attributes;for(var i in n)t.update(n[i],34962);var r=e.morphAttributes;for(var a in r)for(var o=r[a],s=0,l=o.length;s<l;s++)t.update(o[s],34962)},getWireframeAttribute:function(e){var t=a.get(e);if(t){var n=e.index;null!==n&&t.version<n.version&&s(e)}else s(e);return a.get(e)}}}function Ta(e,t,n,i){var r,a,o,s=i.isWebGL2;this.setMode=function(e){r=e},this.setIndex=function(e){a=e.type,o=e.bytesPerElement},this.render=function(t,i){e.drawElements(r,i,a,t*o),n.update(i,r,1)},this.renderInstances=function(i,l,u){if(0!==u){var c,h;if(s)c=e,h="drawElementsInstanced";else if(h="drawElementsInstancedANGLE",null===(c=t.get("ANGLE_instanced_arrays")))return void console.error("THREE.WebGLIndexedBufferRenderer: using THREE.InstancedBufferGeometry but hardware does not support extension ANGLE_instanced_arrays.");c[h](r,l,a,i*o,u),n.update(l,r,u)}}}function Da(e){var t={frame:0,calls:0,triangles:0,points:0,lines:0};return{memory:{geometries:0,textures:0},render:t,programs:null,autoReset:!0,reset:function(){t.frame++,t.calls=0,t.triangles=0,t.points=0,t.lines=0},update:function(e,n,i){switch(t.calls++,n){case 4:t.triangles+=i*(e/3);break;case 1:t.lines+=i*(e/2);break;case 3:t.lines+=i*(e-1);break;case 2:t.lines+=i*e;break;case 0:t.points+=i*e;break;default:console.error("THREE.WebGLInfo: Unknown draw mode:",n)}}}}function Ra(e,t){return e[0]-t[0]}function Pa(e,t){return Math.abs(t[1])-Math.abs(e[1])}function La(e,t,n){for(var i={},r=new Float32Array(8),a=new WeakMap,o=new Fn,s=[],l=0;l<8;l++)s[l]=[l,0];return{update:function(l,u,c,h){var d=l.morphTargetInfluences;if(!0===t.isWebGL2){var f=u.morphAttributes.position||u.morphAttributes.normal||u.morphAttributes.color,p=void 0!==f?f.length:0,A=a.get(u);if(void 0===A||A.count!==p){void 0!==A&&A.texture.dispose();var v=void 0!==u.morphAttributes.position,g=void 0!==u.morphAttributes.normal,m=void 0!==u.morphAttributes.color,y=u.morphAttributes.position||[],x=u.morphAttributes.normal||[],w=u.morphAttributes.color||[],C=0;!0===v&&(C=1),!0===g&&(C=2),!0===m&&(C=3);var b=u.attributes.position.count*C,_=1;b>t.maxTextureSize&&(_=Math.ceil(b/t.maxTextureSize),b=t.maxTextureSize);var E=new Float32Array(b*_*4*p),M=new jn(E,b,_,p);M.type=Le,M.needsUpdate=!0;for(var I=4*C,S=0;S<p;S++)for(var k=y[S],B=x[S],T=w[S],D=b*_*4*S,R=0;R<k.count;R++){var P=R*I;!0===v&&(o.fromBufferAttribute(k,R),E[D+P+0]=o.x,E[D+P+1]=o.y,E[D+P+2]=o.z,E[D+P+3]=0),!0===g&&(o.fromBufferAttribute(B,R),E[D+P+4]=o.x,E[D+P+5]=o.y,E[D+P+6]=o.z,E[D+P+7]=0),!0===m&&(o.fromBufferAttribute(T,R),E[D+P+8]=o.x,E[D+P+9]=o.y,E[D+P+10]=o.z,E[D+P+11]=4===T.itemSize?o.w:1)}A={count:p,texture:M,size:new An(b,_)},a.set(u,A);u.addEventListener("dispose",(function e(){M.dispose(),a.delete(u),u.removeEventListener("dispose",e)}))}for(var L=0,Q=0;Q<d.length;Q++)L+=d[Q];var Z=u.morphTargetsRelative?1:1-L;h.getUniforms().setValue(e,"morphTargetBaseInfluence",Z),h.getUniforms().setValue(e,"morphTargetInfluences",d),h.getUniforms().setValue(e,"morphTargetsTexture",A.texture,n),h.getUniforms().setValue(e,"morphTargetsTextureSize",A.size)}else{var N=void 0===d?0:d.length,F=i[u.id];if(void 0===F||F.length!==N){F=[];for(var U=0;U<N;U++)F[U]=[U,0];i[u.id]=F}for(var j=0;j<N;j++){var O=F[j];O[0]=j,O[1]=d[j]}F.sort(Pa);for(var z=0;z<8;z++)z<N&&F[z][1]?(s[z][0]=F[z][0],s[z][1]=F[z][1]):(s[z][0]=Number.MAX_SAFE_INTEGER,s[z][1]=0);s.sort(Ra);for(var G=u.morphAttributes.position,H=u.morphAttributes.normal,V=0,W=0;W<8;W++){var q=s[W],Y=q[0],J=q[1];Y!==Number.MAX_SAFE_INTEGER&&J?(G&&u.getAttribute("morphTarget"+W)!==G[Y]&&u.setAttribute("morphTarget"+W,G[Y]),H&&u.getAttribute("morphNormal"+W)!==H[Y]&&u.setAttribute("morphNormal"+W,H[Y]),r[W]=J,V+=J):(G&&!0===u.hasAttribute("morphTarget"+W)&&u.deleteAttribute("morphTarget"+W),H&&!0===u.hasAttribute("morphNormal"+W)&&u.deleteAttribute("morphNormal"+W),r[W]=0)}var X=u.morphTargetsRelative?1:1-V;h.getUniforms().setValue(e,"morphTargetBaseInfluence",X),h.getUniforms().setValue(e,"morphTargetInfluences",r)}}}}function Qa(e,t,n,i){var r=new WeakMap;function a(e){var t=e.target;t.removeEventListener("dispose",a),n.remove(t.instanceMatrix),null!==t.instanceColor&&n.remove(t.instanceColor)}return{update:function(e){var o=i.render.frame,s=e.geometry,l=t.get(e,s);return r.get(l)!==o&&(t.update(l),r.set(l,o)),e.isInstancedMesh&&(!1===e.hasEventListener("dispose",a)&&e.addEventListener("dispose",a),n.update(e.instanceMatrix,34962),null!==e.instanceColor&&n.update(e.instanceColor,34962)),l},dispose:function(){r=new WeakMap}}}var Za=new Nn,Na=new jn,Fa=new On,Ua=new Vr,ja=[],Oa=[],za=new Float32Array(16),Ga=new Float32Array(9),Ha=new Float32Array(4);function Va(e,t,n){var i=e[0];if(i<=0||i>0)return e;var r=t*n,a=ja[r];if(void 0===a&&(a=new Float32Array(r),ja[r]=a),0!==t){i.toArray(a,0);for(var o=1,s=0;o!==t;++o)s+=n,e[o].toArray(a,s)}return a}function Wa(e,t){if(e.length!==t.length)return!1;for(var n=0,i=e.length;n<i;n++)if(e[n]!==t[n])return!1;return!0}function qa(e,t){for(var n=0,i=t.length;n<i;n++)e[n]=t[n]}function Ya(e,t){var n=Oa[t];void 0===n&&(n=new Int32Array(t),Oa[t]=n);for(var i=0;i!==t;++i)n[i]=e.allocateTextureUnit();return n}function Ja(e,t){var n=this.cache;n[0]!==t&&(e.uniform1f(this.addr,t),n[0]=t)}function Xa(e,t){var n=this.cache;if(void 0!==t.x)n[0]===t.x&&n[1]===t.y||(e.uniform2f(this.addr,t.x,t.y),n[0]=t.x,n[1]=t.y);else{if(Wa(n,t))return;e.uniform2fv(this.addr,t),qa(n,t)}}function Ka(e,t){var n=this.cache;if(void 0!==t.x)n[0]===t.x&&n[1]===t.y&&n[2]===t.z||(e.uniform3f(this.addr,t.x,t.y,t.z),n[0]=t.x,n[1]=t.y,n[2]=t.z);else if(void 0!==t.r)n[0]===t.r&&n[1]===t.g&&n[2]===t.b||(e.uniform3f(this.addr,t.r,t.g,t.b),n[0]=t.r,n[1]=t.g,n[2]=t.b);else{if(Wa(n,t))return;e.uniform3fv(this.addr,t),qa(n,t)}}function $a(e,t){var n=this.cache;if(void 0!==t.x)n[0]===t.x&&n[1]===t.y&&n[2]===t.z&&n[3]===t.w||(e.uniform4f(this.addr,t.x,t.y,t.z,t.w),n[0]=t.x,n[1]=t.y,n[2]=t.z,n[3]=t.w);else{if(Wa(n,t))return;e.uniform4fv(this.addr,t),qa(n,t)}}function eo(e,t){var n=this.cache,i=t.elements;if(void 0===i){if(Wa(n,t))return;e.uniformMatrix2fv(this.addr,!1,t),qa(n,t)}else{if(Wa(n,i))return;Ha.set(i),e.uniformMatrix2fv(this.addr,!1,Ha),qa(n,i)}}function to(e,t){var n=this.cache,i=t.elements;if(void 0===i){if(Wa(n,t))return;e.uniformMatrix3fv(this.addr,!1,t),qa(n,t)}else{if(Wa(n,i))return;Ga.set(i),e.uniformMatrix3fv(this.addr,!1,Ga),qa(n,i)}}function no(e,t){var n=this.cache,i=t.elements;if(void 0===i){if(Wa(n,t))return;e.uniformMatrix4fv(this.addr,!1,t),qa(n,t)}else{if(Wa(n,i))return;za.set(i),e.uniformMatrix4fv(this.addr,!1,za),qa(n,i)}}function io(e,t){var n=this.cache;n[0]!==t&&(e.uniform1i(this.addr,t),n[0]=t)}function ro(e,t){var n=this.cache;if(void 0!==t.x)n[0]===t.x&&n[1]===t.y||(e.uniform2i(this.addr,t.x,t.y),n[0]=t.x,n[1]=t.y);else{if(Wa(n,t))return;e.uniform2iv(this.addr,t),qa(n,t)}}function ao(e,t){var n=this.cache;if(void 0!==t.x)n[0]===t.x&&n[1]===t.y&&n[2]===t.z||(e.uniform3i(this.addr,t.x,t.y,t.z),n[0]=t.x,n[1]=t.y,n[2]=t.z);else{if(Wa(n,t))return;e.uniform3iv(this.addr,t),qa(n,t)}}function oo(e,t){var n=this.cache;if(void 0!==t.x)n[0]===t.x&&n[1]===t.y&&n[2]===t.z&&n[3]===t.w||(e.uniform4i(this.addr,t.x,t.y,t.z,t.w),n[0]=t.x,n[1]=t.y,n[2]=t.z,n[3]=t.w);else{if(Wa(n,t))return;e.uniform4iv(this.addr,t),qa(n,t)}}function so(e,t){var n=this.cache;n[0]!==t&&(e.uniform1ui(this.addr,t),n[0]=t)}function lo(e,t){var n=this.cache;if(void 0!==t.x)n[0]===t.x&&n[1]===t.y||(e.uniform2ui(this.addr,t.x,t.y),n[0]=t.x,n[1]=t.y);else{if(Wa(n,t))return;e.uniform2uiv(this.addr,t),qa(n,t)}}function uo(e,t){var n=this.cache;if(void 0!==t.x)n[0]===t.x&&n[1]===t.y&&n[2]===t.z||(e.uniform3ui(this.addr,t.x,t.y,t.z),n[0]=t.x,n[1]=t.y,n[2]=t.z);else{if(Wa(n,t))return;e.uniform3uiv(this.addr,t),qa(n,t)}}function co(e,t){var n=this.cache;if(void 0!==t.x)n[0]===t.x&&n[1]===t.y&&n[2]===t.z&&n[3]===t.w||(e.uniform4ui(this.addr,t.x,t.y,t.z,t.w),n[0]=t.x,n[1]=t.y,n[2]=t.z,n[3]=t.w);else{if(Wa(n,t))return;e.uniform4uiv(this.addr,t),qa(n,t)}}function ho(e,t,n){var i=this.cache,r=n.allocateTextureUnit();i[0]!==r&&(e.uniform1i(this.addr,r),i[0]=r),n.setTexture2D(t||Za,r)}function fo(e,t,n){var i=this.cache,r=n.allocateTextureUnit();i[0]!==r&&(e.uniform1i(this.addr,r),i[0]=r),n.setTexture3D(t||Fa,r)}function po(e,t,n){var i=this.cache,r=n.allocateTextureUnit();i[0]!==r&&(e.uniform1i(this.addr,r),i[0]=r),n.setTextureCube(t||Ua,r)}function Ao(e,t,n){var i=this.cache,r=n.allocateTextureUnit();i[0]!==r&&(e.uniform1i(this.addr,r),i[0]=r),n.setTexture2DArray(t||Na,r)}function vo(e,t){e.uniform1fv(this.addr,t)}function go(e,t){var n=Va(t,this.size,2);e.uniform2fv(this.addr,n)}function mo(e,t){var n=Va(t,this.size,3);e.uniform3fv(this.addr,n)}function yo(e,t){var n=Va(t,this.size,4);e.uniform4fv(this.addr,n)}function xo(e,t){var n=Va(t,this.size,4);e.uniformMatrix2fv(this.addr,!1,n)}function wo(e,t){var n=Va(t,this.size,9);e.uniformMatrix3fv(this.addr,!1,n)}function Co(e,t){var n=Va(t,this.size,16);e.uniformMatrix4fv(this.addr,!1,n)}function bo(e,t){e.uniform1iv(this.addr,t)}function _o(e,t){e.uniform2iv(this.addr,t)}function Eo(e,t){e.uniform3iv(this.addr,t)}function Mo(e,t){e.uniform4iv(this.addr,t)}function Io(e,t){e.uniform1uiv(this.addr,t)}function So(e,t){e.uniform2uiv(this.addr,t)}function ko(e,t){e.uniform3uiv(this.addr,t)}function Bo(e,t){e.uniform4uiv(this.addr,t)}function To(e,t,n){var i=this.cache,r=t.length,a=Ya(n,r);Wa(i,a)||(e.uniform1iv(this.addr,a),qa(i,a));for(var o=0;o!==r;++o)n.setTexture2D(t[o]||Za,a[o])}function Do(e,t,n){var i=this.cache,r=t.length,a=Ya(n,r);Wa(i,a)||(e.uniform1iv(this.addr,a),qa(i,a));for(var o=0;o!==r;++o)n.setTexture3D(t[o]||Fa,a[o])}function Ro(e,t,n){var i=this.cache,r=t.length,a=Ya(n,r);Wa(i,a)||(e.uniform1iv(this.addr,a),qa(i,a));for(var o=0;o!==r;++o)n.setTextureCube(t[o]||Ua,a[o])}function Po(e,t,n){var i=this.cache,r=t.length,a=Ya(n,r);Wa(i,a)||(e.uniform1iv(this.addr,a),qa(i,a));for(var o=0;o!==r;++o)n.setTexture2DArray(t[o]||Na,a[o])}var Lo=(0,g.Z)((function e(t,n,i){(0,v.Z)(this,e),this.id=t,this.addr=i,this.cache=[],this.setValue=function(e){switch(e){case 5126:return Ja;case 35664:return Xa;case 35665:return Ka;case 35666:return $a;case 35674:return eo;case 35675:return to;case 35676:return no;case 5124:case 35670:return io;case 35667:case 35671:return ro;case 35668:case 35672:return ao;case 35669:case 35673:return oo;case 5125:return so;case 36294:return lo;case 36295:return uo;case 36296:return co;case 35678:case 36198:case 36298:case 36306:case 35682:return ho;case 35679:case 36299:case 36307:return fo;case 35680:case 36300:case 36308:case 36293:return po;case 36289:case 36303:case 36311:case 36292:return Ao}}(n.type)})),Qo=(0,g.Z)((function e(t,n,i){(0,v.Z)(this,e),this.id=t,this.addr=i,this.cache=[],this.size=n.size,this.setValue=function(e){switch(e){case 5126:return vo;case 35664:return go;case 35665:return mo;case 35666:return yo;case 35674:return xo;case 35675:return wo;case 35676:return Co;case 5124:case 35670:return bo;case 35667:case 35671:return _o;case 35668:case 35672:return Eo;case 35669:case 35673:return Mo;case 5125:return Io;case 36294:return So;case 36295:return ko;case 36296:return Bo;case 35678:case 36198:case 36298:case 36306:case 35682:return To;case 35679:case 36299:case 36307:return Do;case 35680:case 36300:case 36308:case 36293:return Ro;case 36289:case 36303:case 36311:case 36292:return Po}}(n.type)})),Zo=function(){function e(t){(0,v.Z)(this,e),this.id=t,this.seq=[],this.map={}}return(0,g.Z)(e,[{key:"setValue",value:function(e,t,n){for(var i=this.seq,r=0,a=i.length;r!==a;++r){var o=i[r];o.setValue(e,t[o.id],n)}}}]),e}(),No=/(\w+)(\])?(\[|\.)?/g;function Fo(e,t){e.seq.push(t),e.map[t.id]=t}function Uo(e,t,n){var i=e.name,r=i.length;for(No.lastIndex=0;;){var a=No.exec(i),o=No.lastIndex,s=a[1],l="]"===a[2],u=a[3];if(l&&(s|=0),void 0===u||"["===u&&o+2===r){Fo(n,void 0===u?new Lo(s,e,t):new Qo(s,e,t));break}var c=n.map[s];void 0===c&&Fo(n,c=new Zo(s)),n=c}}var jo=function(){function e(t,n){(0,v.Z)(this,e),this.seq=[],this.map={};for(var i=t.getProgramParameter(n,35718),r=0;r<i;++r){var a=t.getActiveUniform(n,r);Uo(a,t.getUniformLocation(n,a.name),this)}}return(0,g.Z)(e,[{key:"setValue",value:function(e,t,n,i){var r=this.map[t];void 0!==r&&r.setValue(e,n,i)}},{key:"setOptional",value:function(e,t,n){var i=t[n];void 0!==i&&this.setValue(e,n,i)}}],[{key:"upload",value:function(e,t,n,i){for(var r=0,a=t.length;r!==a;++r){var o=t[r],s=n[o.id];!1!==s.needsUpdate&&o.setValue(e,s.value,i)}}},{key:"seqWithValue",value:function(e,t){for(var n=[],i=0,r=e.length;i!==r;++i){var a=e[i];a.id in t&&n.push(a)}return n}}]),e}();function Oo(e,t,n){var i=e.createShader(t);return e.shaderSource(i,n),e.compileShader(i),i}var zo=0;function Go(e,t,n){var i=e.getShaderParameter(t,35713),r=e.getShaderInfoLog(t).trim();if(i&&""===r)return"";var a=/ERROR: 0:(\d+)/.exec(r);if(a){var o=parseInt(a[1]);return n.toUpperCase()+"\n\n"+r+"\n\n"+function(e,t){for(var n=e.split("\n"),i=[],r=Math.max(t-6,0),a=Math.min(t+6,n.length),o=r;o<a;o++){var s=o+1;i.push("".concat(s===t?">":" "," ").concat(s,": ").concat(n[o]))}return i.join("\n")}(e.getShaderSource(t),o)}return r}function Ho(e,t){var n=function(e){switch(e){case Nt:return["Linear","( value )"];case Ft:return["sRGB","( value )"];default:return console.warn("THREE.WebGLProgram: Unsupported encoding:",e),["Linear","( value )"]}}(t);return"vec4 "+e+"( vec4 value ) { return LinearTo"+n[0]+n[1]+"; }"}function Vo(e,t){var n;switch(t){case ce:n="Linear";break;case he:n="Reinhard";break;case de:n="OptimizedCineon";break;case fe:n="ACESFilmic";break;case pe:n="Custom";break;default:console.warn("THREE.WebGLProgram: Unsupported toneMapping:",t),n="Linear"}return"vec3 "+e+"( vec3 color ) { return "+n+"ToneMapping( color ); }"}function Wo(e){return""!==e}function qo(e,t){var n=t.numSpotLightShadows+t.numSpotLightMaps-t.numSpotLightShadowsWithMaps;return e.replace(/NUM_DIR_LIGHTS/g,t.numDirLights).replace(/NUM_SPOT_LIGHTS/g,t.numSpotLights).replace(/NUM_SPOT_LIGHT_MAPS/g,t.numSpotLightMaps).replace(/NUM_SPOT_LIGHT_COORDS/g,n).replace(/NUM_RECT_AREA_LIGHTS/g,t.numRectAreaLights).replace(/NUM_POINT_LIGHTS/g,t.numPointLights).replace(/NUM_HEMI_LIGHTS/g,t.numHemiLights).replace(/NUM_DIR_LIGHT_SHADOWS/g,t.numDirLightShadows).replace(/NUM_SPOT_LIGHT_SHADOWS_WITH_MAPS/g,t.numSpotLightShadowsWithMaps).replace(/NUM_SPOT_LIGHT_SHADOWS/g,t.numSpotLightShadows).replace(/NUM_POINT_LIGHT_SHADOWS/g,t.numPointLightShadows)}function Yo(e,t){return e.replace(/NUM_CLIPPING_PLANES/g,t.numClippingPlanes).replace(/UNION_CLIPPING_PLANES/g,t.numClippingPlanes-t.numClipIntersection)}var Jo=/^[ \t]*#include +<([\w\d./]+)>/gm;function Xo(e){return e.replace(Jo,Ko)}function Ko(e,t){var n=ra[t];if(void 0===n)throw new Error("Can not resolve #include <"+t+">");return Xo(n)}var $o=/#pragma unroll_loop_start\s+for\s*\(\s*int\s+i\s*=\s*(\d+)\s*;\s*i\s*<\s*(\d+)\s*;\s*i\s*\+\+\s*\)\s*{([\s\S]+?)}\s+#pragma unroll_loop_end/g;function es(e){return e.replace($o,ts)}function ts(e,t,n,i){for(var r="",a=parseInt(t);a<parseInt(n);a++)r+=i.replace(/\[\s*i\s*\]/g,"[ "+a+" ]").replace(/UNROLLED_LOOP_INDEX/g,a);return r}function ns(e){var t="precision "+e.precision+" float;\nprecision "+e.precision+" int;";return"highp"===e.precision?t+="\n#define HIGH_PRECISION":"mediump"===e.precision?t+="\n#define MEDIUM_PRECISION":"lowp"===e.precision&&(t+="\n#define LOW_PRECISION"),t}function is(e,t,n,i){var r,a,o=e.getContext(),s=n.defines,l=n.vertexShader,u=n.fragmentShader,c=function(e){var t="SHADOWMAP_TYPE_BASIC";return e.shadowMapType===_?t="SHADOWMAP_TYPE_PCF":e.shadowMapType===E?t="SHADOWMAP_TYPE_PCF_SOFT":e.shadowMapType===M&&(t="SHADOWMAP_TYPE_VSM"),t}(n),h=function(e){var t="ENVMAP_TYPE_CUBE";if(e.envMap)switch(e.envMapMode){case Ae:case ve:t="ENVMAP_TYPE_CUBE";break;case ye:t="ENVMAP_TYPE_CUBE_UV"}return t}(n),d=function(e){var t="ENVMAP_MODE_REFLECTION";e.envMap&&e.envMapMode===ve&&(t="ENVMAP_MODE_REFRACTION");return t}(n),f=function(e){var t="ENVMAP_BLENDING_NONE";if(e.envMap)switch(e.combine){case oe:t="ENVMAP_BLENDING_MULTIPLY";break;case se:t="ENVMAP_BLENDING_MIX";break;case le:t="ENVMAP_BLENDING_ADD"}return t}(n),p=function(e){var t=e.envMapCubeUVHeight;if(null===t)return null;var n=Math.log2(t)-2,i=1/t;return{texelWidth:1/(3*Math.max(Math.pow(2,n),112)),texelHeight:i,maxMip:n}}(n),A=n.isWebGL2?"":function(e){return[e.extensionDerivatives||e.envMapCubeUVHeight||e.bumpMap||e.tangentSpaceNormalMap||e.clearcoatNormalMap||e.flatShading||"physical"===e.shaderID?"#extension GL_OES_standard_derivatives : enable":"",(e.extensionFragDepth||e.logarithmicDepthBuffer)&&e.rendererExtensionFragDepth?"#extension GL_EXT_frag_depth : enable":"",e.extensionDrawBuffers&&e.rendererExtensionDrawBuffers?"#extension GL_EXT_draw_buffers : require":"",(e.extensionShaderTextureLOD||e.envMap||e.transmission)&&e.rendererExtensionShaderTextureLod?"#extension GL_EXT_shader_texture_lod : enable":""].filter(Wo).join("\n")}(n),v=function(e){var t=[];for(var n in e){var i=e[n];!1!==i&&t.push("#define "+n+" "+i)}return t.join("\n")}(s),g=o.createProgram(),m=n.glslVersion?"#version "+n.glslVersion+"\n":"";n.isRawShaderMaterial?((r=[v].filter(Wo).join("\n")).length>0&&(r+="\n"),(a=[A,v].filter(Wo).join("\n")).length>0&&(a+="\n")):(r=[ns(n),"#define SHADER_NAME "+n.shaderName,v,n.instancing?"#define USE_INSTANCING":"",n.instancingColor?"#define USE_INSTANCING_COLOR":"",n.supportsVertexTextures?"#define VERTEX_TEXTURES":"",n.useFog&&n.fog?"#define USE_FOG":"",n.useFog&&n.fogExp2?"#define FOG_EXP2":"",n.map?"#define USE_MAP":"",n.envMap?"#define USE_ENVMAP":"",n.envMap?"#define "+d:"",n.lightMap?"#define USE_LIGHTMAP":"",n.aoMap?"#define USE_AOMAP":"",n.emissiveMap?"#define USE_EMISSIVEMAP":"",n.bumpMap?"#define USE_BUMPMAP":"",n.normalMap?"#define USE_NORMALMAP":"",n.normalMap&&n.objectSpaceNormalMap?"#define OBJECTSPACE_NORMALMAP":"",n.normalMap&&n.tangentSpaceNormalMap?"#define TANGENTSPACE_NORMALMAP":"",n.clearcoatMap?"#define USE_CLEARCOATMAP":"",n.clearcoatRoughnessMap?"#define USE_CLEARCOAT_ROUGHNESSMAP":"",n.clearcoatNormalMap?"#define USE_CLEARCOAT_NORMALMAP":"",n.iridescenceMap?"#define USE_IRIDESCENCEMAP":"",n.iridescenceThicknessMap?"#define USE_IRIDESCENCE_THICKNESSMAP":"",n.displacementMap&&n.supportsVertexTextures?"#define USE_DISPLACEMENTMAP":"",n.specularMap?"#define USE_SPECULARMAP":"",n.specularIntensityMap?"#define USE_SPECULARINTENSITYMAP":"",n.specularColorMap?"#define USE_SPECULARCOLORMAP":"",n.roughnessMap?"#define USE_ROUGHNESSMAP":"",n.metalnessMap?"#define USE_METALNESSMAP":"",n.alphaMap?"#define USE_ALPHAMAP":"",n.transmission?"#define USE_TRANSMISSION":"",n.transmissionMap?"#define USE_TRANSMISSIONMAP":"",n.thicknessMap?"#define USE_THICKNESSMAP":"",n.sheenColorMap?"#define USE_SHEENCOLORMAP":"",n.sheenRoughnessMap?"#define USE_SHEENROUGHNESSMAP":"",n.vertexTangents?"#define USE_TANGENT":"",n.vertexColors?"#define USE_COLOR":"",n.vertexAlphas?"#define USE_COLOR_ALPHA":"",n.vertexUvs?"#define USE_UV":"",n.uvsVertexOnly?"#define UVS_VERTEX_ONLY":"",n.flatShading?"#define FLAT_SHADED":"",n.skinning?"#define USE_SKINNING":"",n.morphTargets?"#define USE_MORPHTARGETS":"",n.morphNormals&&!1===n.flatShading?"#define USE_MORPHNORMALS":"",n.morphColors&&n.isWebGL2?"#define USE_MORPHCOLORS":"",n.morphTargetsCount>0&&n.isWebGL2?"#define MORPHTARGETS_TEXTURE":"",n.morphTargetsCount>0&&n.isWebGL2?"#define MORPHTARGETS_TEXTURE_STRIDE "+n.morphTextureStride:"",n.morphTargetsCount>0&&n.isWebGL2?"#define MORPHTARGETS_COUNT "+n.morphTargetsCount:"",n.doubleSided?"#define DOUBLE_SIDED":"",n.flipSided?"#define FLIP_SIDED":"",n.shadowMapEnabled?"#define USE_SHADOWMAP":"",n.shadowMapEnabled?"#define "+c:"",n.sizeAttenuation?"#define USE_SIZEATTENUATION":"",n.logarithmicDepthBuffer?"#define USE_LOGDEPTHBUF":"",n.logarithmicDepthBuffer&&n.rendererExtensionFragDepth?"#define USE_LOGDEPTHBUF_EXT":"","uniform mat4 modelMatrix;","uniform mat4 modelViewMatrix;","uniform mat4 projectionMatrix;","uniform mat4 viewMatrix;","uniform mat3 normalMatrix;","uniform vec3 cameraPosition;","uniform bool isOrthographic;","#ifdef USE_INSTANCING","\tattribute mat4 instanceMatrix;","#endif","#ifdef USE_INSTANCING_COLOR","\tattribute vec3 instanceColor;","#endif","attribute vec3 position;","attribute vec3 normal;","attribute vec2 uv;","#ifdef USE_TANGENT","\tattribute vec4 tangent;","#endif","#if defined( USE_COLOR_ALPHA )","\tattribute vec4 color;","#elif defined( USE_COLOR )","\tattribute vec3 color;","#endif","#if ( defined( USE_MORPHTARGETS ) && ! defined( MORPHTARGETS_TEXTURE ) )","\tattribute vec3 morphTarget0;","\tattribute vec3 morphTarget1;","\tattribute vec3 morphTarget2;","\tattribute vec3 morphTarget3;","\t#ifdef USE_MORPHNORMALS","\t\tattribute vec3 morphNormal0;","\t\tattribute vec3 morphNormal1;","\t\tattribute vec3 morphNormal2;","\t\tattribute vec3 morphNormal3;","\t#else","\t\tattribute vec3 morphTarget4;","\t\tattribute vec3 morphTarget5;","\t\tattribute vec3 morphTarget6;","\t\tattribute vec3 morphTarget7;","\t#endif","#endif","#ifdef USE_SKINNING","\tattribute vec4 skinIndex;","\tattribute vec4 skinWeight;","#endif","\n"].filter(Wo).join("\n"),a=[A,ns(n),"#define SHADER_NAME "+n.shaderName,v,n.useFog&&n.fog?"#define USE_FOG":"",n.useFog&&n.fogExp2?"#define FOG_EXP2":"",n.map?"#define USE_MAP":"",n.matcap?"#define USE_MATCAP":"",n.envMap?"#define USE_ENVMAP":"",n.envMap?"#define "+h:"",n.envMap?"#define "+d:"",n.envMap?"#define "+f:"",p?"#define CUBEUV_TEXEL_WIDTH "+p.texelWidth:"",p?"#define CUBEUV_TEXEL_HEIGHT "+p.texelHeight:"",p?"#define CUBEUV_MAX_MIP "+p.maxMip+".0":"",n.lightMap?"#define USE_LIGHTMAP":"",n.aoMap?"#define USE_AOMAP":"",n.emissiveMap?"#define USE_EMISSIVEMAP":"",n.bumpMap?"#define USE_BUMPMAP":"",n.normalMap?"#define USE_NORMALMAP":"",n.normalMap&&n.objectSpaceNormalMap?"#define OBJECTSPACE_NORMALMAP":"",n.normalMap&&n.tangentSpaceNormalMap?"#define TANGENTSPACE_NORMALMAP":"",n.clearcoat?"#define USE_CLEARCOAT":"",n.clearcoatMap?"#define USE_CLEARCOATMAP":"",n.clearcoatRoughnessMap?"#define USE_CLEARCOAT_ROUGHNESSMAP":"",n.clearcoatNormalMap?"#define USE_CLEARCOAT_NORMALMAP":"",n.iridescence?"#define USE_IRIDESCENCE":"",n.iridescenceMap?"#define USE_IRIDESCENCEMAP":"",n.iridescenceThicknessMap?"#define USE_IRIDESCENCE_THICKNESSMAP":"",n.specularMap?"#define USE_SPECULARMAP":"",n.specularIntensityMap?"#define USE_SPECULARINTENSITYMAP":"",n.specularColorMap?"#define USE_SPECULARCOLORMAP":"",n.roughnessMap?"#define USE_ROUGHNESSMAP":"",n.metalnessMap?"#define USE_METALNESSMAP":"",n.alphaMap?"#define USE_ALPHAMAP":"",n.alphaTest?"#define USE_ALPHATEST":"",n.sheen?"#define USE_SHEEN":"",n.sheenColorMap?"#define USE_SHEENCOLORMAP":"",n.sheenRoughnessMap?"#define USE_SHEENROUGHNESSMAP":"",n.transmission?"#define USE_TRANSMISSION":"",n.transmissionMap?"#define USE_TRANSMISSIONMAP":"",n.thicknessMap?"#define USE_THICKNESSMAP":"",n.decodeVideoTexture?"#define DECODE_VIDEO_TEXTURE":"",n.vertexTangents?"#define USE_TANGENT":"",n.vertexColors||n.instancingColor?"#define USE_COLOR":"",n.vertexAlphas?"#define USE_COLOR_ALPHA":"",n.vertexUvs?"#define USE_UV":"",n.uvsVertexOnly?"#define UVS_VERTEX_ONLY":"",n.gradientMap?"#define USE_GRADIENTMAP":"",n.flatShading?"#define FLAT_SHADED":"",n.doubleSided?"#define DOUBLE_SIDED":"",n.flipSided?"#define FLIP_SIDED":"",n.shadowMapEnabled?"#define USE_SHADOWMAP":"",n.shadowMapEnabled?"#define "+c:"",n.premultipliedAlpha?"#define PREMULTIPLIED_ALPHA":"",n.physicallyCorrectLights?"#define PHYSICALLY_CORRECT_LIGHTS":"",n.logarithmicDepthBuffer?"#define USE_LOGDEPTHBUF":"",n.logarithmicDepthBuffer&&n.rendererExtensionFragDepth?"#define USE_LOGDEPTHBUF_EXT":"","uniform mat4 viewMatrix;","uniform vec3 cameraPosition;","uniform bool isOrthographic;",n.toneMapping!==ue?"#define TONE_MAPPING":"",n.toneMapping!==ue?ra.tonemapping_pars_fragment:"",n.toneMapping!==ue?Vo("toneMapping",n.toneMapping):"",n.dithering?"#define DITHERING":"",n.opaque?"#define OPAQUE":"",ra.encodings_pars_fragment,Ho("linearToOutputTexel",n.outputEncoding),n.useDepthPacking?"#define DEPTH_PACKING "+n.depthPacking:"","\n"].filter(Wo).join("\n")),l=Yo(l=qo(l=Xo(l),n),n),u=Yo(u=qo(u=Xo(u),n),n),l=es(l),u=es(u),n.isWebGL2&&!0!==n.isRawShaderMaterial&&(m="#version 300 es\n",r=["precision mediump sampler2DArray;","#define attribute in","#define varying out","#define texture2D texture"].join("\n")+"\n"+r,a=["#define varying in",n.glslVersion===Wt?"":"layout(location = 0) out highp vec4 pc_fragColor;",n.glslVersion===Wt?"":"#define gl_FragColor pc_fragColor","#define gl_FragDepthEXT gl_FragDepth","#define texture2D texture","#define textureCube texture","#define texture2DProj textureProj","#define texture2DLodEXT textureLod","#define texture2DProjLodEXT textureProjLod","#define textureCubeLodEXT textureLod","#define texture2DGradEXT textureGrad","#define texture2DProjGradEXT textureProjGrad","#define textureCubeGradEXT textureGrad"].join("\n")+"\n"+a);var y,x,w=m+a+u,C=Oo(o,35633,m+r+l),b=Oo(o,35632,w);if(o.attachShader(g,C),o.attachShader(g,b),void 0!==n.index0AttributeName?o.bindAttribLocation(g,0,n.index0AttributeName):!0===n.morphTargets&&o.bindAttribLocation(g,0,"position"),o.linkProgram(g),e.debug.checkShaderErrors){var I=o.getProgramInfoLog(g).trim(),S=o.getShaderInfoLog(C).trim(),k=o.getShaderInfoLog(b).trim(),B=!0,T=!0;if(!1===o.getProgramParameter(g,35714)){B=!1;var D=Go(o,C,"vertex"),R=Go(o,b,"fragment");console.error("THREE.WebGLProgram: Shader Error "+o.getError()+" - VALIDATE_STATUS "+o.getProgramParameter(g,35715)+"\n\nProgram Info Log: "+I+"\n"+D+"\n"+R)}else""!==I?console.warn("THREE.WebGLProgram: Program Info Log:",I):""!==S&&""!==k||(T=!1);T&&(this.diagnostics={runnable:B,programLog:I,vertexShader:{log:S,prefix:r},fragmentShader:{log:k,prefix:a}})}return o.deleteShader(C),o.deleteShader(b),this.getUniforms=function(){return void 0===y&&(y=new jo(o,g)),y},this.getAttributes=function(){return void 0===x&&(x=function(e,t){for(var n={},i=e.getProgramParameter(t,35721),r=0;r<i;r++){var a=e.getActiveAttrib(t,r),o=a.name,s=1;35674===a.type&&(s=2),35675===a.type&&(s=3),35676===a.type&&(s=4),n[o]={type:a.type,location:e.getAttribLocation(t,o),locationSize:s}}return n}(o,g)),x},this.destroy=function(){i.releaseStatesOfProgram(this),o.deleteProgram(g),this.program=void 0},this.name=n.shaderName,this.id=zo++,this.cacheKey=t,this.usedTimes=1,this.program=g,this.vertexShader=C,this.fragmentShader=b,this}var rs=0,as=function(){function e(){(0,v.Z)(this,e),this.shaderCache=new Map,this.materialCache=new Map}return(0,g.Z)(e,[{key:"update",value:function(e){var t=e.vertexShader,n=e.fragmentShader,i=this._getShaderStage(t),r=this._getShaderStage(n),a=this._getShaderCacheForMaterial(e);return!1===a.has(i)&&(a.add(i),i.usedTimes++),!1===a.has(r)&&(a.add(r),r.usedTimes++),this}},{key:"remove",value:function(e){var t,n=this.materialCache.get(e),i=(0,s.Z)(n);try{for(i.s();!(t=i.n()).done;){var r=t.value;r.usedTimes--,0===r.usedTimes&&this.shaderCache.delete(r.code)}}catch(a){i.e(a)}finally{i.f()}return this.materialCache.delete(e),this}},{key:"getVertexShaderID",value:function(e){return this._getShaderStage(e.vertexShader).id}},{key:"getFragmentShaderID",value:function(e){return this._getShaderStage(e.fragmentShader).id}},{key:"dispose",value:function(){this.shaderCache.clear(),this.materialCache.clear()}},{key:"_getShaderCacheForMaterial",value:function(e){var t=this.materialCache,n=t.get(e);return void 0===n&&(n=new Set,t.set(e,n)),n}},{key:"_getShaderStage",value:function(e){var t=this.shaderCache,n=t.get(e);return void 0===n&&(n=new os(e),t.set(e,n)),n}}]),e}(),os=(0,g.Z)((function e(t){(0,v.Z)(this,e),this.id=rs++,this.code=t,this.usedTimes=0}));function ss(e,t,n,i,r,a,o){var s=new Ti,l=new as,u=[],c=r.isWebGL2,h=r.logarithmicDepthBuffer,d=r.vertexTextures,f=r.precision,p={MeshDepthMaterial:"depth",MeshDistanceMaterial:"distanceRGBA",MeshNormalMaterial:"normal",MeshBasicMaterial:"basic",MeshLambertMaterial:"lambert",MeshPhongMaterial:"phong",MeshToonMaterial:"toon",MeshStandardMaterial:"physical",MeshPhysicalMaterial:"physical",MeshMatcapMaterial:"matcap",LineBasicMaterial:"basic",LineDashedMaterial:"dashed",PointsMaterial:"points",ShadowMaterial:"shadow",SpriteMaterial:"sprite"};return{getParameters:function(a,s,u,A,v){var g=A.fog,m=v.geometry,y=a.isMeshStandardMaterial?A.environment:null,x=(a.isMeshStandardMaterial?n:t).get(a.envMap||y),w=x&&x.mapping===ye?x.image.height:null,C=p[a.type];null!==a.precision&&(f=r.getMaxPrecision(a.precision))!==a.precision&&console.warn("THREE.WebGLProgram.getParameters:",a.precision,"not supported, using",f,"instead.");var b,_,E,M,I=m.morphAttributes.position||m.morphAttributes.normal||m.morphAttributes.color,B=void 0!==I?I.length:0,D=0;if(void 0!==m.morphAttributes.position&&(D=1),void 0!==m.morphAttributes.normal&&(D=2),void 0!==m.morphAttributes.color&&(D=3),C){var R=oa[C];b=R.vertexShader,_=R.fragmentShader}else b=a.vertexShader,_=a.fragmentShader,l.update(a),E=l.getVertexShaderID(a),M=l.getFragmentShaderID(a);var P=e.getRenderTarget(),L=a.alphaTest>0,Q=a.clearcoat>0,Z=a.iridescence>0;return{isWebGL2:c,shaderID:C,shaderName:a.type,vertexShader:b,fragmentShader:_,defines:a.defines,customVertexShaderID:E,customFragmentShaderID:M,isRawShaderMaterial:!0===a.isRawShaderMaterial,glslVersion:a.glslVersion,precision:f,instancing:!0===v.isInstancedMesh,instancingColor:!0===v.isInstancedMesh&&null!==v.instanceColor,supportsVertexTextures:d,outputEncoding:null===P?e.outputEncoding:!0===P.isXRRenderTarget?P.texture.encoding:Nt,map:!!a.map,matcap:!!a.matcap,envMap:!!x,envMapMode:x&&x.mapping,envMapCubeUVHeight:w,lightMap:!!a.lightMap,aoMap:!!a.aoMap,emissiveMap:!!a.emissiveMap,bumpMap:!!a.bumpMap,normalMap:!!a.normalMap,objectSpaceNormalMap:a.normalMapType===Ot,tangentSpaceNormalMap:a.normalMapType===jt,decodeVideoTexture:!!a.map&&!0===a.map.isVideoTexture&&a.map.encoding===Ft,clearcoat:Q,clearcoatMap:Q&&!!a.clearcoatMap,clearcoatRoughnessMap:Q&&!!a.clearcoatRoughnessMap,clearcoatNormalMap:Q&&!!a.clearcoatNormalMap,iridescence:Z,iridescenceMap:Z&&!!a.iridescenceMap,iridescenceThicknessMap:Z&&!!a.iridescenceThicknessMap,displacementMap:!!a.displacementMap,roughnessMap:!!a.roughnessMap,metalnessMap:!!a.metalnessMap,specularMap:!!a.specularMap,specularIntensityMap:!!a.specularIntensityMap,specularColorMap:!!a.specularColorMap,opaque:!1===a.transparent&&a.blending===T,alphaMap:!!a.alphaMap,alphaTest:L,gradientMap:!!a.gradientMap,sheen:a.sheen>0,sheenColorMap:!!a.sheenColorMap,sheenRoughnessMap:!!a.sheenRoughnessMap,transmission:a.transmission>0,transmissionMap:!!a.transmissionMap,thicknessMap:!!a.thicknessMap,combine:a.combine,vertexTangents:!!a.normalMap&&!!m.attributes.tangent,vertexColors:a.vertexColors,vertexAlphas:!0===a.vertexColors&&!!m.attributes.color&&4===m.attributes.color.itemSize,vertexUvs:!!a.map||!!a.bumpMap||!!a.normalMap||!!a.specularMap||!!a.alphaMap||!!a.emissiveMap||!!a.roughnessMap||!!a.metalnessMap||!!a.clearcoatMap||!!a.clearcoatRoughnessMap||!!a.clearcoatNormalMap||!!a.iridescenceMap||!!a.iridescenceThicknessMap||!!a.displacementMap||!!a.transmissionMap||!!a.thicknessMap||!!a.specularIntensityMap||!!a.specularColorMap||!!a.sheenColorMap||!!a.sheenRoughnessMap,uvsVertexOnly:!(a.map||a.bumpMap||a.normalMap||a.specularMap||a.alphaMap||a.emissiveMap||a.roughnessMap||a.metalnessMap||a.clearcoatNormalMap||a.iridescenceMap||a.iridescenceThicknessMap||a.transmission>0||a.transmissionMap||a.thicknessMap||a.specularIntensityMap||a.specularColorMap||a.sheen>0||a.sheenColorMap||a.sheenRoughnessMap)&&!!a.displacementMap,fog:!!g,useFog:!0===a.fog,fogExp2:g&&g.isFogExp2,flatShading:!!a.flatShading,sizeAttenuation:a.sizeAttenuation,logarithmicDepthBuffer:h,skinning:!0===v.isSkinnedMesh,morphTargets:void 0!==m.morphAttributes.position,morphNormals:void 0!==m.morphAttributes.normal,morphColors:void 0!==m.morphAttributes.color,morphTargetsCount:B,morphTextureStride:D,numDirLights:s.directional.length,numPointLights:s.point.length,numSpotLights:s.spot.length,numSpotLightMaps:s.spotLightMap.length,numRectAreaLights:s.rectArea.length,numHemiLights:s.hemi.length,numDirLightShadows:s.directionalShadowMap.length,numPointLightShadows:s.pointShadowMap.length,numSpotLightShadows:s.spotShadowMap.length,numSpotLightShadowsWithMaps:s.numSpotLightShadowsWithMaps,numClippingPlanes:o.numPlanes,numClipIntersection:o.numIntersection,dithering:a.dithering,shadowMapEnabled:e.shadowMap.enabled&&u.length>0,shadowMapType:e.shadowMap.type,toneMapping:a.toneMapped?e.toneMapping:ue,physicallyCorrectLights:e.physicallyCorrectLights,premultipliedAlpha:a.premultipliedAlpha,doubleSided:a.side===k,flipSided:a.side===S,useDepthPacking:!!a.depthPacking,depthPacking:a.depthPacking||0,index0AttributeName:a.index0AttributeName,extensionDerivatives:a.extensions&&a.extensions.derivatives,extensionFragDepth:a.extensions&&a.extensions.fragDepth,extensionDrawBuffers:a.extensions&&a.extensions.drawBuffers,extensionShaderTextureLOD:a.extensions&&a.extensions.shaderTextureLOD,rendererExtensionFragDepth:c||i.has("EXT_frag_depth"),rendererExtensionDrawBuffers:c||i.has("WEBGL_draw_buffers"),rendererExtensionShaderTextureLod:c||i.has("EXT_shader_texture_lod"),customProgramCacheKey:a.customProgramCacheKey()}},getProgramCacheKey:function(t){var n=[];if(t.shaderID?n.push(t.shaderID):(n.push(t.customVertexShaderID),n.push(t.customFragmentShaderID)),void 0!==t.defines)for(var i in t.defines)n.push(i),n.push(t.defines[i]);return!1===t.isRawShaderMaterial&&(!function(e,t){e.push(t.precision),e.push(t.outputEncoding),e.push(t.envMapMode),e.push(t.envMapCubeUVHeight),e.push(t.combine),e.push(t.vertexUvs),e.push(t.fogExp2),e.push(t.sizeAttenuation),e.push(t.morphTargetsCount),e.push(t.morphAttributeCount),e.push(t.numDirLights),e.push(t.numPointLights),e.push(t.numSpotLights),e.push(t.numSpotLightMaps),e.push(t.numHemiLights),e.push(t.numRectAreaLights),e.push(t.numDirLightShadows),e.push(t.numPointLightShadows),e.push(t.numSpotLightShadows),e.push(t.numSpotLightShadowsWithMaps),e.push(t.shadowMapType),e.push(t.toneMapping),e.push(t.numClippingPlanes),e.push(t.numClipIntersection),e.push(t.depthPacking)}(n,t),function(e,t){s.disableAll(),t.isWebGL2&&s.enable(0);t.supportsVertexTextures&&s.enable(1);t.instancing&&s.enable(2);t.instancingColor&&s.enable(3);t.map&&s.enable(4);t.matcap&&s.enable(5);t.envMap&&s.enable(6);t.lightMap&&s.enable(7);t.aoMap&&s.enable(8);t.emissiveMap&&s.enable(9);t.bumpMap&&s.enable(10);t.normalMap&&s.enable(11);t.objectSpaceNormalMap&&s.enable(12);t.tangentSpaceNormalMap&&s.enable(13);t.clearcoat&&s.enable(14);t.clearcoatMap&&s.enable(15);t.clearcoatRoughnessMap&&s.enable(16);t.clearcoatNormalMap&&s.enable(17);t.iridescence&&s.enable(18);t.iridescenceMap&&s.enable(19);t.iridescenceThicknessMap&&s.enable(20);t.displacementMap&&s.enable(21);t.specularMap&&s.enable(22);t.roughnessMap&&s.enable(23);t.metalnessMap&&s.enable(24);t.gradientMap&&s.enable(25);t.alphaMap&&s.enable(26);t.alphaTest&&s.enable(27);t.vertexColors&&s.enable(28);t.vertexAlphas&&s.enable(29);t.vertexUvs&&s.enable(30);t.vertexTangents&&s.enable(31);t.uvsVertexOnly&&s.enable(32);e.push(s.mask),s.disableAll(),t.fog&&s.enable(0);t.useFog&&s.enable(1);t.flatShading&&s.enable(2);t.logarithmicDepthBuffer&&s.enable(3);t.skinning&&s.enable(4);t.morphTargets&&s.enable(5);t.morphNormals&&s.enable(6);t.morphColors&&s.enable(7);t.premultipliedAlpha&&s.enable(8);t.shadowMapEnabled&&s.enable(9);t.physicallyCorrectLights&&s.enable(10);t.doubleSided&&s.enable(11);t.flipSided&&s.enable(12);t.useDepthPacking&&s.enable(13);t.dithering&&s.enable(14);t.specularIntensityMap&&s.enable(15);t.specularColorMap&&s.enable(16);t.transmission&&s.enable(17);t.transmissionMap&&s.enable(18);t.thicknessMap&&s.enable(19);t.sheen&&s.enable(20);t.sheenColorMap&&s.enable(21);t.sheenRoughnessMap&&s.enable(22);t.decodeVideoTexture&&s.enable(23);t.opaque&&s.enable(24);e.push(s.mask)}(n,t),n.push(e.outputEncoding)),n.push(t.customProgramCacheKey),n.join()},getUniforms:function(e){var t,n=p[e.type];if(n){var i=oa[n];t=Ur.clone(i.uniforms)}else t=e.uniforms;return t},acquireProgram:function(t,n){for(var i,r=0,o=u.length;r<o;r++){var s=u[r];if(s.cacheKey===n){++(i=s).usedTimes;break}}return void 0===i&&(i=new is(e,n,t,a),u.push(i)),i},releaseProgram:function(e){if(0===--e.usedTimes){var t=u.indexOf(e);u[t]=u[u.length-1],u.pop(),e.destroy()}},releaseShaderCache:function(e){l.remove(e)},programs:u,dispose:function(){l.dispose()}}}function ls(){var e=new WeakMap;return{get:function(t){var n=e.get(t);return void 0===n&&(n={},e.set(t,n)),n},remove:function(t){e.delete(t)},update:function(t,n,i){e.get(t)[n]=i},dispose:function(){e=new WeakMap}}}function us(e,t){return e.groupOrder!==t.groupOrder?e.groupOrder-t.groupOrder:e.renderOrder!==t.renderOrder?e.renderOrder-t.renderOrder:e.material.id!==t.material.id?e.material.id-t.material.id:e.z!==t.z?e.z-t.z:e.id-t.id}function cs(e,t){return e.groupOrder!==t.groupOrder?e.groupOrder-t.groupOrder:e.renderOrder!==t.renderOrder?e.renderOrder-t.renderOrder:e.z!==t.z?t.z-e.z:e.id-t.id}function hs(){var e=[],t=0,n=[],i=[],r=[];function a(n,i,r,a,o,s){var l=e[t];return void 0===l?(l={id:n.id,object:n,geometry:i,material:r,groupOrder:a,renderOrder:n.renderOrder,z:o,group:s},e[t]=l):(l.id=n.id,l.object=n,l.geometry=i,l.material=r,l.groupOrder=a,l.renderOrder=n.renderOrder,l.z=o,l.group=s),t++,l}return{opaque:n,transmissive:i,transparent:r,init:function(){t=0,n.length=0,i.length=0,r.length=0},push:function(e,t,o,s,l,u){var c=a(e,t,o,s,l,u);o.transmission>0?i.push(c):!0===o.transparent?r.push(c):n.push(c)},unshift:function(e,t,o,s,l,u){var c=a(e,t,o,s,l,u);o.transmission>0?i.unshift(c):!0===o.transparent?r.unshift(c):n.unshift(c)},finish:function(){for(var n=t,i=e.length;n<i;n++){var r=e[n];if(null===r.id)break;r.id=null,r.object=null,r.geometry=null,r.material=null,r.group=null}},sort:function(e,t){n.length>1&&n.sort(e||us),i.length>1&&i.sort(t||cs),r.length>1&&r.sort(t||cs)}}}function ds(){var e=new WeakMap;return{get:function(t,n){var i,r=e.get(t);return void 0===r?(i=new hs,e.set(t,[i])):n>=r.length?(i=new hs,r.push(i)):i=r[n],i},dispose:function(){e=new WeakMap}}}function fs(){var e={};return{get:function(t){if(void 0!==e[t.id])return e[t.id];var n;switch(t.type){case"DirectionalLight":n={direction:new Gn,color:new Rn};break;case"SpotLight":n={position:new Gn,direction:new Gn,color:new Rn,distance:0,coneCos:0,penumbraCos:0,decay:0};break;case"PointLight":n={position:new Gn,color:new Rn,distance:0,decay:0};break;case"HemisphereLight":n={direction:new Gn,skyColor:new Rn,groundColor:new Rn};break;case"RectAreaLight":n={color:new Rn,position:new Gn,halfWidth:new Gn,halfHeight:new Gn}}return e[t.id]=n,n}}}var ps=0;function As(e,t){return(t.castShadow?2:0)-(e.castShadow?2:0)+(t.map?1:0)-(e.map?1:0)}function vs(e,t){for(var n=new fs,i=function(){var e={};return{get:function(t){if(void 0!==e[t.id])return e[t.id];var n;switch(t.type){case"DirectionalLight":case"SpotLight":n={shadowBias:0,shadowNormalBias:0,shadowRadius:1,shadowMapSize:new An};break;case"PointLight":n={shadowBias:0,shadowNormalBias:0,shadowRadius:1,shadowMapSize:new An,shadowCameraNear:1,shadowCameraFar:1e3}}return e[t.id]=n,n}}}(),r={version:0,hash:{directionalLength:-1,pointLength:-1,spotLength:-1,rectAreaLength:-1,hemiLength:-1,numDirectionalShadows:-1,numPointShadows:-1,numSpotShadows:-1,numSpotMaps:-1},ambient:[0,0,0],probe:[],directional:[],directionalShadow:[],directionalShadowMap:[],directionalShadowMatrix:[],spot:[],spotLightMap:[],spotShadow:[],spotShadowMap:[],spotLightMatrix:[],rectArea:[],rectAreaLTC1:null,rectAreaLTC2:null,point:[],pointShadow:[],pointShadowMap:[],pointShadowMatrix:[],hemi:[],numSpotLightShadowsWithMaps:0},a=0;a<9;a++)r.probe.push(new Gn);var o=new Gn,s=new xi,l=new xi;return{setup:function(a,o){for(var s=0,l=0,u=0,c=0;c<9;c++)r.probe[c].set(0,0,0);var h=0,d=0,f=0,p=0,A=0,v=0,g=0,m=0,y=0,x=0;a.sort(As);for(var w=!0!==o?Math.PI:1,C=0,b=a.length;C<b;C++){var _=a[C],E=_.color,M=_.intensity,I=_.distance,S=_.shadow&&_.shadow.map?_.shadow.map.texture:null;if(_.isAmbientLight)s+=E.r*M*w,l+=E.g*M*w,u+=E.b*M*w;else if(_.isLightProbe)for(var k=0;k<9;k++)r.probe[k].addScaledVector(_.sh.coefficients[k],M);else if(_.isDirectionalLight){var B=n.get(_);if(B.color.copy(_.color).multiplyScalar(_.intensity*w),_.castShadow){var T=_.shadow,D=i.get(_);D.shadowBias=T.bias,D.shadowNormalBias=T.normalBias,D.shadowRadius=T.radius,D.shadowMapSize=T.mapSize,r.directionalShadow[h]=D,r.directionalShadowMap[h]=S,r.directionalShadowMatrix[h]=_.shadow.matrix,v++}r.directional[h]=B,h++}else if(_.isSpotLight){var R=n.get(_);R.position.setFromMatrixPosition(_.matrixWorld),R.color.copy(E).multiplyScalar(M*w),R.distance=I,R.coneCos=Math.cos(_.angle),R.penumbraCos=Math.cos(_.angle*(1-_.penumbra)),R.decay=_.decay,r.spot[f]=R;var P=_.shadow;if(_.map&&(r.spotLightMap[y]=_.map,y++,P.updateMatrices(_),_.castShadow&&x++),r.spotLightMatrix[f]=P.matrix,_.castShadow){var L=i.get(_);L.shadowBias=P.bias,L.shadowNormalBias=P.normalBias,L.shadowRadius=P.radius,L.shadowMapSize=P.mapSize,r.spotShadow[f]=L,r.spotShadowMap[f]=S,m++}f++}else if(_.isRectAreaLight){var Q=n.get(_);Q.color.copy(E).multiplyScalar(M),Q.halfWidth.set(.5*_.width,0,0),Q.halfHeight.set(0,.5*_.height,0),r.rectArea[p]=Q,p++}else if(_.isPointLight){var Z=n.get(_);if(Z.color.copy(_.color).multiplyScalar(_.intensity*w),Z.distance=_.distance,Z.decay=_.decay,_.castShadow){var N=_.shadow,F=i.get(_);F.shadowBias=N.bias,F.shadowNormalBias=N.normalBias,F.shadowRadius=N.radius,F.shadowMapSize=N.mapSize,F.shadowCameraNear=N.camera.near,F.shadowCameraFar=N.camera.far,r.pointShadow[d]=F,r.pointShadowMap[d]=S,r.pointShadowMatrix[d]=_.shadow.matrix,g++}r.point[d]=Z,d++}else if(_.isHemisphereLight){var U=n.get(_);U.skyColor.copy(_.color).multiplyScalar(M*w),U.groundColor.copy(_.groundColor).multiplyScalar(M*w),r.hemi[A]=U,A++}}p>0&&(t.isWebGL2||!0===e.has("OES_texture_float_linear")?(r.rectAreaLTC1=aa.LTC_FLOAT_1,r.rectAreaLTC2=aa.LTC_FLOAT_2):!0===e.has("OES_texture_half_float_linear")?(r.rectAreaLTC1=aa.LTC_HALF_1,r.rectAreaLTC2=aa.LTC_HALF_2):console.error("THREE.WebGLRenderer: Unable to use RectAreaLight. Missing WebGL extensions.")),r.ambient[0]=s,r.ambient[1]=l,r.ambient[2]=u;var j=r.hash;j.directionalLength===h&&j.pointLength===d&&j.spotLength===f&&j.rectAreaLength===p&&j.hemiLength===A&&j.numDirectionalShadows===v&&j.numPointShadows===g&&j.numSpotShadows===m&&j.numSpotMaps===y||(r.directional.length=h,r.spot.length=f,r.rectArea.length=p,r.point.length=d,r.hemi.length=A,r.directionalShadow.length=v,r.directionalShadowMap.length=v,r.pointShadow.length=g,r.pointShadowMap.length=g,r.spotShadow.length=m,r.spotShadowMap.length=m,r.directionalShadowMatrix.length=v,r.pointShadowMatrix.length=g,r.spotLightMatrix.length=m+y-x,r.spotLightMap.length=y,r.numSpotLightShadowsWithMaps=x,j.directionalLength=h,j.pointLength=d,j.spotLength=f,j.rectAreaLength=p,j.hemiLength=A,j.numDirectionalShadows=v,j.numPointShadows=g,j.numSpotShadows=m,j.numSpotMaps=y,r.version=ps++)},setupView:function(e,t){for(var n=0,i=0,a=0,u=0,c=0,h=t.matrixWorldInverse,d=0,f=e.length;d<f;d++){var p=e[d];if(p.isDirectionalLight){var A=r.directional[n];A.direction.setFromMatrixPosition(p.matrixWorld),o.setFromMatrixPosition(p.target.matrixWorld),A.direction.sub(o),A.direction.transformDirection(h),n++}else if(p.isSpotLight){var v=r.spot[a];v.position.setFromMatrixPosition(p.matrixWorld),v.position.applyMatrix4(h),v.direction.setFromMatrixPosition(p.matrixWorld),o.setFromMatrixPosition(p.target.matrixWorld),v.direction.sub(o),v.direction.transformDirection(h),a++}else if(p.isRectAreaLight){var g=r.rectArea[u];g.position.setFromMatrixPosition(p.matrixWorld),g.position.applyMatrix4(h),l.identity(),s.copy(p.matrixWorld),s.premultiply(h),l.extractRotation(s),g.halfWidth.set(.5*p.width,0,0),g.halfHeight.set(0,.5*p.height,0),g.halfWidth.applyMatrix4(l),g.halfHeight.applyMatrix4(l),u++}else if(p.isPointLight){var m=r.point[i];m.position.setFromMatrixPosition(p.matrixWorld),m.position.applyMatrix4(h),i++}else if(p.isHemisphereLight){var y=r.hemi[c];y.direction.setFromMatrixPosition(p.matrixWorld),y.direction.transformDirection(h),c++}}},state:r}}function gs(e,t){var n=new vs(e,t),i=[],r=[];return{init:function(){i.length=0,r.length=0},state:{lightsArray:i,shadowsArray:r,lights:n},setupLights:function(e){n.setup(i,e)},setupLightsView:function(e){n.setupView(i,e)},pushLight:function(e){i.push(e)},pushShadow:function(e){r.push(e)}}}function ms(e,t){var n=new WeakMap;return{get:function(i){var r,a=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,o=n.get(i);return void 0===o?(r=new gs(e,t),n.set(i,[r])):a>=o.length?(r=new gs(e,t),o.push(r)):r=o[a],r},dispose:function(){n=new WeakMap}}}var ys=function(e){(0,d.Z)(n,e);var t=(0,f.Z)(n);function n(e){var i;return(0,v.Z)(this,n),(i=t.call(this)).isMeshDepthMaterial=!0,i.type="MeshDepthMaterial",i.depthPacking=3200,i.map=null,i.alphaMap=null,i.displacementMap=null,i.displacementScale=1,i.displacementBias=0,i.wireframe=!1,i.wireframeLinewidth=1,i.setValues(e),i}return(0,g.Z)(n,[{key:"copy",value:function(e){return(0,u.Z)((0,c.Z)(n.prototype),"copy",this).call(this,e),this.depthPacking=e.depthPacking,this.map=e.map,this.alphaMap=e.alphaMap,this.displacementMap=e.displacementMap,this.displacementScale=e.displacementScale,this.displacementBias=e.displacementBias,this.wireframe=e.wireframe,this.wireframeLinewidth=e.wireframeLinewidth,this}}]),n}(rr),xs=function(e){(0,d.Z)(n,e);var t=(0,f.Z)(n);function n(e){var i;return(0,v.Z)(this,n),(i=t.call(this)).isMeshDistanceMaterial=!0,i.type="MeshDistanceMaterial",i.referencePosition=new Gn,i.nearDistance=1,i.farDistance=1e3,i.map=null,i.alphaMap=null,i.displacementMap=null,i.displacementScale=1,i.displacementBias=0,i.setValues(e),i}return(0,g.Z)(n,[{key:"copy",value:function(e){return(0,u.Z)((0,c.Z)(n.prototype),"copy",this).call(this,e),this.referencePosition.copy(e.referencePosition),this.nearDistance=e.nearDistance,this.farDistance=e.farDistance,this.map=e.map,this.alphaMap=e.alphaMap,this.displacementMap=e.displacementMap,this.displacementScale=e.displacementScale,this.displacementBias=e.displacementBias,this}}]),n}(rr),ws="void main() {\n\tgl_Position = vec4( position, 1.0 );\n}",Cs="uniform sampler2D shadow_pass;\nuniform vec2 resolution;\nuniform float radius;\n#include <packing>\nvoid main() {\n\tconst float samples = float( VSM_SAMPLES );\n\tfloat mean = 0.0;\n\tfloat squared_mean = 0.0;\n\tfloat uvStride = samples <= 1.0 ? 0.0 : 2.0 / ( samples - 1.0 );\n\tfloat uvStart = samples <= 1.0 ? 0.0 : - 1.0;\n\tfor ( float i = 0.0; i < samples; i ++ ) {\n\t\tfloat uvOffset = uvStart + i * uvStride;\n\t\t#ifdef HORIZONTAL_PASS\n\t\t\tvec2 distribution = unpackRGBATo2Half( texture2D( shadow_pass, ( gl_FragCoord.xy + vec2( uvOffset, 0.0 ) * radius ) / resolution ) );\n\t\t\tmean += distribution.x;\n\t\t\tsquared_mean += distribution.y * distribution.y + distribution.x * distribution.x;\n\t\t#else\n\t\t\tfloat depth = unpackRGBAToDepth( texture2D( shadow_pass, ( gl_FragCoord.xy + vec2( 0.0, uvOffset ) * radius ) / resolution ) );\n\t\t\tmean += depth;\n\t\t\tsquared_mean += depth * depth;\n\t\t#endif\n\t}\n\tmean = mean / samples;\n\tsquared_mean = squared_mean / samples;\n\tfloat std_dev = sqrt( squared_mean - mean * mean );\n\tgl_FragColor = pack2HalfToRGBA( vec2( mean, std_dev ) );\n}";function bs(e,t,n){var i,r=new ea,a=new An,o=new An,s=new Fn,l=new ys({depthPacking:Ut}),u=new xs,c={},h=n.maxTextureSize,d=(i={},(0,p.Z)(i,I,S),(0,p.Z)(i,S,I),(0,p.Z)(i,k,k),i),f=new jr({defines:{VSM_SAMPLES:8},uniforms:{shadow_pass:{value:null},resolution:{value:new An},radius:{value:4}},vertexShader:ws,fragmentShader:Cs}),A=f.clone();A.defines.HORIZONTAL_PASS=1;var v=new xr;v.setAttribute("position",new lr(new Float32Array([-1,-1,.5,3,-1,.5,-1,3,.5]),3));var g=new Pr(v,f),m=this;function y(n,i){var r=t.update(g);f.defines.VSM_SAMPLES!==n.blurSamples&&(f.defines.VSM_SAMPLES=n.blurSamples,A.defines.VSM_SAMPLES=n.blurSamples,f.needsUpdate=!0,A.needsUpdate=!0),null===n.mapPass&&(n.mapPass=new Un(a.x,a.y)),f.uniforms.shadow_pass.value=n.map.texture,f.uniforms.resolution.value=n.mapSize,f.uniforms.radius.value=n.radius,e.setRenderTarget(n.mapPass),e.clear(),e.renderBufferDirect(i,null,r,f,g,null),A.uniforms.shadow_pass.value=n.mapPass.texture,A.uniforms.resolution.value=n.mapSize,A.uniforms.radius.value=n.radius,e.setRenderTarget(n.map),e.clear(),e.renderBufferDirect(i,null,r,A,g,null)}function x(t,n,i,r,a,o){var s=null,h=!0===i.isPointLight?t.customDistanceMaterial:t.customDepthMaterial;if(void 0!==h)s=h;else if(s=!0===i.isPointLight?u:l,e.localClippingEnabled&&!0===n.clipShadows&&Array.isArray(n.clippingPlanes)&&0!==n.clippingPlanes.length||n.displacementMap&&0!==n.displacementScale||n.alphaMap&&n.alphaTest>0||n.map&&n.alphaTest>0){var f=s.uuid,p=n.uuid,A=c[f];void 0===A&&(A={},c[f]=A);var v=A[p];void 0===v&&(v=s.clone(),A[p]=v),s=v}return s.visible=n.visible,s.wireframe=n.wireframe,s.side=o===M?null!==n.shadowSide?n.shadowSide:n.side:null!==n.shadowSide?n.shadowSide:d[n.side],s.alphaMap=n.alphaMap,s.alphaTest=n.alphaTest,s.map=n.map,s.clipShadows=n.clipShadows,s.clippingPlanes=n.clippingPlanes,s.clipIntersection=n.clipIntersection,s.displacementMap=n.displacementMap,s.displacementScale=n.displacementScale,s.displacementBias=n.displacementBias,s.wireframeLinewidth=n.wireframeLinewidth,s.linewidth=n.linewidth,!0===i.isPointLight&&!0===s.isMeshDistanceMaterial&&(s.referencePosition.setFromMatrixPosition(i.matrixWorld),s.nearDistance=r,s.farDistance=a),s}function w(n,i,a,o,s){if(!1!==n.visible){if(n.layers.test(i.layers)&&(n.isMesh||n.isLine||n.isPoints)&&(n.castShadow||n.receiveShadow&&s===M)&&(!n.frustumCulled||r.intersectsObject(n))){n.modelViewMatrix.multiplyMatrices(a.matrixWorldInverse,n.matrixWorld);var l=t.update(n),u=n.material;if(Array.isArray(u))for(var c=l.groups,h=0,d=c.length;h<d;h++){var f=c[h],p=u[f.materialIndex];if(p&&p.visible){var A=x(n,p,o,a.near,a.far,s);e.renderBufferDirect(a,null,l,A,n,f)}}else if(u.visible){var v=x(n,u,o,a.near,a.far,s);e.renderBufferDirect(a,null,l,v,n,null)}}for(var g=n.children,m=0,y=g.length;m<y;m++)w(g[m],i,a,o,s)}}this.enabled=!1,this.autoUpdate=!0,this.needsUpdate=!1,this.type=_,this.render=function(t,n,i){if(!1!==m.enabled&&(!1!==m.autoUpdate||!1!==m.needsUpdate)&&0!==t.length){var l=e.getRenderTarget(),u=e.getActiveCubeFace(),c=e.getActiveMipmapLevel(),d=e.state;d.setBlending(B),d.buffers.color.setClear(1,1,1,1),d.buffers.depth.setTest(!0),d.setScissorTest(!1);for(var f=0,p=t.length;f<p;f++){var A=t[f],v=A.shadow;if(void 0!==v){if(!1!==v.autoUpdate||!1!==v.needsUpdate){a.copy(v.mapSize);var g=v.getFrameExtents();if(a.multiply(g),o.copy(v.mapSize),(a.x>h||a.y>h)&&(a.x>h&&(o.x=Math.floor(h/g.x),a.x=o.x*g.x,v.mapSize.x=o.x),a.y>h&&(o.y=Math.floor(h/g.y),a.y=o.y*g.y,v.mapSize.y=o.y)),null===v.map){var x=this.type!==M?{minFilter:be,magFilter:be}:{};v.map=new Un(a.x,a.y,x),v.map.texture.name=A.name+".shadowMap",v.camera.updateProjectionMatrix()}e.setRenderTarget(v.map),e.clear();for(var C=v.getViewportCount(),b=0;b<C;b++){var _=v.getViewport(b);s.set(o.x*_.x,o.y*_.y,o.x*_.z,o.y*_.w),d.viewport(s),v.updateMatrices(A,b),r=v.getFrustum(),w(n,i,v.camera,A,this.type)}!0!==v.isPointLightShadow&&this.type===M&&y(v,i),v.needsUpdate=!1}}else console.warn("THREE.WebGLShadowMap:",A,"has no shadow.")}m.needsUpdate=!1,e.setRenderTarget(l,u,c)}}}function _s(e,t,n){var i,r,a=n.isWebGL2;var o=new function(){var t=!1,n=new Fn,i=null,r=new Fn(0,0,0,0);return{setMask:function(n){i===n||t||(e.colorMask(n,n,n,n),i=n)},setLocked:function(e){t=e},setClear:function(t,i,a,o,s){!0===s&&(t*=o,i*=o,a*=o),n.set(t,i,a,o),!1===r.equals(n)&&(e.clearColor(t,i,a,o),r.copy(n))},reset:function(){t=!1,i=null,r.set(-1,0,0,0)}}},s=new function(){var t=!1,n=null,i=null,r=null;return{setTest:function(e){e?_e(2929):Ee(2929)},setMask:function(i){n===i||t||(e.depthMask(i),n=i)},setFunc:function(t){if(i!==t){switch(t){case K:e.depthFunc(512);break;case $:e.depthFunc(519);break;case ee:e.depthFunc(513);break;case te:e.depthFunc(515);break;case ne:e.depthFunc(514);break;case ie:e.depthFunc(518);break;case re:e.depthFunc(516);break;case ae:e.depthFunc(517);break;default:e.depthFunc(515)}i=t}},setLocked:function(e){t=e},setClear:function(t){r!==t&&(e.clearDepth(t),r=t)},reset:function(){t=!1,n=null,i=null,r=null}}},l=new function(){var t=!1,n=null,i=null,r=null,a=null,o=null,s=null,l=null,u=null;return{setTest:function(e){t||(e?_e(2960):Ee(2960))},setMask:function(i){n===i||t||(e.stencilMask(i),n=i)},setFunc:function(t,n,o){i===t&&r===n&&a===o||(e.stencilFunc(t,n,o),i=t,r=n,a=o)},setOp:function(t,n,i){o===t&&s===n&&l===i||(e.stencilOp(t,n,i),o=t,s=n,l=i)},setLocked:function(e){t=e},setClear:function(t){u!==t&&(e.clearStencil(t),u=t)},reset:function(){t=!1,n=null,i=null,r=null,a=null,o=null,s=null,l=null,u=null}}},u=new WeakMap,c=new WeakMap,h={},d={},f=new WeakMap,A=[],v=null,g=!1,m=null,y=null,x=null,_=null,E=null,M=null,I=null,oe=!1,se=null,le=null,ue=null,ce=null,he=null,de=e.getParameter(35661),fe=!1,pe=0,Ae=e.getParameter(7938);-1!==Ae.indexOf("WebGL")?(pe=parseFloat(/^WebGL (\d)/.exec(Ae)[1]),fe=pe>=1):-1!==Ae.indexOf("OpenGL ES")&&(pe=parseFloat(/^OpenGL ES (\d)/.exec(Ae)[1]),fe=pe>=2);var ve=null,ge={},me=e.getParameter(3088),ye=e.getParameter(2978),xe=(new Fn).fromArray(me),we=(new Fn).fromArray(ye);function Ce(t,n,i){var r=new Uint8Array(4),a=e.createTexture();e.bindTexture(t,a),e.texParameteri(t,10241,9728),e.texParameteri(t,10240,9728);for(var o=0;o<i;o++)e.texImage2D(n+o,0,6408,1,1,0,6408,5121,r);return a}var be={};function _e(t){!0!==h[t]&&(e.enable(t),h[t]=!0)}function Ee(t){!1!==h[t]&&(e.disable(t),h[t]=!1)}be[3553]=Ce(3553,3553,1),be[34067]=Ce(34067,34069,6),o.setClear(0,0,0,1),s.setClear(1),l.setClear(0),_e(2929),s.setFunc(te),Be(!1),Te(C),_e(2884),ke(B);var Me=(i={},(0,p.Z)(i,Q,32774),(0,p.Z)(i,Z,32778),(0,p.Z)(i,N,32779),i);if(a)Me[F]=32775,Me[U]=32776;else{var Ie=t.get("EXT_blend_minmax");null!==Ie&&(Me[F]=Ie.MIN_EXT,Me[U]=Ie.MAX_EXT)}var Se=(r={},(0,p.Z)(r,j,0),(0,p.Z)(r,O,1),(0,p.Z)(r,z,768),(0,p.Z)(r,H,770),(0,p.Z)(r,X,776),(0,p.Z)(r,Y,774),(0,p.Z)(r,W,772),(0,p.Z)(r,G,769),(0,p.Z)(r,V,771),(0,p.Z)(r,J,775),(0,p.Z)(r,q,773),r);function ke(t,n,i,r,a,o,s,l){if(t!==B){if(!1===g&&(_e(3042),g=!0),t===L)a=a||n,o=o||i,s=s||r,n===y&&a===E||(e.blendEquationSeparate(Me[n],Me[a]),y=n,E=a),i===x&&r===_&&o===M&&s===I||(e.blendFuncSeparate(Se[i],Se[r],Se[o],Se[s]),x=i,_=r,M=o,I=s),m=t,oe=!1;else if(t!==m||l!==oe){if(y===Q&&E===Q||(e.blendEquation(32774),y=Q,E=Q),l)switch(t){case T:e.blendFuncSeparate(1,771,1,771);break;case D:e.blendFunc(1,1);break;case R:e.blendFuncSeparate(0,769,0,1);break;case P:e.blendFuncSeparate(0,768,0,770);break;default:console.error("THREE.WebGLState: Invalid blending: ",t)}else switch(t){case T:e.blendFuncSeparate(770,771,1,771);break;case D:e.blendFunc(770,1);break;case R:e.blendFuncSeparate(0,769,0,1);break;case P:e.blendFunc(0,768);break;default:console.error("THREE.WebGLState: Invalid blending: ",t)}x=null,_=null,M=null,I=null,m=t,oe=l}}else!0===g&&(Ee(3042),g=!1)}function Be(t){se!==t&&(t?e.frontFace(2304):e.frontFace(2305),se=t)}function Te(t){t!==w?(_e(2884),t!==le&&(t===C?e.cullFace(1029):t===b?e.cullFace(1028):e.cullFace(1032))):Ee(2884),le=t}function De(t,n,i){t?(_e(32823),ce===n&&he===i||(e.polygonOffset(n,i),ce=n,he=i)):Ee(32823)}return{buffers:{color:o,depth:s,stencil:l},enable:_e,disable:Ee,bindFramebuffer:function(t,n){return d[t]!==n&&(e.bindFramebuffer(t,n),d[t]=n,a&&(36009===t&&(d[36160]=n),36160===t&&(d[36009]=n)),!0)},drawBuffers:function(i,r){var a=A,o=!1;if(i)if(void 0===(a=f.get(r))&&(a=[],f.set(r,a)),i.isWebGLMultipleRenderTargets){var s=i.texture;if(a.length!==s.length||36064!==a[0]){for(var l=0,u=s.length;l<u;l++)a[l]=36064+l;a.length=s.length,o=!0}}else 36064!==a[0]&&(a[0]=36064,o=!0);else 1029!==a[0]&&(a[0]=1029,o=!0);o&&(n.isWebGL2?e.drawBuffers(a):t.get("WEBGL_draw_buffers").drawBuffersWEBGL(a))},useProgram:function(t){return v!==t&&(e.useProgram(t),v=t,!0)},setBlending:ke,setMaterial:function(e,t){e.side===k?Ee(2884):_e(2884);var n=e.side===S;t&&(n=!n),Be(n),e.blending===T&&!1===e.transparent?ke(B):ke(e.blending,e.blendEquation,e.blendSrc,e.blendDst,e.blendEquationAlpha,e.blendSrcAlpha,e.blendDstAlpha,e.premultipliedAlpha),s.setFunc(e.depthFunc),s.setTest(e.depthTest),s.setMask(e.depthWrite),o.setMask(e.colorWrite);var i=e.stencilWrite;l.setTest(i),i&&(l.setMask(e.stencilWriteMask),l.setFunc(e.stencilFunc,e.stencilRef,e.stencilFuncMask),l.setOp(e.stencilFail,e.stencilZFail,e.stencilZPass)),De(e.polygonOffset,e.polygonOffsetFactor,e.polygonOffsetUnits),!0===e.alphaToCoverage?_e(32926):Ee(32926)},setFlipSided:Be,setCullFace:Te,setLineWidth:function(t){t!==ue&&(fe&&e.lineWidth(t),ue=t)},setPolygonOffset:De,setScissorTest:function(e){e?_e(3089):Ee(3089)},activeTexture:function(t){void 0===t&&(t=33984+de-1),ve!==t&&(e.activeTexture(t),ve=t)},bindTexture:function(t,n,i){void 0===i&&(i=null===ve?33984+de-1:ve);var r=ge[i];void 0===r&&(r={type:void 0,texture:void 0},ge[i]=r),r.type===t&&r.texture===n||(ve!==i&&(e.activeTexture(i),ve=i),e.bindTexture(t,n||be[t]),r.type=t,r.texture=n)},unbindTexture:function(){var t=ge[ve];void 0!==t&&void 0!==t.type&&(e.bindTexture(t.type,null),t.type=void 0,t.texture=void 0)},compressedTexImage2D:function(){try{e.compressedTexImage2D.apply(e,arguments)}catch(t){console.error("THREE.WebGLState:",t)}},compressedTexImage3D:function(){try{e.compressedTexImage3D.apply(e,arguments)}catch(t){console.error("THREE.WebGLState:",t)}},texImage2D:function(){try{e.texImage2D.apply(e,arguments)}catch(t){console.error("THREE.WebGLState:",t)}},texImage3D:function(){try{e.texImage3D.apply(e,arguments)}catch(t){console.error("THREE.WebGLState:",t)}},updateUBOMapping:function(t,n){var i=c.get(n);void 0===i&&(i=new WeakMap,c.set(n,i));var r=i.get(t);void 0===r&&(r=e.getUniformBlockIndex(n,t.name),i.set(t,r))},uniformBlockBinding:function(t,n){var i=c.get(n).get(t);u.get(n)!==i&&(e.uniformBlockBinding(n,i,t.__bindingPointIndex),u.set(n,i))},texStorage2D:function(){try{e.texStorage2D.apply(e,arguments)}catch(t){console.error("THREE.WebGLState:",t)}},texStorage3D:function(){try{e.texStorage3D.apply(e,arguments)}catch(t){console.error("THREE.WebGLState:",t)}},texSubImage2D:function(){try{e.texSubImage2D.apply(e,arguments)}catch(t){console.error("THREE.WebGLState:",t)}},texSubImage3D:function(){try{e.texSubImage3D.apply(e,arguments)}catch(t){console.error("THREE.WebGLState:",t)}},compressedTexSubImage2D:function(){try{e.compressedTexSubImage2D.apply(e,arguments)}catch(t){console.error("THREE.WebGLState:",t)}},compressedTexSubImage3D:function(){try{e.compressedTexSubImage3D.apply(e,arguments)}catch(t){console.error("THREE.WebGLState:",t)}},scissor:function(t){!1===xe.equals(t)&&(e.scissor(t.x,t.y,t.z,t.w),xe.copy(t))},viewport:function(t){!1===we.equals(t)&&(e.viewport(t.x,t.y,t.z,t.w),we.copy(t))},reset:function(){e.disable(3042),e.disable(2884),e.disable(2929),e.disable(32823),e.disable(3089),e.disable(2960),e.disable(32926),e.blendEquation(32774),e.blendFunc(1,0),e.blendFuncSeparate(1,0,1,0),e.colorMask(!0,!0,!0,!0),e.clearColor(0,0,0,0),e.depthMask(!0),e.depthFunc(513),e.clearDepth(1),e.stencilMask(4294967295),e.stencilFunc(519,0,4294967295),e.stencilOp(7680,7680,7680),e.clearStencil(0),e.cullFace(1029),e.frontFace(2305),e.polygonOffset(0,0),e.activeTexture(33984),e.bindFramebuffer(36160,null),!0===a&&(e.bindFramebuffer(36009,null),e.bindFramebuffer(36008,null)),e.useProgram(null),e.lineWidth(1),e.scissor(0,0,e.canvas.width,e.canvas.height),e.viewport(0,0,e.canvas.width,e.canvas.height),h={},ve=null,ge={},d={},f=new WeakMap,A=[],v=null,g=!1,m=null,y=null,x=null,_=null,E=null,M=null,I=null,oe=!1,se=null,le=null,ue=null,ce=null,he=null,xe.set(0,0,e.canvas.width,e.canvas.height),we.set(0,0,e.canvas.width,e.canvas.height),o.reset(),s.reset(),l.reset()}}}function Es(e,t,n,i,r,a,o){var s,l,u,c=r.isWebGL2,h=r.maxTextures,d=r.maxCubemapSize,f=r.maxTextureSize,A=r.maxSamples,v=t.has("WEBGL_multisampled_render_to_texture")?t.get("WEBGL_multisampled_render_to_texture"):null,g="undefined"!==typeof navigator&&/OculusBrowser/g.test(navigator.userAgent),m=new WeakMap,y=new WeakMap,x=!1;try{x="undefined"!==typeof OffscreenCanvas&&null!==new OffscreenCanvas(1,1).getContext("2d")}catch(H){}function w(e,t){return x?new OffscreenCanvas(e,t):wn("canvas")}function C(e,t,n,i){var r=1;if((e.width>i||e.height>i)&&(r=i/Math.max(e.width,e.height)),r<1||!0===t){if("undefined"!==typeof HTMLImageElement&&e instanceof HTMLImageElement||"undefined"!==typeof HTMLCanvasElement&&e instanceof HTMLCanvasElement||"undefined"!==typeof ImageBitmap&&e instanceof ImageBitmap){var a=t?hn:Math.floor,o=a(r*e.width),s=a(r*e.height);void 0===u&&(u=w(o,s));var l=n?w(o,s):u;return l.width=o,l.height=s,l.getContext("2d").drawImage(e,0,0,o,s),console.warn("THREE.WebGLRenderer: Texture has been resized from ("+e.width+"x"+e.height+") to ("+o+"x"+s+")."),l}return"data"in e&&console.warn("THREE.WebGLRenderer: Image in DataTexture is too big ("+e.width+"x"+e.height+")."),e}return e}function b(e){return un(e.width)&&un(e.height)}function _(e,t){return e.generateMipmaps&&t&&e.minFilter!==be&&e.minFilter!==Me}function E(t){e.generateMipmap(t)}function M(n,i,r,a){var o=arguments.length>4&&void 0!==arguments[4]&&arguments[4];if(!1===c)return i;if(null!==n){if(void 0!==e[n])return e[n];console.warn("THREE.WebGLRenderer: Attempt to use non-existing WebGL internal format '"+n+"'")}var s=i;return 6403===i&&(5126===r&&(s=33326),5131===r&&(s=33325),5121===r&&(s=33321)),33319===i&&(5126===r&&(s=33328),5131===r&&(s=33327),5121===r&&(s=33323)),6408===i&&(5126===r&&(s=34836),5131===r&&(s=34842),5121===r&&(s=a===Ft&&!1===o?35907:32856),32819===r&&(s=32854),32820===r&&(s=32855)),33325!==s&&33326!==s&&33327!==s&&33328!==s&&34842!==s&&34836!==s||t.get("EXT_color_buffer_float"),s}function I(e,t,n){return!0===_(e,n)||e.isFramebufferTexture&&e.minFilter!==be&&e.minFilter!==Me?Math.log2(Math.max(t.width,t.height))+1:void 0!==e.mipmaps&&e.mipmaps.length>0?e.mipmaps.length:e.isCompressedTexture&&Array.isArray(e.image)?t.mipmaps.length:1}function S(e){return e===be||e===_e||e===Ee?9728:9729}function k(e){var t=e.target;t.removeEventListener("dispose",k),function(e){var t=i.get(e);if(void 0===t.__webglInit)return;var n=e.source,r=y.get(n);if(r){var a=r[t.__cacheKey];a.usedTimes--,0===a.usedTimes&&T(e),0===Object.keys(r).length&&y.delete(n)}i.remove(e)}(t),t.isVideoTexture&&m.delete(t)}function B(t){var n=t.target;n.removeEventListener("dispose",B),function(t){var n=t.texture,r=i.get(t),a=i.get(n);void 0!==a.__webglTexture&&(e.deleteTexture(a.__webglTexture),o.memory.textures--);t.depthTexture&&t.depthTexture.dispose();if(t.isWebGLCubeRenderTarget)for(var s=0;s<6;s++)e.deleteFramebuffer(r.__webglFramebuffer[s]),r.__webglDepthbuffer&&e.deleteRenderbuffer(r.__webglDepthbuffer[s]);else{if(e.deleteFramebuffer(r.__webglFramebuffer),r.__webglDepthbuffer&&e.deleteRenderbuffer(r.__webglDepthbuffer),r.__webglMultisampledFramebuffer&&e.deleteFramebuffer(r.__webglMultisampledFramebuffer),r.__webglColorRenderbuffer)for(var l=0;l<r.__webglColorRenderbuffer.length;l++)r.__webglColorRenderbuffer[l]&&e.deleteRenderbuffer(r.__webglColorRenderbuffer[l]);r.__webglDepthRenderbuffer&&e.deleteRenderbuffer(r.__webglDepthRenderbuffer)}if(t.isWebGLMultipleRenderTargets)for(var u=0,c=n.length;u<c;u++){var h=i.get(n[u]);h.__webglTexture&&(e.deleteTexture(h.__webglTexture),o.memory.textures--),i.remove(n[u])}i.remove(n),i.remove(t)}(n)}function T(t){var n=i.get(t);e.deleteTexture(n.__webglTexture);var r=t.source;delete y.get(r)[n.__cacheKey],o.memory.textures--}var D=0;function R(e,t){var r=i.get(e);if(e.isVideoTexture&&function(e){var t=o.render.frame;m.get(e)!==t&&(m.set(e,t),e.update())}(e),!1===e.isRenderTargetTexture&&e.version>0&&r.__version!==e.version){var a=e.image;if(null===a)console.warn("THREE.WebGLRenderer: Texture marked for update but no image data found.");else{if(!1!==a.complete)return void N(r,e,t);console.warn("THREE.WebGLRenderer: Texture marked for update but image is incomplete")}}n.bindTexture(3553,r.__webglTexture,33984+t)}var P=(s={},(0,p.Z)(s,xe,10497),(0,p.Z)(s,we,33071),(0,p.Z)(s,Ce,33648),s),L=(l={},(0,p.Z)(l,be,9728),(0,p.Z)(l,_e,9984),(0,p.Z)(l,Ee,9986),(0,p.Z)(l,Me,9729),(0,p.Z)(l,Ie,9985),(0,p.Z)(l,Se,9987),l);function Q(n,a,o){if(o?(e.texParameteri(n,10242,P[a.wrapS]),e.texParameteri(n,10243,P[a.wrapT]),32879!==n&&35866!==n||e.texParameteri(n,32882,P[a.wrapR]),e.texParameteri(n,10240,L[a.magFilter]),e.texParameteri(n,10241,L[a.minFilter])):(e.texParameteri(n,10242,33071),e.texParameteri(n,10243,33071),32879!==n&&35866!==n||e.texParameteri(n,32882,33071),a.wrapS===we&&a.wrapT===we||console.warn("THREE.WebGLRenderer: Texture is not power of two. Texture.wrapS and Texture.wrapT should be set to THREE.ClampToEdgeWrapping."),e.texParameteri(n,10240,S(a.magFilter)),e.texParameteri(n,10241,S(a.minFilter)),a.minFilter!==be&&a.minFilter!==Me&&console.warn("THREE.WebGLRenderer: Texture is not power of two. Texture.minFilter should be set to THREE.NearestFilter or THREE.LinearFilter.")),!0===t.has("EXT_texture_filter_anisotropic")){var s=t.get("EXT_texture_filter_anisotropic");if(a.magFilter===be)return;if(a.minFilter!==Ee&&a.minFilter!==Se)return;if(a.type===Le&&!1===t.has("OES_texture_float_linear"))return;if(!1===c&&a.type===Qe&&!1===t.has("OES_texture_half_float_linear"))return;(a.anisotropy>1||i.get(a).__currentAnisotropy)&&(e.texParameterf(n,s.TEXTURE_MAX_ANISOTROPY_EXT,Math.min(a.anisotropy,r.getMaxAnisotropy())),i.get(a).__currentAnisotropy=a.anisotropy)}}function Z(t,n){var i=!1;void 0===t.__webglInit&&(t.__webglInit=!0,n.addEventListener("dispose",k));var r=n.source,a=y.get(r);void 0===a&&(a={},y.set(r,a));var s=function(e){var t=[];return t.push(e.wrapS),t.push(e.wrapT),t.push(e.wrapR||0),t.push(e.magFilter),t.push(e.minFilter),t.push(e.anisotropy),t.push(e.internalFormat),t.push(e.format),t.push(e.type),t.push(e.generateMipmaps),t.push(e.premultiplyAlpha),t.push(e.flipY),t.push(e.unpackAlignment),t.push(e.encoding),t.join()}(n);if(s!==t.__cacheKey){void 0===a[s]&&(a[s]={texture:e.createTexture(),usedTimes:0},o.memory.textures++,i=!0),a[s].usedTimes++;var l=a[t.__cacheKey];void 0!==l&&(a[t.__cacheKey].usedTimes--,0===l.usedTimes&&T(n)),t.__cacheKey=s,t.__webglTexture=a[s].texture}return i}function N(t,r,o){var s=3553;(r.isDataArrayTexture||r.isCompressedArrayTexture)&&(s=35866),r.isData3DTexture&&(s=32879);var l=Z(t,r),u=r.source;n.bindTexture(s,t.__webglTexture,33984+o);var h=i.get(u);if(u.version!==h.__version||!0===l){n.activeTexture(33984+o),e.pixelStorei(37440,r.flipY),e.pixelStorei(37441,r.premultiplyAlpha),e.pixelStorei(3317,r.unpackAlignment),e.pixelStorei(37443,0);var d,p=function(e){return!c&&(e.wrapS!==we||e.wrapT!==we||e.minFilter!==be&&e.minFilter!==Me)}(r)&&!1===b(r.image),A=C(r.image,p,!1,f),v=b(A=G(r,A))||c,g=a.convert(r.format,r.encoding),m=a.convert(r.type),y=M(r.internalFormat,g,m,r.encoding,r.isVideoTexture);Q(s,r,v);var x=r.mipmaps,w=c&&!0!==r.isVideoTexture,S=void 0===h.__version||!0===l,k=I(r,A,v);if(r.isDepthTexture)y=6402,c?y=r.type===Le?36012:r.type===Pe?33190:r.type===Fe?35056:33189:r.type===Le&&console.error("WebGLRenderer: Floating point depth texture requires WebGL2."),r.format===Ge&&6402===y&&r.type!==De&&r.type!==Pe&&(console.warn("THREE.WebGLRenderer: Use UnsignedShortType or UnsignedIntType for DepthFormat DepthTexture."),r.type=Pe,m=a.convert(r.type)),r.format===He&&6402===y&&(y=34041,r.type!==Fe&&(console.warn("THREE.WebGLRenderer: Use UnsignedInt248Type for DepthStencilFormat DepthTexture."),r.type=Fe,m=a.convert(r.type))),S&&(w?n.texStorage2D(3553,1,y,A.width,A.height):n.texImage2D(3553,0,y,A.width,A.height,0,g,m,null));else if(r.isDataTexture)if(x.length>0&&v){w&&S&&n.texStorage2D(3553,k,y,x[0].width,x[0].height);for(var B=0,T=x.length;B<T;B++)d=x[B],w?n.texSubImage2D(3553,B,0,0,d.width,d.height,g,m,d.data):n.texImage2D(3553,B,y,d.width,d.height,0,g,m,d.data);r.generateMipmaps=!1}else w?(S&&n.texStorage2D(3553,k,y,A.width,A.height),n.texSubImage2D(3553,0,0,0,A.width,A.height,g,m,A.data)):n.texImage2D(3553,0,y,A.width,A.height,0,g,m,A.data);else if(r.isCompressedTexture)if(r.isCompressedArrayTexture){w&&S&&n.texStorage3D(35866,k,y,x[0].width,x[0].height,A.depth);for(var D=0,R=x.length;D<R;D++)d=x[D],r.format!==je?null!==g?w?n.compressedTexSubImage3D(35866,D,0,0,0,d.width,d.height,A.depth,g,d.data,0,0):n.compressedTexImage3D(35866,D,y,d.width,d.height,A.depth,0,d.data,0,0):console.warn("THREE.WebGLRenderer: Attempt to load unsupported compressed texture format in .uploadTexture()"):w?n.texSubImage3D(35866,D,0,0,0,d.width,d.height,A.depth,g,m,d.data):n.texImage3D(35866,D,y,d.width,d.height,A.depth,0,g,m,d.data)}else{w&&S&&n.texStorage2D(3553,k,y,x[0].width,x[0].height);for(var P=0,L=x.length;P<L;P++)d=x[P],r.format!==je?null!==g?w?n.compressedTexSubImage2D(3553,P,0,0,d.width,d.height,g,d.data):n.compressedTexImage2D(3553,P,y,d.width,d.height,0,d.data):console.warn("THREE.WebGLRenderer: Attempt to load unsupported compressed texture format in .uploadTexture()"):w?n.texSubImage2D(3553,P,0,0,d.width,d.height,g,m,d.data):n.texImage2D(3553,P,y,d.width,d.height,0,g,m,d.data)}else if(r.isDataArrayTexture)w?(S&&n.texStorage3D(35866,k,y,A.width,A.height,A.depth),n.texSubImage3D(35866,0,0,0,0,A.width,A.height,A.depth,g,m,A.data)):n.texImage3D(35866,0,y,A.width,A.height,A.depth,0,g,m,A.data);else if(r.isData3DTexture)w?(S&&n.texStorage3D(32879,k,y,A.width,A.height,A.depth),n.texSubImage3D(32879,0,0,0,0,A.width,A.height,A.depth,g,m,A.data)):n.texImage3D(32879,0,y,A.width,A.height,A.depth,0,g,m,A.data);else if(r.isFramebufferTexture){if(S)if(w)n.texStorage2D(3553,k,y,A.width,A.height);else for(var N=A.width,F=A.height,U=0;U<k;U++)n.texImage2D(3553,U,y,N,F,0,g,m,null),N>>=1,F>>=1}else if(x.length>0&&v){w&&S&&n.texStorage2D(3553,k,y,x[0].width,x[0].height);for(var j=0,O=x.length;j<O;j++)d=x[j],w?n.texSubImage2D(3553,j,0,0,g,m,d):n.texImage2D(3553,j,y,g,m,d);r.generateMipmaps=!1}else w?(S&&n.texStorage2D(3553,k,y,A.width,A.height),n.texSubImage2D(3553,0,0,0,g,m,A)):n.texImage2D(3553,0,y,g,m,A);_(r,v)&&E(s),h.__version=u.version,r.onUpdate&&r.onUpdate(r)}t.__version=r.version}function F(t,r,o,s,l){var u=a.convert(o.format,o.encoding),c=a.convert(o.type),h=M(o.internalFormat,u,c,o.encoding);i.get(r).__hasExternalTextures||(32879===l||35866===l?n.texImage3D(l,0,h,r.width,r.height,r.depth,0,u,c,null):n.texImage2D(l,0,h,r.width,r.height,0,u,c,null)),n.bindFramebuffer(36160,t),z(r)?v.framebufferTexture2DMultisampleEXT(36160,s,l,i.get(o).__webglTexture,0,O(r)):(3553===l||l>=34069&&l<=34074)&&e.framebufferTexture2D(36160,s,l,i.get(o).__webglTexture,0),n.bindFramebuffer(36160,null)}function U(t,n,i){if(e.bindRenderbuffer(36161,t),n.depthBuffer&&!n.stencilBuffer){var r=33189;if(i||z(n)){var o=n.depthTexture;o&&o.isDepthTexture&&(o.type===Le?r=36012:o.type===Pe&&(r=33190));var s=O(n);z(n)?v.renderbufferStorageMultisampleEXT(36161,s,r,n.width,n.height):e.renderbufferStorageMultisample(36161,s,r,n.width,n.height)}else e.renderbufferStorage(36161,r,n.width,n.height);e.framebufferRenderbuffer(36160,36096,36161,t)}else if(n.depthBuffer&&n.stencilBuffer){var l=O(n);i&&!1===z(n)?e.renderbufferStorageMultisample(36161,l,35056,n.width,n.height):z(n)?v.renderbufferStorageMultisampleEXT(36161,l,35056,n.width,n.height):e.renderbufferStorage(36161,34041,n.width,n.height),e.framebufferRenderbuffer(36160,33306,36161,t)}else for(var u=!0===n.isWebGLMultipleRenderTargets?n.texture:[n.texture],c=0;c<u.length;c++){var h=u[c],d=a.convert(h.format,h.encoding),f=a.convert(h.type),p=M(h.internalFormat,d,f,h.encoding),A=O(n);i&&!1===z(n)?e.renderbufferStorageMultisample(36161,A,p,n.width,n.height):z(n)?v.renderbufferStorageMultisampleEXT(36161,A,p,n.width,n.height):e.renderbufferStorage(36161,p,n.width,n.height)}e.bindRenderbuffer(36161,null)}function j(t){var r=i.get(t),a=!0===t.isWebGLCubeRenderTarget;if(t.depthTexture&&!r.__autoAllocateDepthBuffer){if(a)throw new Error("target.depthTexture not supported in Cube render targets");!function(t,r){if(r&&r.isWebGLCubeRenderTarget)throw new Error("Depth Texture with cube render targets is not supported");if(n.bindFramebuffer(36160,t),!r.depthTexture||!r.depthTexture.isDepthTexture)throw new Error("renderTarget.depthTexture must be an instance of THREE.DepthTexture");i.get(r.depthTexture).__webglTexture&&r.depthTexture.image.width===r.width&&r.depthTexture.image.height===r.height||(r.depthTexture.image.width=r.width,r.depthTexture.image.height=r.height,r.depthTexture.needsUpdate=!0),R(r.depthTexture,0);var a=i.get(r.depthTexture).__webglTexture,o=O(r);if(r.depthTexture.format===Ge)z(r)?v.framebufferTexture2DMultisampleEXT(36160,36096,3553,a,0,o):e.framebufferTexture2D(36160,36096,3553,a,0);else{if(r.depthTexture.format!==He)throw new Error("Unknown depthTexture format");z(r)?v.framebufferTexture2DMultisampleEXT(36160,33306,3553,a,0,o):e.framebufferTexture2D(36160,33306,3553,a,0)}}(r.__webglFramebuffer,t)}else if(a){r.__webglDepthbuffer=[];for(var o=0;o<6;o++)n.bindFramebuffer(36160,r.__webglFramebuffer[o]),r.__webglDepthbuffer[o]=e.createRenderbuffer(),U(r.__webglDepthbuffer[o],t,!1)}else n.bindFramebuffer(36160,r.__webglFramebuffer),r.__webglDepthbuffer=e.createRenderbuffer(),U(r.__webglDepthbuffer,t,!1);n.bindFramebuffer(36160,null)}function O(e){return Math.min(A,e.samples)}function z(e){var n=i.get(e);return c&&e.samples>0&&!0===t.has("WEBGL_multisampled_render_to_texture")&&!1!==n.__useRenderToTexture}function G(e,n){var i=e.encoding,r=e.format,a=e.type;return!0===e.isCompressedTexture||!0===e.isVideoTexture||e.format===qt||i!==Nt&&(i===Ft?!1===c?!0===t.has("EXT_sRGB")&&r===je?(e.format=qt,e.minFilter=Me,e.generateMipmaps=!1):n=Pn.sRGBToLinear(n):r===je&&a===ke||console.warn("THREE.WebGLTextures: sRGB encoded textures have to use RGBAFormat and UnsignedByteType."):console.error("THREE.WebGLTextures: Unsupported texture encoding:",i)),n}this.allocateTextureUnit=function(){var e=D;return e>=h&&console.warn("THREE.WebGLTextures: Trying to use "+e+" texture units while this GPU supports only "+h),D+=1,e},this.resetTextureUnits=function(){D=0},this.setTexture2D=R,this.setTexture2DArray=function(e,t){var r=i.get(e);e.version>0&&r.__version!==e.version?N(r,e,t):n.bindTexture(35866,r.__webglTexture,33984+t)},this.setTexture3D=function(e,t){var r=i.get(e);e.version>0&&r.__version!==e.version?N(r,e,t):n.bindTexture(32879,r.__webglTexture,33984+t)},this.setTextureCube=function(t,r){var o=i.get(t);t.version>0&&o.__version!==t.version?function(t,r,o){if(6!==r.image.length)return;var s=Z(t,r),l=r.source;n.bindTexture(34067,t.__webglTexture,33984+o);var u=i.get(l);if(l.version!==u.__version||!0===s){n.activeTexture(33984+o),e.pixelStorei(37440,r.flipY),e.pixelStorei(37441,r.premultiplyAlpha),e.pixelStorei(3317,r.unpackAlignment),e.pixelStorei(37443,0);for(var h=r.isCompressedTexture||r.image[0].isCompressedTexture,f=r.image[0]&&r.image[0].isDataTexture,p=[],A=0;A<6;A++)p[A]=h||f?f?r.image[A].image:r.image[A]:C(r.image[A],!1,!0,d),p[A]=G(r,p[A]);var v,g=p[0],m=b(g)||c,y=a.convert(r.format,r.encoding),x=a.convert(r.type),w=M(r.internalFormat,y,x,r.encoding),S=c&&!0!==r.isVideoTexture,k=void 0===u.__version||!0===s,B=I(r,g,m);if(Q(34067,r,m),h){S&&k&&n.texStorage2D(34067,B,w,g.width,g.height);for(var T=0;T<6;T++){v=p[T].mipmaps;for(var D=0;D<v.length;D++){var R=v[D];r.format!==je?null!==y?S?n.compressedTexSubImage2D(34069+T,D,0,0,R.width,R.height,y,R.data):n.compressedTexImage2D(34069+T,D,w,R.width,R.height,0,R.data):console.warn("THREE.WebGLRenderer: Attempt to load unsupported compressed texture format in .setTextureCube()"):S?n.texSubImage2D(34069+T,D,0,0,R.width,R.height,y,x,R.data):n.texImage2D(34069+T,D,w,R.width,R.height,0,y,x,R.data)}}}else{v=r.mipmaps,S&&k&&(v.length>0&&B++,n.texStorage2D(34067,B,w,p[0].width,p[0].height));for(var P=0;P<6;P++)if(f){S?n.texSubImage2D(34069+P,0,0,0,p[P].width,p[P].height,y,x,p[P].data):n.texImage2D(34069+P,0,w,p[P].width,p[P].height,0,y,x,p[P].data);for(var L=0;L<v.length;L++){var N=v[L].image[P].image;S?n.texSubImage2D(34069+P,L+1,0,0,N.width,N.height,y,x,N.data):n.texImage2D(34069+P,L+1,w,N.width,N.height,0,y,x,N.data)}}else{S?n.texSubImage2D(34069+P,0,0,0,y,x,p[P]):n.texImage2D(34069+P,0,w,y,x,p[P]);for(var F=0;F<v.length;F++){var U=v[F];S?n.texSubImage2D(34069+P,F+1,0,0,y,x,U.image[P]):n.texImage2D(34069+P,F+1,w,y,x,U.image[P])}}}_(r,m)&&E(34067),u.__version=l.version,r.onUpdate&&r.onUpdate(r)}t.__version=r.version}(o,t,r):n.bindTexture(34067,o.__webglTexture,33984+r)},this.rebindTextures=function(e,t,n){var r=i.get(e);void 0!==t&&F(r.__webglFramebuffer,e,e.texture,36064,3553),void 0!==n&&j(e)},this.setupRenderTarget=function(t){var s=t.texture,l=i.get(t),u=i.get(s);t.addEventListener("dispose",B),!0!==t.isWebGLMultipleRenderTargets&&(void 0===u.__webglTexture&&(u.__webglTexture=e.createTexture()),u.__version=s.version,o.memory.textures++);var h=!0===t.isWebGLCubeRenderTarget,d=!0===t.isWebGLMultipleRenderTargets,f=b(t)||c;if(h){l.__webglFramebuffer=[];for(var p=0;p<6;p++)l.__webglFramebuffer[p]=e.createFramebuffer()}else{if(l.__webglFramebuffer=e.createFramebuffer(),d)if(r.drawBuffers)for(var A=t.texture,v=0,g=A.length;v<g;v++){var m=i.get(A[v]);void 0===m.__webglTexture&&(m.__webglTexture=e.createTexture(),o.memory.textures++)}else console.warn("THREE.WebGLRenderer: WebGLMultipleRenderTargets can only be used with WebGL2 or WEBGL_draw_buffers extension.");if(c&&t.samples>0&&!1===z(t)){var y=d?s:[s];l.__webglMultisampledFramebuffer=e.createFramebuffer(),l.__webglColorRenderbuffer=[],n.bindFramebuffer(36160,l.__webglMultisampledFramebuffer);for(var x=0;x<y.length;x++){var w=y[x];l.__webglColorRenderbuffer[x]=e.createRenderbuffer(),e.bindRenderbuffer(36161,l.__webglColorRenderbuffer[x]);var C=a.convert(w.format,w.encoding),I=a.convert(w.type),S=M(w.internalFormat,C,I,w.encoding,!0===t.isXRRenderTarget),k=O(t);e.renderbufferStorageMultisample(36161,k,S,t.width,t.height),e.framebufferRenderbuffer(36160,36064+x,36161,l.__webglColorRenderbuffer[x])}e.bindRenderbuffer(36161,null),t.depthBuffer&&(l.__webglDepthRenderbuffer=e.createRenderbuffer(),U(l.__webglDepthRenderbuffer,t,!0)),n.bindFramebuffer(36160,null)}}if(h){n.bindTexture(34067,u.__webglTexture),Q(34067,s,f);for(var T=0;T<6;T++)F(l.__webglFramebuffer[T],t,s,36064,34069+T);_(s,f)&&E(34067),n.unbindTexture()}else if(d){for(var D=t.texture,R=0,P=D.length;R<P;R++){var L=D[R],Z=i.get(L);n.bindTexture(3553,Z.__webglTexture),Q(3553,L,f),F(l.__webglFramebuffer,t,L,36064+R,3553),_(L,f)&&E(3553)}n.unbindTexture()}else{var N=3553;(t.isWebGL3DRenderTarget||t.isWebGLArrayRenderTarget)&&(c?N=t.isWebGL3DRenderTarget?32879:35866:console.error("THREE.WebGLTextures: THREE.Data3DTexture and THREE.DataArrayTexture only supported with WebGL2.")),n.bindTexture(N,u.__webglTexture),Q(N,s,f),F(l.__webglFramebuffer,t,s,36064,N),_(s,f)&&E(N),n.unbindTexture()}t.depthBuffer&&j(t)},this.updateRenderTargetMipmap=function(e){for(var t=b(e)||c,r=!0===e.isWebGLMultipleRenderTargets?e.texture:[e.texture],a=0,o=r.length;a<o;a++){var s=r[a];if(_(s,t)){var l=e.isWebGLCubeRenderTarget?34067:3553,u=i.get(s).__webglTexture;n.bindTexture(l,u),E(l),n.unbindTexture()}}},this.updateMultisampleRenderTarget=function(t){if(c&&t.samples>0&&!1===z(t)){var r=t.isWebGLMultipleRenderTargets?t.texture:[t.texture],a=t.width,o=t.height,s=16384,l=[],u=t.stencilBuffer?33306:36096,h=i.get(t),d=!0===t.isWebGLMultipleRenderTargets;if(d)for(var f=0;f<r.length;f++)n.bindFramebuffer(36160,h.__webglMultisampledFramebuffer),e.framebufferRenderbuffer(36160,36064+f,36161,null),n.bindFramebuffer(36160,h.__webglFramebuffer),e.framebufferTexture2D(36009,36064+f,3553,null,0);n.bindFramebuffer(36008,h.__webglMultisampledFramebuffer),n.bindFramebuffer(36009,h.__webglFramebuffer);for(var p=0;p<r.length;p++){l.push(36064+p),t.depthBuffer&&l.push(u);var A=void 0!==h.__ignoreDepthValues&&h.__ignoreDepthValues;if(!1===A&&(t.depthBuffer&&(s|=256),t.stencilBuffer&&(s|=1024)),d&&e.framebufferRenderbuffer(36008,36064,36161,h.__webglColorRenderbuffer[p]),!0===A&&(e.invalidateFramebuffer(36008,[u]),e.invalidateFramebuffer(36009,[u])),d){var v=i.get(r[p]).__webglTexture;e.framebufferTexture2D(36009,36064,3553,v,0)}e.blitFramebuffer(0,0,a,o,0,0,a,o,s,9728),g&&e.invalidateFramebuffer(36008,l)}if(n.bindFramebuffer(36008,null),n.bindFramebuffer(36009,null),d)for(var m=0;m<r.length;m++){n.bindFramebuffer(36160,h.__webglMultisampledFramebuffer),e.framebufferRenderbuffer(36160,36064+m,36161,h.__webglColorRenderbuffer[m]);var y=i.get(r[m]).__webglTexture;n.bindFramebuffer(36160,h.__webglFramebuffer),e.framebufferTexture2D(36009,36064+m,3553,y,0)}n.bindFramebuffer(36009,h.__webglMultisampledFramebuffer)}},this.setupDepthRenderbuffer=j,this.setupFrameBufferTexture=F,this.useMultisampledRTT=z}function Ms(e,t,n){var i=n.isWebGL2;return{convert:function(n){var r,a=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;if(n===ke)return 5121;if(n===Ze)return 32819;if(n===Ne)return 32820;if(n===Be)return 5120;if(n===Te)return 5122;if(n===De)return 5123;if(n===Re)return 5124;if(n===Pe)return 5125;if(n===Le)return 5126;if(n===Qe)return i?5131:null!==(r=t.get("OES_texture_half_float"))?r.HALF_FLOAT_OES:null;if(n===Ue)return 6406;if(n===je)return 6408;if(n===Oe)return 6409;if(n===ze)return 6410;if(n===Ge)return 6402;if(n===He)return 34041;if(n===qt)return null!==(r=t.get("EXT_sRGB"))?r.SRGB_ALPHA_EXT:null;if(n===Ve)return 6403;if(n===We)return 36244;if(n===qe)return 33319;if(n===Ye)return 33320;if(n===Je)return 36249;if(n===Xe||n===Ke||n===$e||n===et)if(a===Ft){if(null===(r=t.get("WEBGL_compressed_texture_s3tc_srgb")))return null;if(n===Xe)return r.COMPRESSED_SRGB_S3TC_DXT1_EXT;if(n===Ke)return r.COMPRESSED_SRGB_ALPHA_S3TC_DXT1_EXT;if(n===$e)return r.COMPRESSED_SRGB_ALPHA_S3TC_DXT3_EXT;if(n===et)return r.COMPRESSED_SRGB_ALPHA_S3TC_DXT5_EXT}else{if(null===(r=t.get("WEBGL_compressed_texture_s3tc")))return null;if(n===Xe)return r.COMPRESSED_RGB_S3TC_DXT1_EXT;if(n===Ke)return r.COMPRESSED_RGBA_S3TC_DXT1_EXT;if(n===$e)return r.COMPRESSED_RGBA_S3TC_DXT3_EXT;if(n===et)return r.COMPRESSED_RGBA_S3TC_DXT5_EXT}if(n===tt||n===nt||n===it||n===rt){if(null===(r=t.get("WEBGL_compressed_texture_pvrtc")))return null;if(n===tt)return r.COMPRESSED_RGB_PVRTC_4BPPV1_IMG;if(n===nt)return r.COMPRESSED_RGB_PVRTC_2BPPV1_IMG;if(n===it)return r.COMPRESSED_RGBA_PVRTC_4BPPV1_IMG;if(n===rt)return r.COMPRESSED_RGBA_PVRTC_2BPPV1_IMG}if(n===at)return null!==(r=t.get("WEBGL_compressed_texture_etc1"))?r.COMPRESSED_RGB_ETC1_WEBGL:null;if(n===ot||n===st){if(null===(r=t.get("WEBGL_compressed_texture_etc")))return null;if(n===ot)return a===Ft?r.COMPRESSED_SRGB8_ETC2:r.COMPRESSED_RGB8_ETC2;if(n===st)return a===Ft?r.COMPRESSED_SRGB8_ALPHA8_ETC2_EAC:r.COMPRESSED_RGBA8_ETC2_EAC}if(n===lt||n===ut||n===ct||n===ht||n===dt||n===ft||n===pt||n===At||n===vt||n===gt||n===mt||n===yt||n===xt||n===wt){if(null===(r=t.get("WEBGL_compressed_texture_astc")))return null;if(n===lt)return a===Ft?r.COMPRESSED_SRGB8_ALPHA8_ASTC_4x4_KHR:r.COMPRESSED_RGBA_ASTC_4x4_KHR;if(n===ut)return a===Ft?r.COMPRESSED_SRGB8_ALPHA8_ASTC_5x4_KHR:r.COMPRESSED_RGBA_ASTC_5x4_KHR;if(n===ct)return a===Ft?r.COMPRESSED_SRGB8_ALPHA8_ASTC_5x5_KHR:r.COMPRESSED_RGBA_ASTC_5x5_KHR;if(n===ht)return a===Ft?r.COMPRESSED_SRGB8_ALPHA8_ASTC_6x5_KHR:r.COMPRESSED_RGBA_ASTC_6x5_KHR;if(n===dt)return a===Ft?r.COMPRESSED_SRGB8_ALPHA8_ASTC_6x6_KHR:r.COMPRESSED_RGBA_ASTC_6x6_KHR;if(n===ft)return a===Ft?r.COMPRESSED_SRGB8_ALPHA8_ASTC_8x5_KHR:r.COMPRESSED_RGBA_ASTC_8x5_KHR;if(n===pt)return a===Ft?r.COMPRESSED_SRGB8_ALPHA8_ASTC_8x6_KHR:r.COMPRESSED_RGBA_ASTC_8x6_KHR;if(n===At)return a===Ft?r.COMPRESSED_SRGB8_ALPHA8_ASTC_8x8_KHR:r.COMPRESSED_RGBA_ASTC_8x8_KHR;if(n===vt)return a===Ft?r.COMPRESSED_SRGB8_ALPHA8_ASTC_10x5_KHR:r.COMPRESSED_RGBA_ASTC_10x5_KHR;if(n===gt)return a===Ft?r.COMPRESSED_SRGB8_ALPHA8_ASTC_10x6_KHR:r.COMPRESSED_RGBA_ASTC_10x6_KHR;if(n===mt)return a===Ft?r.COMPRESSED_SRGB8_ALPHA8_ASTC_10x8_KHR:r.COMPRESSED_RGBA_ASTC_10x8_KHR;if(n===yt)return a===Ft?r.COMPRESSED_SRGB8_ALPHA8_ASTC_10x10_KHR:r.COMPRESSED_RGBA_ASTC_10x10_KHR;if(n===xt)return a===Ft?r.COMPRESSED_SRGB8_ALPHA8_ASTC_12x10_KHR:r.COMPRESSED_RGBA_ASTC_12x10_KHR;if(n===wt)return a===Ft?r.COMPRESSED_SRGB8_ALPHA8_ASTC_12x12_KHR:r.COMPRESSED_RGBA_ASTC_12x12_KHR}if(n===Ct){if(null===(r=t.get("EXT_texture_compression_bptc")))return null;if(n===Ct)return a===Ft?r.COMPRESSED_SRGB_ALPHA_BPTC_UNORM_EXT:r.COMPRESSED_RGBA_BPTC_UNORM_EXT}if(n===bt||n===_t||n===Et||n===Mt){if(null===(r=t.get("EXT_texture_compression_rgtc")))return null;if(n===Ct)return r.COMPRESSED_RED_RGTC1_EXT;if(n===_t)return r.COMPRESSED_SIGNED_RED_RGTC1_EXT;if(n===Et)return r.COMPRESSED_RED_GREEN_RGTC2_EXT;if(n===Mt)return r.COMPRESSED_SIGNED_RED_GREEN_RGTC2_EXT}return n===Fe?i?34042:null!==(r=t.get("WEBGL_depth_texture"))?r.UNSIGNED_INT_24_8_WEBGL:null:void 0!==e[n]?e[n]:null}}}var Is=function(e){(0,d.Z)(n,e);var t=(0,f.Z)(n);function n(){var e,i=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[];return(0,v.Z)(this,n),(e=t.call(this)).isArrayCamera=!0,e.cameras=i,e}return(0,g.Z)(n)}(zr),Ss=function(e){(0,d.Z)(n,e);var t=(0,f.Z)(n);function n(){var e;return(0,v.Z)(this,n),(e=t.call(this)).isGroup=!0,e.type="Group",e}return(0,g.Z)(n)}(Hi),ks={type:"move"},Bs=function(){function e(){(0,v.Z)(this,e),this._targetRay=null,this._grip=null,this._hand=null}return(0,g.Z)(e,[{key:"getHandSpace",value:function(){return null===this._hand&&(this._hand=new Ss,this._hand.matrixAutoUpdate=!1,this._hand.visible=!1,this._hand.joints={},this._hand.inputState={pinching:!1}),this._hand}},{key:"getTargetRaySpace",value:function(){return null===this._targetRay&&(this._targetRay=new Ss,this._targetRay.matrixAutoUpdate=!1,this._targetRay.visible=!1,this._targetRay.hasLinearVelocity=!1,this._targetRay.linearVelocity=new Gn,this._targetRay.hasAngularVelocity=!1,this._targetRay.angularVelocity=new Gn),this._targetRay}},{key:"getGripSpace",value:function(){return null===this._grip&&(this._grip=new Ss,this._grip.matrixAutoUpdate=!1,this._grip.visible=!1,this._grip.hasLinearVelocity=!1,this._grip.linearVelocity=new Gn,this._grip.hasAngularVelocity=!1,this._grip.angularVelocity=new Gn),this._grip}},{key:"dispatchEvent",value:function(e){return null!==this._targetRay&&this._targetRay.dispatchEvent(e),null!==this._grip&&this._grip.dispatchEvent(e),null!==this._hand&&this._hand.dispatchEvent(e),this}},{key:"connect",value:function(e){if(e&&e.hand){var t=this._hand;if(t){var n,i=(0,s.Z)(e.hand.values());try{for(i.s();!(n=i.n()).done;){var r=n.value;this._getHandJoint(t,r)}}catch(a){i.e(a)}finally{i.f()}}}return this.dispatchEvent({type:"connected",data:e}),this}},{key:"disconnect",value:function(e){return this.dispatchEvent({type:"disconnected",data:e}),null!==this._targetRay&&(this._targetRay.visible=!1),null!==this._grip&&(this._grip.visible=!1),null!==this._hand&&(this._hand.visible=!1),this}},{key:"update",value:function(e,t,n){var i=null,r=null,a=null,o=this._targetRay,l=this._grip,u=this._hand;if(e&&"visible-blurred"!==t.session.visibilityState){if(u&&e.hand){a=!0;var c,h=(0,s.Z)(e.hand.values());try{for(h.s();!(c=h.n()).done;){var d=c.value,f=t.getJointPose(d,n),p=this._getHandJoint(u,d);null!==f&&(p.matrix.fromArray(f.transform.matrix),p.matrix.decompose(p.position,p.rotation,p.scale),p.jointRadius=f.radius),p.visible=null!==f}}catch(m){h.e(m)}finally{h.f()}var A=u.joints["index-finger-tip"],v=u.joints["thumb-tip"],g=A.position.distanceTo(v.position);u.inputState.pinching&&g>.025?(u.inputState.pinching=!1,this.dispatchEvent({type:"pinchend",handedness:e.handedness,target:this})):!u.inputState.pinching&&g<=.015&&(u.inputState.pinching=!0,this.dispatchEvent({type:"pinchstart",handedness:e.handedness,target:this}))}else null!==l&&e.gripSpace&&null!==(r=t.getPose(e.gripSpace,n))&&(l.matrix.fromArray(r.transform.matrix),l.matrix.decompose(l.position,l.rotation,l.scale),r.linearVelocity?(l.hasLinearVelocity=!0,l.linearVelocity.copy(r.linearVelocity)):l.hasLinearVelocity=!1,r.angularVelocity?(l.hasAngularVelocity=!0,l.angularVelocity.copy(r.angularVelocity)):l.hasAngularVelocity=!1);null!==o&&(null===(i=t.getPose(e.targetRaySpace,n))&&null!==r&&(i=r),null!==i&&(o.matrix.fromArray(i.transform.matrix),o.matrix.decompose(o.position,o.rotation,o.scale),i.linearVelocity?(o.hasLinearVelocity=!0,o.linearVelocity.copy(i.linearVelocity)):o.hasLinearVelocity=!1,i.angularVelocity?(o.hasAngularVelocity=!0,o.angularVelocity.copy(i.angularVelocity)):o.hasAngularVelocity=!1,this.dispatchEvent(ks)))}return null!==o&&(o.visible=null!==i),null!==l&&(l.visible=null!==r),null!==u&&(u.visible=null!==a),this}},{key:"_getHandJoint",value:function(e,t){if(void 0===e.joints[t.jointName]){var n=new Ss;n.matrixAutoUpdate=!1,n.visible=!1,e.joints[t.jointName]=n,e.add(n)}return e.joints[t.jointName]}}]),e}(),Ts=function(e){(0,d.Z)(n,e);var t=(0,f.Z)(n);function n(e,i,r,a,o,s,l,u,c,h){var d;if((0,v.Z)(this,n),(h=void 0!==h?h:Ge)!==Ge&&h!==He)throw new Error("DepthTexture format must be either THREE.DepthFormat or THREE.DepthStencilFormat");return void 0===r&&h===Ge&&(r=Pe),void 0===r&&h===He&&(r=Fe),(d=t.call(this,null,a,o,s,l,u,h,r,c)).isDepthTexture=!0,d.image={width:e,height:i},d.magFilter=void 0!==l?l:be,d.minFilter=void 0!==u?u:be,d.flipY=!1,d.generateMipmaps=!1,d}return(0,g.Z)(n)}(Nn),Ds=function(e){(0,d.Z)(n,e);var t=(0,f.Z)(n);function n(e,i){var r;(0,v.Z)(this,n),r=t.call(this);var a=(0,h.Z)(r),l=null,u=1,c=null,d="local-floor",f=1,p=null,g=null,m=null,y=null,x=null,w=null,C=i.getContextAttributes(),b=null,_=null,E=[],M=[],I=new Set,S=new Map,k=new zr;k.layers.enable(1),k.viewport=new Fn;var B=new zr;B.layers.enable(2),B.viewport=new Fn;var T=[k,B],D=new Is;D.layers.enable(1),D.layers.enable(2);var R=null,P=null;function L(e){var t=M.indexOf(e.inputSource);if(-1!==t){var n=E[t];void 0!==n&&n.dispatchEvent({type:e.type,data:e.inputSource})}}function Q(){l.removeEventListener("select",L),l.removeEventListener("selectstart",L),l.removeEventListener("selectend",L),l.removeEventListener("squeeze",L),l.removeEventListener("squeezestart",L),l.removeEventListener("squeezeend",L),l.removeEventListener("end",Q),l.removeEventListener("inputsourceschange",Z);for(var t=0;t<E.length;t++){var n=M[t];null!==n&&(M[t]=null,E[t].disconnect(n))}R=null,P=null,e.setRenderTarget(b),x=null,y=null,m=null,l=null,_=null,O.stop(),a.isPresenting=!1,a.dispatchEvent({type:"sessionend"})}function Z(e){for(var t=0;t<e.removed.length;t++){var n=e.removed[t],i=M.indexOf(n);i>=0&&(M[i]=null,E[i].disconnect(n))}for(var r=0;r<e.added.length;r++){var a=e.added[r],o=M.indexOf(a);if(-1===o){for(var s=0;s<E.length;s++){if(s>=M.length){M.push(a),o=s;break}if(null===M[s]){M[s]=a,o=s;break}}if(-1===o)break}var l=E[o];l&&l.connect(a)}}r.cameraAutoUpdate=!0,r.enabled=!1,r.isPresenting=!1,r.getController=function(e){var t=E[e];return void 0===t&&(t=new Bs,E[e]=t),t.getTargetRaySpace()},r.getControllerGrip=function(e){var t=E[e];return void 0===t&&(t=new Bs,E[e]=t),t.getGripSpace()},r.getHand=function(e){var t=E[e];return void 0===t&&(t=new Bs,E[e]=t),t.getHandSpace()},r.setFramebufferScaleFactor=function(e){u=e,!0===a.isPresenting&&console.warn("THREE.WebXRManager: Cannot change framebuffer scale while presenting.")},r.setReferenceSpaceType=function(e){d=e,!0===a.isPresenting&&console.warn("THREE.WebXRManager: Cannot change reference space type while presenting.")},r.getReferenceSpace=function(){return p||c},r.setReferenceSpace=function(e){p=e},r.getBaseLayer=function(){return null!==y?y:x},r.getBinding=function(){return m},r.getFrame=function(){return w},r.getSession=function(){return l},r.setSession=function(){var t=(0,o.Z)((0,A.Z)().mark((function t(n){var r,o,s,h,v;return(0,A.Z)().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(null===(l=n)){t.next=25;break}if(b=e.getRenderTarget(),l.addEventListener("select",L),l.addEventListener("selectstart",L),l.addEventListener("selectend",L),l.addEventListener("squeeze",L),l.addEventListener("squeezestart",L),l.addEventListener("squeezeend",L),l.addEventListener("end",Q),l.addEventListener("inputsourceschange",Z),!0===C.xrCompatible){t.next=14;break}return t.next=14,i.makeXRCompatible();case 14:return void 0===l.renderState.layers||!1===e.capabilities.isWebGL2?(r={antialias:void 0!==l.renderState.layers||C.antialias,alpha:C.alpha,depth:C.depth,stencil:C.stencil,framebufferScaleFactor:u},x=new Jt(l,i,r),l.updateRenderState({baseLayer:x}),_=new Un(x.framebufferWidth,x.framebufferHeight,{format:je,type:ke,encoding:e.outputEncoding,stencilBuffer:C.stencil})):(o=null,s=null,h=null,C.depth&&(h=C.stencil?35056:33190,o=C.stencil?He:Ge,s=C.stencil?Fe:Pe),v={colorFormat:32856,depthFormat:h,scaleFactor:u},m=new Xt(l,i),y=m.createProjectionLayer(v),l.updateRenderState({layers:[y]}),_=new Un(y.textureWidth,y.textureHeight,{format:je,type:ke,depthTexture:new Ts(y.textureWidth,y.textureHeight,s,void 0,void 0,void 0,void 0,void 0,void 0,o),stencilBuffer:C.stencil,encoding:e.outputEncoding,samples:C.antialias?4:0}),e.properties.get(_).__ignoreDepthValues=y.ignoreDepthValues),_.isXRRenderTarget=!0,this.setFoveation(f),p=null,t.next=20,l.requestReferenceSpace(d);case 20:c=t.sent,O.setContext(l),O.start(),a.isPresenting=!0,a.dispatchEvent({type:"sessionstart"});case 25:case"end":return t.stop()}}),t,this)})));return function(e){return t.apply(this,arguments)}}();var N=new Gn,F=new Gn;function U(e,t){null===t?e.matrixWorld.copy(e.matrix):e.matrixWorld.multiplyMatrices(t.matrixWorld,e.matrix),e.matrixWorldInverse.copy(e.matrixWorld).invert()}r.updateCamera=function(e){if(null!==l){D.near=B.near=k.near=e.near,D.far=B.far=k.far=e.far,R===D.near&&P===D.far||(l.updateRenderState({depthNear:D.near,depthFar:D.far}),R=D.near,P=D.far);var t=e.parent,n=D.cameras;U(D,t);for(var i=0;i<n.length;i++)U(n[i],t);D.matrixWorld.decompose(D.position,D.quaternion,D.scale),e.matrix.copy(D.matrix),e.matrix.decompose(e.position,e.quaternion,e.scale);for(var r=e.children,a=0,o=r.length;a<o;a++)r[a].updateMatrixWorld(!0);2===n.length?function(e,t,n){N.setFromMatrixPosition(t.matrixWorld),F.setFromMatrixPosition(n.matrixWorld);var i=N.distanceTo(F),r=t.projectionMatrix.elements,a=n.projectionMatrix.elements,o=r[14]/(r[10]-1),s=r[14]/(r[10]+1),l=(r[9]+1)/r[5],u=(r[9]-1)/r[5],c=(r[8]-1)/r[0],h=(a[8]+1)/a[0],d=o*c,f=o*h,p=i/(-c+h),A=p*-c;t.matrixWorld.decompose(e.position,e.quaternion,e.scale),e.translateX(A),e.translateZ(p),e.matrixWorld.compose(e.position,e.quaternion,e.scale),e.matrixWorldInverse.copy(e.matrixWorld).invert();var v=o+p,g=s+p,m=d-A,y=f+(i-A),x=l*s/g*v,w=u*s/g*v;e.projectionMatrix.makePerspective(m,y,x,w,v,g)}(D,k,B):D.projectionMatrix.copy(k.projectionMatrix)}},r.getCamera=function(){return D},r.getFoveation=function(){if(null!==y||null!==x)return f},r.setFoveation=function(e){f=e,null!==y&&(y.fixedFoveation=e),null!==x&&void 0!==x.fixedFoveation&&(x.fixedFoveation=e)},r.getPlanes=function(){return I};var j=null;var O=new ta;return O.setAnimationLoop((function(t,n){if(g=n.getViewerPose(p||c),w=n,null!==g){var i=g.views;null!==x&&(e.setRenderTargetFramebuffer(_,x.framebuffer),e.setRenderTarget(_));var r=!1;i.length!==D.cameras.length&&(D.cameras.length=0,r=!0);for(var o=0;o<i.length;o++){var l=i[o],u=null;if(null!==x)u=x.getViewport(l);else{var h=m.getViewSubImage(y,l);u=h.viewport,0===o&&(e.setRenderTargetTextures(_,h.colorTexture,y.ignoreDepthValues?void 0:h.depthStencilTexture),e.setRenderTarget(_))}var d=T[o];void 0===d&&((d=new zr).layers.enable(o),d.viewport=new Fn,T[o]=d),d.matrix.fromArray(l.transform.matrix),d.projectionMatrix.fromArray(l.projectionMatrix),d.viewport.set(u.x,u.y,u.width,u.height),0===o&&D.matrix.copy(d.matrix),!0===r&&D.cameras.push(d)}}for(var f=0;f<E.length;f++){var A=M[f],v=E[f];null!==A&&void 0!==v&&v.update(A,n,p||c)}if(j&&j(t,n),n.detectedPlanes){a.dispatchEvent({type:"planesdetected",data:n.detectedPlanes});var C,b=null,k=(0,s.Z)(I);try{for(k.s();!(C=k.n()).done;){var B=C.value;n.detectedPlanes.has(B)||(null===b&&(b=[]),b.push(B))}}catch(U){k.e(U)}finally{k.f()}if(null!==b){var R,P=(0,s.Z)(b);try{for(P.s();!(R=P.n()).done;){var L=R.value;I.delete(L),S.delete(L),a.dispatchEvent({type:"planeremoved",data:L})}}catch(U){P.e(U)}finally{P.f()}}var Q,Z=(0,s.Z)(n.detectedPlanes);try{for(Z.s();!(Q=Z.n()).done;){var N=Q.value;if(I.has(N)){var F=S.get(N);N.lastChangedTime>F&&(S.set(N,N.lastChangedTime),a.dispatchEvent({type:"planechanged",data:N}))}else I.add(N),S.set(N,n.lastChangedTime),a.dispatchEvent({type:"planeadded",data:N})}}catch(U){Z.e(U)}finally{Z.f()}}w=null})),r.setAnimationLoop=function(e){j=e},r.dispose=function(){},r}return(0,g.Z)(n)}($t);function Rs(e,t){function n(n,i){n.opacity.value=i.opacity,i.color&&n.diffuse.value.copy(i.color),i.emissive&&n.emissive.value.copy(i.emissive).multiplyScalar(i.emissiveIntensity),i.map&&(n.map.value=i.map),i.alphaMap&&(n.alphaMap.value=i.alphaMap),i.bumpMap&&(n.bumpMap.value=i.bumpMap,n.bumpScale.value=i.bumpScale,i.side===S&&(n.bumpScale.value*=-1)),i.displacementMap&&(n.displacementMap.value=i.displacementMap,n.displacementScale.value=i.displacementScale,n.displacementBias.value=i.displacementBias),i.emissiveMap&&(n.emissiveMap.value=i.emissiveMap),i.normalMap&&(n.normalMap.value=i.normalMap,n.normalScale.value.copy(i.normalScale),i.side===S&&n.normalScale.value.negate()),i.specularMap&&(n.specularMap.value=i.specularMap),i.alphaTest>0&&(n.alphaTest.value=i.alphaTest);var r,a,o=t.get(i).envMap;if(o&&(n.envMap.value=o,n.flipEnvMap.value=o.isCubeTexture&&!1===o.isRenderTargetTexture?-1:1,n.reflectivity.value=i.reflectivity,n.ior.value=i.ior,n.refractionRatio.value=i.refractionRatio),i.lightMap){n.lightMap.value=i.lightMap;var s=!0!==e.physicallyCorrectLights?Math.PI:1;n.lightMapIntensity.value=i.lightMapIntensity*s}i.aoMap&&(n.aoMap.value=i.aoMap,n.aoMapIntensity.value=i.aoMapIntensity),i.map?r=i.map:i.specularMap?r=i.specularMap:i.displacementMap?r=i.displacementMap:i.normalMap?r=i.normalMap:i.bumpMap?r=i.bumpMap:i.roughnessMap?r=i.roughnessMap:i.metalnessMap?r=i.metalnessMap:i.alphaMap?r=i.alphaMap:i.emissiveMap?r=i.emissiveMap:i.clearcoatMap?r=i.clearcoatMap:i.clearcoatNormalMap?r=i.clearcoatNormalMap:i.clearcoatRoughnessMap?r=i.clearcoatRoughnessMap:i.iridescenceMap?r=i.iridescenceMap:i.iridescenceThicknessMap?r=i.iridescenceThicknessMap:i.specularIntensityMap?r=i.specularIntensityMap:i.specularColorMap?r=i.specularColorMap:i.transmissionMap?r=i.transmissionMap:i.thicknessMap?r=i.thicknessMap:i.sheenColorMap?r=i.sheenColorMap:i.sheenRoughnessMap&&(r=i.sheenRoughnessMap),void 0!==r&&(r.isWebGLRenderTarget&&(r=r.texture),!0===r.matrixAutoUpdate&&r.updateMatrix(),n.uvTransform.value.copy(r.matrix)),i.aoMap?a=i.aoMap:i.lightMap&&(a=i.lightMap),void 0!==a&&(a.isWebGLRenderTarget&&(a=a.texture),!0===a.matrixAutoUpdate&&a.updateMatrix(),n.uv2Transform.value.copy(a.matrix))}return{refreshFogUniforms:function(t,n){n.color.getRGB(t.fogColor.value,Fr(e)),n.isFog?(t.fogNear.value=n.near,t.fogFar.value=n.far):n.isFogExp2&&(t.fogDensity.value=n.density)},refreshMaterialUniforms:function(e,i,r,a,o){i.isMeshBasicMaterial||i.isMeshLambertMaterial?n(e,i):i.isMeshToonMaterial?(n(e,i),function(e,t){t.gradientMap&&(e.gradientMap.value=t.gradientMap)}(e,i)):i.isMeshPhongMaterial?(n(e,i),function(e,t){e.specular.value.copy(t.specular),e.shininess.value=Math.max(t.shininess,1e-4)}(e,i)):i.isMeshStandardMaterial?(n(e,i),function(e,n){e.roughness.value=n.roughness,e.metalness.value=n.metalness,n.roughnessMap&&(e.roughnessMap.value=n.roughnessMap);n.metalnessMap&&(e.metalnessMap.value=n.metalnessMap);var i=t.get(n).envMap;i&&(e.envMapIntensity.value=n.envMapIntensity)}(e,i),i.isMeshPhysicalMaterial&&function(e,t,n){e.ior.value=t.ior,t.sheen>0&&(e.sheenColor.value.copy(t.sheenColor).multiplyScalar(t.sheen),e.sheenRoughness.value=t.sheenRoughness,t.sheenColorMap&&(e.sheenColorMap.value=t.sheenColorMap),t.sheenRoughnessMap&&(e.sheenRoughnessMap.value=t.sheenRoughnessMap));t.clearcoat>0&&(e.clearcoat.value=t.clearcoat,e.clearcoatRoughness.value=t.clearcoatRoughness,t.clearcoatMap&&(e.clearcoatMap.value=t.clearcoatMap),t.clearcoatRoughnessMap&&(e.clearcoatRoughnessMap.value=t.clearcoatRoughnessMap),t.clearcoatNormalMap&&(e.clearcoatNormalScale.value.copy(t.clearcoatNormalScale),e.clearcoatNormalMap.value=t.clearcoatNormalMap,t.side===S&&e.clearcoatNormalScale.value.negate()));t.iridescence>0&&(e.iridescence.value=t.iridescence,e.iridescenceIOR.value=t.iridescenceIOR,e.iridescenceThicknessMinimum.value=t.iridescenceThicknessRange[0],e.iridescenceThicknessMaximum.value=t.iridescenceThicknessRange[1],t.iridescenceMap&&(e.iridescenceMap.value=t.iridescenceMap),t.iridescenceThicknessMap&&(e.iridescenceThicknessMap.value=t.iridescenceThicknessMap));t.transmission>0&&(e.transmission.value=t.transmission,e.transmissionSamplerMap.value=n.texture,e.transmissionSamplerSize.value.set(n.width,n.height),t.transmissionMap&&(e.transmissionMap.value=t.transmissionMap),e.thickness.value=t.thickness,t.thicknessMap&&(e.thicknessMap.value=t.thicknessMap),e.attenuationDistance.value=t.attenuationDistance,e.attenuationColor.value.copy(t.attenuationColor));e.specularIntensity.value=t.specularIntensity,e.specularColor.value.copy(t.specularColor),t.specularIntensityMap&&(e.specularIntensityMap.value=t.specularIntensityMap);t.specularColorMap&&(e.specularColorMap.value=t.specularColorMap)}(e,i,o)):i.isMeshMatcapMaterial?(n(e,i),function(e,t){t.matcap&&(e.matcap.value=t.matcap)}(e,i)):i.isMeshDepthMaterial?n(e,i):i.isMeshDistanceMaterial?(n(e,i),function(e,t){e.referencePosition.value.copy(t.referencePosition),e.nearDistance.value=t.nearDistance,e.farDistance.value=t.farDistance}(e,i)):i.isMeshNormalMaterial?n(e,i):i.isLineBasicMaterial?(function(e,t){e.diffuse.value.copy(t.color),e.opacity.value=t.opacity}(e,i),i.isLineDashedMaterial&&function(e,t){e.dashSize.value=t.dashSize,e.totalSize.value=t.dashSize+t.gapSize,e.scale.value=t.scale}(e,i)):i.isPointsMaterial?function(e,t,n,i){e.diffuse.value.copy(t.color),e.opacity.value=t.opacity,e.size.value=t.size*n,e.scale.value=.5*i,t.map&&(e.map.value=t.map);t.alphaMap&&(e.alphaMap.value=t.alphaMap);t.alphaTest>0&&(e.alphaTest.value=t.alphaTest);var r;t.map?r=t.map:t.alphaMap&&(r=t.alphaMap);void 0!==r&&(!0===r.matrixAutoUpdate&&r.updateMatrix(),e.uvTransform.value.copy(r.matrix))}(e,i,r,a):i.isSpriteMaterial?function(e,t){e.diffuse.value.copy(t.color),e.opacity.value=t.opacity,e.rotation.value=t.rotation,t.map&&(e.map.value=t.map);t.alphaMap&&(e.alphaMap.value=t.alphaMap);t.alphaTest>0&&(e.alphaTest.value=t.alphaTest);var n;t.map?n=t.map:t.alphaMap&&(n=t.alphaMap);void 0!==n&&(!0===n.matrixAutoUpdate&&n.updateMatrix(),e.uvTransform.value.copy(n.matrix))}(e,i):i.isShadowMaterial?(e.color.value.copy(i.color),e.opacity.value=i.opacity):i.isShaderMaterial&&(i.uniformsNeedUpdate=!1)}}}function Ps(e,t,n,i){var r={},a={},o=[],s=n.isWebGL2?e.getParameter(35375):0;function l(e,t,n){var i=e.value;if(void 0===n[t]){if("number"===typeof i)n[t]=i;else{for(var r=Array.isArray(i)?i:[i],a=[],o=0;o<r.length;o++)a.push(r[o].clone());n[t]=a}return!0}if("number"===typeof i){if(n[t]!==i)return n[t]=i,!0}else for(var s=Array.isArray(n[t])?n[t]:[n[t]],l=Array.isArray(i)?i:[i],u=0;u<s.length;u++){var c=s[u];if(!1===c.equals(l[u]))return c.copy(l[u]),!0}return!1}function u(e){var t={boundary:0,storage:0};return"number"===typeof e?(t.boundary=4,t.storage=4):e.isVector2?(t.boundary=8,t.storage=8):e.isVector3||e.isColor?(t.boundary=16,t.storage=12):e.isVector4?(t.boundary=16,t.storage=16):e.isMatrix3?(t.boundary=48,t.storage=48):e.isMatrix4?(t.boundary=64,t.storage=64):e.isTexture?console.warn("THREE.WebGLRenderer: Texture samplers can not be part of an uniforms group."):console.warn("THREE.WebGLRenderer: Unsupported uniform value type.",e),t}function c(t){var n=t.target;n.removeEventListener("dispose",c);var i=o.indexOf(n.__bindingPointIndex);o.splice(i,1),e.deleteBuffer(r[n.id]),delete r[n.id],delete a[n.id]}return{bind:function(e,t){var n=t.program;i.uniformBlockBinding(e,n)},update:function(n,h){var d=r[n.id];void 0===d&&(!function(e){for(var t=e.uniforms,n=0,i=16,r=0,a=0,o=t.length;a<o;a++){for(var s=t[a],l={boundary:0,storage:0},c=Array.isArray(s.value)?s.value:[s.value],h=0,d=c.length;h<d;h++){var f=u(c[h]);l.boundary+=f.boundary,l.storage+=f.storage}if(s.__data=new Float32Array(l.storage/Float32Array.BYTES_PER_ELEMENT),s.__offset=n,a>0)0!==(r=n%i)&&i-r-l.boundary<0&&(n+=i-r,s.__offset=n);n+=l.storage}(r=n%i)>0&&(n+=i-r);e.__size=n,e.__cache={}}(n),d=function(t){var n=function(){for(var e=0;e<s;e++)if(-1===o.indexOf(e))return o.push(e),e;return console.error("THREE.WebGLRenderer: Maximum number of simultaneously usable uniforms groups reached."),0}();t.__bindingPointIndex=n;var i=e.createBuffer(),r=t.__size,a=t.usage;return e.bindBuffer(35345,i),e.bufferData(35345,r,a),e.bindBuffer(35345,null),e.bindBufferBase(35345,n,i),i}(n),r[n.id]=d,n.addEventListener("dispose",c));var f=h.program;i.updateUBOMapping(n,f);var p=t.render.frame;a[n.id]!==p&&(!function(t){var n=r[t.id],i=t.uniforms,a=t.__cache;e.bindBuffer(35345,n);for(var o=0,s=i.length;o<s;o++){var c=i[o];if(!0===l(c,o,a)){for(var h=c.__offset,d=Array.isArray(c.value)?c.value:[c.value],f=0,p=0;p<d.length;p++){var A=d[p],v=u(A);"number"===typeof A?(c.__data[0]=A,e.bufferSubData(35345,h+f,c.__data)):A.isMatrix3?(c.__data[0]=A.elements[0],c.__data[1]=A.elements[1],c.__data[2]=A.elements[2],c.__data[3]=A.elements[0],c.__data[4]=A.elements[3],c.__data[5]=A.elements[4],c.__data[6]=A.elements[5],c.__data[7]=A.elements[0],c.__data[8]=A.elements[6],c.__data[9]=A.elements[7],c.__data[10]=A.elements[8],c.__data[11]=A.elements[0]):(A.toArray(c.__data,f),f+=v.storage/Float32Array.BYTES_PER_ELEMENT)}e.bufferSubData(35345,h,c.__data)}}e.bindBuffer(35345,null)}(n),a[n.id]=p)},dispose:function(){for(var t in r)e.deleteBuffer(r[t]);o=[],r={},a={}}}}function Ls(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};this.isWebGLRenderer=!0;var t,n=void 0!==e.canvas?e.canvas:function(){var e=wn("canvas");return e.style.display="block",e}(),i=void 0!==e.context?e.context:null,r=void 0===e.depth||e.depth,a=void 0===e.stencil||e.stencil,o=void 0!==e.antialias&&e.antialias,s=void 0===e.premultipliedAlpha||e.premultipliedAlpha,l=void 0!==e.preserveDrawingBuffer&&e.preserveDrawingBuffer,u=void 0!==e.powerPreference?e.powerPreference:"default",c=void 0!==e.failIfMajorPerformanceCaveat&&e.failIfMajorPerformanceCaveat;t=null!==i?i.getContextAttributes().alpha:void 0!==e.alpha&&e.alpha;var h=null,d=null,f=[],p=[];this.domElement=n,this.debug={checkShaderErrors:!0},this.autoClear=!0,this.autoClearColor=!0,this.autoClearDepth=!0,this.autoClearStencil=!0,this.sortObjects=!0,this.clippingPlanes=[],this.localClippingEnabled=!1,this.outputEncoding=Nt,this.physicallyCorrectLights=!1,this.toneMapping=ue,this.toneMappingExposure=1;var A=this,v=!1,g=0,y=0,x=null,w=-1,C=null,b=new Fn,_=new Fn,E=null,M=n.width,B=n.height,T=1,D=null,R=null,P=new Fn(0,0,M,B),L=new Fn(0,0,M,B),Q=!1,Z=new ea,N=!1,F=!1,U=null,j=new xi,O=new An,z=new Gn,G={background:null,fog:null,environment:null,overrideMaterial:null,isScene:!0};function H(){return null===x?T:1}var V,W,q,Y,J,X,K,$,ee,te,ne,ie,re,ae,oe,se,le,ce,he,de,fe,pe,Ae,ve,ge=i;function me(e,t){for(var i=0;i<e.length;i++){var r=e[i],a=n.getContext(r,t);if(null!==a)return a}return null}try{var ye={alpha:!0,depth:r,stencil:a,antialias:o,premultipliedAlpha:s,preserveDrawingBuffer:l,powerPreference:u,failIfMajorPerformanceCaveat:c};if("setAttribute"in n&&n.setAttribute("data-engine","three.js r".concat(m)),n.addEventListener("webglcontextlost",be,!1),n.addEventListener("webglcontextrestored",_e,!1),n.addEventListener("webglcontextcreationerror",Ee,!1),null===ge){var xe=["webgl2","webgl","experimental-webgl"];if(!0===A.isWebGL1Renderer&&xe.shift(),null===(ge=me(xe,ye)))throw me(xe)?new Error("Error creating WebGL context with your selected attributes."):new Error("Error creating WebGL context.")}void 0===ge.getShaderPrecisionFormat&&(ge.getShaderPrecisionFormat=function(){return{rangeMin:1,rangeMax:1,precision:1}})}catch(Oe){throw console.error("THREE.WebGLRenderer: "+Oe.message),Oe}function we(){V=new ka(ge),W=new ha(ge,V,e),V.init(W),pe=new Ms(ge,V,W),q=new _s(ge,V,W),Y=new Da,J=new ls,X=new Es(ge,V,q,J,W,pe,Y),K=new fa(A),$=new Sa(A),ee=new na(ge,W),Ae=new ua(ge,V,ee,W),te=new Ba(ge,ee,Y,Ae),ne=new Qa(ge,te,ee,Y),he=new La(ge,W,X),se=new da(J),ie=new ss(A,K,$,V,W,Ae,se),re=new Rs(A,J),ae=new ds,oe=new ms(V,W),ce=new la(A,K,$,q,ne,t,s),le=new bs(A,ne,W),ve=new Ps(ge,Y,W,q),de=new ca(ge,V,Y,W),fe=new Ta(ge,V,Y,W),Y.programs=ie.programs,A.capabilities=W,A.extensions=V,A.properties=J,A.renderLists=ae,A.shadowMap=le,A.state=q,A.info=Y}we();var Ce=new Ds(A,ge);function be(e){e.preventDefault(),console.log("THREE.WebGLRenderer: Context Lost."),v=!0}function _e(){console.log("THREE.WebGLRenderer: Context Restored."),v=!1;var e=Y.autoReset,t=le.enabled,n=le.autoUpdate,i=le.needsUpdate,r=le.type;we(),Y.autoReset=e,le.enabled=t,le.autoUpdate=n,le.needsUpdate=i,le.type=r}function Ee(e){console.error("THREE.WebGLRenderer: A WebGL context could not be created. Reason: ",e.statusMessage)}function Me(e){var t=e.target;t.removeEventListener("dispose",Me),function(e){(function(e){var t=J.get(e).programs;void 0!==t&&(t.forEach((function(e){ie.releaseProgram(e)})),e.isShaderMaterial&&ie.releaseShaderCache(e))})(e),J.remove(e)}(t)}this.xr=Ce,this.getContext=function(){return ge},this.getContextAttributes=function(){return ge.getContextAttributes()},this.forceContextLoss=function(){var e=V.get("WEBGL_lose_context");e&&e.loseContext()},this.forceContextRestore=function(){var e=V.get("WEBGL_lose_context");e&&e.restoreContext()},this.getPixelRatio=function(){return T},this.setPixelRatio=function(e){void 0!==e&&(T=e,this.setSize(M,B,!1))},this.getSize=function(e){return e.set(M,B)},this.setSize=function(e,t,i){Ce.isPresenting?console.warn("THREE.WebGLRenderer: Can't change size while VR device is presenting."):(M=e,B=t,n.width=Math.floor(e*T),n.height=Math.floor(t*T),!1!==i&&(n.style.width=e+"px",n.style.height=t+"px"),this.setViewport(0,0,e,t))},this.getDrawingBufferSize=function(e){return e.set(M*T,B*T).floor()},this.setDrawingBufferSize=function(e,t,i){M=e,B=t,T=i,n.width=Math.floor(e*i),n.height=Math.floor(t*i),this.setViewport(0,0,e,t)},this.getCurrentViewport=function(e){return e.copy(b)},this.getViewport=function(e){return e.copy(P)},this.setViewport=function(e,t,n,i){e.isVector4?P.set(e.x,e.y,e.z,e.w):P.set(e,t,n,i),q.viewport(b.copy(P).multiplyScalar(T).floor())},this.getScissor=function(e){return e.copy(L)},this.setScissor=function(e,t,n,i){e.isVector4?L.set(e.x,e.y,e.z,e.w):L.set(e,t,n,i),q.scissor(_.copy(L).multiplyScalar(T).floor())},this.getScissorTest=function(){return Q},this.setScissorTest=function(e){q.setScissorTest(Q=e)},this.setOpaqueSort=function(e){D=e},this.setTransparentSort=function(e){R=e},this.getClearColor=function(e){return e.copy(ce.getClearColor())},this.setClearColor=function(){ce.setClearColor.apply(ce,arguments)},this.getClearAlpha=function(){return ce.getClearAlpha()},this.setClearAlpha=function(){ce.setClearAlpha.apply(ce,arguments)},this.clear=function(){var e=0;(!(arguments.length>0&&void 0!==arguments[0])||arguments[0])&&(e|=16384),(!(arguments.length>1&&void 0!==arguments[1])||arguments[1])&&(e|=256),(!(arguments.length>2&&void 0!==arguments[2])||arguments[2])&&(e|=1024),ge.clear(e)},this.clearColor=function(){this.clear(!0,!1,!1)},this.clearDepth=function(){this.clear(!1,!0,!1)},this.clearStencil=function(){this.clear(!1,!1,!0)},this.dispose=function(){n.removeEventListener("webglcontextlost",be,!1),n.removeEventListener("webglcontextrestored",_e,!1),n.removeEventListener("webglcontextcreationerror",Ee,!1),ae.dispose(),oe.dispose(),J.dispose(),K.dispose(),$.dispose(),ne.dispose(),Ae.dispose(),ve.dispose(),ie.dispose(),Ce.dispose(),Ce.removeEventListener("sessionstart",Be),Ce.removeEventListener("sessionend",Te),U&&(U.dispose(),U=null),De.stop()},this.renderBufferDirect=function(e,t,n,i,r,a){null===t&&(t=G);var o=r.isMesh&&r.matrixWorld.determinant()<0,s=function(e,t,n,i,r){!0!==t.isScene&&(t=G);X.resetTextureUnits();var a=t.fog,o=i.isMeshStandardMaterial?t.environment:null,s=null===x?A.outputEncoding:!0===x.isXRRenderTarget?x.texture.encoding:Nt,l=(i.isMeshStandardMaterial?$:K).get(i.envMap||o),u=!0===i.vertexColors&&!!n.attributes.color&&4===n.attributes.color.itemSize,c=!!i.normalMap&&!!n.attributes.tangent,h=!!n.morphAttributes.position,f=!!n.morphAttributes.normal,p=!!n.morphAttributes.color,v=i.toneMapped?A.toneMapping:ue,g=n.morphAttributes.position||n.morphAttributes.normal||n.morphAttributes.color,m=void 0!==g?g.length:0,y=J.get(i),b=d.state.lights;if(!0===N&&(!0===F||e!==C)){var _=e===C&&i.id===w;se.setState(i,e,_)}var E=!1;i.version===y.__version?y.needsLights&&y.lightsStateVersion!==b.state.version||y.outputEncoding!==s||r.isInstancedMesh&&!1===y.instancing?E=!0:r.isInstancedMesh||!0!==y.instancing?r.isSkinnedMesh&&!1===y.skinning?E=!0:r.isSkinnedMesh||!0!==y.skinning?y.envMap!==l||!0===i.fog&&y.fog!==a?E=!0:void 0===y.numClippingPlanes||y.numClippingPlanes===se.numPlanes&&y.numIntersection===se.numIntersection?(y.vertexAlphas!==u||y.vertexTangents!==c||y.morphTargets!==h||y.morphNormals!==f||y.morphColors!==p||y.toneMapping!==v||!0===W.isWebGL2&&y.morphTargetsCount!==m)&&(E=!0):E=!0:E=!0:E=!0:(E=!0,y.__version=i.version);var M=y.currentProgram;!0===E&&(M=Fe(i,t,r));var I=!1,S=!1,k=!1,D=M.getUniforms(),R=y.uniforms;q.useProgram(M.program)&&(I=!0,S=!0,k=!0);i.id!==w&&(w=i.id,S=!0);if(I||C!==e){if(D.setValue(ge,"projectionMatrix",e.projectionMatrix),W.logarithmicDepthBuffer&&D.setValue(ge,"logDepthBufFC",2/(Math.log(e.far+1)/Math.LN2)),C!==e&&(C=e,S=!0,k=!0),i.isShaderMaterial||i.isMeshPhongMaterial||i.isMeshToonMaterial||i.isMeshStandardMaterial||i.envMap){var P=D.map.cameraPosition;void 0!==P&&P.setValue(ge,z.setFromMatrixPosition(e.matrixWorld))}(i.isMeshPhongMaterial||i.isMeshToonMaterial||i.isMeshLambertMaterial||i.isMeshBasicMaterial||i.isMeshStandardMaterial||i.isShaderMaterial)&&D.setValue(ge,"isOrthographic",!0===e.isOrthographicCamera),(i.isMeshPhongMaterial||i.isMeshToonMaterial||i.isMeshLambertMaterial||i.isMeshBasicMaterial||i.isMeshStandardMaterial||i.isShaderMaterial||i.isShadowMaterial||r.isSkinnedMesh)&&D.setValue(ge,"viewMatrix",e.matrixWorldInverse)}if(r.isSkinnedMesh){D.setOptional(ge,r,"bindMatrix"),D.setOptional(ge,r,"bindMatrixInverse");var L=r.skeleton;L&&(W.floatVertexTextures?(null===L.boneTexture&&L.computeBoneTexture(),D.setValue(ge,"boneTexture",L.boneTexture,X),D.setValue(ge,"boneTextureSize",L.boneTextureSize)):console.warn("THREE.WebGLRenderer: SkinnedMesh can only be used with WebGL 2. With WebGL 1 OES_texture_float and vertex textures support is required."))}var Q=n.morphAttributes;(void 0!==Q.position||void 0!==Q.normal||void 0!==Q.color&&!0===W.isWebGL2)&&he.update(r,n,i,M);(S||y.receiveShadow!==r.receiveShadow)&&(y.receiveShadow=r.receiveShadow,D.setValue(ge,"receiveShadow",r.receiveShadow));i.isMeshGouraudMaterial&&null!==i.envMap&&(R.envMap.value=l,R.flipEnvMap.value=l.isCubeTexture&&!1===l.isRenderTargetTexture?-1:1);S&&(D.setValue(ge,"toneMappingExposure",A.toneMappingExposure),y.needsLights&&(j=k,(Z=R).ambientLightColor.needsUpdate=j,Z.lightProbe.needsUpdate=j,Z.directionalLights.needsUpdate=j,Z.directionalLightShadows.needsUpdate=j,Z.pointLights.needsUpdate=j,Z.pointLightShadows.needsUpdate=j,Z.spotLights.needsUpdate=j,Z.spotLightShadows.needsUpdate=j,Z.rectAreaLights.needsUpdate=j,Z.hemisphereLights.needsUpdate=j),a&&!0===i.fog&&re.refreshFogUniforms(R,a),re.refreshMaterialUniforms(R,i,T,B,U),jo.upload(ge,y.uniformsList,R,X));var Z,j;i.isShaderMaterial&&!0===i.uniformsNeedUpdate&&(jo.upload(ge,y.uniformsList,R,X),i.uniformsNeedUpdate=!1);i.isSpriteMaterial&&D.setValue(ge,"center",r.center);if(D.setValue(ge,"modelViewMatrix",r.modelViewMatrix),D.setValue(ge,"normalMatrix",r.normalMatrix),D.setValue(ge,"modelMatrix",r.matrixWorld),i.isShaderMaterial||i.isRawShaderMaterial)for(var O=i.uniformsGroups,H=0,V=O.length;H<V;H++)if(W.isWebGL2){var Y=O[H];ve.update(Y,M),ve.bind(Y,M)}else console.warn("THREE.WebGLRenderer: Uniform Buffer Objects can only be used with WebGL 2.");return M}(e,t,n,i,r);q.setMaterial(i,o);var l=n.index,u=1;!0===i.wireframe&&(l=te.getWireframeAttribute(n),u=2);var c=n.drawRange,h=n.attributes.position,f=c.start*u,p=(c.start+c.count)*u;null!==a&&(f=Math.max(f,a.start*u),p=Math.min(p,(a.start+a.count)*u)),null!==l?(f=Math.max(f,0),p=Math.min(p,l.count)):void 0!==h&&null!==h&&(f=Math.max(f,0),p=Math.min(p,h.count));var v=p-f;if(!(v<0||v===1/0)){var g;Ae.setup(r,i,s,n,l);var m=de;if(null!==l&&(g=ee.get(l),(m=fe).setIndex(g)),r.isMesh)!0===i.wireframe?(q.setLineWidth(i.wireframeLinewidth*H()),m.setMode(1)):m.setMode(4);else if(r.isLine){var y=i.linewidth;void 0===y&&(y=1),q.setLineWidth(y*H()),r.isLineSegments?m.setMode(1):r.isLineLoop?m.setMode(2):m.setMode(3)}else r.isPoints?m.setMode(0):r.isSprite&&m.setMode(4);if(r.isInstancedMesh)m.renderInstances(f,v,r.count);else if(n.isInstancedBufferGeometry){var b=void 0!==n._maxInstanceCount?n._maxInstanceCount:1/0,_=Math.min(n.instanceCount,b);m.renderInstances(f,v,_)}else m.render(f,v)}},this.compile=function(e,t){function n(e,t,n){!0===e.transparent&&e.side===k&&!1===e.forceSinglePass?(e.side=S,e.needsUpdate=!0,Fe(e,t,n),e.side=I,e.needsUpdate=!0,Fe(e,t,n),e.side=k):Fe(e,t,n)}(d=oe.get(e)).init(),p.push(d),e.traverseVisible((function(e){e.isLight&&e.layers.test(t.layers)&&(d.pushLight(e),e.castShadow&&d.pushShadow(e))})),d.setupLights(A.physicallyCorrectLights),e.traverse((function(t){var i=t.material;if(i)if(Array.isArray(i))for(var r=0;r<i.length;r++){n(i[r],e,t)}else n(i,e,t)})),p.pop(),d=null};var Ie=null;function Be(){De.stop()}function Te(){De.start()}var De=new ta;function Re(e,t,n,i){if(!1!==e.visible){if(e.layers.test(t.layers))if(e.isGroup)n=e.renderOrder;else if(e.isLOD)!0===e.autoUpdate&&e.update(t);else if(e.isLight)d.pushLight(e),e.castShadow&&d.pushShadow(e);else if(e.isSprite){if(!e.frustumCulled||Z.intersectsSprite(e)){i&&z.setFromMatrixPosition(e.matrixWorld).applyMatrix4(j);var r=ne.update(e),a=e.material;a.visible&&h.push(e,r,a,n,z.z,null)}}else if((e.isMesh||e.isLine||e.isPoints)&&(e.isSkinnedMesh&&e.skeleton.frame!==Y.render.frame&&(e.skeleton.update(),e.skeleton.frame=Y.render.frame),!e.frustumCulled||Z.intersectsObject(e))){i&&z.setFromMatrixPosition(e.matrixWorld).applyMatrix4(j);var o=ne.update(e),s=e.material;if(Array.isArray(s))for(var l=o.groups,u=0,c=l.length;u<c;u++){var f=l[u],p=s[f.materialIndex];p&&p.visible&&h.push(e,o,p,n,z.z,f)}else s.visible&&h.push(e,o,s,n,z.z,null)}for(var A=e.children,v=0,g=A.length;v<g;v++)Re(A[v],t,n,i)}}function Pe(e,t,n,i){var r=e.opaque,a=e.transmissive,s=e.transparent;d.setupLightsView(n),!0===N&&se.setGlobalState(A.clippingPlanes,n),a.length>0&&function(e,t,n){var i=W.isWebGL2;null===U&&(U=new Un(1,1,{generateMipmaps:!0,type:V.has("EXT_color_buffer_half_float")?Qe:ke,minFilter:Se,samples:i&&!0===o?4:0}));A.getDrawingBufferSize(O),i?U.setSize(O.x,O.y):U.setSize(hn(O.x),hn(O.y));var r=A.getRenderTarget();A.setRenderTarget(U),A.clear();var a=A.toneMapping;A.toneMapping=ue,Ze(e,t,n),A.toneMapping=a,X.updateMultisampleRenderTarget(U),X.updateRenderTargetMipmap(U),A.setRenderTarget(r)}(r,t,n),i&&q.viewport(b.copy(i)),r.length>0&&Ze(r,t,n),a.length>0&&Ze(a,t,n),s.length>0&&Ze(s,t,n),q.buffers.depth.setTest(!0),q.buffers.depth.setMask(!0),q.buffers.color.setMask(!0),q.setPolygonOffset(!1)}function Ze(e,t,n){for(var i=!0===t.isScene?t.overrideMaterial:null,r=0,a=e.length;r<a;r++){var o=e[r],s=o.object,l=o.geometry,u=null===i?o.material:i,c=o.group;s.layers.test(n.layers)&&Ne(s,t,n,l,u,c)}}function Ne(e,t,n,i,r,a){e.onBeforeRender(A,t,n,i,r,a),e.modelViewMatrix.multiplyMatrices(n.matrixWorldInverse,e.matrixWorld),e.normalMatrix.getNormalMatrix(e.modelViewMatrix),r.onBeforeRender(A,t,n,i,e,a),!0===r.transparent&&r.side===k&&!1===r.forceSinglePass?(r.side=S,r.needsUpdate=!0,A.renderBufferDirect(n,t,i,r,e,a),r.side=I,r.needsUpdate=!0,A.renderBufferDirect(n,t,i,r,e,a),r.side=k):A.renderBufferDirect(n,t,i,r,e,a),e.onAfterRender(A,t,n,i,r,a)}function Fe(e,t,n){!0!==t.isScene&&(t=G);var i=J.get(e),r=d.state.lights,a=d.state.shadowsArray,o=r.state.version,s=ie.getParameters(e,r.state,a,t,n),l=ie.getProgramCacheKey(s),u=i.programs;i.environment=e.isMeshStandardMaterial?t.environment:null,i.fog=t.fog,i.envMap=(e.isMeshStandardMaterial?$:K).get(e.envMap||i.environment),void 0===u&&(e.addEventListener("dispose",Me),u=new Map,i.programs=u);var c=u.get(l);if(void 0!==c){if(i.currentProgram===c&&i.lightsStateVersion===o)return Ue(e,s),c}else s.uniforms=ie.getUniforms(e),e.onBuild(n,s,A),e.onBeforeCompile(s,A),c=ie.acquireProgram(s,l),u.set(l,c),i.uniforms=s.uniforms;var h=i.uniforms;(e.isShaderMaterial||e.isRawShaderMaterial)&&!0!==e.clipping||(h.clippingPlanes=se.uniform),Ue(e,s),i.needsLights=function(e){return e.isMeshLambertMaterial||e.isMeshToonMaterial||e.isMeshPhongMaterial||e.isMeshStandardMaterial||e.isShadowMaterial||e.isShaderMaterial&&!0===e.lights}(e),i.lightsStateVersion=o,i.needsLights&&(h.ambientLightColor.value=r.state.ambient,h.lightProbe.value=r.state.probe,h.directionalLights.value=r.state.directional,h.directionalLightShadows.value=r.state.directionalShadow,h.spotLights.value=r.state.spot,h.spotLightShadows.value=r.state.spotShadow,h.rectAreaLights.value=r.state.rectArea,h.ltc_1.value=r.state.rectAreaLTC1,h.ltc_2.value=r.state.rectAreaLTC2,h.pointLights.value=r.state.point,h.pointLightShadows.value=r.state.pointShadow,h.hemisphereLights.value=r.state.hemi,h.directionalShadowMap.value=r.state.directionalShadowMap,h.directionalShadowMatrix.value=r.state.directionalShadowMatrix,h.spotShadowMap.value=r.state.spotShadowMap,h.spotLightMatrix.value=r.state.spotLightMatrix,h.spotLightMap.value=r.state.spotLightMap,h.pointShadowMap.value=r.state.pointShadowMap,h.pointShadowMatrix.value=r.state.pointShadowMatrix);var f=c.getUniforms(),p=jo.seqWithValue(f.seq,h);return i.currentProgram=c,i.uniformsList=p,c}function Ue(e,t){var n=J.get(e);n.outputEncoding=t.outputEncoding,n.instancing=t.instancing,n.skinning=t.skinning,n.morphTargets=t.morphTargets,n.morphNormals=t.morphNormals,n.morphColors=t.morphColors,n.morphTargetsCount=t.morphTargetsCount,n.numClippingPlanes=t.numClippingPlanes,n.numIntersection=t.numClipIntersection,n.vertexAlphas=t.vertexAlphas,n.vertexTangents=t.vertexTangents,n.toneMapping=t.toneMapping}De.setAnimationLoop((function(e){Ie&&Ie(e)})),"undefined"!==typeof self&&De.setContext(self),this.setAnimationLoop=function(e){Ie=e,Ce.setAnimationLoop(e),null===e?De.stop():De.start()},Ce.addEventListener("sessionstart",Be),Ce.addEventListener("sessionend",Te),this.render=function(e,t){if(void 0===t||!0===t.isCamera){if(!0!==v){!0===e.matrixWorldAutoUpdate&&e.updateMatrixWorld(),null===t.parent&&!0===t.matrixWorldAutoUpdate&&t.updateMatrixWorld(),!0===Ce.enabled&&!0===Ce.isPresenting&&(!0===Ce.cameraAutoUpdate&&Ce.updateCamera(t),t=Ce.getCamera()),!0===e.isScene&&e.onBeforeRender(A,e,t,x),(d=oe.get(e,p.length)).init(),p.push(d),j.multiplyMatrices(t.projectionMatrix,t.matrixWorldInverse),Z.setFromProjectionMatrix(j),F=this.localClippingEnabled,N=se.init(this.clippingPlanes,F),(h=ae.get(e,f.length)).init(),f.push(h),Re(e,t,0,A.sortObjects),h.finish(),!0===A.sortObjects&&h.sort(D,R),!0===N&&se.beginShadows();var n=d.state.shadowsArray;if(le.render(n,e,t),!0===N&&se.endShadows(),!0===this.info.autoReset&&this.info.reset(),ce.render(h,e),d.setupLights(A.physicallyCorrectLights),t.isArrayCamera)for(var i=t.cameras,r=0,a=i.length;r<a;r++){var o=i[r];Pe(h,e,o,o.viewport)}else Pe(h,e,t);null!==x&&(X.updateMultisampleRenderTarget(x),X.updateRenderTargetMipmap(x)),!0===e.isScene&&e.onAfterRender(A,e,t),Ae.resetDefaultState(),w=-1,C=null,p.pop(),d=p.length>0?p[p.length-1]:null,f.pop(),h=f.length>0?f[f.length-1]:null}}else console.error("THREE.WebGLRenderer.render: camera is not an instance of THREE.Camera.")},this.getActiveCubeFace=function(){return g},this.getActiveMipmapLevel=function(){return y},this.getRenderTarget=function(){return x},this.setRenderTargetTextures=function(e,t,n){J.get(e.texture).__webglTexture=t,J.get(e.depthTexture).__webglTexture=n;var i=J.get(e);i.__hasExternalTextures=!0,i.__hasExternalTextures&&(i.__autoAllocateDepthBuffer=void 0===n,i.__autoAllocateDepthBuffer||!0===V.has("WEBGL_multisampled_render_to_texture")&&(console.warn("THREE.WebGLRenderer: Render-to-texture extension was disabled because an external texture was provided"),i.__useRenderToTexture=!1))},this.setRenderTargetFramebuffer=function(e,t){var n=J.get(e);n.__webglFramebuffer=t,n.__useDefaultFramebuffer=void 0===t},this.setRenderTarget=function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0;x=e,g=t,y=n;var i=!0,r=null,a=!1,o=!1;if(e){var s=J.get(e);void 0!==s.__useDefaultFramebuffer?(q.bindFramebuffer(36160,null),i=!1):void 0===s.__webglFramebuffer?X.setupRenderTarget(e):s.__hasExternalTextures&&X.rebindTextures(e,J.get(e.texture).__webglTexture,J.get(e.depthTexture).__webglTexture);var l=e.texture;(l.isData3DTexture||l.isDataArrayTexture||l.isCompressedArrayTexture)&&(o=!0);var u=J.get(e).__webglFramebuffer;e.isWebGLCubeRenderTarget?(r=u[t],a=!0):r=W.isWebGL2&&e.samples>0&&!1===X.useMultisampledRTT(e)?J.get(e).__webglMultisampledFramebuffer:u,b.copy(e.viewport),_.copy(e.scissor),E=e.scissorTest}else b.copy(P).multiplyScalar(T).floor(),_.copy(L).multiplyScalar(T).floor(),E=Q;if(q.bindFramebuffer(36160,r)&&W.drawBuffers&&i&&q.drawBuffers(e,r),q.viewport(b),q.scissor(_),q.setScissorTest(E),a){var c=J.get(e.texture);ge.framebufferTexture2D(36160,36064,34069+t,c.__webglTexture,n)}else if(o){var h=J.get(e.texture),d=t||0;ge.framebufferTextureLayer(36160,36064,h.__webglTexture,n||0,d)}w=-1},this.readRenderTargetPixels=function(e,t,n,i,r,a,o){if(e&&e.isWebGLRenderTarget){var s=J.get(e).__webglFramebuffer;if(e.isWebGLCubeRenderTarget&&void 0!==o&&(s=s[o]),s){q.bindFramebuffer(36160,s);try{var l=e.texture,u=l.format,c=l.type;if(u!==je&&pe.convert(u)!==ge.getParameter(35739))return void console.error("THREE.WebGLRenderer.readRenderTargetPixels: renderTarget is not in RGBA or implementation defined format.");var h=c===Qe&&(V.has("EXT_color_buffer_half_float")||W.isWebGL2&&V.has("EXT_color_buffer_float"));if(c!==ke&&pe.convert(c)!==ge.getParameter(35738)&&(c!==Le||!(W.isWebGL2||V.has("OES_texture_float")||V.has("WEBGL_color_buffer_float")))&&!h)return void console.error("THREE.WebGLRenderer.readRenderTargetPixels: renderTarget is not in UnsignedByteType or implementation defined type.");t>=0&&t<=e.width-i&&n>=0&&n<=e.height-r&&ge.readPixels(t,n,i,r,pe.convert(u),pe.convert(c),a)}finally{var d=null!==x?J.get(x).__webglFramebuffer:null;q.bindFramebuffer(36160,d)}}}else console.error("THREE.WebGLRenderer.readRenderTargetPixels: renderTarget is not THREE.WebGLRenderTarget.")},this.copyFramebufferToTexture=function(e,t){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0,i=Math.pow(2,-n),r=Math.floor(t.image.width*i),a=Math.floor(t.image.height*i);X.setTexture2D(t,0),ge.copyTexSubImage2D(3553,n,0,0,e.x,e.y,r,a),q.unbindTexture()},this.copyTextureToTexture=function(e,t,n){var i=arguments.length>3&&void 0!==arguments[3]?arguments[3]:0,r=t.image.width,a=t.image.height,o=pe.convert(n.format),s=pe.convert(n.type);X.setTexture2D(n,0),ge.pixelStorei(37440,n.flipY),ge.pixelStorei(37441,n.premultiplyAlpha),ge.pixelStorei(3317,n.unpackAlignment),t.isDataTexture?ge.texSubImage2D(3553,i,e.x,e.y,r,a,o,s,t.image.data):t.isCompressedTexture?ge.compressedTexSubImage2D(3553,i,e.x,e.y,t.mipmaps[0].width,t.mipmaps[0].height,o,t.mipmaps[0].data):ge.texSubImage2D(3553,i,e.x,e.y,o,s,t.image),0===i&&n.generateMipmaps&&ge.generateMipmap(3553),q.unbindTexture()},this.copyTextureToTexture3D=function(e,t,n,i){var r=arguments.length>4&&void 0!==arguments[4]?arguments[4]:0;if(A.isWebGL1Renderer)console.warn("THREE.WebGLRenderer.copyTextureToTexture3D: can only be used with WebGL2.");else{var a,o=e.max.x-e.min.x+1,s=e.max.y-e.min.y+1,l=e.max.z-e.min.z+1,u=pe.convert(i.format),c=pe.convert(i.type);if(i.isData3DTexture)X.setTexture3D(i,0),a=32879;else{if(!i.isDataArrayTexture)return void console.warn("THREE.WebGLRenderer.copyTextureToTexture3D: only supports THREE.DataTexture3D and THREE.DataTexture2DArray.");X.setTexture2DArray(i,0),a=35866}ge.pixelStorei(37440,i.flipY),ge.pixelStorei(37441,i.premultiplyAlpha),ge.pixelStorei(3317,i.unpackAlignment);var h=ge.getParameter(3314),d=ge.getParameter(32878),f=ge.getParameter(3316),p=ge.getParameter(3315),v=ge.getParameter(32877),g=n.isCompressedTexture?n.mipmaps[0]:n.image;ge.pixelStorei(3314,g.width),ge.pixelStorei(32878,g.height),ge.pixelStorei(3316,e.min.x),ge.pixelStorei(3315,e.min.y),ge.pixelStorei(32877,e.min.z),n.isDataTexture||n.isData3DTexture?ge.texSubImage3D(a,r,t.x,t.y,t.z,o,s,l,u,c,g.data):n.isCompressedArrayTexture?(console.warn("THREE.WebGLRenderer.copyTextureToTexture3D: untested support for compressed srcTexture."),ge.compressedTexSubImage3D(a,r,t.x,t.y,t.z,o,s,l,u,g.data)):ge.texSubImage3D(a,r,t.x,t.y,t.z,o,s,l,u,c,g),ge.pixelStorei(3314,h),ge.pixelStorei(32878,d),ge.pixelStorei(3316,f),ge.pixelStorei(3315,p),ge.pixelStorei(32877,v),0===r&&i.generateMipmaps&&ge.generateMipmap(a),q.unbindTexture()}},this.initTexture=function(e){e.isCubeTexture?X.setTextureCube(e,0):e.isData3DTexture?X.setTexture3D(e,0):e.isDataArrayTexture||e.isCompressedArrayTexture?X.setTexture2DArray(e,0):X.setTexture2D(e,0),q.unbindTexture()},this.resetState=function(){g=0,y=0,x=null,q.reset(),Ae.reset()},"undefined"!==typeof Kt&&Kt.dispatchEvent(new CustomEvent("observe",{detail:this}))}var Qs=function(e){(0,d.Z)(n,e);var t=(0,f.Z)(n);function n(){return(0,v.Z)(this,n),t.apply(this,arguments)}return(0,g.Z)(n)}(Ls);Qs.prototype.isWebGL1Renderer=!0;var Zs,Ns=function(){function e(t){var n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:25e-5;(0,v.Z)(this,e),this.isFogExp2=!0,this.name="",this.color=new Rn(t),this.density=n}return(0,g.Z)(e,[{key:"clone",value:function(){return new e(this.color,this.density)}},{key:"toJSON",value:function(){return{type:"FogExp2",color:this.color.getHex(),density:this.density}}}]),e}(),Fs=function(){function e(t){var n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1,i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:1e3;(0,v.Z)(this,e),this.isFog=!0,this.name="",this.color=new Rn(t),this.near=n,this.far=i}return(0,g.Z)(e,[{key:"clone",value:function(){return new e(this.color,this.near,this.far)}},{key:"toJSON",value:function(){return{type:"Fog",color:this.color.getHex(),near:this.near,far:this.far}}}]),e}(),Us=function(e){(0,d.Z)(n,e);var t=(0,f.Z)(n);function n(){var e;return(0,v.Z)(this,n),(e=t.call(this)).isScene=!0,e.type="Scene",e.background=null,e.environment=null,e.fog=null,e.backgroundBlurriness=0,e.backgroundIntensity=1,e.overrideMaterial=null,"undefined"!==typeof Kt&&Kt.dispatchEvent(new CustomEvent("observe",{detail:(0,h.Z)(e)})),e}return(0,g.Z)(n,[{key:"copy",value:function(e,t){return(0,u.Z)((0,c.Z)(n.prototype),"copy",this).call(this,e,t),null!==e.background&&(this.background=e.background.clone()),null!==e.environment&&(this.environment=e.environment.clone()),null!==e.fog&&(this.fog=e.fog.clone()),this.backgroundBlurriness=e.backgroundBlurriness,this.backgroundIntensity=e.backgroundIntensity,null!==e.overrideMaterial&&(this.overrideMaterial=e.overrideMaterial.clone()),this.matrixAutoUpdate=e.matrixAutoUpdate,this}},{key:"toJSON",value:function(e){var t=(0,u.Z)((0,c.Z)(n.prototype),"toJSON",this).call(this,e);return null!==this.fog&&(t.object.fog=this.fog.toJSON()),this.backgroundBlurriness>0&&(t.object.backgroundBlurriness=this.backgroundBlurriness),1!==this.backgroundIntensity&&(t.object.backgroundIntensity=this.backgroundIntensity),t}},{key:"autoUpdate",get:function(){return console.warn("THREE.Scene: autoUpdate was renamed to matrixWorldAutoUpdate in r144."),this.matrixWorldAutoUpdate},set:function(e){console.warn("THREE.Scene: autoUpdate was renamed to matrixWorldAutoUpdate in r144."),this.matrixWorldAutoUpdate=e}}]),n}(Hi),js=function(){function e(t,n){(0,v.Z)(this,e),this.isInterleavedBuffer=!0,this.array=t,this.stride=n,this.count=void 0!==t?t.length/n:0,this.usage=Vt,this.updateRange={offset:0,count:-1},this.version=0,this.uuid=an()}return(0,g.Z)(e,[{key:"onUploadCallback",value:function(){}},{key:"needsUpdate",set:function(e){!0===e&&this.version++}},{key:"setUsage",value:function(e){return this.usage=e,this}},{key:"copy",value:function(e){return this.array=new e.array.constructor(e.array),this.count=e.count,this.stride=e.stride,this.usage=e.usage,this}},{key:"copyAt",value:function(e,t,n){e*=this.stride,n*=t.stride;for(var i=0,r=this.stride;i<r;i++)this.array[e+i]=t.array[n+i];return this}},{key:"set",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;return this.array.set(e,t),this}},{key:"clone",value:function(e){void 0===e.arrayBuffers&&(e.arrayBuffers={}),void 0===this.array.buffer._uuid&&(this.array.buffer._uuid=an()),void 0===e.arrayBuffers[this.array.buffer._uuid]&&(e.arrayBuffers[this.array.buffer._uuid]=this.array.slice(0).buffer);var t=new this.array.constructor(e.arrayBuffers[this.array.buffer._uuid]),n=new this.constructor(t,this.stride);return n.setUsage(this.usage),n}},{key:"onUpload",value:function(e){return this.onUploadCallback=e,this}},{key:"toJSON",value:function(e){return void 0===e.arrayBuffers&&(e.arrayBuffers={}),void 0===this.array.buffer._uuid&&(this.array.buffer._uuid=an()),void 0===e.arrayBuffers[this.array.buffer._uuid]&&(e.arrayBuffers[this.array.buffer._uuid]=Array.from(new Uint32Array(this.array.buffer))),{uuid:this.uuid,buffer:this.array.buffer._uuid,type:this.array.constructor.name,stride:this.stride}}}]),e}(),Os=new Gn,zs=function(){function e(t,n,i){var r=arguments.length>3&&void 0!==arguments[3]&&arguments[3];(0,v.Z)(this,e),this.isInterleavedBufferAttribute=!0,this.name="",this.data=t,this.itemSize=n,this.offset=i,this.normalized=r}return(0,g.Z)(e,[{key:"count",get:function(){return this.data.count}},{key:"array",get:function(){return this.data.array}},{key:"needsUpdate",set:function(e){this.data.needsUpdate=e}},{key:"applyMatrix4",value:function(e){for(var t=0,n=this.data.count;t<n;t++)Os.fromBufferAttribute(this,t),Os.applyMatrix4(e),this.setXYZ(t,Os.x,Os.y,Os.z);return this}},{key:"applyNormalMatrix",value:function(e){for(var t=0,n=this.count;t<n;t++)Os.fromBufferAttribute(this,t),Os.applyNormalMatrix(e),this.setXYZ(t,Os.x,Os.y,Os.z);return this}},{key:"transformDirection",value:function(e){for(var t=0,n=this.count;t<n;t++)Os.fromBufferAttribute(this,t),Os.transformDirection(e),this.setXYZ(t,Os.x,Os.y,Os.z);return this}},{key:"setX",value:function(e,t){return this.normalized&&(t=fn(t,this.array)),this.data.array[e*this.data.stride+this.offset]=t,this}},{key:"setY",value:function(e,t){return this.normalized&&(t=fn(t,this.array)),this.data.array[e*this.data.stride+this.offset+1]=t,this}},{key:"setZ",value:function(e,t){return this.normalized&&(t=fn(t,this.array)),this.data.array[e*this.data.stride+this.offset+2]=t,this}},{key:"setW",value:function(e,t){return this.normalized&&(t=fn(t,this.array)),this.data.array[e*this.data.stride+this.offset+3]=t,this}},{key:"getX",value:function(e){var t=this.data.array[e*this.data.stride+this.offset];return this.normalized&&(t=dn(t,this.array)),t}},{key:"getY",value:function(e){var t=this.data.array[e*this.data.stride+this.offset+1];return this.normalized&&(t=dn(t,this.array)),t}},{key:"getZ",value:function(e){var t=this.data.array[e*this.data.stride+this.offset+2];return this.normalized&&(t=dn(t,this.array)),t}},{key:"getW",value:function(e){var t=this.data.array[e*this.data.stride+this.offset+3];return this.normalized&&(t=dn(t,this.array)),t}},{key:"setXY",value:function(e,t,n){return e=e*this.data.stride+this.offset,this.normalized&&(t=fn(t,this.array),n=fn(n,this.array)),this.data.array[e+0]=t,this.data.array[e+1]=n,this}},{key:"setXYZ",value:function(e,t,n,i){return e=e*this.data.stride+this.offset,this.normalized&&(t=fn(t,this.array),n=fn(n,this.array),i=fn(i,this.array)),this.data.array[e+0]=t,this.data.array[e+1]=n,this.data.array[e+2]=i,this}},{key:"setXYZW",value:function(e,t,n,i,r){return e=e*this.data.stride+this.offset,this.normalized&&(t=fn(t,this.array),n=fn(n,this.array),i=fn(i,this.array),r=fn(r,this.array)),this.data.array[e+0]=t,this.data.array[e+1]=n,this.data.array[e+2]=i,this.data.array[e+3]=r,this}},{key:"clone",value:function(t){if(void 0===t){console.log("THREE.InterleavedBufferAttribute.clone(): Cloning an interleaved buffer attribute will de-interleave buffer data.");for(var n=[],i=0;i<this.count;i++)for(var r=i*this.data.stride+this.offset,a=0;a<this.itemSize;a++)n.push(this.data.array[r+a]);return new lr(new this.array.constructor(n),this.itemSize,this.normalized)}return void 0===t.interleavedBuffers&&(t.interleavedBuffers={}),void 0===t.interleavedBuffers[this.data.uuid]&&(t.interleavedBuffers[this.data.uuid]=this.data.clone(t)),new e(t.interleavedBuffers[this.data.uuid],this.itemSize,this.offset,this.normalized)}},{key:"toJSON",value:function(e){if(void 0===e){console.log("THREE.InterleavedBufferAttribute.toJSON(): Serializing an interleaved buffer attribute will de-interleave buffer data.");for(var t=[],n=0;n<this.count;n++)for(var i=n*this.data.stride+this.offset,r=0;r<this.itemSize;r++)t.push(this.data.array[i+r]);return{itemSize:this.itemSize,type:this.array.constructor.name,array:t,normalized:this.normalized}}return void 0===e.interleavedBuffers&&(e.interleavedBuffers={}),void 0===e.interleavedBuffers[this.data.uuid]&&(e.interleavedBuffers[this.data.uuid]=this.data.toJSON(e)),{isInterleavedBufferAttribute:!0,itemSize:this.itemSize,data:this.data.uuid,offset:this.offset,normalized:this.normalized}}}]),e}(),Gs=function(e){(0,d.Z)(n,e);var t=(0,f.Z)(n);function n(e){var i;return(0,v.Z)(this,n),(i=t.call(this)).isSpriteMaterial=!0,i.type="SpriteMaterial",i.color=new Rn(16777215),i.map=null,i.alphaMap=null,i.rotation=0,i.sizeAttenuation=!0,i.transparent=!0,i.fog=!0,i.setValues(e),i}return(0,g.Z)(n,[{key:"copy",value:function(e){return(0,u.Z)((0,c.Z)(n.prototype),"copy",this).call(this,e),this.color.copy(e.color),this.map=e.map,this.alphaMap=e.alphaMap,this.rotation=e.rotation,this.sizeAttenuation=e.sizeAttenuation,this.fog=e.fog,this}}]),n}(rr),Hs=new Gn,Vs=new Gn,Ws=new Gn,qs=new An,Ys=new An,Js=new xi,Xs=new Gn,Ks=new Gn,$s=new Gn,el=new An,tl=new An,nl=new An,il=function(e){(0,d.Z)(n,e);var t=(0,f.Z)(n);function n(e){var i;if((0,v.Z)(this,n),(i=t.call(this)).isSprite=!0,i.type="Sprite",void 0===Zs){Zs=new xr;var r=new Float32Array([-.5,-.5,0,0,0,.5,-.5,0,1,0,.5,.5,0,1,1,-.5,.5,0,0,1]),a=new js(r,5);Zs.setIndex([0,1,2,0,2,3]),Zs.setAttribute("position",new zs(a,3,0,!1)),Zs.setAttribute("uv",new zs(a,2,3,!1))}return i.geometry=Zs,i.material=void 0!==e?e:new Gs,i.center=new An(.5,.5),i}return(0,g.Z)(n,[{key:"raycast",value:function(e,t){null===e.camera&&console.error('THREE.Sprite: "Raycaster.camera" needs to be set in order to raycast against sprites.'),Vs.setFromMatrixScale(this.matrixWorld),Js.copy(e.camera.matrixWorld),this.modelViewMatrix.multiplyMatrices(e.camera.matrixWorldInverse,this.matrixWorld),Ws.setFromMatrixPosition(this.modelViewMatrix),e.camera.isPerspectiveCamera&&!1===this.material.sizeAttenuation&&Vs.multiplyScalar(-Ws.z);var n,i,r=this.material.rotation;0!==r&&(i=Math.cos(r),n=Math.sin(r));var a=this.center;rl(Xs.set(-.5,-.5,0),Ws,a,Vs,n,i),rl(Ks.set(.5,-.5,0),Ws,a,Vs,n,i),rl($s.set(.5,.5,0),Ws,a,Vs,n,i),el.set(0,0),tl.set(1,0),nl.set(1,1);var o=e.ray.intersectTriangle(Xs,Ks,$s,!1,Hs);if(null!==o||(rl(Ks.set(-.5,.5,0),Ws,a,Vs,n,i),tl.set(0,1),null!==(o=e.ray.intersectTriangle(Xs,$s,Ks,!1,Hs)))){var s=e.ray.origin.distanceTo(Hs);s<e.near||s>e.far||t.push({distance:s,point:Hs.clone(),uv:nr.getUV(Hs,Xs,Ks,$s,el,tl,nl,new An),face:null,object:this})}}},{key:"copy",value:function(e,t){return(0,u.Z)((0,c.Z)(n.prototype),"copy",this).call(this,e,t),void 0!==e.center&&this.center.copy(e.center),this.material=e.material,this}}]),n}(Hi);function rl(e,t,n,i,r,a){qs.subVectors(e,n).addScalar(.5).multiply(i),void 0!==r?(Ys.x=a*qs.x-r*qs.y,Ys.y=r*qs.x+a*qs.y):Ys.copy(qs),e.copy(t),e.x+=Ys.x,e.y+=Ys.y,e.applyMatrix4(Js)}var al=new Gn,ol=new Fn,sl=new Fn,ll=new Gn,ul=new xi,cl=function(e){(0,d.Z)(n,e);var t=(0,f.Z)(n);function n(e,i){var r;return(0,v.Z)(this,n),(r=t.call(this,e,i)).isSkinnedMesh=!0,r.type="SkinnedMesh",r.bindMode="attached",r.bindMatrix=new xi,r.bindMatrixInverse=new xi,r}return(0,g.Z)(n,[{key:"copy",value:function(e,t){return(0,u.Z)((0,c.Z)(n.prototype),"copy",this).call(this,e,t),this.bindMode=e.bindMode,this.bindMatrix.copy(e.bindMatrix),this.bindMatrixInverse.copy(e.bindMatrixInverse),this.skeleton=e.skeleton,this}},{key:"bind",value:function(e,t){this.skeleton=e,void 0===t&&(this.updateMatrixWorld(!0),this.skeleton.calculateInverses(),t=this.matrixWorld),this.bindMatrix.copy(t),this.bindMatrixInverse.copy(t).invert()}},{key:"pose",value:function(){this.skeleton.pose()}},{key:"normalizeSkinWeights",value:function(){for(var e=new Fn,t=this.geometry.attributes.skinWeight,n=0,i=t.count;n<i;n++){e.fromBufferAttribute(t,n);var r=1/e.manhattanLength();r!==1/0?e.multiplyScalar(r):e.set(1,0,0,0),t.setXYZW(n,e.x,e.y,e.z,e.w)}}},{key:"updateMatrixWorld",value:function(e){(0,u.Z)((0,c.Z)(n.prototype),"updateMatrixWorld",this).call(this,e),"attached"===this.bindMode?this.bindMatrixInverse.copy(this.matrixWorld).invert():"detached"===this.bindMode?this.bindMatrixInverse.copy(this.bindMatrix).invert():console.warn("THREE.SkinnedMesh: Unrecognized bindMode: "+this.bindMode)}},{key:"boneTransform",value:function(e,t){var n=this.skeleton,i=this.geometry;ol.fromBufferAttribute(i.attributes.skinIndex,e),sl.fromBufferAttribute(i.attributes.skinWeight,e),al.copy(t).applyMatrix4(this.bindMatrix),t.set(0,0,0);for(var r=0;r<4;r++){var a=sl.getComponent(r);if(0!==a){var o=ol.getComponent(r);ul.multiplyMatrices(n.bones[o].matrixWorld,n.boneInverses[o]),t.addScaledVector(ll.copy(al).applyMatrix4(ul),a)}}return t.applyMatrix4(this.bindMatrixInverse)}}]),n}(Pr),hl=function(e){(0,d.Z)(n,e);var t=(0,f.Z)(n);function n(){var e;return(0,v.Z)(this,n),(e=t.call(this)).isBone=!0,e.type="Bone",e}return(0,g.Z)(n)}(Hi),dl=function(e){(0,d.Z)(n,e);var t=(0,f.Z)(n);function n(){var e,i=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null,r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1,a=arguments.length>2&&void 0!==arguments[2]?arguments[2]:1,o=arguments.length>3?arguments[3]:void 0,s=arguments.length>4?arguments[4]:void 0,l=arguments.length>5?arguments[5]:void 0,u=arguments.length>6?arguments[6]:void 0,c=arguments.length>7?arguments[7]:void 0,h=arguments.length>8&&void 0!==arguments[8]?arguments[8]:be,d=arguments.length>9&&void 0!==arguments[9]?arguments[9]:be,f=arguments.length>10?arguments[10]:void 0,p=arguments.length>11?arguments[11]:void 0;return(0,v.Z)(this,n),(e=t.call(this,null,l,u,c,h,d,o,s,f,p)).isDataTexture=!0,e.image={data:i,width:r,height:a},e.generateMipmaps=!1,e.flipY=!1,e.unpackAlignment=1,e}return(0,g.Z)(n)}(Nn),fl=new xi,pl=new xi,Al=function(){function e(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[],n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:[];(0,v.Z)(this,e),this.uuid=an(),this.bones=t.slice(0),this.boneInverses=n,this.boneMatrices=null,this.boneTexture=null,this.boneTextureSize=0,this.frame=-1,this.init()}return(0,g.Z)(e,[{key:"init",value:function(){var e=this.bones,t=this.boneInverses;if(this.boneMatrices=new Float32Array(16*e.length),0===t.length)this.calculateInverses();else if(e.length!==t.length){console.warn("THREE.Skeleton: Number of inverse bone matrices does not match amount of bones."),this.boneInverses=[];for(var n=0,i=this.bones.length;n<i;n++)this.boneInverses.push(new xi)}}},{key:"calculateInverses",value:function(){this.boneInverses.length=0;for(var e=0,t=this.bones.length;e<t;e++){var n=new xi;this.bones[e]&&n.copy(this.bones[e].matrixWorld).invert(),this.boneInverses.push(n)}}},{key:"pose",value:function(){for(var e=0,t=this.bones.length;e<t;e++){var n=this.bones[e];n&&n.matrixWorld.copy(this.boneInverses[e]).invert()}for(var i=0,r=this.bones.length;i<r;i++){var a=this.bones[i];a&&(a.parent&&a.parent.isBone?(a.matrix.copy(a.parent.matrixWorld).invert(),a.matrix.multiply(a.matrixWorld)):a.matrix.copy(a.matrixWorld),a.matrix.decompose(a.position,a.quaternion,a.scale))}}},{key:"update",value:function(){for(var e=this.bones,t=this.boneInverses,n=this.boneMatrices,i=this.boneTexture,r=0,a=e.length;r<a;r++){var o=e[r]?e[r].matrixWorld:pl;fl.multiplyMatrices(o,t[r]),fl.toArray(n,16*r)}null!==i&&(i.needsUpdate=!0)}},{key:"clone",value:function(){return new e(this.bones,this.boneInverses)}},{key:"computeBoneTexture",value:function(){var e=Math.sqrt(4*this.bones.length);e=cn(e),e=Math.max(e,4);var t=new Float32Array(e*e*4);t.set(this.boneMatrices);var n=new dl(t,e,e,je,Le);return n.needsUpdate=!0,this.boneMatrices=t,this.boneTexture=n,this.boneTextureSize=e,this}},{key:"getBoneByName",value:function(e){for(var t=0,n=this.bones.length;t<n;t++){var i=this.bones[t];if(i.name===e)return i}}},{key:"dispose",value:function(){null!==this.boneTexture&&(this.boneTexture.dispose(),this.boneTexture=null)}},{key:"fromJSON",value:function(e,t){this.uuid=e.uuid;for(var n=0,i=e.bones.length;n<i;n++){var r=e.bones[n],a=t[r];void 0===a&&(console.warn("THREE.Skeleton: No bone found with UUID:",r),a=new hl),this.bones.push(a),this.boneInverses.push((new xi).fromArray(e.boneInverses[n]))}return this.init(),this}},{key:"toJSON",value:function(){var e={metadata:{version:4.5,type:"Skeleton",generator:"Skeleton.toJSON"},bones:[],boneInverses:[]};e.uuid=this.uuid;for(var t=this.bones,n=this.boneInverses,i=0,r=t.length;i<r;i++){var a=t[i];e.bones.push(a.uuid);var o=n[i];e.boneInverses.push(o.toArray())}return e}}]),e}(),vl=function(e){(0,d.Z)(n,e);var t=(0,f.Z)(n);function n(e,i,r){var a,o=arguments.length>3&&void 0!==arguments[3]?arguments[3]:1;return(0,v.Z)(this,n),(a=t.call(this,e,i,r)).isInstancedBufferAttribute=!0,a.meshPerAttribute=o,a}return(0,g.Z)(n,[{key:"copy",value:function(e){return(0,u.Z)((0,c.Z)(n.prototype),"copy",this).call(this,e),this.meshPerAttribute=e.meshPerAttribute,this}},{key:"toJSON",value:function(){var e=(0,u.Z)((0,c.Z)(n.prototype),"toJSON",this).call(this);return e.meshPerAttribute=this.meshPerAttribute,e.isInstancedBufferAttribute=!0,e}}]),n}(lr),gl=new xi,ml=new xi,yl=[],xl=new xi,wl=new Pr,Cl=function(e){(0,d.Z)(n,e);var t=(0,f.Z)(n);function n(e,i,r){var a;(0,v.Z)(this,n),(a=t.call(this,e,i)).isInstancedMesh=!0,a.instanceMatrix=new vl(new Float32Array(16*r),16),a.instanceColor=null,a.count=r,a.frustumCulled=!1;for(var o=0;o<r;o++)a.setMatrixAt(o,xl);return a}return(0,g.Z)(n,[{key:"copy",value:function(e,t){return(0,u.Z)((0,c.Z)(n.prototype),"copy",this).call(this,e,t),this.instanceMatrix.copy(e.instanceMatrix),null!==e.instanceColor&&(this.instanceColor=e.instanceColor.clone()),this.count=e.count,this}},{key:"getColorAt",value:function(e,t){t.fromArray(this.instanceColor.array,3*e)}},{key:"getMatrixAt",value:function(e,t){t.fromArray(this.instanceMatrix.array,16*e)}},{key:"raycast",value:function(e,t){var n=this.matrixWorld,i=this.count;if(wl.geometry=this.geometry,wl.material=this.material,void 0!==wl.material)for(var r=0;r<i;r++){this.getMatrixAt(r,gl),ml.multiplyMatrices(n,gl),wl.matrixWorld=ml,wl.raycast(e,yl);for(var a=0,o=yl.length;a<o;a++){var s=yl[a];s.instanceId=r,s.object=this,t.push(s)}yl.length=0}}},{key:"setColorAt",value:function(e,t){null===this.instanceColor&&(this.instanceColor=new vl(new Float32Array(3*this.instanceMatrix.count),3)),t.toArray(this.instanceColor.array,3*e)}},{key:"setMatrixAt",value:function(e,t){t.toArray(this.instanceMatrix.array,16*e)}},{key:"updateMorphTargets",value:function(){}},{key:"dispose",value:function(){this.dispatchEvent({type:"dispose"})}}]),n}(Pr),bl=function(e){(0,d.Z)(n,e);var t=(0,f.Z)(n);function n(e){var i;return(0,v.Z)(this,n),(i=t.call(this)).isLineBasicMaterial=!0,i.type="LineBasicMaterial",i.color=new Rn(16777215),i.linewidth=1,i.linecap="round",i.linejoin="round",i.fog=!0,i.setValues(e),i}return(0,g.Z)(n,[{key:"copy",value:function(e){return(0,u.Z)((0,c.Z)(n.prototype),"copy",this).call(this,e),this.color.copy(e.color),this.linewidth=e.linewidth,this.linecap=e.linecap,this.linejoin=e.linejoin,this.fog=e.fog,this}}]),n}(rr),_l=new Gn,El=new Gn,Ml=new xi,Il=new yi,Sl=new hi,kl=function(e){(0,d.Z)(n,e);var t=(0,f.Z)(n);function n(){var e,i=arguments.length>0&&void 0!==arguments[0]?arguments[0]:new xr,r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:new bl;return(0,v.Z)(this,n),(e=t.call(this)).isLine=!0,e.type="Line",e.geometry=i,e.material=r,e.updateMorphTargets(),e}return(0,g.Z)(n,[{key:"copy",value:function(e,t){return(0,u.Z)((0,c.Z)(n.prototype),"copy",this).call(this,e,t),this.material=e.material,this.geometry=e.geometry,this}},{key:"computeLineDistances",value:function(){var e=this.geometry;if(null===e.index){for(var t=e.attributes.position,n=[0],i=1,r=t.count;i<r;i++)_l.fromBufferAttribute(t,i-1),El.fromBufferAttribute(t,i),n[i]=n[i-1],n[i]+=_l.distanceTo(El);e.setAttribute("lineDistance",new dr(n,1))}else console.warn("THREE.Line.computeLineDistances(): Computation only possible with non-indexed BufferGeometry.");return this}},{key:"raycast",value:function(e,t){var n=this.geometry,i=this.matrixWorld,r=e.params.Line.threshold,a=n.drawRange;if(null===n.boundingSphere&&n.computeBoundingSphere(),Sl.copy(n.boundingSphere),Sl.applyMatrix4(i),Sl.radius+=r,!1!==e.ray.intersectsSphere(Sl)){Ml.copy(i).invert(),Il.copy(e.ray).applyMatrix4(Ml);var o=r/((this.scale.x+this.scale.y+this.scale.z)/3),s=o*o,l=new Gn,u=new Gn,c=new Gn,h=new Gn,d=this.isLineSegments?2:1,f=n.index,p=n.attributes.position;if(null!==f)for(var A=Math.max(0,a.start),v=Math.min(f.count,a.start+a.count)-1;A<v;A+=d){var g=f.getX(A),m=f.getX(A+1);if(l.fromBufferAttribute(p,g),u.fromBufferAttribute(p,m),!(Il.distanceSqToSegment(l,u,h,c)>s)){h.applyMatrix4(this.matrixWorld);var y=e.ray.origin.distanceTo(h);y<e.near||y>e.far||t.push({distance:y,point:c.clone().applyMatrix4(this.matrixWorld),index:A,face:null,faceIndex:null,object:this})}}else for(var x=Math.max(0,a.start),w=Math.min(p.count,a.start+a.count)-1;x<w;x+=d){if(l.fromBufferAttribute(p,x),u.fromBufferAttribute(p,x+1),!(Il.distanceSqToSegment(l,u,h,c)>s)){h.applyMatrix4(this.matrixWorld);var C=e.ray.origin.distanceTo(h);C<e.near||C>e.far||t.push({distance:C,point:c.clone().applyMatrix4(this.matrixWorld),index:x,face:null,faceIndex:null,object:this})}}}}},{key:"updateMorphTargets",value:function(){var e=this.geometry.morphAttributes,t=Object.keys(e);if(t.length>0){var n=e[t[0]];if(void 0!==n){this.morphTargetInfluences=[],this.morphTargetDictionary={};for(var i=0,r=n.length;i<r;i++){var a=n[i].name||String(i);this.morphTargetInfluences.push(0),this.morphTargetDictionary[a]=i}}}}}]),n}(Hi),Bl=new Gn,Tl=new Gn,Dl=function(e){(0,d.Z)(n,e);var t=(0,f.Z)(n);function n(e,i){var r;return(0,v.Z)(this,n),(r=t.call(this,e,i)).isLineSegments=!0,r.type="LineSegments",r}return(0,g.Z)(n,[{key:"computeLineDistances",value:function(){var e=this.geometry;if(null===e.index){for(var t=e.attributes.position,n=[],i=0,r=t.count;i<r;i+=2)Bl.fromBufferAttribute(t,i),Tl.fromBufferAttribute(t,i+1),n[i]=0===i?0:n[i-1],n[i+1]=n[i]+Bl.distanceTo(Tl);e.setAttribute("lineDistance",new dr(n,1))}else console.warn("THREE.LineSegments.computeLineDistances(): Computation only possible with non-indexed BufferGeometry.");return this}}]),n}(kl),Rl=function(e){(0,d.Z)(n,e);var t=(0,f.Z)(n);function n(e,i){var r;return(0,v.Z)(this,n),(r=t.call(this,e,i)).isLineLoop=!0,r.type="LineLoop",r}return(0,g.Z)(n)}(kl),Pl=function(e){(0,d.Z)(n,e);var t=(0,f.Z)(n);function n(e){var i;return(0,v.Z)(this,n),(i=t.call(this)).isPointsMaterial=!0,i.type="PointsMaterial",i.color=new Rn(16777215),i.map=null,i.alphaMap=null,i.size=1,i.sizeAttenuation=!0,i.fog=!0,i.setValues(e),i}return(0,g.Z)(n,[{key:"copy",value:function(e){return(0,u.Z)((0,c.Z)(n.prototype),"copy",this).call(this,e),this.color.copy(e.color),this.map=e.map,this.alphaMap=e.alphaMap,this.size=e.size,this.sizeAttenuation=e.sizeAttenuation,this.fog=e.fog,this}}]),n}(rr),Ll=new xi,Ql=new yi,Zl=new hi,Nl=new Gn,Fl=function(e){(0,d.Z)(n,e);var t=(0,f.Z)(n);function n(){var e,i=arguments.length>0&&void 0!==arguments[0]?arguments[0]:new xr,r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:new Pl;return(0,v.Z)(this,n),(e=t.call(this)).isPoints=!0,e.type="Points",e.geometry=i,e.material=r,e.updateMorphTargets(),e}return(0,g.Z)(n,[{key:"copy",value:function(e,t){return(0,u.Z)((0,c.Z)(n.prototype),"copy",this).call(this,e,t),this.material=e.material,this.geometry=e.geometry,this}},{key:"raycast",value:function(e,t){var n=this.geometry,i=this.matrixWorld,r=e.params.Points.threshold,a=n.drawRange;if(null===n.boundingSphere&&n.computeBoundingSphere(),Zl.copy(n.boundingSphere),Zl.applyMatrix4(i),Zl.radius+=r,!1!==e.ray.intersectsSphere(Zl)){Ll.copy(i).invert(),Ql.copy(e.ray).applyMatrix4(Ll);var o=r/((this.scale.x+this.scale.y+this.scale.z)/3),s=o*o,l=n.index,u=n.attributes.position;if(null!==l)for(var c=Math.max(0,a.start),h=Math.min(l.count,a.start+a.count);c<h;c++){var d=l.getX(c);Nl.fromBufferAttribute(u,d),Ul(Nl,d,s,i,e,t,this)}else for(var f=Math.max(0,a.start),p=Math.min(u.count,a.start+a.count);f<p;f++)Nl.fromBufferAttribute(u,f),Ul(Nl,f,s,i,e,t,this)}}},{key:"updateMorphTargets",value:function(){var e=this.geometry.morphAttributes,t=Object.keys(e);if(t.length>0){var n=e[t[0]];if(void 0!==n){this.morphTargetInfluences=[],this.morphTargetDictionary={};for(var i=0,r=n.length;i<r;i++){var a=n[i].name||String(i);this.morphTargetInfluences.push(0),this.morphTargetDictionary[a]=i}}}}}]),n}(Hi);function Ul(e,t,n,i,r,a,o){var s=Ql.distanceSqToPoint(e);if(s<n){var l=new Gn;Ql.closestPointToPoint(e,l),l.applyMatrix4(i);var u=r.ray.origin.distanceTo(l);if(u<r.near||u>r.far)return;a.push({distance:u,distanceToRay:Math.sqrt(s),point:l,index:t,face:null,object:o})}}var jl=function(e){(0,d.Z)(n,e);var t=(0,f.Z)(n);function n(e,i,r,a,o,s,l,u,c,h,d,f){var p;return(0,v.Z)(this,n),(p=t.call(this,null,s,l,u,c,h,a,o,d,f)).isCompressedTexture=!0,p.image={width:i,height:r},p.mipmaps=e,p.flipY=!1,p.generateMipmaps=!1,p}return(0,g.Z)(n)}(Nn),Ol=function(e){(0,d.Z)(n,e);var t=(0,f.Z)(n);function n(e,i,r,a,o,s){var l;return(0,v.Z)(this,n),(l=t.call(this,e,i,r,o,s)).isCompressedArrayTexture=!0,l.image.depth=a,l.wrapR=we,l}return(0,g.Z)(n)}(jl),zl=function(e){(0,d.Z)(n,e);var t=(0,f.Z)(n);function n(e,i,r,a,o,s,l,u,c){var h;return(0,v.Z)(this,n),(h=t.call(this,e,i,r,a,o,s,l,u,c)).isCanvasTexture=!0,h.needsUpdate=!0,h}return(0,g.Z)(n)}(Nn),Gl=function(){function e(){(0,v.Z)(this,e),this.type="Curve",this.arcLengthDivisions=200}return(0,g.Z)(e,[{key:"getPoint",value:function(){return console.warn("THREE.Curve: .getPoint() not implemented."),null}},{key:"getPointAt",value:function(e,t){var n=this.getUtoTmapping(e);return this.getPoint(n,t)}},{key:"getPoints",value:function(){for(var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:5,t=[],n=0;n<=e;n++)t.push(this.getPoint(n/e));return t}},{key:"getSpacedPoints",value:function(){for(var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:5,t=[],n=0;n<=e;n++)t.push(this.getPointAt(n/e));return t}},{key:"getLength",value:function(){var e=this.getLengths();return e[e.length-1]}},{key:"getLengths",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:this.arcLengthDivisions;if(this.cacheArcLengths&&this.cacheArcLengths.length===e+1&&!this.needsUpdate)return this.cacheArcLengths;this.needsUpdate=!1;var t,n=[],i=this.getPoint(0),r=0;n.push(0);for(var a=1;a<=e;a++)r+=(t=this.getPoint(a/e)).distanceTo(i),n.push(r),i=t;return this.cacheArcLengths=n,n}},{key:"updateArcLengths",value:function(){this.needsUpdate=!0,this.getLengths()}},{key:"getUtoTmapping",value:function(e,t){var n,i=this.getLengths(),r=0,a=i.length;n=t||e*i[a-1];for(var o,s=0,l=a-1;s<=l;)if((o=i[r=Math.floor(s+(l-s)/2)]-n)<0)s=r+1;else{if(!(o>0)){l=r;break}l=r-1}if(i[r=l]===n)return r/(a-1);var u=i[r];return(r+(n-u)/(i[r+1]-u))/(a-1)}},{key:"getTangent",value:function(e,t){var n=1e-4,i=e-n,r=e+n;i<0&&(i=0),r>1&&(r=1);var a=this.getPoint(i),o=this.getPoint(r),s=t||(a.isVector2?new An:new Gn);return s.copy(o).sub(a).normalize(),s}},{key:"getTangentAt",value:function(e,t){var n=this.getUtoTmapping(e);return this.getTangent(n,t)}},{key:"computeFrenetFrames",value:function(e,t){for(var n=new Gn,i=[],r=[],a=[],o=new Gn,s=new xi,l=0;l<=e;l++){var u=l/e;i[l]=this.getTangentAt(u,new Gn)}r[0]=new Gn,a[0]=new Gn;var c=Number.MAX_VALUE,h=Math.abs(i[0].x),d=Math.abs(i[0].y),f=Math.abs(i[0].z);h<=c&&(c=h,n.set(1,0,0)),d<=c&&(c=d,n.set(0,1,0)),f<=c&&n.set(0,0,1),o.crossVectors(i[0],n).normalize(),r[0].crossVectors(i[0],o),a[0].crossVectors(i[0],r[0]);for(var p=1;p<=e;p++){if(r[p]=r[p-1].clone(),a[p]=a[p-1].clone(),o.crossVectors(i[p-1],i[p]),o.length()>Number.EPSILON){o.normalize();var A=Math.acos(on(i[p-1].dot(i[p]),-1,1));r[p].applyMatrix4(s.makeRotationAxis(o,A))}a[p].crossVectors(i[p],r[p])}if(!0===t){var v=Math.acos(on(r[0].dot(r[e]),-1,1));v/=e,i[0].dot(o.crossVectors(r[0],r[e]))>0&&(v=-v);for(var g=1;g<=e;g++)r[g].applyMatrix4(s.makeRotationAxis(i[g],v*g)),a[g].crossVectors(i[g],r[g])}return{tangents:i,normals:r,binormals:a}}},{key:"clone",value:function(){return(new this.constructor).copy(this)}},{key:"copy",value:function(e){return this.arcLengthDivisions=e.arcLengthDivisions,this}},{key:"toJSON",value:function(){var e={metadata:{version:4.5,type:"Curve",generator:"Curve.toJSON"}};return e.arcLengthDivisions=this.arcLengthDivisions,e.type=this.type,e}},{key:"fromJSON",value:function(e){return this.arcLengthDivisions=e.arcLengthDivisions,this}}]),e}(),Hl=function(e){(0,d.Z)(n,e);var t=(0,f.Z)(n);function n(){var e,i=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,a=arguments.length>2&&void 0!==arguments[2]?arguments[2]:1,o=arguments.length>3&&void 0!==arguments[3]?arguments[3]:1,s=arguments.length>4&&void 0!==arguments[4]?arguments[4]:0,l=arguments.length>5&&void 0!==arguments[5]?arguments[5]:2*Math.PI,u=arguments.length>6&&void 0!==arguments[6]&&arguments[6],c=arguments.length>7&&void 0!==arguments[7]?arguments[7]:0;return(0,v.Z)(this,n),(e=t.call(this)).isEllipseCurve=!0,e.type="EllipseCurve",e.aX=i,e.aY=r,e.xRadius=a,e.yRadius=o,e.aStartAngle=s,e.aEndAngle=l,e.aClockwise=u,e.aRotation=c,e}return(0,g.Z)(n,[{key:"getPoint",value:function(e,t){for(var n=t||new An,i=2*Math.PI,r=this.aEndAngle-this.aStartAngle,a=Math.abs(r)<Number.EPSILON;r<0;)r+=i;for(;r>i;)r-=i;r<Number.EPSILON&&(r=a?0:i),!0!==this.aClockwise||a||(r===i?r=-i:r-=i);var o=this.aStartAngle+e*r,s=this.aX+this.xRadius*Math.cos(o),l=this.aY+this.yRadius*Math.sin(o);if(0!==this.aRotation){var u=Math.cos(this.aRotation),c=Math.sin(this.aRotation),h=s-this.aX,d=l-this.aY;s=h*u-d*c+this.aX,l=h*c+d*u+this.aY}return n.set(s,l)}},{key:"copy",value:function(e){return(0,u.Z)((0,c.Z)(n.prototype),"copy",this).call(this,e),this.aX=e.aX,this.aY=e.aY,this.xRadius=e.xRadius,this.yRadius=e.yRadius,this.aStartAngle=e.aStartAngle,this.aEndAngle=e.aEndAngle,this.aClockwise=e.aClockwise,this.aRotation=e.aRotation,this}},{key:"toJSON",value:function(){var e=(0,u.Z)((0,c.Z)(n.prototype),"toJSON",this).call(this);return e.aX=this.aX,e.aY=this.aY,e.xRadius=this.xRadius,e.yRadius=this.yRadius,e.aStartAngle=this.aStartAngle,e.aEndAngle=this.aEndAngle,e.aClockwise=this.aClockwise,e.aRotation=this.aRotation,e}},{key:"fromJSON",value:function(e){return(0,u.Z)((0,c.Z)(n.prototype),"fromJSON",this).call(this,e),this.aX=e.aX,this.aY=e.aY,this.xRadius=e.xRadius,this.yRadius=e.yRadius,this.aStartAngle=e.aStartAngle,this.aEndAngle=e.aEndAngle,this.aClockwise=e.aClockwise,this.aRotation=e.aRotation,this}}]),n}(Gl),Vl=function(e){(0,d.Z)(n,e);var t=(0,f.Z)(n);function n(e,i,r,a,o,s){var l;return(0,v.Z)(this,n),(l=t.call(this,e,i,r,r,a,o,s)).isArcCurve=!0,l.type="ArcCurve",l}return(0,g.Z)(n)}(Hl);function Wl(){var e=0,t=0,n=0,i=0;function r(r,a,o,s){e=r,t=o,n=-3*r+3*a-2*o-s,i=2*r-2*a+o+s}return{initCatmullRom:function(e,t,n,i,a){r(t,n,a*(n-e),a*(i-t))},initNonuniformCatmullRom:function(e,t,n,i,a,o,s){var l=(t-e)/a-(n-e)/(a+o)+(n-t)/o,u=(n-t)/o-(i-t)/(o+s)+(i-n)/s;r(t,n,l*=o,u*=o)},calc:function(r){var a=r*r;return e+t*r+n*a+i*(a*r)}}}var ql=new Gn,Yl=new Wl,Jl=new Wl,Xl=new Wl,Kl=function(e){(0,d.Z)(n,e);var t=(0,f.Z)(n);function n(){var e,i=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[],r=arguments.length>1&&void 0!==arguments[1]&&arguments[1],a=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"centripetal",o=arguments.length>3&&void 0!==arguments[3]?arguments[3]:.5;return(0,v.Z)(this,n),(e=t.call(this)).isCatmullRomCurve3=!0,e.type="CatmullRomCurve3",e.points=i,e.closed=r,e.curveType=a,e.tension=o,e}return(0,g.Z)(n,[{key:"getPoint",value:function(e){var t,n,i=arguments.length>1&&void 0!==arguments[1]?arguments[1]:new Gn,r=this.points,a=r.length,o=(a-(this.closed?0:1))*e,s=Math.floor(o),l=o-s;this.closed?s+=s>0?0:(Math.floor(Math.abs(s)/a)+1)*a:0===l&&s===a-1&&(s=a-2,l=1),this.closed||s>0?t=r[(s-1)%a]:(ql.subVectors(r[0],r[1]).add(r[0]),t=ql);var u=r[s%a],c=r[(s+1)%a];if(this.closed||s+2<a?n=r[(s+2)%a]:(ql.subVectors(r[a-1],r[a-2]).add(r[a-1]),n=ql),"centripetal"===this.curveType||"chordal"===this.curveType){var h="chordal"===this.curveType?.5:.25,d=Math.pow(t.distanceToSquared(u),h),f=Math.pow(u.distanceToSquared(c),h),p=Math.pow(c.distanceToSquared(n),h);f<1e-4&&(f=1),d<1e-4&&(d=f),p<1e-4&&(p=f),Yl.initNonuniformCatmullRom(t.x,u.x,c.x,n.x,d,f,p),Jl.initNonuniformCatmullRom(t.y,u.y,c.y,n.y,d,f,p),Xl.initNonuniformCatmullRom(t.z,u.z,c.z,n.z,d,f,p)}else"catmullrom"===this.curveType&&(Yl.initCatmullRom(t.x,u.x,c.x,n.x,this.tension),Jl.initCatmullRom(t.y,u.y,c.y,n.y,this.tension),Xl.initCatmullRom(t.z,u.z,c.z,n.z,this.tension));return i.set(Yl.calc(l),Jl.calc(l),Xl.calc(l)),i}},{key:"copy",value:function(e){(0,u.Z)((0,c.Z)(n.prototype),"copy",this).call(this,e),this.points=[];for(var t=0,i=e.points.length;t<i;t++){var r=e.points[t];this.points.push(r.clone())}return this.closed=e.closed,this.curveType=e.curveType,this.tension=e.tension,this}},{key:"toJSON",value:function(){var e=(0,u.Z)((0,c.Z)(n.prototype),"toJSON",this).call(this);e.points=[];for(var t=0,i=this.points.length;t<i;t++){var r=this.points[t];e.points.push(r.toArray())}return e.closed=this.closed,e.curveType=this.curveType,e.tension=this.tension,e}},{key:"fromJSON",value:function(e){(0,u.Z)((0,c.Z)(n.prototype),"fromJSON",this).call(this,e),this.points=[];for(var t=0,i=e.points.length;t<i;t++){var r=e.points[t];this.points.push((new Gn).fromArray(r))}return this.closed=e.closed,this.curveType=e.curveType,this.tension=e.tension,this}}]),n}(Gl);function $l(e,t,n,i,r){var a=.5*(i-t),o=.5*(r-n),s=e*e;return(2*n-2*i+a+o)*(e*s)+(-3*n+3*i-2*a-o)*s+a*e+n}function eu(e,t,n,i){return function(e,t){var n=1-e;return n*n*t}(e,t)+function(e,t){return 2*(1-e)*e*t}(e,n)+function(e,t){return e*e*t}(e,i)}function tu(e,t,n,i,r){return function(e,t){var n=1-e;return n*n*n*t}(e,t)+function(e,t){var n=1-e;return 3*n*n*e*t}(e,n)+function(e,t){return 3*(1-e)*e*e*t}(e,i)+function(e,t){return e*e*e*t}(e,r)}var nu=function(e){(0,d.Z)(n,e);var t=(0,f.Z)(n);function n(){var e,i=arguments.length>0&&void 0!==arguments[0]?arguments[0]:new An,r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:new An,a=arguments.length>2&&void 0!==arguments[2]?arguments[2]:new An,o=arguments.length>3&&void 0!==arguments[3]?arguments[3]:new An;return(0,v.Z)(this,n),(e=t.call(this)).isCubicBezierCurve=!0,e.type="CubicBezierCurve",e.v0=i,e.v1=r,e.v2=a,e.v3=o,e}return(0,g.Z)(n,[{key:"getPoint",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:new An,n=this.v0,i=this.v1,r=this.v2,a=this.v3;return t.set(tu(e,n.x,i.x,r.x,a.x),tu(e,n.y,i.y,r.y,a.y)),t}},{key:"copy",value:function(e){return(0,u.Z)((0,c.Z)(n.prototype),"copy",this).call(this,e),this.v0.copy(e.v0),this.v1.copy(e.v1),this.v2.copy(e.v2),this.v3.copy(e.v3),this}},{key:"toJSON",value:function(){var e=(0,u.Z)((0,c.Z)(n.prototype),"toJSON",this).call(this);return e.v0=this.v0.toArray(),e.v1=this.v1.toArray(),e.v2=this.v2.toArray(),e.v3=this.v3.toArray(),e}},{key:"fromJSON",value:function(e){return(0,u.Z)((0,c.Z)(n.prototype),"fromJSON",this).call(this,e),this.v0.fromArray(e.v0),this.v1.fromArray(e.v1),this.v2.fromArray(e.v2),this.v3.fromArray(e.v3),this}}]),n}(Gl),iu=function(e){(0,d.Z)(n,e);var t=(0,f.Z)(n);function n(){var e,i=arguments.length>0&&void 0!==arguments[0]?arguments[0]:new Gn,r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:new Gn,a=arguments.length>2&&void 0!==arguments[2]?arguments[2]:new Gn,o=arguments.length>3&&void 0!==arguments[3]?arguments[3]:new Gn;return(0,v.Z)(this,n),(e=t.call(this)).isCubicBezierCurve3=!0,e.type="CubicBezierCurve3",e.v0=i,e.v1=r,e.v2=a,e.v3=o,e}return(0,g.Z)(n,[{key:"getPoint",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:new Gn,n=this.v0,i=this.v1,r=this.v2,a=this.v3;return t.set(tu(e,n.x,i.x,r.x,a.x),tu(e,n.y,i.y,r.y,a.y),tu(e,n.z,i.z,r.z,a.z)),t}},{key:"copy",value:function(e){return(0,u.Z)((0,c.Z)(n.prototype),"copy",this).call(this,e),this.v0.copy(e.v0),this.v1.copy(e.v1),this.v2.copy(e.v2),this.v3.copy(e.v3),this}},{key:"toJSON",value:function(){var e=(0,u.Z)((0,c.Z)(n.prototype),"toJSON",this).call(this);return e.v0=this.v0.toArray(),e.v1=this.v1.toArray(),e.v2=this.v2.toArray(),e.v3=this.v3.toArray(),e}},{key:"fromJSON",value:function(e){return(0,u.Z)((0,c.Z)(n.prototype),"fromJSON",this).call(this,e),this.v0.fromArray(e.v0),this.v1.fromArray(e.v1),this.v2.fromArray(e.v2),this.v3.fromArray(e.v3),this}}]),n}(Gl),ru=function(e){(0,d.Z)(n,e);var t=(0,f.Z)(n);function n(){var e,i=arguments.length>0&&void 0!==arguments[0]?arguments[0]:new An,r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:new An;return(0,v.Z)(this,n),(e=t.call(this)).isLineCurve=!0,e.type="LineCurve",e.v1=i,e.v2=r,e}return(0,g.Z)(n,[{key:"getPoint",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:new An;return 1===e?t.copy(this.v2):(t.copy(this.v2).sub(this.v1),t.multiplyScalar(e).add(this.v1)),t}},{key:"getPointAt",value:function(e,t){return this.getPoint(e,t)}},{key:"getTangent",value:function(e,t){var n=t||new An;return n.copy(this.v2).sub(this.v1).normalize(),n}},{key:"copy",value:function(e){return(0,u.Z)((0,c.Z)(n.prototype),"copy",this).call(this,e),this.v1.copy(e.v1),this.v2.copy(e.v2),this}},{key:"toJSON",value:function(){var e=(0,u.Z)((0,c.Z)(n.prototype),"toJSON",this).call(this);return e.v1=this.v1.toArray(),e.v2=this.v2.toArray(),e}},{key:"fromJSON",value:function(e){return(0,u.Z)((0,c.Z)(n.prototype),"fromJSON",this).call(this,e),this.v1.fromArray(e.v1),this.v2.fromArray(e.v2),this}}]),n}(Gl),au=function(e){(0,d.Z)(n,e);var t=(0,f.Z)(n);function n(){var e,i=arguments.length>0&&void 0!==arguments[0]?arguments[0]:new Gn,r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:new Gn;return(0,v.Z)(this,n),(e=t.call(this)).isLineCurve3=!0,e.type="LineCurve3",e.v1=i,e.v2=r,e}return(0,g.Z)(n,[{key:"getPoint",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:new Gn;return 1===e?t.copy(this.v2):(t.copy(this.v2).sub(this.v1),t.multiplyScalar(e).add(this.v1)),t}},{key:"getPointAt",value:function(e,t){return this.getPoint(e,t)}},{key:"copy",value:function(e){return(0,u.Z)((0,c.Z)(n.prototype),"copy",this).call(this,e),this.v1.copy(e.v1),this.v2.copy(e.v2),this}},{key:"toJSON",value:function(){var e=(0,u.Z)((0,c.Z)(n.prototype),"toJSON",this).call(this);return e.v1=this.v1.toArray(),e.v2=this.v2.toArray(),e}},{key:"fromJSON",value:function(e){return(0,u.Z)((0,c.Z)(n.prototype),"fromJSON",this).call(this,e),this.v1.fromArray(e.v1),this.v2.fromArray(e.v2),this}}]),n}(Gl),ou=function(e){(0,d.Z)(n,e);var t=(0,f.Z)(n);function n(){var e,i=arguments.length>0&&void 0!==arguments[0]?arguments[0]:new An,r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:new An,a=arguments.length>2&&void 0!==arguments[2]?arguments[2]:new An;return(0,v.Z)(this,n),(e=t.call(this)).isQuadraticBezierCurve=!0,e.type="QuadraticBezierCurve",e.v0=i,e.v1=r,e.v2=a,e}return(0,g.Z)(n,[{key:"getPoint",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:new An,n=this.v0,i=this.v1,r=this.v2;return t.set(eu(e,n.x,i.x,r.x),eu(e,n.y,i.y,r.y)),t}},{key:"copy",value:function(e){return(0,u.Z)((0,c.Z)(n.prototype),"copy",this).call(this,e),this.v0.copy(e.v0),this.v1.copy(e.v1),this.v2.copy(e.v2),this}},{key:"toJSON",value:function(){var e=(0,u.Z)((0,c.Z)(n.prototype),"toJSON",this).call(this);return e.v0=this.v0.toArray(),e.v1=this.v1.toArray(),e.v2=this.v2.toArray(),e}},{key:"fromJSON",value:function(e){return(0,u.Z)((0,c.Z)(n.prototype),"fromJSON",this).call(this,e),this.v0.fromArray(e.v0),this.v1.fromArray(e.v1),this.v2.fromArray(e.v2),this}}]),n}(Gl),su=function(e){(0,d.Z)(n,e);var t=(0,f.Z)(n);function n(){var e,i=arguments.length>0&&void 0!==arguments[0]?arguments[0]:new Gn,r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:new Gn,a=arguments.length>2&&void 0!==arguments[2]?arguments[2]:new Gn;return(0,v.Z)(this,n),(e=t.call(this)).isQuadraticBezierCurve3=!0,e.type="QuadraticBezierCurve3",e.v0=i,e.v1=r,e.v2=a,e}return(0,g.Z)(n,[{key:"getPoint",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:new Gn,n=this.v0,i=this.v1,r=this.v2;return t.set(eu(e,n.x,i.x,r.x),eu(e,n.y,i.y,r.y),eu(e,n.z,i.z,r.z)),t}},{key:"copy",value:function(e){return(0,u.Z)((0,c.Z)(n.prototype),"copy",this).call(this,e),this.v0.copy(e.v0),this.v1.copy(e.v1),this.v2.copy(e.v2),this}},{key:"toJSON",value:function(){var e=(0,u.Z)((0,c.Z)(n.prototype),"toJSON",this).call(this);return e.v0=this.v0.toArray(),e.v1=this.v1.toArray(),e.v2=this.v2.toArray(),e}},{key:"fromJSON",value:function(e){return(0,u.Z)((0,c.Z)(n.prototype),"fromJSON",this).call(this,e),this.v0.fromArray(e.v0),this.v1.fromArray(e.v1),this.v2.fromArray(e.v2),this}}]),n}(Gl),lu=function(e){(0,d.Z)(n,e);var t=(0,f.Z)(n);function n(){var e,i=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[];return(0,v.Z)(this,n),(e=t.call(this)).isSplineCurve=!0,e.type="SplineCurve",e.points=i,e}return(0,g.Z)(n,[{key:"getPoint",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:new An,n=this.points,i=(n.length-1)*e,r=Math.floor(i),a=i-r,o=n[0===r?r:r-1],s=n[r],l=n[r>n.length-2?n.length-1:r+1],u=n[r>n.length-3?n.length-1:r+2];return t.set($l(a,o.x,s.x,l.x,u.x),$l(a,o.y,s.y,l.y,u.y)),t}},{key:"copy",value:function(e){(0,u.Z)((0,c.Z)(n.prototype),"copy",this).call(this,e),this.points=[];for(var t=0,i=e.points.length;t<i;t++){var r=e.points[t];this.points.push(r.clone())}return this}},{key:"toJSON",value:function(){var e=(0,u.Z)((0,c.Z)(n.prototype),"toJSON",this).call(this);e.points=[];for(var t=0,i=this.points.length;t<i;t++){var r=this.points[t];e.points.push(r.toArray())}return e}},{key:"fromJSON",value:function(e){(0,u.Z)((0,c.Z)(n.prototype),"fromJSON",this).call(this,e),this.points=[];for(var t=0,i=e.points.length;t<i;t++){var r=e.points[t];this.points.push((new An).fromArray(r))}return this}}]),n}(Gl),uu=Object.freeze({__proto__:null,ArcCurve:Vl,CatmullRomCurve3:Kl,CubicBezierCurve:nu,CubicBezierCurve3:iu,EllipseCurve:Hl,LineCurve:ru,LineCurve3:au,QuadraticBezierCurve:ou,QuadraticBezierCurve3:su,SplineCurve:lu}),cu=function(e){(0,d.Z)(n,e);var t=(0,f.Z)(n);function n(){var e;return(0,v.Z)(this,n),(e=t.call(this)).type="CurvePath",e.curves=[],e.autoClose=!1,e}return(0,g.Z)(n,[{key:"add",value:function(e){this.curves.push(e)}},{key:"closePath",value:function(){var e=this.curves[0].getPoint(0),t=this.curves[this.curves.length-1].getPoint(1);e.equals(t)||this.curves.push(new ru(t,e))}},{key:"getPoint",value:function(e,t){for(var n=e*this.getLength(),i=this.getCurveLengths(),r=0;r<i.length;){if(i[r]>=n){var a=i[r]-n,o=this.curves[r],s=o.getLength(),l=0===s?0:1-a/s;return o.getPointAt(l,t)}r++}return null}},{key:"getLength",value:function(){var e=this.getCurveLengths();return e[e.length-1]}},{key:"updateArcLengths",value:function(){this.needsUpdate=!0,this.cacheLengths=null,this.getCurveLengths()}},{key:"getCurveLengths",value:function(){if(this.cacheLengths&&this.cacheLengths.length===this.curves.length)return this.cacheLengths;for(var e=[],t=0,n=0,i=this.curves.length;n<i;n++)t+=this.curves[n].getLength(),e.push(t);return this.cacheLengths=e,e}},{key:"getSpacedPoints",value:function(){for(var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:40,t=[],n=0;n<=e;n++)t.push(this.getPoint(n/e));return this.autoClose&&t.push(t[0]),t}},{key:"getPoints",value:function(){for(var e,t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:12,n=[],i=0,r=this.curves;i<r.length;i++)for(var a=r[i],o=a.isEllipseCurve?2*t:a.isLineCurve||a.isLineCurve3?1:a.isSplineCurve?t*a.points.length:t,s=a.getPoints(o),l=0;l<s.length;l++){var u=s[l];e&&e.equals(u)||(n.push(u),e=u)}return this.autoClose&&n.length>1&&!n[n.length-1].equals(n[0])&&n.push(n[0]),n}},{key:"copy",value:function(e){(0,u.Z)((0,c.Z)(n.prototype),"copy",this).call(this,e),this.curves=[];for(var t=0,i=e.curves.length;t<i;t++){var r=e.curves[t];this.curves.push(r.clone())}return this.autoClose=e.autoClose,this}},{key:"toJSON",value:function(){var e=(0,u.Z)((0,c.Z)(n.prototype),"toJSON",this).call(this);e.autoClose=this.autoClose,e.curves=[];for(var t=0,i=this.curves.length;t<i;t++){var r=this.curves[t];e.curves.push(r.toJSON())}return e}},{key:"fromJSON",value:function(e){(0,u.Z)((0,c.Z)(n.prototype),"fromJSON",this).call(this,e),this.autoClose=e.autoClose,this.curves=[];for(var t=0,i=e.curves.length;t<i;t++){var r=e.curves[t];this.curves.push((new uu[r.type]).fromJSON(r))}return this}}]),n}(Gl),hu=function(e){(0,d.Z)(n,e);var t=(0,f.Z)(n);function n(e){var i;return(0,v.Z)(this,n),(i=t.call(this)).type="Path",i.currentPoint=new An,e&&i.setFromPoints(e),i}return(0,g.Z)(n,[{key:"setFromPoints",value:function(e){this.moveTo(e[0].x,e[0].y);for(var t=1,n=e.length;t<n;t++)this.lineTo(e[t].x,e[t].y);return this}},{key:"moveTo",value:function(e,t){return this.currentPoint.set(e,t),this}},{key:"lineTo",value:function(e,t){var n=new ru(this.currentPoint.clone(),new An(e,t));return this.curves.push(n),this.currentPoint.set(e,t),this}},{key:"quadraticCurveTo",value:function(e,t,n,i){var r=new ou(this.currentPoint.clone(),new An(e,t),new An(n,i));return this.curves.push(r),this.currentPoint.set(n,i),this}},{key:"bezierCurveTo",value:function(e,t,n,i,r,a){var o=new nu(this.currentPoint.clone(),new An(e,t),new An(n,i),new An(r,a));return this.curves.push(o),this.currentPoint.set(r,a),this}},{key:"splineThru",value:function(e){var t=[this.currentPoint.clone()].concat(e),n=new lu(t);return this.curves.push(n),this.currentPoint.copy(e[e.length-1]),this}},{key:"arc",value:function(e,t,n,i,r,a){var o=this.currentPoint.x,s=this.currentPoint.y;return this.absarc(e+o,t+s,n,i,r,a),this}},{key:"absarc",value:function(e,t,n,i,r,a){return this.absellipse(e,t,n,n,i,r,a),this}},{key:"ellipse",value:function(e,t,n,i,r,a,o,s){var l=this.currentPoint.x,u=this.currentPoint.y;return this.absellipse(e+l,t+u,n,i,r,a,o,s),this}},{key:"absellipse",value:function(e,t,n,i,r,a,o,s){var l=new Hl(e,t,n,i,r,a,o,s);if(this.curves.length>0){var u=l.getPoint(0);u.equals(this.currentPoint)||this.lineTo(u.x,u.y)}this.curves.push(l);var c=l.getPoint(1);return this.currentPoint.copy(c),this}},{key:"copy",value:function(e){return(0,u.Z)((0,c.Z)(n.prototype),"copy",this).call(this,e),this.currentPoint.copy(e.currentPoint),this}},{key:"toJSON",value:function(){var e=(0,u.Z)((0,c.Z)(n.prototype),"toJSON",this).call(this);return e.currentPoint=this.currentPoint.toArray(),e}},{key:"fromJSON",value:function(e){return(0,u.Z)((0,c.Z)(n.prototype),"fromJSON",this).call(this,e),this.currentPoint.fromArray(e.currentPoint),this}}]),n}(cu),du=function(e){(0,d.Z)(n,e);var t=(0,f.Z)(n);function n(){var e,i=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[new An(0,-.5),new An(.5,0),new An(0,.5)],r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:12,a=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0,o=arguments.length>3&&void 0!==arguments[3]?arguments[3]:2*Math.PI;(0,v.Z)(this,n),(e=t.call(this)).type="LatheGeometry",e.parameters={points:i,segments:r,phiStart:a,phiLength:o},r=Math.floor(r),o=on(o,0,2*Math.PI);for(var s=[],l=[],u=[],c=[],h=[],d=1/r,f=new Gn,p=new An,A=new Gn,g=new Gn,m=new Gn,y=0,x=0,w=0;w<=i.length-1;w++)switch(w){case 0:y=i[w+1].x-i[w].x,x=i[w+1].y-i[w].y,A.x=1*x,A.y=-y,A.z=0*x,m.copy(A),A.normalize(),c.push(A.x,A.y,A.z);break;case i.length-1:c.push(m.x,m.y,m.z);break;default:y=i[w+1].x-i[w].x,x=i[w+1].y-i[w].y,A.x=1*x,A.y=-y,A.z=0*x,g.copy(A),A.x+=m.x,A.y+=m.y,A.z+=m.z,A.normalize(),c.push(A.x,A.y,A.z),m.copy(g)}for(var C=0;C<=r;C++)for(var b=a+C*d*o,_=Math.sin(b),E=Math.cos(b),M=0;M<=i.length-1;M++){f.x=i[M].x*_,f.y=i[M].y,f.z=i[M].x*E,l.push(f.x,f.y,f.z),p.x=C/r,p.y=M/(i.length-1),u.push(p.x,p.y);var I=c[3*M+0]*_,S=c[3*M+1],k=c[3*M+0]*E;h.push(I,S,k)}for(var B=0;B<r;B++)for(var T=0;T<i.length-1;T++){var D=T+B*i.length,R=D,P=D+i.length,L=D+i.length+1,Q=D+1;s.push(R,P,Q),s.push(L,Q,P)}return e.setIndex(s),e.setAttribute("position",new dr(l,3)),e.setAttribute("uv",new dr(u,2)),e.setAttribute("normal",new dr(h,3)),e}return(0,g.Z)(n,null,[{key:"fromJSON",value:function(e){return new n(e.points,e.segments,e.phiStart,e.phiLength)}}]),n}(xr),fu=function(e){(0,d.Z)(n,e);var t=(0,f.Z)(n);function n(){var e,i=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1,a=arguments.length>2&&void 0!==arguments[2]?arguments[2]:4,o=arguments.length>3&&void 0!==arguments[3]?arguments[3]:8;(0,v.Z)(this,n);var s=new hu;return s.absarc(0,-r/2,i,1.5*Math.PI,0),s.absarc(0,r/2,i,0,.5*Math.PI),(e=t.call(this,s.getPoints(a),o)).type="CapsuleGeometry",e.parameters={radius:i,height:r,capSegments:a,radialSegments:o},e}return(0,g.Z)(n,null,[{key:"fromJSON",value:function(e){return new n(e.radius,e.length,e.capSegments,e.radialSegments)}}]),n}(du),pu=function(e){(0,d.Z)(n,e);var t=(0,f.Z)(n);function n(){var e,i=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:32,a=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0,o=arguments.length>3&&void 0!==arguments[3]?arguments[3]:2*Math.PI;(0,v.Z)(this,n),(e=t.call(this)).type="CircleGeometry",e.parameters={radius:i,segments:r,thetaStart:a,thetaLength:o},r=Math.max(3,r);var s=[],l=[],u=[],c=[],h=new Gn,d=new An;l.push(0,0,0),u.push(0,0,1),c.push(.5,.5);for(var f=0,p=3;f<=r;f++,p+=3){var A=a+f/r*o;h.x=i*Math.cos(A),h.y=i*Math.sin(A),l.push(h.x,h.y,h.z),u.push(0,0,1),d.x=(l[p]/i+1)/2,d.y=(l[p+1]/i+1)/2,c.push(d.x,d.y)}for(var g=1;g<=r;g++)s.push(g,g+1,0);return e.setIndex(s),e.setAttribute("position",new dr(l,3)),e.setAttribute("normal",new dr(u,3)),e.setAttribute("uv",new dr(c,2)),e}return(0,g.Z)(n,null,[{key:"fromJSON",value:function(e){return new n(e.radius,e.segments,e.thetaStart,e.thetaLength)}}]),n}(xr),Au=function(e){(0,d.Z)(n,e);var t=(0,f.Z)(n);function n(){var e,i=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1,a=arguments.length>2&&void 0!==arguments[2]?arguments[2]:1,o=arguments.length>3&&void 0!==arguments[3]?arguments[3]:32,s=arguments.length>4&&void 0!==arguments[4]?arguments[4]:1,l=arguments.length>5&&void 0!==arguments[5]&&arguments[5],u=arguments.length>6&&void 0!==arguments[6]?arguments[6]:0,c=arguments.length>7&&void 0!==arguments[7]?arguments[7]:2*Math.PI;(0,v.Z)(this,n),(e=t.call(this)).type="CylinderGeometry",e.parameters={radiusTop:i,radiusBottom:r,height:a,radialSegments:o,heightSegments:s,openEnded:l,thetaStart:u,thetaLength:c};var d=(0,h.Z)(e);o=Math.floor(o),s=Math.floor(s);var f=[],p=[],A=[],g=[],m=0,y=[],x=a/2,w=0;function C(e){for(var t=m,n=new An,a=new Gn,s=0,l=!0===e?i:r,h=!0===e?1:-1,v=1;v<=o;v++)p.push(0,x*h,0),A.push(0,h,0),g.push(.5,.5),m++;for(var y=m,C=0;C<=o;C++){var b=C/o*c+u,_=Math.cos(b),E=Math.sin(b);a.x=l*E,a.y=x*h,a.z=l*_,p.push(a.x,a.y,a.z),A.push(0,h,0),n.x=.5*_+.5,n.y=.5*E*h+.5,g.push(n.x,n.y),m++}for(var M=0;M<o;M++){var I=t+M,S=y+M;!0===e?f.push(S,S+1,I):f.push(S+1,S,I),s+=3}d.addGroup(w,s,!0===e?1:2),w+=s}return function(){for(var e=new Gn,t=new Gn,n=0,l=(r-i)/a,h=0;h<=s;h++){for(var v=[],C=h/s,b=C*(r-i)+i,_=0;_<=o;_++){var E=_/o,M=E*c+u,I=Math.sin(M),S=Math.cos(M);t.x=b*I,t.y=-C*a+x,t.z=b*S,p.push(t.x,t.y,t.z),e.set(I,l,S).normalize(),A.push(e.x,e.y,e.z),g.push(E,1-C),v.push(m++)}y.push(v)}for(var k=0;k<o;k++)for(var B=0;B<s;B++){var T=y[B][k],D=y[B+1][k],R=y[B+1][k+1],P=y[B][k+1];f.push(T,D,P),f.push(D,R,P),n+=6}d.addGroup(w,n,0),w+=n}(),!1===l&&(i>0&&C(!0),r>0&&C(!1)),e.setIndex(f),e.setAttribute("position",new dr(p,3)),e.setAttribute("normal",new dr(A,3)),e.setAttribute("uv",new dr(g,2)),e}return(0,g.Z)(n,null,[{key:"fromJSON",value:function(e){return new n(e.radiusTop,e.radiusBottom,e.height,e.radialSegments,e.heightSegments,e.openEnded,e.thetaStart,e.thetaLength)}}]),n}(xr),vu=function(e){(0,d.Z)(n,e);var t=(0,f.Z)(n);function n(){var e,i=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1,a=arguments.length>2&&void 0!==arguments[2]?arguments[2]:32,o=arguments.length>3&&void 0!==arguments[3]?arguments[3]:1,s=arguments.length>4&&void 0!==arguments[4]&&arguments[4],l=arguments.length>5&&void 0!==arguments[5]?arguments[5]:0,u=arguments.length>6&&void 0!==arguments[6]?arguments[6]:2*Math.PI;return(0,v.Z)(this,n),(e=t.call(this,0,i,r,a,o,s,l,u)).type="ConeGeometry",e.parameters={radius:i,height:r,radialSegments:a,heightSegments:o,openEnded:s,thetaStart:l,thetaLength:u},e}return(0,g.Z)(n,null,[{key:"fromJSON",value:function(e){return new n(e.radius,e.height,e.radialSegments,e.heightSegments,e.openEnded,e.thetaStart,e.thetaLength)}}]),n}(Au),gu=function(e){(0,d.Z)(n,e);var t=(0,f.Z)(n);function n(){var e,i=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[],r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:[],a=arguments.length>2&&void 0!==arguments[2]?arguments[2]:1,o=arguments.length>3&&void 0!==arguments[3]?arguments[3]:0;(0,v.Z)(this,n),(e=t.call(this)).type="PolyhedronGeometry",e.parameters={vertices:i,indices:r,radius:a,detail:o};var s=[],l=[];function u(e,t,n,i){for(var r=i+1,a=[],o=0;o<=r;o++){a[o]=[];for(var s=e.clone().lerp(n,o/r),l=t.clone().lerp(n,o/r),u=r-o,h=0;h<=u;h++)a[o][h]=0===h&&o===r?s:s.clone().lerp(l,h/u)}for(var d=0;d<r;d++)for(var f=0;f<2*(r-d)-1;f++){var p=Math.floor(f/2);f%2===0?(c(a[d][p+1]),c(a[d+1][p]),c(a[d][p])):(c(a[d][p+1]),c(a[d+1][p+1]),c(a[d+1][p]))}}function c(e){s.push(e.x,e.y,e.z)}function h(e,t){var n=3*e;t.x=i[n+0],t.y=i[n+1],t.z=i[n+2]}function d(e,t,n,i){i<0&&1===e.x&&(l[t]=e.x-1),0===n.x&&0===n.z&&(l[t]=i/2/Math.PI+.5)}function f(e){return Math.atan2(e.z,-e.x)}return function(e){for(var t=new Gn,n=new Gn,i=new Gn,a=0;a<r.length;a+=3)h(r[a+0],t),h(r[a+1],n),h(r[a+2],i),u(t,n,i,e)}(o),function(e){for(var t=new Gn,n=0;n<s.length;n+=3)t.x=s[n+0],t.y=s[n+1],t.z=s[n+2],t.normalize().multiplyScalar(e),s[n+0]=t.x,s[n+1]=t.y,s[n+2]=t.z}(a),function(){for(var e=new Gn,t=0;t<s.length;t+=3){e.x=s[t+0],e.y=s[t+1],e.z=s[t+2];var n=f(e)/2/Math.PI+.5,i=(r=e,Math.atan2(-r.y,Math.sqrt(r.x*r.x+r.z*r.z))/Math.PI+.5);l.push(n,1-i)}var r;(function(){for(var e=new Gn,t=new Gn,n=new Gn,i=new Gn,r=new An,a=new An,o=new An,u=0,c=0;u<s.length;u+=9,c+=6){e.set(s[u+0],s[u+1],s[u+2]),t.set(s[u+3],s[u+4],s[u+5]),n.set(s[u+6],s[u+7],s[u+8]),r.set(l[c+0],l[c+1]),a.set(l[c+2],l[c+3]),o.set(l[c+4],l[c+5]),i.copy(e).add(t).add(n).divideScalar(3);var h=f(i);d(r,c+0,e,h),d(a,c+2,t,h),d(o,c+4,n,h)}})(),function(){for(var e=0;e<l.length;e+=6){var t=l[e+0],n=l[e+2],i=l[e+4],r=Math.max(t,n,i),a=Math.min(t,n,i);r>.9&&a<.1&&(t<.2&&(l[e+0]+=1),n<.2&&(l[e+2]+=1),i<.2&&(l[e+4]+=1))}}()}(),e.setAttribute("position",new dr(s,3)),e.setAttribute("normal",new dr(s.slice(),3)),e.setAttribute("uv",new dr(l,2)),0===o?e.computeVertexNormals():e.normalizeNormals(),e}return(0,g.Z)(n,null,[{key:"fromJSON",value:function(e){return new n(e.vertices,e.indices,e.radius,e.details)}}]),n}(xr),mu=function(e){(0,d.Z)(n,e);var t=(0,f.Z)(n);function n(){var e,i=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;(0,v.Z)(this,n);var a=(1+Math.sqrt(5))/2,o=1/a,s=[-1,-1,-1,-1,-1,1,-1,1,-1,-1,1,1,1,-1,-1,1,-1,1,1,1,-1,1,1,1,0,-o,-a,0,-o,a,0,o,-a,0,o,a,-o,-a,0,-o,a,0,o,-a,0,o,a,0,-a,0,-o,a,0,-o,-a,0,o,a,0,o];return(e=t.call(this,s,[3,11,7,3,7,15,3,15,13,7,19,17,7,17,6,7,6,15,17,4,8,17,8,10,17,10,6,8,0,16,8,16,2,8,2,10,0,12,1,0,1,18,0,18,16,6,10,2,6,2,13,6,13,15,2,16,18,2,18,3,2,3,13,18,1,9,18,9,11,18,11,3,4,14,12,4,12,0,4,0,8,11,9,5,11,5,19,11,19,7,19,5,14,19,14,4,19,4,17,1,12,14,1,14,5,1,5,9],i,r)).type="DodecahedronGeometry",e.parameters={radius:i,detail:r},e}return(0,g.Z)(n,null,[{key:"fromJSON",value:function(e){return new n(e.radius,e.detail)}}]),n}(gu),yu=function(e){(0,d.Z)(n,e);var t=(0,f.Z)(n);function n(e){var i;return(0,v.Z)(this,n),(i=t.call(this,e)).uuid=an(),i.type="Shape",i.holes=[],i}return(0,g.Z)(n,[{key:"getPointsHoles",value:function(e){for(var t=[],n=0,i=this.holes.length;n<i;n++)t[n]=this.holes[n].getPoints(e);return t}},{key:"extractPoints",value:function(e){return{shape:this.getPoints(e),holes:this.getPointsHoles(e)}}},{key:"copy",value:function(e){(0,u.Z)((0,c.Z)(n.prototype),"copy",this).call(this,e),this.holes=[];for(var t=0,i=e.holes.length;t<i;t++){var r=e.holes[t];this.holes.push(r.clone())}return this}},{key:"toJSON",value:function(){var e=(0,u.Z)((0,c.Z)(n.prototype),"toJSON",this).call(this);e.uuid=this.uuid,e.holes=[];for(var t=0,i=this.holes.length;t<i;t++){var r=this.holes[t];e.holes.push(r.toJSON())}return e}},{key:"fromJSON",value:function(e){(0,u.Z)((0,c.Z)(n.prototype),"fromJSON",this).call(this,e),this.uuid=e.uuid,this.holes=[];for(var t=0,i=e.holes.length;t<i;t++){var r=e.holes[t];this.holes.push((new hu).fromJSON(r))}return this}}]),n}(hu),xu=function(e,t){var n,i,r,a,o,s,l,u=arguments.length>2&&void 0!==arguments[2]?arguments[2]:2,c=t&&t.length,h=c?t[0]*u:e.length,d=wu(e,0,h,u,!0),f=[];if(!d||d.next===d.prev)return f;if(c&&(d=function(e,t,n,i){var r,a,o,s=[];for(r=0,a=t.length;r<a;r++)(o=wu(e,t[r]*i,r<a-1?t[r+1]*i:e.length,i,!1))===o.next&&(o.steiner=!0),s.push(Du(o));for(s.sort(Su),r=0;r<s.length;r++)n=ku(s[r],n);return n}(e,t,d,u)),e.length>80*u){n=r=e[0],i=a=e[1];for(var p=u;p<h;p+=u)(o=e[p])<n&&(n=o),(s=e[p+1])<i&&(i=s),o>r&&(r=o),s>a&&(a=s);l=0!==(l=Math.max(r-n,a-i))?32767/l:0}return bu(d,f,u,n,i,l,0),f};function wu(e,t,n,i,r){var a,o;if(r===function(e,t,n,i){for(var r=0,a=t,o=n-i;a<n;a+=i)r+=(e[o]-e[a])*(e[a+1]+e[o+1]),o=a;return r}(e,t,n,i)>0)for(a=t;a<n;a+=i)o=Ou(a,e[a],e[a+1],o);else for(a=n-i;a>=t;a-=i)o=Ou(a,e[a],e[a+1],o);return o&&Qu(o,o.next)&&(zu(o),o=o.next),o}function Cu(e,t){if(!e)return e;t||(t=e);var n,i=e;do{if(n=!1,i.steiner||!Qu(i,i.next)&&0!==Lu(i.prev,i,i.next))i=i.next;else{if(zu(i),(i=t=i.prev)===i.next)break;n=!0}}while(n||i!==t);return t}function bu(e,t,n,i,r,a,o){if(e){!o&&a&&function(e,t,n,i){var r=e;do{0===r.z&&(r.z=Tu(r.x,r.y,t,n,i)),r.prevZ=r.prev,r.nextZ=r.next,r=r.next}while(r!==e);r.prevZ.nextZ=null,r.prevZ=null,function(e){var t,n,i,r,a,o,s,l,u=1;do{for(n=e,e=null,a=null,o=0;n;){for(o++,i=n,s=0,t=0;t<u&&(s++,i=i.nextZ);t++);for(l=u;s>0||l>0&&i;)0!==s&&(0===l||!i||n.z<=i.z)?(r=n,n=n.nextZ,s--):(r=i,i=i.nextZ,l--),a?a.nextZ=r:e=r,r.prevZ=a,a=r;n=i}a.nextZ=null,u*=2}while(o>1)}(r)}(e,i,r,a);for(var s,l,u=e;e.prev!==e.next;)if(s=e.prev,l=e.next,a?Eu(e,i,r,a):_u(e))t.push(s.i/n|0),t.push(e.i/n|0),t.push(l.i/n|0),zu(e),e=l.next,u=l.next;else if((e=l)===u){o?1===o?bu(e=Mu(Cu(e),t,n),t,n,i,r,a,2):2===o&&Iu(e,t,n,i,r,a):bu(Cu(e),t,n,i,r,a,1);break}}}function _u(e){var t=e.prev,n=e,i=e.next;if(Lu(t,n,i)>=0)return!1;for(var r=t.x,a=n.x,o=i.x,s=t.y,l=n.y,u=i.y,c=r<a?r<o?r:o:a<o?a:o,h=s<l?s<u?s:u:l<u?l:u,d=r>a?r>o?r:o:a>o?a:o,f=s>l?s>u?s:u:l>u?l:u,p=i.next;p!==t;){if(p.x>=c&&p.x<=d&&p.y>=h&&p.y<=f&&Ru(r,s,a,l,o,u,p.x,p.y)&&Lu(p.prev,p,p.next)>=0)return!1;p=p.next}return!0}function Eu(e,t,n,i){var r=e.prev,a=e,o=e.next;if(Lu(r,a,o)>=0)return!1;for(var s=r.x,l=a.x,u=o.x,c=r.y,h=a.y,d=o.y,f=s<l?s<u?s:u:l<u?l:u,p=c<h?c<d?c:d:h<d?h:d,A=s>l?s>u?s:u:l>u?l:u,v=c>h?c>d?c:d:h>d?h:d,g=Tu(f,p,t,n,i),m=Tu(A,v,t,n,i),y=e.prevZ,x=e.nextZ;y&&y.z>=g&&x&&x.z<=m;){if(y.x>=f&&y.x<=A&&y.y>=p&&y.y<=v&&y!==r&&y!==o&&Ru(s,c,l,h,u,d,y.x,y.y)&&Lu(y.prev,y,y.next)>=0)return!1;if(y=y.prevZ,x.x>=f&&x.x<=A&&x.y>=p&&x.y<=v&&x!==r&&x!==o&&Ru(s,c,l,h,u,d,x.x,x.y)&&Lu(x.prev,x,x.next)>=0)return!1;x=x.nextZ}for(;y&&y.z>=g;){if(y.x>=f&&y.x<=A&&y.y>=p&&y.y<=v&&y!==r&&y!==o&&Ru(s,c,l,h,u,d,y.x,y.y)&&Lu(y.prev,y,y.next)>=0)return!1;y=y.prevZ}for(;x&&x.z<=m;){if(x.x>=f&&x.x<=A&&x.y>=p&&x.y<=v&&x!==r&&x!==o&&Ru(s,c,l,h,u,d,x.x,x.y)&&Lu(x.prev,x,x.next)>=0)return!1;x=x.nextZ}return!0}function Mu(e,t,n){var i=e;do{var r=i.prev,a=i.next.next;!Qu(r,a)&&Zu(r,i,i.next,a)&&Uu(r,a)&&Uu(a,r)&&(t.push(r.i/n|0),t.push(i.i/n|0),t.push(a.i/n|0),zu(i),zu(i.next),i=e=a),i=i.next}while(i!==e);return Cu(i)}function Iu(e,t,n,i,r,a){var o=e;do{for(var s=o.next.next;s!==o.prev;){if(o.i!==s.i&&Pu(o,s)){var l=ju(o,s);return o=Cu(o,o.next),l=Cu(l,l.next),bu(o,t,n,i,r,a,0),void bu(l,t,n,i,r,a,0)}s=s.next}o=o.next}while(o!==e)}function Su(e,t){return e.x-t.x}function ku(e,t){var n=function(e,t){var n,i=t,r=-1/0,a=e.x,o=e.y;do{if(o<=i.y&&o>=i.next.y&&i.next.y!==i.y){var s=i.x+(o-i.y)*(i.next.x-i.x)/(i.next.y-i.y);if(s<=a&&s>r&&(r=s,n=i.x<i.next.x?i:i.next,s===a))return n}i=i.next}while(i!==t);if(!n)return null;var l,u=n,c=n.x,h=n.y,d=1/0;i=n;do{a>=i.x&&i.x>=c&&a!==i.x&&Ru(o<h?a:r,o,c,h,o<h?r:a,o,i.x,i.y)&&(l=Math.abs(o-i.y)/(a-i.x),Uu(i,e)&&(l<d||l===d&&(i.x>n.x||i.x===n.x&&Bu(n,i)))&&(n=i,d=l)),i=i.next}while(i!==u);return n}(e,t);if(!n)return t;var i=ju(n,e);return Cu(i,i.next),Cu(n,n.next)}function Bu(e,t){return Lu(e.prev,e,t.prev)<0&&Lu(t.next,e,e.next)<0}function Tu(e,t,n,i,r){return(e=1431655765&((e=858993459&((e=252645135&((e=16711935&((e=(e-n)*r|0)|e<<8))|e<<4))|e<<2))|e<<1))|(t=1431655765&((t=858993459&((t=252645135&((t=16711935&((t=(t-i)*r|0)|t<<8))|t<<4))|t<<2))|t<<1))<<1}function Du(e){var t=e,n=e;do{(t.x<n.x||t.x===n.x&&t.y<n.y)&&(n=t),t=t.next}while(t!==e);return n}function Ru(e,t,n,i,r,a,o,s){return(r-o)*(t-s)>=(e-o)*(a-s)&&(e-o)*(i-s)>=(n-o)*(t-s)&&(n-o)*(a-s)>=(r-o)*(i-s)}function Pu(e,t){return e.next.i!==t.i&&e.prev.i!==t.i&&!function(e,t){var n=e;do{if(n.i!==e.i&&n.next.i!==e.i&&n.i!==t.i&&n.next.i!==t.i&&Zu(n,n.next,e,t))return!0;n=n.next}while(n!==e);return!1}(e,t)&&(Uu(e,t)&&Uu(t,e)&&function(e,t){var n=e,i=!1,r=(e.x+t.x)/2,a=(e.y+t.y)/2;do{n.y>a!==n.next.y>a&&n.next.y!==n.y&&r<(n.next.x-n.x)*(a-n.y)/(n.next.y-n.y)+n.x&&(i=!i),n=n.next}while(n!==e);return i}(e,t)&&(Lu(e.prev,e,t.prev)||Lu(e,t.prev,t))||Qu(e,t)&&Lu(e.prev,e,e.next)>0&&Lu(t.prev,t,t.next)>0)}function Lu(e,t,n){return(t.y-e.y)*(n.x-t.x)-(t.x-e.x)*(n.y-t.y)}function Qu(e,t){return e.x===t.x&&e.y===t.y}function Zu(e,t,n,i){var r=Fu(Lu(e,t,n)),a=Fu(Lu(e,t,i)),o=Fu(Lu(n,i,e)),s=Fu(Lu(n,i,t));return r!==a&&o!==s||(!(0!==r||!Nu(e,n,t))||(!(0!==a||!Nu(e,i,t))||(!(0!==o||!Nu(n,e,i))||!(0!==s||!Nu(n,t,i)))))}function Nu(e,t,n){return t.x<=Math.max(e.x,n.x)&&t.x>=Math.min(e.x,n.x)&&t.y<=Math.max(e.y,n.y)&&t.y>=Math.min(e.y,n.y)}function Fu(e){return e>0?1:e<0?-1:0}function Uu(e,t){return Lu(e.prev,e,e.next)<0?Lu(e,t,e.next)>=0&&Lu(e,e.prev,t)>=0:Lu(e,t,e.prev)<0||Lu(e,e.next,t)<0}function ju(e,t){var n=new Gu(e.i,e.x,e.y),i=new Gu(t.i,t.x,t.y),r=e.next,a=t.prev;return e.next=t,t.prev=e,n.next=r,r.prev=n,i.next=n,n.prev=i,a.next=i,i.prev=a,i}function Ou(e,t,n,i){var r=new Gu(e,t,n);return i?(r.next=i.next,r.prev=i,i.next.prev=r,i.next=r):(r.prev=r,r.next=r),r}function zu(e){e.next.prev=e.prev,e.prev.next=e.next,e.prevZ&&(e.prevZ.nextZ=e.nextZ),e.nextZ&&(e.nextZ.prevZ=e.prevZ)}function Gu(e,t,n){this.i=e,this.x=t,this.y=n,this.prev=null,this.next=null,this.z=0,this.prevZ=null,this.nextZ=null,this.steiner=!1}var Hu=function(){function e(){(0,v.Z)(this,e)}return(0,g.Z)(e,null,[{key:"area",value:function(e){for(var t=e.length,n=0,i=t-1,r=0;r<t;i=r++)n+=e[i].x*e[r].y-e[r].x*e[i].y;return.5*n}},{key:"isClockWise",value:function(t){return e.area(t)<0}},{key:"triangulateShape",value:function(e,t){var n=[],i=[],r=[];Vu(e),Wu(n,e);var a=e.length;t.forEach(Vu);for(var o=0;o<t.length;o++)i.push(a),a+=t[o].length,Wu(n,t[o]);for(var s=xu(n,i),l=0;l<s.length;l+=3)r.push(s.slice(l,l+3));return r}}]),e}();function Vu(e){var t=e.length;t>2&&e[t-1].equals(e[0])&&e.pop()}function Wu(e,t){for(var n=0;n<t.length;n++)e.push(t[n].x),e.push(t[n].y)}var qu=function(e){(0,d.Z)(n,e);var t=(0,f.Z)(n);function n(){var e,i=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;(0,v.Z)(this,n);var a=(1+Math.sqrt(5))/2,o=[-1,a,0,1,a,0,-1,-a,0,1,-a,0,0,-1,a,0,1,a,0,-1,-a,0,1,-a,a,0,-1,a,0,1,-a,0,-1,-a,0,1];return(e=t.call(this,o,[0,11,5,0,5,1,0,1,7,0,7,10,0,10,11,1,5,9,5,11,4,11,10,2,10,7,6,7,1,8,3,9,4,3,4,2,3,2,6,3,6,8,3,8,9,4,9,5,2,4,11,6,2,10,8,6,7,9,8,1],i,r)).type="IcosahedronGeometry",e.parameters={radius:i,detail:r},e}return(0,g.Z)(n,null,[{key:"fromJSON",value:function(e){return new n(e.radius,e.detail)}}]),n}(gu),Yu=function(e){(0,d.Z)(n,e);var t=(0,f.Z)(n);function n(){var e,i=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;(0,v.Z)(this,n);return(e=t.call(this,[1,0,0,-1,0,0,0,1,0,0,-1,0,0,0,1,0,0,-1],[0,2,4,0,4,3,0,3,5,0,5,2,1,2,5,1,5,3,1,3,4,1,4,2],i,r)).type="OctahedronGeometry",e.parameters={radius:i,detail:r},e}return(0,g.Z)(n,null,[{key:"fromJSON",value:function(e){return new n(e.radius,e.detail)}}]),n}(gu),Ju=function(e){(0,d.Z)(n,e);var t=(0,f.Z)(n);function n(){var e,i=arguments.length>0&&void 0!==arguments[0]?arguments[0]:.5,r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1,a=arguments.length>2&&void 0!==arguments[2]?arguments[2]:32,o=arguments.length>3&&void 0!==arguments[3]?arguments[3]:1,s=arguments.length>4&&void 0!==arguments[4]?arguments[4]:0,l=arguments.length>5&&void 0!==arguments[5]?arguments[5]:2*Math.PI;(0,v.Z)(this,n),(e=t.call(this)).type="RingGeometry",e.parameters={innerRadius:i,outerRadius:r,thetaSegments:a,phiSegments:o,thetaStart:s,thetaLength:l},a=Math.max(3,a);for(var u=[],c=[],h=[],d=[],f=i,p=(r-i)/(o=Math.max(1,o)),A=new Gn,g=new An,m=0;m<=o;m++){for(var y=0;y<=a;y++){var x=s+y/a*l;A.x=f*Math.cos(x),A.y=f*Math.sin(x),c.push(A.x,A.y,A.z),h.push(0,0,1),g.x=(A.x/r+1)/2,g.y=(A.y/r+1)/2,d.push(g.x,g.y)}f+=p}for(var w=0;w<o;w++)for(var C=w*(a+1),b=0;b<a;b++){var _=b+C,E=_,M=_+a+1,I=_+a+2,S=_+1;u.push(E,M,S),u.push(M,I,S)}return e.setIndex(u),e.setAttribute("position",new dr(c,3)),e.setAttribute("normal",new dr(h,3)),e.setAttribute("uv",new dr(d,2)),e}return(0,g.Z)(n,null,[{key:"fromJSON",value:function(e){return new n(e.innerRadius,e.outerRadius,e.thetaSegments,e.phiSegments,e.thetaStart,e.thetaLength)}}]),n}(xr),Xu=function(e){(0,d.Z)(n,e);var t=(0,f.Z)(n);function n(){var e,i=arguments.length>0&&void 0!==arguments[0]?arguments[0]:new yu([new An(0,.5),new An(-.5,-.5),new An(.5,-.5)]),r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:12;(0,v.Z)(this,n),(e=t.call(this)).type="ShapeGeometry",e.parameters={shapes:i,curveSegments:r};var a=[],o=[],s=[],l=[],u=0,c=0;if(!1===Array.isArray(i))d(i);else for(var h=0;h<i.length;h++)d(i[h]),e.addGroup(u,c,h),u+=c,c=0;function d(e){var t=o.length/3,n=e.extractPoints(r),i=n.shape,u=n.holes;!1===Hu.isClockWise(i)&&(i=i.reverse());for(var h=0,d=u.length;h<d;h++){var f=u[h];!0===Hu.isClockWise(f)&&(u[h]=f.reverse())}for(var p=Hu.triangulateShape(i,u),A=0,v=u.length;A<v;A++){var g=u[A];i=i.concat(g)}for(var m=0,y=i.length;m<y;m++){var x=i[m];o.push(x.x,x.y,0),s.push(0,0,1),l.push(x.x,x.y)}for(var w=0,C=p.length;w<C;w++){var b=p[w],_=b[0]+t,E=b[1]+t,M=b[2]+t;a.push(_,E,M),c+=3}}return e.setIndex(a),e.setAttribute("position",new dr(o,3)),e.setAttribute("normal",new dr(s,3)),e.setAttribute("uv",new dr(l,2)),e}return(0,g.Z)(n,[{key:"toJSON",value:function(){var e=(0,u.Z)((0,c.Z)(n.prototype),"toJSON",this).call(this);return function(e,t){if(t.shapes=[],Array.isArray(e))for(var n=0,i=e.length;n<i;n++){var r=e[n];t.shapes.push(r.uuid)}else t.shapes.push(e.uuid);return t}(this.parameters.shapes,e)}}],[{key:"fromJSON",value:function(e,t){for(var i=[],r=0,a=e.shapes.length;r<a;r++){var o=t[e.shapes[r]];i.push(o)}return new n(i,e.curveSegments)}}]),n}(xr);var Ku=function(e){(0,d.Z)(n,e);var t=(0,f.Z)(n);function n(){var e,i=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:32,a=arguments.length>2&&void 0!==arguments[2]?arguments[2]:16,o=arguments.length>3&&void 0!==arguments[3]?arguments[3]:0,s=arguments.length>4&&void 0!==arguments[4]?arguments[4]:2*Math.PI,l=arguments.length>5&&void 0!==arguments[5]?arguments[5]:0,u=arguments.length>6&&void 0!==arguments[6]?arguments[6]:Math.PI;(0,v.Z)(this,n),(e=t.call(this)).type="SphereGeometry",e.parameters={radius:i,widthSegments:r,heightSegments:a,phiStart:o,phiLength:s,thetaStart:l,thetaLength:u},r=Math.max(3,Math.floor(r)),a=Math.max(2,Math.floor(a));for(var c=Math.min(l+u,Math.PI),h=0,d=[],f=new Gn,p=new Gn,A=[],g=[],m=[],y=[],x=0;x<=a;x++){var w=[],C=x/a,b=0;0==x&&0==l?b=.5/r:x==a&&c==Math.PI&&(b=-.5/r);for(var _=0;_<=r;_++){var E=_/r;f.x=-i*Math.cos(o+E*s)*Math.sin(l+C*u),f.y=i*Math.cos(l+C*u),f.z=i*Math.sin(o+E*s)*Math.sin(l+C*u),g.push(f.x,f.y,f.z),p.copy(f).normalize(),m.push(p.x,p.y,p.z),y.push(E+b,1-C),w.push(h++)}d.push(w)}for(var M=0;M<a;M++)for(var I=0;I<r;I++){var S=d[M][I+1],k=d[M][I],B=d[M+1][I],T=d[M+1][I+1];(0!==M||l>0)&&A.push(S,k,T),(M!==a-1||c<Math.PI)&&A.push(k,B,T)}return e.setIndex(A),e.setAttribute("position",new dr(g,3)),e.setAttribute("normal",new dr(m,3)),e.setAttribute("uv",new dr(y,2)),e}return(0,g.Z)(n,null,[{key:"fromJSON",value:function(e){return new n(e.radius,e.widthSegments,e.heightSegments,e.phiStart,e.phiLength,e.thetaStart,e.thetaLength)}}]),n}(xr),$u=function(e){(0,d.Z)(n,e);var t=(0,f.Z)(n);function n(){var e,i=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;(0,v.Z)(this,n);return(e=t.call(this,[1,1,1,-1,-1,1,-1,1,-1,1,-1,-1],[2,1,0,0,3,2,1,3,0,2,3,1],i,r)).type="TetrahedronGeometry",e.parameters={radius:i,detail:r},e}return(0,g.Z)(n,null,[{key:"fromJSON",value:function(e){return new n(e.radius,e.detail)}}]),n}(gu),ec=function(e){(0,d.Z)(n,e);var t=(0,f.Z)(n);function n(){var e,i=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:.4,a=arguments.length>2&&void 0!==arguments[2]?arguments[2]:12,o=arguments.length>3&&void 0!==arguments[3]?arguments[3]:48,s=arguments.length>4&&void 0!==arguments[4]?arguments[4]:2*Math.PI;(0,v.Z)(this,n),(e=t.call(this)).type="TorusGeometry",e.parameters={radius:i,tube:r,radialSegments:a,tubularSegments:o,arc:s},a=Math.floor(a),o=Math.floor(o);for(var l=[],u=[],c=[],h=[],d=new Gn,f=new Gn,p=new Gn,A=0;A<=a;A++)for(var g=0;g<=o;g++){var m=g/o*s,y=A/a*Math.PI*2;f.x=(i+r*Math.cos(y))*Math.cos(m),f.y=(i+r*Math.cos(y))*Math.sin(m),f.z=r*Math.sin(y),u.push(f.x,f.y,f.z),d.x=i*Math.cos(m),d.y=i*Math.sin(m),p.subVectors(f,d).normalize(),c.push(p.x,p.y,p.z),h.push(g/o),h.push(A/a)}for(var x=1;x<=a;x++)for(var w=1;w<=o;w++){var C=(o+1)*x+w-1,b=(o+1)*(x-1)+w-1,_=(o+1)*(x-1)+w,E=(o+1)*x+w;l.push(C,b,E),l.push(b,_,E)}return e.setIndex(l),e.setAttribute("position",new dr(u,3)),e.setAttribute("normal",new dr(c,3)),e.setAttribute("uv",new dr(h,2)),e}return(0,g.Z)(n,null,[{key:"fromJSON",value:function(e){return new n(e.radius,e.tube,e.radialSegments,e.tubularSegments,e.arc)}}]),n}(xr),tc=function(e){(0,d.Z)(n,e);var t=(0,f.Z)(n);function n(){var e,i=arguments.length>0&&void 0!==arguments[0]?arguments[0]:new su(new Gn(-1,-1,0),new Gn(-1,1,0),new Gn(1,1,0)),r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:64,a=arguments.length>2&&void 0!==arguments[2]?arguments[2]:1,o=arguments.length>3&&void 0!==arguments[3]?arguments[3]:8,s=arguments.length>4&&void 0!==arguments[4]&&arguments[4];(0,v.Z)(this,n),(e=t.call(this)).type="TubeGeometry",e.parameters={path:i,tubularSegments:r,radius:a,radialSegments:o,closed:s};var l=i.computeFrenetFrames(r,s);e.tangents=l.tangents,e.normals=l.normals,e.binormals=l.binormals;var u=new Gn,c=new Gn,h=new An,d=new Gn,f=[],p=[],A=[],g=[];function m(e){d=i.getPointAt(e/r,d);for(var t=l.normals[e],n=l.binormals[e],s=0;s<=o;s++){var h=s/o*Math.PI*2,A=Math.sin(h),v=-Math.cos(h);c.x=v*t.x+A*n.x,c.y=v*t.y+A*n.y,c.z=v*t.z+A*n.z,c.normalize(),p.push(c.x,c.y,c.z),u.x=d.x+a*c.x,u.y=d.y+a*c.y,u.z=d.z+a*c.z,f.push(u.x,u.y,u.z)}}return function(){for(var e=0;e<r;e++)m(e);m(!1===s?r:0),function(){for(var e=0;e<=r;e++)for(var t=0;t<=o;t++)h.x=e/r,h.y=t/o,A.push(h.x,h.y)}(),function(){for(var e=1;e<=r;e++)for(var t=1;t<=o;t++){var n=(o+1)*(e-1)+(t-1),i=(o+1)*e+(t-1),a=(o+1)*e+t,s=(o+1)*(e-1)+t;g.push(n,i,s),g.push(i,a,s)}}()}(),e.setIndex(g),e.setAttribute("position",new dr(f,3)),e.setAttribute("normal",new dr(p,3)),e.setAttribute("uv",new dr(A,2)),e}return(0,g.Z)(n,[{key:"toJSON",value:function(){var e=(0,u.Z)((0,c.Z)(n.prototype),"toJSON",this).call(this);return e.path=this.parameters.path.toJSON(),e}}],[{key:"fromJSON",value:function(e){return new n((new uu[e.path.type]).fromJSON(e.path),e.tubularSegments,e.radius,e.radialSegments,e.closed)}}]),n}(xr);var nc=function(e){(0,d.Z)(n,e);var t=(0,f.Z)(n);function n(e){var i;return(0,v.Z)(this,n),(i=t.call(this)).isShadowMaterial=!0,i.type="ShadowMaterial",i.color=new Rn(0),i.transparent=!0,i.fog=!0,i.setValues(e),i}return(0,g.Z)(n,[{key:"copy",value:function(e){return(0,u.Z)((0,c.Z)(n.prototype),"copy",this).call(this,e),this.color.copy(e.color),this.fog=e.fog,this}}]),n}(rr),ic=function(e){(0,d.Z)(n,e);var t=(0,f.Z)(n);function n(e){var i;return(0,v.Z)(this,n),(i=t.call(this,e)).isRawShaderMaterial=!0,i.type="RawShaderMaterial",i}return(0,g.Z)(n)}(jr),rc=function(e){(0,d.Z)(n,e);var t=(0,f.Z)(n);function n(e){var i;return(0,v.Z)(this,n),(i=t.call(this)).isMeshStandardMaterial=!0,i.defines={STANDARD:""},i.type="MeshStandardMaterial",i.color=new Rn(16777215),i.roughness=1,i.metalness=0,i.map=null,i.lightMap=null,i.lightMapIntensity=1,i.aoMap=null,i.aoMapIntensity=1,i.emissive=new Rn(0),i.emissiveIntensity=1,i.emissiveMap=null,i.bumpMap=null,i.bumpScale=1,i.normalMap=null,i.normalMapType=jt,i.normalScale=new An(1,1),i.displacementMap=null,i.displacementScale=1,i.displacementBias=0,i.roughnessMap=null,i.metalnessMap=null,i.alphaMap=null,i.envMap=null,i.envMapIntensity=1,i.wireframe=!1,i.wireframeLinewidth=1,i.wireframeLinecap="round",i.wireframeLinejoin="round",i.flatShading=!1,i.fog=!0,i.setValues(e),i}return(0,g.Z)(n,[{key:"copy",value:function(e){return(0,u.Z)((0,c.Z)(n.prototype),"copy",this).call(this,e),this.defines={STANDARD:""},this.color.copy(e.color),this.roughness=e.roughness,this.metalness=e.metalness,this.map=e.map,this.lightMap=e.lightMap,this.lightMapIntensity=e.lightMapIntensity,this.aoMap=e.aoMap,this.aoMapIntensity=e.aoMapIntensity,this.emissive.copy(e.emissive),this.emissiveMap=e.emissiveMap,this.emissiveIntensity=e.emissiveIntensity,this.bumpMap=e.bumpMap,this.bumpScale=e.bumpScale,this.normalMap=e.normalMap,this.normalMapType=e.normalMapType,this.normalScale.copy(e.normalScale),this.displacementMap=e.displacementMap,this.displacementScale=e.displacementScale,this.displacementBias=e.displacementBias,this.roughnessMap=e.roughnessMap,this.metalnessMap=e.metalnessMap,this.alphaMap=e.alphaMap,this.envMap=e.envMap,this.envMapIntensity=e.envMapIntensity,this.wireframe=e.wireframe,this.wireframeLinewidth=e.wireframeLinewidth,this.wireframeLinecap=e.wireframeLinecap,this.wireframeLinejoin=e.wireframeLinejoin,this.flatShading=e.flatShading,this.fog=e.fog,this}}]),n}(rr),ac=function(e){(0,d.Z)(n,e);var t=(0,f.Z)(n);function n(e){var i;return(0,v.Z)(this,n),(i=t.call(this)).isMeshPhysicalMaterial=!0,i.defines={STANDARD:"",PHYSICAL:""},i.type="MeshPhysicalMaterial",i.clearcoatMap=null,i.clearcoatRoughness=0,i.clearcoatRoughnessMap=null,i.clearcoatNormalScale=new An(1,1),i.clearcoatNormalMap=null,i.ior=1.5,Object.defineProperty((0,h.Z)(i),"reflectivity",{get:function(){return on(2.5*(this.ior-1)/(this.ior+1),0,1)},set:function(e){this.ior=(1+.4*e)/(1-.4*e)}}),i.iridescenceMap=null,i.iridescenceIOR=1.3,i.iridescenceThicknessRange=[100,400],i.iridescenceThicknessMap=null,i.sheenColor=new Rn(0),i.sheenColorMap=null,i.sheenRoughness=1,i.sheenRoughnessMap=null,i.transmissionMap=null,i.thickness=0,i.thicknessMap=null,i.attenuationDistance=1/0,i.attenuationColor=new Rn(1,1,1),i.specularIntensity=1,i.specularIntensityMap=null,i.specularColor=new Rn(1,1,1),i.specularColorMap=null,i._sheen=0,i._clearcoat=0,i._iridescence=0,i._transmission=0,i.setValues(e),i}return(0,g.Z)(n,[{key:"sheen",get:function(){return this._sheen},set:function(e){this._sheen>0!==e>0&&this.version++,this._sheen=e}},{key:"clearcoat",get:function(){return this._clearcoat},set:function(e){this._clearcoat>0!==e>0&&this.version++,this._clearcoat=e}},{key:"iridescence",get:function(){return this._iridescence},set:function(e){this._iridescence>0!==e>0&&this.version++,this._iridescence=e}},{key:"transmission",get:function(){return this._transmission},set:function(e){this._transmission>0!==e>0&&this.version++,this._transmission=e}},{key:"copy",value:function(e){return(0,u.Z)((0,c.Z)(n.prototype),"copy",this).call(this,e),this.defines={STANDARD:"",PHYSICAL:""},this.clearcoat=e.clearcoat,this.clearcoatMap=e.clearcoatMap,this.clearcoatRoughness=e.clearcoatRoughness,this.clearcoatRoughnessMap=e.clearcoatRoughnessMap,this.clearcoatNormalMap=e.clearcoatNormalMap,this.clearcoatNormalScale.copy(e.clearcoatNormalScale),this.ior=e.ior,this.iridescence=e.iridescence,this.iridescenceMap=e.iridescenceMap,this.iridescenceIOR=e.iridescenceIOR,this.iridescenceThicknessRange=(0,a.Z)(e.iridescenceThicknessRange),this.iridescenceThicknessMap=e.iridescenceThicknessMap,this.sheen=e.sheen,this.sheenColor.copy(e.sheenColor),this.sheenColorMap=e.sheenColorMap,this.sheenRoughness=e.sheenRoughness,this.sheenRoughnessMap=e.sheenRoughnessMap,this.transmission=e.transmission,this.transmissionMap=e.transmissionMap,this.thickness=e.thickness,this.thicknessMap=e.thicknessMap,this.attenuationDistance=e.attenuationDistance,this.attenuationColor.copy(e.attenuationColor),this.specularIntensity=e.specularIntensity,this.specularIntensityMap=e.specularIntensityMap,this.specularColor.copy(e.specularColor),this.specularColorMap=e.specularColorMap,this}}]),n}(rc),oc=function(e){(0,d.Z)(n,e);var t=(0,f.Z)(n);function n(e){var i;return(0,v.Z)(this,n),(i=t.call(this)).isMeshPhongMaterial=!0,i.type="MeshPhongMaterial",i.color=new Rn(16777215),i.specular=new Rn(1118481),i.shininess=30,i.map=null,i.lightMap=null,i.lightMapIntensity=1,i.aoMap=null,i.aoMapIntensity=1,i.emissive=new Rn(0),i.emissiveIntensity=1,i.emissiveMap=null,i.bumpMap=null,i.bumpScale=1,i.normalMap=null,i.normalMapType=jt,i.normalScale=new An(1,1),i.displacementMap=null,i.displacementScale=1,i.displacementBias=0,i.specularMap=null,i.alphaMap=null,i.envMap=null,i.combine=oe,i.reflectivity=1,i.refractionRatio=.98,i.wireframe=!1,i.wireframeLinewidth=1,i.wireframeLinecap="round",i.wireframeLinejoin="round",i.flatShading=!1,i.fog=!0,i.setValues(e),i}return(0,g.Z)(n,[{key:"copy",value:function(e){return(0,u.Z)((0,c.Z)(n.prototype),"copy",this).call(this,e),this.color.copy(e.color),this.specular.copy(e.specular),this.shininess=e.shininess,this.map=e.map,this.lightMap=e.lightMap,this.lightMapIntensity=e.lightMapIntensity,this.aoMap=e.aoMap,this.aoMapIntensity=e.aoMapIntensity,this.emissive.copy(e.emissive),this.emissiveMap=e.emissiveMap,this.emissiveIntensity=e.emissiveIntensity,this.bumpMap=e.bumpMap,this.bumpScale=e.bumpScale,this.normalMap=e.normalMap,this.normalMapType=e.normalMapType,this.normalScale.copy(e.normalScale),this.displacementMap=e.displacementMap,this.displacementScale=e.displacementScale,this.displacementBias=e.displacementBias,this.specularMap=e.specularMap,this.alphaMap=e.alphaMap,this.envMap=e.envMap,this.combine=e.combine,this.reflectivity=e.reflectivity,this.refractionRatio=e.refractionRatio,this.wireframe=e.wireframe,this.wireframeLinewidth=e.wireframeLinewidth,this.wireframeLinecap=e.wireframeLinecap,this.wireframeLinejoin=e.wireframeLinejoin,this.flatShading=e.flatShading,this.fog=e.fog,this}}]),n}(rr),sc=function(e){(0,d.Z)(n,e);var t=(0,f.Z)(n);function n(e){var i;return(0,v.Z)(this,n),(i=t.call(this)).isMeshLambertMaterial=!0,i.type="MeshLambertMaterial",i.color=new Rn(16777215),i.map=null,i.lightMap=null,i.lightMapIntensity=1,i.aoMap=null,i.aoMapIntensity=1,i.emissive=new Rn(0),i.emissiveIntensity=1,i.emissiveMap=null,i.bumpMap=null,i.bumpScale=1,i.normalMap=null,i.normalMapType=jt,i.normalScale=new An(1,1),i.displacementMap=null,i.displacementScale=1,i.displacementBias=0,i.specularMap=null,i.alphaMap=null,i.envMap=null,i.combine=oe,i.reflectivity=1,i.refractionRatio=.98,i.wireframe=!1,i.wireframeLinewidth=1,i.wireframeLinecap="round",i.wireframeLinejoin="round",i.flatShading=!1,i.fog=!0,i.setValues(e),i}return(0,g.Z)(n,[{key:"copy",value:function(e){return(0,u.Z)((0,c.Z)(n.prototype),"copy",this).call(this,e),this.color.copy(e.color),this.map=e.map,this.lightMap=e.lightMap,this.lightMapIntensity=e.lightMapIntensity,this.aoMap=e.aoMap,this.aoMapIntensity=e.aoMapIntensity,this.emissive.copy(e.emissive),this.emissiveMap=e.emissiveMap,this.emissiveIntensity=e.emissiveIntensity,this.bumpMap=e.bumpMap,this.bumpScale=e.bumpScale,this.normalMap=e.normalMap,this.normalMapType=e.normalMapType,this.normalScale.copy(e.normalScale),this.displacementMap=e.displacementMap,this.displacementScale=e.displacementScale,this.displacementBias=e.displacementBias,this.specularMap=e.specularMap,this.alphaMap=e.alphaMap,this.envMap=e.envMap,this.combine=e.combine,this.reflectivity=e.reflectivity,this.refractionRatio=e.refractionRatio,this.wireframe=e.wireframe,this.wireframeLinewidth=e.wireframeLinewidth,this.wireframeLinecap=e.wireframeLinecap,this.wireframeLinejoin=e.wireframeLinejoin,this.flatShading=e.flatShading,this.fog=e.fog,this}}]),n}(rr);function lc(e,t,n){return cc(e)?new e.constructor(e.subarray(t,void 0!==n?n:e.length)):e.slice(t,n)}function uc(e,t,n){return!e||!n&&e.constructor===t?e:"number"===typeof t.BYTES_PER_ELEMENT?new t(e):Array.prototype.slice.call(e)}function cc(e){return ArrayBuffer.isView(e)&&!(e instanceof DataView)}function hc(e){for(var t=e.length,n=new Array(t),i=0;i!==t;++i)n[i]=i;return n.sort((function(t,n){return e[t]-e[n]})),n}function dc(e,t,n){for(var i=e.length,r=new e.constructor(i),a=0,o=0;o!==i;++a)for(var s=n[a]*t,l=0;l!==t;++l)r[o++]=e[s+l];return r}function fc(e,t,n,i){for(var r=1,a=e[0];void 0!==a&&void 0===a[i];)a=e[r++];if(void 0!==a){var o=a[i];if(void 0!==o)if(Array.isArray(o))do{void 0!==(o=a[i])&&(t.push(a.time),n.push.apply(n,o)),a=e[r++]}while(void 0!==a);else if(void 0!==o.toArray)do{void 0!==(o=a[i])&&(t.push(a.time),o.toArray(n,n.length)),a=e[r++]}while(void 0!==a);else do{void 0!==(o=a[i])&&(t.push(a.time),n.push(o)),a=e[r++]}while(void 0!==a)}}var pc=function(){function e(t,n,i,r){(0,v.Z)(this,e),this.parameterPositions=t,this._cachedIndex=0,this.resultBuffer=void 0!==r?r:new n.constructor(i),this.sampleValues=n,this.valueSize=i,this.settings=null,this.DefaultSettings_={}}return(0,g.Z)(e,[{key:"evaluate",value:function(e){var t=this.parameterPositions,n=this._cachedIndex,i=t[n],r=t[n-1];e:{t:{var a;n:{i:if(!(e<i)){for(var o=n+2;;){if(void 0===i){if(e<r)break i;return n=t.length,this._cachedIndex=n,this.copySampleValue_(n-1)}if(n===o)break;if(r=i,e<(i=t[++n]))break t}a=t.length;break n}if(e>=r)break e;var s=t[1];e<s&&(n=2,r=s);for(var l=n-2;;){if(void 0===r)return this._cachedIndex=0,this.copySampleValue_(0);if(n===l)break;if(i=r,e>=(r=t[--n-1]))break t}a=n,n=0}for(;n<a;){var u=n+a>>>1;e<t[u]?a=u:n=u+1}if(i=t[n],void 0===(r=t[n-1]))return this._cachedIndex=0,this.copySampleValue_(0);if(void 0===i)return n=t.length,this._cachedIndex=n,this.copySampleValue_(n-1)}this._cachedIndex=n,this.intervalChanged_(n,r,i)}return this.interpolate_(n,r,e,i)}},{key:"getSettings_",value:function(){return this.settings||this.DefaultSettings_}},{key:"copySampleValue_",value:function(e){for(var t=this.resultBuffer,n=this.sampleValues,i=this.valueSize,r=e*i,a=0;a!==i;++a)t[a]=n[r+a];return t}},{key:"interpolate_",value:function(){throw new Error("call to abstract method")}},{key:"intervalChanged_",value:function(){}}]),e}(),Ac=function(e){(0,d.Z)(n,e);var t=(0,f.Z)(n);function n(e,i,r,a){var o;return(0,v.Z)(this,n),(o=t.call(this,e,i,r,a))._weightPrev=-0,o._offsetPrev=-0,o._weightNext=-0,o._offsetNext=-0,o.DefaultSettings_={endingStart:Tt,endingEnd:Tt},o}return(0,g.Z)(n,[{key:"intervalChanged_",value:function(e,t,n){var i=this.parameterPositions,r=e-2,a=e+1,o=i[r],s=i[a];if(void 0===o)switch(this.getSettings_().endingStart){case Dt:r=e,o=2*t-n;break;case Rt:o=t+i[r=i.length-2]-i[r+1];break;default:r=e,o=n}if(void 0===s)switch(this.getSettings_().endingEnd){case Dt:a=e,s=2*n-t;break;case Rt:a=1,s=n+i[1]-i[0];break;default:a=e-1,s=t}var l=.5*(n-t),u=this.valueSize;this._weightPrev=l/(t-o),this._weightNext=l/(s-n),this._offsetPrev=r*u,this._offsetNext=a*u}},{key:"interpolate_",value:function(e,t,n,i){for(var r=this.resultBuffer,a=this.sampleValues,o=this.valueSize,s=e*o,l=s-o,u=this._offsetPrev,c=this._offsetNext,h=this._weightPrev,d=this._weightNext,f=(n-t)/(i-t),p=f*f,A=p*f,v=-h*A+2*h*p-h*f,g=(1+h)*A+(-1.5-2*h)*p+(-.5+h)*f+1,m=(-1-d)*A+(1.5+d)*p+.5*f,y=d*A-d*p,x=0;x!==o;++x)r[x]=v*a[u+x]+g*a[l+x]+m*a[s+x]+y*a[c+x];return r}}]),n}(pc),vc=function(e){(0,d.Z)(n,e);var t=(0,f.Z)(n);function n(e,i,r,a){return(0,v.Z)(this,n),t.call(this,e,i,r,a)}return(0,g.Z)(n,[{key:"interpolate_",value:function(e,t,n,i){for(var r=this.resultBuffer,a=this.sampleValues,o=this.valueSize,s=e*o,l=s-o,u=(n-t)/(i-t),c=1-u,h=0;h!==o;++h)r[h]=a[l+h]*c+a[s+h]*u;return r}}]),n}(pc),gc=function(e){(0,d.Z)(n,e);var t=(0,f.Z)(n);function n(e,i,r,a){return(0,v.Z)(this,n),t.call(this,e,i,r,a)}return(0,g.Z)(n,[{key:"interpolate_",value:function(e){return this.copySampleValue_(e-1)}}]),n}(pc),mc=function(){function e(t,n,i,r){if((0,v.Z)(this,e),void 0===t)throw new Error("THREE.KeyframeTrack: track name is undefined");if(void 0===n||0===n.length)throw new Error("THREE.KeyframeTrack: no keyframes in track named "+t);this.name=t,this.times=uc(n,this.TimeBufferType),this.values=uc(i,this.ValueBufferType),this.setInterpolation(r||this.DefaultInterpolation)}return(0,g.Z)(e,[{key:"InterpolantFactoryMethodDiscrete",value:function(e){return new gc(this.times,this.values,this.getValueSize(),e)}},{key:"InterpolantFactoryMethodLinear",value:function(e){return new vc(this.times,this.values,this.getValueSize(),e)}},{key:"InterpolantFactoryMethodSmooth",value:function(e){return new Ac(this.times,this.values,this.getValueSize(),e)}},{key:"setInterpolation",value:function(e){var t;switch(e){case St:t=this.InterpolantFactoryMethodDiscrete;break;case kt:t=this.InterpolantFactoryMethodLinear;break;case Bt:t=this.InterpolantFactoryMethodSmooth}if(void 0===t){var n="unsupported interpolation for "+this.ValueTypeName+" keyframe track named "+this.name;if(void 0===this.createInterpolant){if(e===this.DefaultInterpolation)throw new Error(n);this.setInterpolation(this.DefaultInterpolation)}return console.warn("THREE.KeyframeTrack:",n),this}return this.createInterpolant=t,this}},{key:"getInterpolation",value:function(){switch(this.createInterpolant){case this.InterpolantFactoryMethodDiscrete:return St;case this.InterpolantFactoryMethodLinear:return kt;case this.InterpolantFactoryMethodSmooth:return Bt}}},{key:"getValueSize",value:function(){return this.values.length/this.times.length}},{key:"shift",value:function(e){if(0!==e)for(var t=this.times,n=0,i=t.length;n!==i;++n)t[n]+=e;return this}},{key:"scale",value:function(e){if(1!==e)for(var t=this.times,n=0,i=t.length;n!==i;++n)t[n]*=e;return this}},{key:"trim",value:function(e,t){for(var n=this.times,i=n.length,r=0,a=i-1;r!==i&&n[r]<e;)++r;for(;-1!==a&&n[a]>t;)--a;if(++a,0!==r||a!==i){r>=a&&(r=(a=Math.max(a,1))-1);var o=this.getValueSize();this.times=lc(n,r,a),this.values=lc(this.values,r*o,a*o)}return this}},{key:"validate",value:function(){var e=!0,t=this.getValueSize();t-Math.floor(t)!==0&&(console.error("THREE.KeyframeTrack: Invalid value size in track.",this),e=!1);var n=this.times,i=this.values,r=n.length;0===r&&(console.error("THREE.KeyframeTrack: Track is empty.",this),e=!1);for(var a=null,o=0;o!==r;o++){var s=n[o];if("number"===typeof s&&isNaN(s)){console.error("THREE.KeyframeTrack: Time is not a valid number.",this,o,s),e=!1;break}if(null!==a&&a>s){console.error("THREE.KeyframeTrack: Out of order keys.",this,o,s,a),e=!1;break}a=s}if(void 0!==i&&cc(i))for(var l=0,u=i.length;l!==u;++l){var c=i[l];if(isNaN(c)){console.error("THREE.KeyframeTrack: Value is not a valid number.",this,l,c),e=!1;break}}return e}},{key:"optimize",value:function(){for(var e=lc(this.times),t=lc(this.values),n=this.getValueSize(),i=this.getInterpolation()===Bt,r=e.length-1,a=1,o=1;o<r;++o){var s=!1,l=e[o];if(l!==e[o+1]&&(1!==o||l!==e[0]))if(i)s=!0;else for(var u=o*n,c=u-n,h=u+n,d=0;d!==n;++d){var f=t[u+d];if(f!==t[c+d]||f!==t[h+d]){s=!0;break}}if(s){if(o!==a){e[a]=e[o];for(var p=o*n,A=a*n,v=0;v!==n;++v)t[A+v]=t[p+v]}++a}}if(r>0){e[a]=e[r];for(var g=r*n,m=a*n,y=0;y!==n;++y)t[m+y]=t[g+y];++a}return a!==e.length?(this.times=lc(e,0,a),this.values=lc(t,0,a*n)):(this.times=e,this.values=t),this}},{key:"clone",value:function(){var e=lc(this.times,0),t=lc(this.values,0),n=new(0,this.constructor)(this.name,e,t);return n.createInterpolant=this.createInterpolant,n}}],[{key:"toJSON",value:function(e){var t,n=e.constructor;if(n.toJSON!==this.toJSON)t=n.toJSON(e);else{t={name:e.name,times:uc(e.times,Array),values:uc(e.values,Array)};var i=e.getInterpolation();i!==e.DefaultInterpolation&&(t.interpolation=i)}return t.type=e.ValueTypeName,t}}]),e}();mc.prototype.TimeBufferType=Float32Array,mc.prototype.ValueBufferType=Float32Array,mc.prototype.DefaultInterpolation=kt;var yc=function(e){(0,d.Z)(n,e);var t=(0,f.Z)(n);function n(){return(0,v.Z)(this,n),t.apply(this,arguments)}return(0,g.Z)(n)}(mc);yc.prototype.ValueTypeName="bool",yc.prototype.ValueBufferType=Array,yc.prototype.DefaultInterpolation=St,yc.prototype.InterpolantFactoryMethodLinear=void 0,yc.prototype.InterpolantFactoryMethodSmooth=void 0;var xc=function(e){(0,d.Z)(n,e);var t=(0,f.Z)(n);function n(){return(0,v.Z)(this,n),t.apply(this,arguments)}return(0,g.Z)(n)}(mc);xc.prototype.ValueTypeName="color";var wc=function(e){(0,d.Z)(n,e);var t=(0,f.Z)(n);function n(){return(0,v.Z)(this,n),t.apply(this,arguments)}return(0,g.Z)(n)}(mc);wc.prototype.ValueTypeName="number";var Cc=function(e){(0,d.Z)(n,e);var t=(0,f.Z)(n);function n(e,i,r,a){return(0,v.Z)(this,n),t.call(this,e,i,r,a)}return(0,g.Z)(n,[{key:"interpolate_",value:function(e,t,n,i){for(var r=this.resultBuffer,a=this.sampleValues,o=this.valueSize,s=(n-t)/(i-t),l=e*o,u=l+o;l!==u;l+=4)zn.slerpFlat(r,0,a,l-o,a,l,s);return r}}]),n}(pc),bc=function(e){(0,d.Z)(n,e);var t=(0,f.Z)(n);function n(){return(0,v.Z)(this,n),t.apply(this,arguments)}return(0,g.Z)(n,[{key:"InterpolantFactoryMethodLinear",value:function(e){return new Cc(this.times,this.values,this.getValueSize(),e)}}]),n}(mc);bc.prototype.ValueTypeName="quaternion",bc.prototype.DefaultInterpolation=kt,bc.prototype.InterpolantFactoryMethodSmooth=void 0;var _c=function(e){(0,d.Z)(n,e);var t=(0,f.Z)(n);function n(){return(0,v.Z)(this,n),t.apply(this,arguments)}return(0,g.Z)(n)}(mc);_c.prototype.ValueTypeName="string",_c.prototype.ValueBufferType=Array,_c.prototype.DefaultInterpolation=St,_c.prototype.InterpolantFactoryMethodLinear=void 0,_c.prototype.InterpolantFactoryMethodSmooth=void 0;var Ec=function(e){(0,d.Z)(n,e);var t=(0,f.Z)(n);function n(){return(0,v.Z)(this,n),t.apply(this,arguments)}return(0,g.Z)(n)}(mc);Ec.prototype.ValueTypeName="vector";var Mc=function(){function e(t){var n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:-1,i=arguments.length>2?arguments[2]:void 0,r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:Pt;(0,v.Z)(this,e),this.name=t,this.tracks=i,this.duration=n,this.blendMode=r,this.uuid=an(),this.duration<0&&this.resetDuration()}return(0,g.Z)(e,[{key:"resetDuration",value:function(){for(var e=0,t=0,n=this.tracks.length;t!==n;++t){var i=this.tracks[t];e=Math.max(e,i.times[i.times.length-1])}return this.duration=e,this}},{key:"trim",value:function(){for(var e=0;e<this.tracks.length;e++)this.tracks[e].trim(0,this.duration);return this}},{key:"validate",value:function(){for(var e=!0,t=0;t<this.tracks.length;t++)e=e&&this.tracks[t].validate();return e}},{key:"optimize",value:function(){for(var e=0;e<this.tracks.length;e++)this.tracks[e].optimize();return this}},{key:"clone",value:function(){for(var e=[],t=0;t<this.tracks.length;t++)e.push(this.tracks[t].clone());return new this.constructor(this.name,this.duration,e,this.blendMode)}},{key:"toJSON",value:function(){return this.constructor.toJSON(this)}}],[{key:"parse",value:function(e){for(var t=[],n=e.tracks,i=1/(e.fps||1),r=0,a=n.length;r!==a;++r)t.push(Ic(n[r]).scale(i));var o=new this(e.name,e.duration,t,e.blendMode);return o.uuid=e.uuid,o}},{key:"toJSON",value:function(e){for(var t=[],n=e.tracks,i={name:e.name,duration:e.duration,tracks:t,uuid:e.uuid,blendMode:e.blendMode},r=0,a=n.length;r!==a;++r)t.push(mc.toJSON(n[r]));return i}},{key:"CreateFromMorphTargetSequence",value:function(e,t,n,i){for(var r=t.length,a=[],o=0;o<r;o++){var s=[],l=[];s.push((o+r-1)%r,o,(o+1)%r),l.push(0,1,0);var u=hc(s);s=dc(s,1,u),l=dc(l,1,u),i||0!==s[0]||(s.push(r),l.push(l[0])),a.push(new wc(".morphTargetInfluences["+t[o].name+"]",s,l).scale(1/n))}return new this(e,-1,a)}},{key:"findByName",value:function(e,t){var n=e;if(!Array.isArray(e)){var i=e;n=i.geometry&&i.geometry.animations||i.animations}for(var r=0;r<n.length;r++)if(n[r].name===t)return n[r];return null}},{key:"CreateClipsFromMorphTargetSequences",value:function(e,t,n){for(var i={},r=/^([\w-]*?)([\d]+)$/,a=0,o=e.length;a<o;a++){var s=e[a],l=s.name.match(r);if(l&&l.length>1){var u=l[1],c=i[u];c||(i[u]=c=[]),c.push(s)}}var h=[];for(var d in i)h.push(this.CreateFromMorphTargetSequence(d,i[d],t,n));return h}},{key:"parseAnimation",value:function(e,t){if(!e)return console.error("THREE.AnimationClip: No animation in JSONLoader data."),null;for(var n=function(e,t,n,i,r){if(0!==n.length){var a=[],o=[];fc(n,a,o,i),0!==a.length&&r.push(new e(t,a,o))}},i=[],r=e.name||"default",a=e.fps||30,o=e.blendMode,s=e.length||-1,l=e.hierarchy||[],u=0;u<l.length;u++){var c=l[u].keys;if(c&&0!==c.length)if(c[0].morphTargets){var h={},d=void 0;for(d=0;d<c.length;d++)if(c[d].morphTargets)for(var f=0;f<c[d].morphTargets.length;f++)h[c[d].morphTargets[f]]=-1;for(var p in h){for(var A=[],v=[],g=0;g!==c[d].morphTargets.length;++g){var m=c[d];A.push(m.time),v.push(m.morphTarget===p?1:0)}i.push(new wc(".morphTargetInfluence["+p+"]",A,v))}s=h.length*a}else{var y=".bones["+t[u].name+"]";n(Ec,y+".position",c,"pos",i),n(bc,y+".quaternion",c,"rot",i),n(Ec,y+".scale",c,"scl",i)}}return 0===i.length?null:new this(r,s,i,o)}}]),e}();function Ic(e){if(void 0===e.type)throw new Error("THREE.KeyframeTrack: track type undefined, can not parse");var t=function(e){switch(e.toLowerCase()){case"scalar":case"double":case"float":case"number":case"integer":return wc;case"vector":case"vector2":case"vector3":case"vector4":return Ec;case"color":return xc;case"quaternion":return bc;case"bool":case"boolean":return yc;case"string":return _c}throw new Error("THREE.KeyframeTrack: Unsupported typeName: "+e)}(e.type);if(void 0===e.times){var n=[],i=[];fc(e.keys,n,i,"value"),e.times=n,e.values=i}return void 0!==t.parse?t.parse(e):new t(e.name,e.times,e.values,e.interpolation)}var Sc={enabled:!1,files:{},add:function(e,t){!1!==this.enabled&&(this.files[e]=t)},get:function(e){if(!1!==this.enabled)return this.files[e]},remove:function(e){delete this.files[e]},clear:function(){this.files={}}},kc=(0,g.Z)((function e(t,n,i){(0,v.Z)(this,e);var r=this,a=!1,o=0,s=0,l=void 0,u=[];this.onStart=void 0,this.onLoad=t,this.onProgress=n,this.onError=i,this.itemStart=function(e){s++,!1===a&&void 0!==r.onStart&&r.onStart(e,o,s),a=!0},this.itemEnd=function(e){o++,void 0!==r.onProgress&&r.onProgress(e,o,s),o===s&&(a=!1,void 0!==r.onLoad&&r.onLoad())},this.itemError=function(e){void 0!==r.onError&&r.onError(e)},this.resolveURL=function(e){return l?l(e):e},this.setURLModifier=function(e){return l=e,this},this.addHandler=function(e,t){return u.push(e,t),this},this.removeHandler=function(e){var t=u.indexOf(e);return-1!==t&&u.splice(t,2),this},this.getHandler=function(e){for(var t=0,n=u.length;t<n;t+=2){var i=u[t],r=u[t+1];if(i.global&&(i.lastIndex=0),i.test(e))return r}return null}})),Bc=new kc,Tc=function(){function e(t){(0,v.Z)(this,e),this.manager=void 0!==t?t:Bc,this.crossOrigin="anonymous",this.withCredentials=!1,this.path="",this.resourcePath="",this.requestHeader={}}return(0,g.Z)(e,[{key:"load",value:function(){}},{key:"loadAsync",value:function(e,t){var n=this;return new Promise((function(i,r){n.load(e,i,t,r)}))}},{key:"parse",value:function(){}},{key:"setCrossOrigin",value:function(e){return this.crossOrigin=e,this}},{key:"setWithCredentials",value:function(e){return this.withCredentials=e,this}},{key:"setPath",value:function(e){return this.path=e,this}},{key:"setResourcePath",value:function(e){return this.resourcePath=e,this}},{key:"setRequestHeader",value:function(e){return this.requestHeader=e,this}}]),e}(),Dc={},Rc=function(e){(0,d.Z)(n,e);var t=(0,f.Z)(n);function n(e,i){var r;return(0,v.Z)(this,n),(r=t.call(this,e)).response=i,r}return(0,g.Z)(n)}((0,r.Z)(Error)),Pc=function(e){(0,d.Z)(n,e);var t=(0,f.Z)(n);function n(e){return(0,v.Z)(this,n),t.call(this,e)}return(0,g.Z)(n,[{key:"load",value:function(e,t,n,i){var r=this;void 0===e&&(e=""),void 0!==this.path&&(e=this.path+e),e=this.manager.resolveURL(e);var a=Sc.get(e);if(void 0!==a)return this.manager.itemStart(e),setTimeout((function(){t&&t(a),r.manager.itemEnd(e)}),0),a;if(void 0===Dc[e]){Dc[e]=[],Dc[e].push({onLoad:t,onProgress:n,onError:i});var o=new Request(e,{headers:new Headers(this.requestHeader),credentials:this.withCredentials?"include":"same-origin"}),s=this.mimeType,l=this.responseType;fetch(o).then((function(t){if(200===t.status||0===t.status){if(0===t.status&&console.warn("THREE.FileLoader: HTTP Status 0 received."),"undefined"===typeof ReadableStream||void 0===t.body||void 0===t.body.getReader)return t;var n=Dc[e],i=t.body.getReader(),r=t.headers.get("Content-Length")||t.headers.get("X-File-Size"),a=r?parseInt(r):0,o=0!==a,s=0,l=new ReadableStream({start:function(e){!function t(){i.read().then((function(i){var r=i.done,l=i.value;if(r)e.close();else{s+=l.byteLength;for(var u=new ProgressEvent("progress",{lengthComputable:o,loaded:s,total:a}),c=0,h=n.length;c<h;c++){var d=n[c];d.onProgress&&d.onProgress(u)}e.enqueue(l),t()}}))}()}});return new Response(l)}throw new Rc('fetch for "'.concat(t.url,'" responded with ').concat(t.status,": ").concat(t.statusText),t)})).then((function(e){switch(l){case"arraybuffer":return e.arrayBuffer();case"blob":return e.blob();case"document":return e.text().then((function(e){return(new DOMParser).parseFromString(e,s)}));case"json":return e.json();default:if(void 0===s)return e.text();var t=/charset="?([^;"\s]*)"?/i.exec(s),n=t&&t[1]?t[1].toLowerCase():void 0,i=new TextDecoder(n);return e.arrayBuffer().then((function(e){return i.decode(e)}))}})).then((function(t){Sc.add(e,t);var n=Dc[e];delete Dc[e];for(var i=0,r=n.length;i<r;i++){var a=n[i];a.onLoad&&a.onLoad(t)}})).catch((function(t){var n=Dc[e];if(void 0===n)throw r.manager.itemError(e),t;delete Dc[e];for(var i=0,a=n.length;i<a;i++){var o=n[i];o.onError&&o.onError(t)}r.manager.itemError(e)})).finally((function(){r.manager.itemEnd(e)})),this.manager.itemStart(e)}else Dc[e].push({onLoad:t,onProgress:n,onError:i})}},{key:"setResponseType",value:function(e){return this.responseType=e,this}},{key:"setMimeType",value:function(e){return this.mimeType=e,this}}]),n}(Tc),Lc=function(e){(0,d.Z)(n,e);var t=(0,f.Z)(n);function n(e){return(0,v.Z)(this,n),t.call(this,e)}return(0,g.Z)(n,[{key:"load",value:function(e,t,n,i){void 0!==this.path&&(e=this.path+e),e=this.manager.resolveURL(e);var r=this,a=Sc.get(e);if(void 0!==a)return r.manager.itemStart(e),setTimeout((function(){t&&t(a),r.manager.itemEnd(e)}),0),a;var o=wn("img");function s(){u(),Sc.add(e,this),t&&t(this),r.manager.itemEnd(e)}function l(t){u(),i&&i(t),r.manager.itemError(e),r.manager.itemEnd(e)}function u(){o.removeEventListener("load",s,!1),o.removeEventListener("error",l,!1)}return o.addEventListener("load",s,!1),o.addEventListener("error",l,!1),"data:"!==e.slice(0,5)&&void 0!==this.crossOrigin&&(o.crossOrigin=this.crossOrigin),r.manager.itemStart(e),o.src=e,o}}]),n}(Tc),Qc=function(e){(0,d.Z)(n,e);var t=(0,f.Z)(n);function n(e){return(0,v.Z)(this,n),t.call(this,e)}return(0,g.Z)(n,[{key:"load",value:function(e,t,n,i){var r=this,a=new dl,o=new Pc(this.manager);return o.setResponseType("arraybuffer"),o.setRequestHeader(this.requestHeader),o.setPath(this.path),o.setWithCredentials(r.withCredentials),o.load(e,(function(e){var n=r.parse(e);n&&(void 0!==n.image?a.image=n.image:void 0!==n.data&&(a.image.width=n.width,a.image.height=n.height,a.image.data=n.data),a.wrapS=void 0!==n.wrapS?n.wrapS:we,a.wrapT=void 0!==n.wrapT?n.wrapT:we,a.magFilter=void 0!==n.magFilter?n.magFilter:Me,a.minFilter=void 0!==n.minFilter?n.minFilter:Me,a.anisotropy=void 0!==n.anisotropy?n.anisotropy:1,void 0!==n.encoding&&(a.encoding=n.encoding),void 0!==n.flipY&&(a.flipY=n.flipY),void 0!==n.format&&(a.format=n.format),void 0!==n.type&&(a.type=n.type),void 0!==n.mipmaps&&(a.mipmaps=n.mipmaps,a.minFilter=Se),1===n.mipmapCount&&(a.minFilter=Me),void 0!==n.generateMipmaps&&(a.generateMipmaps=n.generateMipmaps),a.needsUpdate=!0,t&&t(a,n))}),n,i),a}}]),n}(Tc),Zc=function(e){(0,d.Z)(n,e);var t=(0,f.Z)(n);function n(e){return(0,v.Z)(this,n),t.call(this,e)}return(0,g.Z)(n,[{key:"load",value:function(e,t,n,i){var r=new Nn,a=new Lc(this.manager);return a.setCrossOrigin(this.crossOrigin),a.setPath(this.path),a.load(e,(function(e){r.image=e,r.needsUpdate=!0,void 0!==t&&t(r)}),n,i),r}}]),n}(Tc),Nc=function(e){(0,d.Z)(n,e);var t=(0,f.Z)(n);function n(e){var i,r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1;return(0,v.Z)(this,n),(i=t.call(this)).isLight=!0,i.type="Light",i.color=new Rn(e),i.intensity=r,i}return(0,g.Z)(n,[{key:"dispose",value:function(){}},{key:"copy",value:function(e,t){return(0,u.Z)((0,c.Z)(n.prototype),"copy",this).call(this,e,t),this.color.copy(e.color),this.intensity=e.intensity,this}},{key:"toJSON",value:function(e){var t=(0,u.Z)((0,c.Z)(n.prototype),"toJSON",this).call(this,e);return t.object.color=this.color.getHex(),t.object.intensity=this.intensity,void 0!==this.groundColor&&(t.object.groundColor=this.groundColor.getHex()),void 0!==this.distance&&(t.object.distance=this.distance),void 0!==this.angle&&(t.object.angle=this.angle),void 0!==this.decay&&(t.object.decay=this.decay),void 0!==this.penumbra&&(t.object.penumbra=this.penumbra),void 0!==this.shadow&&(t.object.shadow=this.shadow.toJSON()),t}}]),n}(Hi),Fc=function(e){(0,d.Z)(n,e);var t=(0,f.Z)(n);function n(e,i,r){var a;return(0,v.Z)(this,n),(a=t.call(this,e,r)).isHemisphereLight=!0,a.type="HemisphereLight",a.position.copy(Hi.DEFAULT_UP),a.updateMatrix(),a.groundColor=new Rn(i),a}return(0,g.Z)(n,[{key:"copy",value:function(e,t){return(0,u.Z)((0,c.Z)(n.prototype),"copy",this).call(this,e,t),this.groundColor.copy(e.groundColor),this}}]),n}(Nc),Uc=new xi,jc=new Gn,Oc=new Gn,zc=function(){function e(t){(0,v.Z)(this,e),this.camera=t,this.bias=0,this.normalBias=0,this.radius=1,this.blurSamples=8,this.mapSize=new An(512,512),this.map=null,this.mapPass=null,this.matrix=new xi,this.autoUpdate=!0,this.needsUpdate=!1,this._frustum=new ea,this._frameExtents=new An(1,1),this._viewportCount=1,this._viewports=[new Fn(0,0,1,1)]}return(0,g.Z)(e,[{key:"getViewportCount",value:function(){return this._viewportCount}},{key:"getFrustum",value:function(){return this._frustum}},{key:"updateMatrices",value:function(e){var t=this.camera,n=this.matrix;jc.setFromMatrixPosition(e.matrixWorld),t.position.copy(jc),Oc.setFromMatrixPosition(e.target.matrixWorld),t.lookAt(Oc),t.updateMatrixWorld(),Uc.multiplyMatrices(t.projectionMatrix,t.matrixWorldInverse),this._frustum.setFromProjectionMatrix(Uc),n.set(.5,0,0,.5,0,.5,0,.5,0,0,.5,.5,0,0,0,1),n.multiply(Uc)}},{key:"getViewport",value:function(e){return this._viewports[e]}},{key:"getFrameExtents",value:function(){return this._frameExtents}},{key:"dispose",value:function(){this.map&&this.map.dispose(),this.mapPass&&this.mapPass.dispose()}},{key:"copy",value:function(e){return this.camera=e.camera.clone(),this.bias=e.bias,this.radius=e.radius,this.mapSize.copy(e.mapSize),this}},{key:"clone",value:function(){return(new this.constructor).copy(this)}},{key:"toJSON",value:function(){var e={};return 0!==this.bias&&(e.bias=this.bias),0!==this.normalBias&&(e.normalBias=this.normalBias),1!==this.radius&&(e.radius=this.radius),512===this.mapSize.x&&512===this.mapSize.y||(e.mapSize=this.mapSize.toArray()),e.camera=this.camera.toJSON(!1).object,delete e.camera.matrix,e}}]),e}(),Gc=function(e){(0,d.Z)(n,e);var t=(0,f.Z)(n);function n(){var e;return(0,v.Z)(this,n),(e=t.call(this,new zr(50,1,.5,500))).isSpotLightShadow=!0,e.focus=1,e}return(0,g.Z)(n,[{key:"updateMatrices",value:function(e){var t=this.camera,i=2*rn*e.angle*this.focus,r=this.mapSize.width/this.mapSize.height,a=e.distance||t.far;i===t.fov&&r===t.aspect&&a===t.far||(t.fov=i,t.aspect=r,t.far=a,t.updateProjectionMatrix()),(0,u.Z)((0,c.Z)(n.prototype),"updateMatrices",this).call(this,e)}},{key:"copy",value:function(e){return(0,u.Z)((0,c.Z)(n.prototype),"copy",this).call(this,e),this.focus=e.focus,this}}]),n}(zc),Hc=function(e){(0,d.Z)(n,e);var t=(0,f.Z)(n);function n(e,i){var r,a=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0,o=arguments.length>3&&void 0!==arguments[3]?arguments[3]:Math.PI/3,s=arguments.length>4&&void 0!==arguments[4]?arguments[4]:0,l=arguments.length>5&&void 0!==arguments[5]?arguments[5]:2;return(0,v.Z)(this,n),(r=t.call(this,e,i)).isSpotLight=!0,r.type="SpotLight",r.position.copy(Hi.DEFAULT_UP),r.updateMatrix(),r.target=new Hi,r.distance=a,r.angle=o,r.penumbra=s,r.decay=l,r.map=null,r.shadow=new Gc,r}return(0,g.Z)(n,[{key:"power",get:function(){return this.intensity*Math.PI},set:function(e){this.intensity=e/Math.PI}},{key:"dispose",value:function(){this.shadow.dispose()}},{key:"copy",value:function(e,t){return(0,u.Z)((0,c.Z)(n.prototype),"copy",this).call(this,e,t),this.distance=e.distance,this.angle=e.angle,this.penumbra=e.penumbra,this.decay=e.decay,this.target=e.target.clone(),this.shadow=e.shadow.clone(),this}}]),n}(Nc),Vc=new xi,Wc=new Gn,qc=new Gn,Yc=function(e){(0,d.Z)(n,e);var t=(0,f.Z)(n);function n(){var e;return(0,v.Z)(this,n),(e=t.call(this,new zr(90,1,.5,500))).isPointLightShadow=!0,e._frameExtents=new An(4,2),e._viewportCount=6,e._viewports=[new Fn(2,1,1,1),new Fn(0,1,1,1),new Fn(3,1,1,1),new Fn(1,1,1,1),new Fn(3,0,1,1),new Fn(1,0,1,1)],e._cubeDirections=[new Gn(1,0,0),new Gn(-1,0,0),new Gn(0,0,1),new Gn(0,0,-1),new Gn(0,1,0),new Gn(0,-1,0)],e._cubeUps=[new Gn(0,1,0),new Gn(0,1,0),new Gn(0,1,0),new Gn(0,1,0),new Gn(0,0,1),new Gn(0,0,-1)],e}return(0,g.Z)(n,[{key:"updateMatrices",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,n=this.camera,i=this.matrix,r=e.distance||n.far;r!==n.far&&(n.far=r,n.updateProjectionMatrix()),Wc.setFromMatrixPosition(e.matrixWorld),n.position.copy(Wc),qc.copy(n.position),qc.add(this._cubeDirections[t]),n.up.copy(this._cubeUps[t]),n.lookAt(qc),n.updateMatrixWorld(),i.makeTranslation(-Wc.x,-Wc.y,-Wc.z),Vc.multiplyMatrices(n.projectionMatrix,n.matrixWorldInverse),this._frustum.setFromProjectionMatrix(Vc)}}]),n}(zc),Jc=function(e){(0,d.Z)(n,e);var t=(0,f.Z)(n);function n(e,i){var r,a=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0,o=arguments.length>3&&void 0!==arguments[3]?arguments[3]:2;return(0,v.Z)(this,n),(r=t.call(this,e,i)).isPointLight=!0,r.type="PointLight",r.distance=a,r.decay=o,r.shadow=new Yc,r}return(0,g.Z)(n,[{key:"power",get:function(){return 4*this.intensity*Math.PI},set:function(e){this.intensity=e/(4*Math.PI)}},{key:"dispose",value:function(){this.shadow.dispose()}},{key:"copy",value:function(e,t){return(0,u.Z)((0,c.Z)(n.prototype),"copy",this).call(this,e,t),this.distance=e.distance,this.decay=e.decay,this.shadow=e.shadow.clone(),this}}]),n}(Nc),Xc=function(e){(0,d.Z)(n,e);var t=(0,f.Z)(n);function n(){var e;return(0,v.Z)(this,n),(e=t.call(this,new pa(-5,5,5,-5,.5,500))).isDirectionalLightShadow=!0,e}return(0,g.Z)(n)}(zc),Kc=function(e){(0,d.Z)(n,e);var t=(0,f.Z)(n);function n(e,i){var r;return(0,v.Z)(this,n),(r=t.call(this,e,i)).isDirectionalLight=!0,r.type="DirectionalLight",r.position.copy(Hi.DEFAULT_UP),r.updateMatrix(),r.target=new Hi,r.shadow=new Xc,r}return(0,g.Z)(n,[{key:"dispose",value:function(){this.shadow.dispose()}},{key:"copy",value:function(e){return(0,u.Z)((0,c.Z)(n.prototype),"copy",this).call(this,e),this.target=e.target.clone(),this.shadow=e.shadow.clone(),this}}]),n}(Nc),$c=function(e){(0,d.Z)(n,e);var t=(0,f.Z)(n);function n(e,i){var r;return(0,v.Z)(this,n),(r=t.call(this,e,i)).isAmbientLight=!0,r.type="AmbientLight",r}return(0,g.Z)(n)}(Nc),eh=function(e){(0,d.Z)(n,e);var t=(0,f.Z)(n);function n(e,i){var r,a=arguments.length>2&&void 0!==arguments[2]?arguments[2]:10,o=arguments.length>3&&void 0!==arguments[3]?arguments[3]:10;return(0,v.Z)(this,n),(r=t.call(this,e,i)).isRectAreaLight=!0,r.type="RectAreaLight",r.width=a,r.height=o,r}return(0,g.Z)(n,[{key:"power",get:function(){return this.intensity*this.width*this.height*Math.PI},set:function(e){this.intensity=e/(this.width*this.height*Math.PI)}},{key:"copy",value:function(e){return(0,u.Z)((0,c.Z)(n.prototype),"copy",this).call(this,e),this.width=e.width,this.height=e.height,this}},{key:"toJSON",value:function(e){var t=(0,u.Z)((0,c.Z)(n.prototype),"toJSON",this).call(this,e);return t.object.width=this.width,t.object.height=this.height,t}}]),n}(Nc),th=function(){function e(){(0,v.Z)(this,e)}return(0,g.Z)(e,null,[{key:"decodeText",value:function(e){if("undefined"!==typeof TextDecoder)return(new TextDecoder).decode(e);for(var t="",n=0,i=e.length;n<i;n++)t+=String.fromCharCode(e[n]);try{return decodeURIComponent(escape(t))}catch(r){return t}}},{key:"extractUrlBase",value:function(e){var t=e.lastIndexOf("/");return-1===t?"./":e.slice(0,t+1)}},{key:"resolveURL",value:function(e,t){return"string"!==typeof e||""===e?"":(/^https?:\/\//i.test(t)&&/^\//.test(e)&&(t=t.replace(/(^https?:\/\/[^\/]+).*/i,"$1")),/^(https?:)?\/\//i.test(e)||/^data:.*,.*$/i.test(e)||/^blob:.*$/i.test(e)?e:t+e)}}]),e}(),nh=function(e){(0,d.Z)(n,e);var t=(0,f.Z)(n);function n(){var e;return(0,v.Z)(this,n),(e=t.call(this)).isInstancedBufferGeometry=!0,e.type="InstancedBufferGeometry",e.instanceCount=1/0,e}return(0,g.Z)(n,[{key:"copy",value:function(e){return(0,u.Z)((0,c.Z)(n.prototype),"copy",this).call(this,e),this.instanceCount=e.instanceCount,this}},{key:"toJSON",value:function(){var e=(0,u.Z)((0,c.Z)(n.prototype),"toJSON",this).call(this);return e.instanceCount=this.instanceCount,e.isInstancedBufferGeometry=!0,e}}]),n}(xr),ih=function(e){(0,d.Z)(n,e);var t=(0,f.Z)(n);function n(e){return(0,v.Z)(this,n),t.call(this,e)}return(0,g.Z)(n,[{key:"load",value:function(e,t,n,i){var r=this,a=new Pc(r.manager);a.setPath(r.path),a.setRequestHeader(r.requestHeader),a.setWithCredentials(r.withCredentials),a.load(e,(function(n){try{t(r.parse(JSON.parse(n)))}catch(a){i?i(a):console.error(a),r.manager.itemError(e)}}),n,i)}},{key:"parse",value:function(e){var t={},n={};function i(e,i){if(void 0!==t[i])return t[i];var r=e.interleavedBuffers[i],a=function(e,t){if(void 0!==n[t])return n[t];var i=e.arrayBuffers,r=i[t],a=new Uint32Array(r).buffer;return n[t]=a,a}(e,r.buffer),o=xn(r.type,a),s=new js(o,r.stride);return s.uuid=r.uuid,t[i]=s,s}var r=e.isInstancedBufferGeometry?new nh:new xr,a=e.data.index;if(void 0!==a){var o=xn(a.type,a.array);r.setIndex(new lr(o,1))}var s=e.data.attributes;for(var l in s){var u=s[l],c=void 0;if(u.isInterleavedBufferAttribute){var h=i(e.data,u.data);c=new zs(h,u.itemSize,u.offset,u.normalized)}else{var d=xn(u.type,u.array);c=new(u.isInstancedBufferAttribute?vl:lr)(d,u.itemSize,u.normalized)}void 0!==u.name&&(c.name=u.name),void 0!==u.usage&&c.setUsage(u.usage),void 0!==u.updateRange&&(c.updateRange.offset=u.updateRange.offset,c.updateRange.count=u.updateRange.count),r.setAttribute(l,c)}var f=e.data.morphAttributes;if(f)for(var p in f){for(var A=f[p],v=[],g=0,m=A.length;g<m;g++){var y=A[g],x=void 0;if(y.isInterleavedBufferAttribute){var w=i(e.data,y.data);x=new zs(w,y.itemSize,y.offset,y.normalized)}else{var C=xn(y.type,y.array);x=new lr(C,y.itemSize,y.normalized)}void 0!==y.name&&(x.name=y.name),v.push(x)}r.morphAttributes[p]=v}e.data.morphTargetsRelative&&(r.morphTargetsRelative=!0);var b=e.data.groups||e.data.drawcalls||e.data.offsets;if(void 0!==b)for(var _=0,E=b.length;_!==E;++_){var M=b[_];r.addGroup(M.start,M.count,M.materialIndex)}var I=e.data.boundingSphere;if(void 0!==I){var S=new Gn;void 0!==I.center&&S.fromArray(I.center),r.boundingSphere=new hi(S,I.radius)}return e.name&&(r.name=e.name),e.userData&&(r.userData=e.userData),r}}]),n}(Tc),rh=function(e){(0,d.Z)(n,e);var t=(0,f.Z)(n);function n(e){var i;return(0,v.Z)(this,n),(i=t.call(this,e)).isImageBitmapLoader=!0,"undefined"===typeof createImageBitmap&&console.warn("THREE.ImageBitmapLoader: createImageBitmap() not supported."),"undefined"===typeof fetch&&console.warn("THREE.ImageBitmapLoader: fetch() not supported."),i.options={premultiplyAlpha:"none"},i}return(0,g.Z)(n,[{key:"setOptions",value:function(e){return this.options=e,this}},{key:"load",value:function(e,t,n,i){void 0===e&&(e=""),void 0!==this.path&&(e=this.path+e),e=this.manager.resolveURL(e);var r=this,a=Sc.get(e);if(void 0!==a)return r.manager.itemStart(e),setTimeout((function(){t&&t(a),r.manager.itemEnd(e)}),0),a;var o={};o.credentials="anonymous"===this.crossOrigin?"same-origin":"include",o.headers=this.requestHeader,fetch(e,o).then((function(e){return e.blob()})).then((function(e){return createImageBitmap(e,Object.assign(r.options,{colorSpaceConversion:"none"}))})).then((function(n){Sc.add(e,n),t&&t(n),r.manager.itemEnd(e)})).catch((function(t){i&&i(t),r.manager.itemError(e),r.manager.itemEnd(e)})),r.manager.itemStart(e)}}]),n}(Tc),ah=function(){function e(){var t=!(arguments.length>0&&void 0!==arguments[0])||arguments[0];(0,v.Z)(this,e),this.autoStart=t,this.startTime=0,this.oldTime=0,this.elapsedTime=0,this.running=!1}return(0,g.Z)(e,[{key:"start",value:function(){this.startTime=oh(),this.oldTime=this.startTime,this.elapsedTime=0,this.running=!0}},{key:"stop",value:function(){this.getElapsedTime(),this.running=!1,this.autoStart=!1}},{key:"getElapsedTime",value:function(){return this.getDelta(),this.elapsedTime}},{key:"getDelta",value:function(){var e=0;if(this.autoStart&&!this.running)return this.start(),0;if(this.running){var t=oh();e=(t-this.oldTime)/1e3,this.oldTime=t,this.elapsedTime+=e}return e}}]),e}();function oh(){return("undefined"===typeof performance?Date:performance).now()}var sh=function(){function e(t,n,i){var r,a,o;switch((0,v.Z)(this,e),this.binding=t,this.valueSize=i,n){case"quaternion":r=this._slerp,a=this._slerpAdditive,o=this._setAdditiveIdentityQuaternion,this.buffer=new Float64Array(6*i),this._workIndex=5;break;case"string":case"bool":r=this._select,a=this._select,o=this._setAdditiveIdentityOther,this.buffer=new Array(5*i);break;default:r=this._lerp,a=this._lerpAdditive,o=this._setAdditiveIdentityNumeric,this.buffer=new Float64Array(5*i)}this._mixBufferRegion=r,this._mixBufferRegionAdditive=a,this._setIdentity=o,this._origIndex=3,this._addIndex=4,this.cumulativeWeight=0,this.cumulativeWeightAdditive=0,this.useCount=0,this.referenceCount=0}return(0,g.Z)(e,[{key:"accumulate",value:function(e,t){var n=this.buffer,i=this.valueSize,r=e*i+i,a=this.cumulativeWeight;if(0===a){for(var o=0;o!==i;++o)n[r+o]=n[o];a=t}else{var s=t/(a+=t);this._mixBufferRegion(n,r,0,s,i)}this.cumulativeWeight=a}},{key:"accumulateAdditive",value:function(e){var t=this.buffer,n=this.valueSize,i=n*this._addIndex;0===this.cumulativeWeightAdditive&&this._setIdentity(),this._mixBufferRegionAdditive(t,i,0,e,n),this.cumulativeWeightAdditive+=e}},{key:"apply",value:function(e){var t=this.valueSize,n=this.buffer,i=e*t+t,r=this.cumulativeWeight,a=this.cumulativeWeightAdditive,o=this.binding;if(this.cumulativeWeight=0,this.cumulativeWeightAdditive=0,r<1){var s=t*this._origIndex;this._mixBufferRegion(n,i,s,1-r,t)}a>0&&this._mixBufferRegionAdditive(n,i,this._addIndex*t,1,t);for(var l=t,u=t+t;l!==u;++l)if(n[l]!==n[l+t]){o.setValue(n,i);break}}},{key:"saveOriginalState",value:function(){var e=this.binding,t=this.buffer,n=this.valueSize,i=n*this._origIndex;e.getValue(t,i);for(var r=n,a=i;r!==a;++r)t[r]=t[i+r%n];this._setIdentity(),this.cumulativeWeight=0,this.cumulativeWeightAdditive=0}},{key:"restoreOriginalState",value:function(){var e=3*this.valueSize;this.binding.setValue(this.buffer,e)}},{key:"_setAdditiveIdentityNumeric",value:function(){for(var e=this._addIndex*this.valueSize,t=e+this.valueSize,n=e;n<t;n++)this.buffer[n]=0}},{key:"_setAdditiveIdentityQuaternion",value:function(){this._setAdditiveIdentityNumeric(),this.buffer[this._addIndex*this.valueSize+3]=1}},{key:"_setAdditiveIdentityOther",value:function(){for(var e=this._origIndex*this.valueSize,t=this._addIndex*this.valueSize,n=0;n<this.valueSize;n++)this.buffer[t+n]=this.buffer[e+n]}},{key:"_select",value:function(e,t,n,i,r){if(i>=.5)for(var a=0;a!==r;++a)e[t+a]=e[n+a]}},{key:"_slerp",value:function(e,t,n,i){zn.slerpFlat(e,t,e,t,e,n,i)}},{key:"_slerpAdditive",value:function(e,t,n,i,r){var a=this._workIndex*r;zn.multiplyQuaternionsFlat(e,a,e,t,e,n),zn.slerpFlat(e,t,e,t,e,a,i)}},{key:"_lerp",value:function(e,t,n,i,r){for(var a=1-i,o=0;o!==r;++o){var s=t+o;e[s]=e[s]*a+e[n+o]*i}}},{key:"_lerpAdditive",value:function(e,t,n,i,r){for(var a=0;a!==r;++a){var o=t+a;e[o]=e[o]+e[n+a]*i}}}]),e}(),lh="\\[\\]\\.:\\/",uh=new RegExp("["+lh+"]","g"),ch="[^"+lh+"]",hh="[^"+lh.replace("\\.","")+"]",dh=new RegExp("^"+/((?:WC+[\/:])*)/.source.replace("WC",ch)+/(WCOD+)?/.source.replace("WCOD",hh)+/(?:\.(WC+)(?:\[(.+)\])?)?/.source.replace("WC",ch)+/\.(WC+)(?:\[(.+)\])?/.source.replace("WC",ch)+"$"),fh=["material","materials","bones","map"],ph=function(){function e(t,n,i){(0,v.Z)(this,e);var r=i||Ah.parseTrackName(n);this._targetGroup=t,this._bindings=t.subscribe_(n,r)}return(0,g.Z)(e,[{key:"getValue",value:function(e,t){this.bind();var n=this._targetGroup.nCachedObjects_,i=this._bindings[n];void 0!==i&&i.getValue(e,t)}},{key:"setValue",value:function(e,t){for(var n=this._bindings,i=this._targetGroup.nCachedObjects_,r=n.length;i!==r;++i)n[i].setValue(e,t)}},{key:"bind",value:function(){for(var e=this._bindings,t=this._targetGroup.nCachedObjects_,n=e.length;t!==n;++t)e[t].bind()}},{key:"unbind",value:function(){for(var e=this._bindings,t=this._targetGroup.nCachedObjects_,n=e.length;t!==n;++t)e[t].unbind()}}]),e}(),Ah=function(){function e(t,n,i){(0,v.Z)(this,e),this.path=n,this.parsedPath=i||e.parseTrackName(n),this.node=e.findNode(t,this.parsedPath.nodeName)||t,this.rootNode=t,this.getValue=this._getValue_unbound,this.setValue=this._setValue_unbound}return(0,g.Z)(e,[{key:"_getValue_unavailable",value:function(){}},{key:"_setValue_unavailable",value:function(){}},{key:"_getValue_direct",value:function(e,t){e[t]=this.targetObject[this.propertyName]}},{key:"_getValue_array",value:function(e,t){for(var n=this.resolvedProperty,i=0,r=n.length;i!==r;++i)e[t++]=n[i]}},{key:"_getValue_arrayElement",value:function(e,t){e[t]=this.resolvedProperty[this.propertyIndex]}},{key:"_getValue_toArray",value:function(e,t){this.resolvedProperty.toArray(e,t)}},{key:"_setValue_direct",value:function(e,t){this.targetObject[this.propertyName]=e[t]}},{key:"_setValue_direct_setNeedsUpdate",value:function(e,t){this.targetObject[this.propertyName]=e[t],this.targetObject.needsUpdate=!0}},{key:"_setValue_direct_setMatrixWorldNeedsUpdate",value:function(e,t){this.targetObject[this.propertyName]=e[t],this.targetObject.matrixWorldNeedsUpdate=!0}},{key:"_setValue_array",value:function(e,t){for(var n=this.resolvedProperty,i=0,r=n.length;i!==r;++i)n[i]=e[t++]}},{key:"_setValue_array_setNeedsUpdate",value:function(e,t){for(var n=this.resolvedProperty,i=0,r=n.length;i!==r;++i)n[i]=e[t++];this.targetObject.needsUpdate=!0}},{key:"_setValue_array_setMatrixWorldNeedsUpdate",value:function(e,t){for(var n=this.resolvedProperty,i=0,r=n.length;i!==r;++i)n[i]=e[t++];this.targetObject.matrixWorldNeedsUpdate=!0}},{key:"_setValue_arrayElement",value:function(e,t){this.resolvedProperty[this.propertyIndex]=e[t]}},{key:"_setValue_arrayElement_setNeedsUpdate",value:function(e,t){this.resolvedProperty[this.propertyIndex]=e[t],this.targetObject.needsUpdate=!0}},{key:"_setValue_arrayElement_setMatrixWorldNeedsUpdate",value:function(e,t){this.resolvedProperty[this.propertyIndex]=e[t],this.targetObject.matrixWorldNeedsUpdate=!0}},{key:"_setValue_fromArray",value:function(e,t){this.resolvedProperty.fromArray(e,t)}},{key:"_setValue_fromArray_setNeedsUpdate",value:function(e,t){this.resolvedProperty.fromArray(e,t),this.targetObject.needsUpdate=!0}},{key:"_setValue_fromArray_setMatrixWorldNeedsUpdate",value:function(e,t){this.resolvedProperty.fromArray(e,t),this.targetObject.matrixWorldNeedsUpdate=!0}},{key:"_getValue_unbound",value:function(e,t){this.bind(),this.getValue(e,t)}},{key:"_setValue_unbound",value:function(e,t){this.bind(),this.setValue(e,t)}},{key:"bind",value:function(){var t=this.node,n=this.parsedPath,i=n.objectName,r=n.propertyName,a=n.propertyIndex;if(t||(t=e.findNode(this.rootNode,n.nodeName)||this.rootNode,this.node=t),this.getValue=this._getValue_unavailable,this.setValue=this._setValue_unavailable,t){if(i){var o=n.objectIndex;switch(i){case"materials":if(!t.material)return void console.error("THREE.PropertyBinding: Can not bind to material as node does not have a material.",this);if(!t.material.materials)return void console.error("THREE.PropertyBinding: Can not bind to material.materials as node.material does not have a materials array.",this);t=t.material.materials;break;case"bones":if(!t.skeleton)return void console.error("THREE.PropertyBinding: Can not bind to bones as node does not have a skeleton.",this);t=t.skeleton.bones;for(var s=0;s<t.length;s++)if(t[s].name===o){o=s;break}break;case"map":if("map"in t){t=t.map;break}if(!t.material)return void console.error("THREE.PropertyBinding: Can not bind to material as node does not have a material.",this);if(!t.material.map)return void console.error("THREE.PropertyBinding: Can not bind to material.map as node.material does not have a map.",this);t=t.material.map;break;default:if(void 0===t[i])return void console.error("THREE.PropertyBinding: Can not bind to objectName of node undefined.",this);t=t[i]}if(void 0!==o){if(void 0===t[o])return void console.error("THREE.PropertyBinding: Trying to bind to objectIndex of objectName, but is undefined.",this,t);t=t[o]}}var l=t[r];if(void 0!==l){var u=this.Versioning.None;this.targetObject=t,void 0!==t.needsUpdate?u=this.Versioning.NeedsUpdate:void 0!==t.matrixWorldNeedsUpdate&&(u=this.Versioning.MatrixWorldNeedsUpdate);var c=this.BindingType.Direct;if(void 0!==a){if("morphTargetInfluences"===r){if(!t.geometry)return void console.error("THREE.PropertyBinding: Can not bind to morphTargetInfluences because node does not have a geometry.",this);if(!t.geometry.morphAttributes)return void console.error("THREE.PropertyBinding: Can not bind to morphTargetInfluences because node does not have a geometry.morphAttributes.",this);void 0!==t.morphTargetDictionary[a]&&(a=t.morphTargetDictionary[a])}c=this.BindingType.ArrayElement,this.resolvedProperty=l,this.propertyIndex=a}else void 0!==l.fromArray&&void 0!==l.toArray?(c=this.BindingType.HasFromToArray,this.resolvedProperty=l):Array.isArray(l)?(c=this.BindingType.EntireArray,this.resolvedProperty=l):this.propertyName=r;this.getValue=this.GetterByBindingType[c],this.setValue=this.SetterByBindingTypeAndVersioning[c][u]}else{var h=n.nodeName;console.error("THREE.PropertyBinding: Trying to update property for track: "+h+"."+r+" but it wasn't found.",t)}}else console.error("THREE.PropertyBinding: Trying to update node for track: "+this.path+" but it wasn't found.")}},{key:"unbind",value:function(){this.node=null,this.getValue=this._getValue_unbound,this.setValue=this._setValue_unbound}}],[{key:"create",value:function(t,n,i){return t&&t.isAnimationObjectGroup?new e.Composite(t,n,i):new e(t,n,i)}},{key:"sanitizeNodeName",value:function(e){return e.replace(/\s/g,"_").replace(uh,"")}},{key:"parseTrackName",value:function(e){var t=dh.exec(e);if(null===t)throw new Error("PropertyBinding: Cannot parse trackName: "+e);var n={nodeName:t[2],objectName:t[3],objectIndex:t[4],propertyName:t[5],propertyIndex:t[6]},i=n.nodeName&&n.nodeName.lastIndexOf(".");if(void 0!==i&&-1!==i){var r=n.nodeName.substring(i+1);-1!==fh.indexOf(r)&&(n.nodeName=n.nodeName.substring(0,i),n.objectName=r)}if(null===n.propertyName||0===n.propertyName.length)throw new Error("PropertyBinding: can not parse propertyName from trackName: "+e);return n}},{key:"findNode",value:function(e,t){if(void 0===t||""===t||"."===t||-1===t||t===e.name||t===e.uuid)return e;if(e.skeleton){var n=e.skeleton.getBoneByName(t);if(void 0!==n)return n}if(e.children){var i=function e(n){for(var i=0;i<n.length;i++){var r=n[i];if(r.name===t||r.uuid===t)return r;var a=e(r.children);if(a)return a}return null}(e.children);if(i)return i}return null}}]),e}();Ah.Composite=ph,Ah.prototype.BindingType={Direct:0,EntireArray:1,ArrayElement:2,HasFromToArray:3},Ah.prototype.Versioning={None:0,NeedsUpdate:1,MatrixWorldNeedsUpdate:2},Ah.prototype.GetterByBindingType=[Ah.prototype._getValue_direct,Ah.prototype._getValue_array,Ah.prototype._getValue_arrayElement,Ah.prototype._getValue_toArray],Ah.prototype.SetterByBindingTypeAndVersioning=[[Ah.prototype._setValue_direct,Ah.prototype._setValue_direct_setNeedsUpdate,Ah.prototype._setValue_direct_setMatrixWorldNeedsUpdate],[Ah.prototype._setValue_array,Ah.prototype._setValue_array_setNeedsUpdate,Ah.prototype._setValue_array_setMatrixWorldNeedsUpdate],[Ah.prototype._setValue_arrayElement,Ah.prototype._setValue_arrayElement_setNeedsUpdate,Ah.prototype._setValue_arrayElement_setMatrixWorldNeedsUpdate],[Ah.prototype._setValue_fromArray,Ah.prototype._setValue_fromArray_setNeedsUpdate,Ah.prototype._setValue_fromArray_setMatrixWorldNeedsUpdate]];var vh=function(){function e(t,n){var i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null,r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:n.blendMode;(0,v.Z)(this,e),this._mixer=t,this._clip=n,this._localRoot=i,this.blendMode=r;for(var a=n.tracks,o=a.length,s=new Array(o),l={endingStart:Tt,endingEnd:Tt},u=0;u!==o;++u){var c=a[u].createInterpolant(null);s[u]=c,c.settings=l}this._interpolantSettings=l,this._interpolants=s,this._propertyBindings=new Array(o),this._cacheIndex=null,this._byClipCacheIndex=null,this._timeScaleInterpolant=null,this._weightInterpolant=null,this.loop=It,this._loopCount=-1,this._startTime=null,this.time=0,this.timeScale=1,this._effectiveTimeScale=1,this.weight=1,this._effectiveWeight=1,this.repetitions=1/0,this.paused=!1,this.enabled=!0,this.clampWhenFinished=!1,this.zeroSlopeAtStart=!0,this.zeroSlopeAtEnd=!0}return(0,g.Z)(e,[{key:"play",value:function(){return this._mixer._activateAction(this),this}},{key:"stop",value:function(){return this._mixer._deactivateAction(this),this.reset()}},{key:"reset",value:function(){return this.paused=!1,this.enabled=!0,this.time=0,this._loopCount=-1,this._startTime=null,this.stopFading().stopWarping()}},{key:"isRunning",value:function(){return this.enabled&&!this.paused&&0!==this.timeScale&&null===this._startTime&&this._mixer._isActiveAction(this)}},{key:"isScheduled",value:function(){return this._mixer._isActiveAction(this)}},{key:"startAt",value:function(e){return this._startTime=e,this}},{key:"setLoop",value:function(e,t){return this.loop=e,this.repetitions=t,this}},{key:"setEffectiveWeight",value:function(e){return this.weight=e,this._effectiveWeight=this.enabled?e:0,this.stopFading()}},{key:"getEffectiveWeight",value:function(){return this._effectiveWeight}},{key:"fadeIn",value:function(e){return this._scheduleFading(e,0,1)}},{key:"fadeOut",value:function(e){return this._scheduleFading(e,1,0)}},{key:"crossFadeFrom",value:function(e,t,n){if(e.fadeOut(t),this.fadeIn(t),n){var i=this._clip.duration,r=e._clip.duration,a=r/i,o=i/r;e.warp(1,a,t),this.warp(o,1,t)}return this}},{key:"crossFadeTo",value:function(e,t,n){return e.crossFadeFrom(this,t,n)}},{key:"stopFading",value:function(){var e=this._weightInterpolant;return null!==e&&(this._weightInterpolant=null,this._mixer._takeBackControlInterpolant(e)),this}},{key:"setEffectiveTimeScale",value:function(e){return this.timeScale=e,this._effectiveTimeScale=this.paused?0:e,this.stopWarping()}},{key:"getEffectiveTimeScale",value:function(){return this._effectiveTimeScale}},{key:"setDuration",value:function(e){return this.timeScale=this._clip.duration/e,this.stopWarping()}},{key:"syncWith",value:function(e){return this.time=e.time,this.timeScale=e.timeScale,this.stopWarping()}},{key:"halt",value:function(e){return this.warp(this._effectiveTimeScale,0,e)}},{key:"warp",value:function(e,t,n){var i=this._mixer,r=i.time,a=this.timeScale,o=this._timeScaleInterpolant;null===o&&(o=i._lendControlInterpolant(),this._timeScaleInterpolant=o);var s=o.parameterPositions,l=o.sampleValues;return s[0]=r,s[1]=r+n,l[0]=e/a,l[1]=t/a,this}},{key:"stopWarping",value:function(){var e=this._timeScaleInterpolant;return null!==e&&(this._timeScaleInterpolant=null,this._mixer._takeBackControlInterpolant(e)),this}},{key:"getMixer",value:function(){return this._mixer}},{key:"getClip",value:function(){return this._clip}},{key:"getRoot",value:function(){return this._localRoot||this._mixer._root}},{key:"_update",value:function(e,t,n,i){if(this.enabled){var r=this._startTime;if(null!==r){var a=(e-r)*n;a<0||0===n?t=0:(this._startTime=null,t=n*a)}t*=this._updateTimeScale(e);var o=this._updateTime(t),s=this._updateWeight(e);if(s>0){var l=this._interpolants,u=this._propertyBindings;if(2501===this.blendMode)for(var c=0,h=l.length;c!==h;++c)l[c].evaluate(o),u[c].accumulateAdditive(s);else for(var d=0,f=l.length;d!==f;++d)l[d].evaluate(o),u[d].accumulate(i,s)}}else this._updateWeight(e)}},{key:"_updateWeight",value:function(e){var t=0;if(this.enabled){t=this.weight;var n=this._weightInterpolant;if(null!==n){var i=n.evaluate(e)[0];t*=i,e>n.parameterPositions[1]&&(this.stopFading(),0===i&&(this.enabled=!1))}}return this._effectiveWeight=t,t}},{key:"_updateTimeScale",value:function(e){var t=0;if(!this.paused){t=this.timeScale;var n=this._timeScaleInterpolant;if(null!==n)t*=n.evaluate(e)[0],e>n.parameterPositions[1]&&(this.stopWarping(),0===t?this.paused=!0:this.timeScale=t)}return this._effectiveTimeScale=t,t}},{key:"_updateTime",value:function(e){var t=this._clip.duration,n=this.loop,i=this.time+e,r=this._loopCount,a=2202===n;if(0===e)return-1===r?i:a&&1===(1&r)?t-i:i;if(2200===n){-1===r&&(this._loopCount=0,this._setEndings(!0,!0,!1));e:{if(i>=t)i=t;else{if(!(i<0)){this.time=i;break e}i=0}this.clampWhenFinished?this.paused=!0:this.enabled=!1,this.time=i,this._mixer.dispatchEvent({type:"finished",action:this,direction:e<0?-1:1})}}else{if(-1===r&&(e>=0?(r=0,this._setEndings(!0,0===this.repetitions,a)):this._setEndings(0===this.repetitions,!0,a)),i>=t||i<0){var o=Math.floor(i/t);i-=t*o,r+=Math.abs(o);var s=this.repetitions-r;if(s<=0)this.clampWhenFinished?this.paused=!0:this.enabled=!1,i=e>0?t:0,this.time=i,this._mixer.dispatchEvent({type:"finished",action:this,direction:e>0?1:-1});else{if(1===s){var l=e<0;this._setEndings(l,!l,a)}else this._setEndings(!1,!1,a);this._loopCount=r,this.time=i,this._mixer.dispatchEvent({type:"loop",action:this,loopDelta:o})}}else this.time=i;if(a&&1===(1&r))return t-i}return i}},{key:"_setEndings",value:function(e,t,n){var i=this._interpolantSettings;n?(i.endingStart=Dt,i.endingEnd=Dt):(i.endingStart=e?this.zeroSlopeAtStart?Dt:Tt:Rt,i.endingEnd=t?this.zeroSlopeAtEnd?Dt:Tt:Rt)}},{key:"_scheduleFading",value:function(e,t,n){var i=this._mixer,r=i.time,a=this._weightInterpolant;null===a&&(a=i._lendControlInterpolant(),this._weightInterpolant=a);var o=a.parameterPositions,s=a.sampleValues;return o[0]=r,s[0]=t,o[1]=r+e,s[1]=n,this}}]),e}(),gh=new Float32Array(1),mh=function(e){(0,d.Z)(n,e);var t=(0,f.Z)(n);function n(e){var i;return(0,v.Z)(this,n),(i=t.call(this))._root=e,i._initMemoryManager(),i._accuIndex=0,i.time=0,i.timeScale=1,i}return(0,g.Z)(n,[{key:"_bindAction",value:function(e,t){var n=e._localRoot||this._root,i=e._clip.tracks,r=i.length,a=e._propertyBindings,o=e._interpolants,s=n.uuid,l=this._bindingsByRootAndName,u=l[s];void 0===u&&(u={},l[s]=u);for(var c=0;c!==r;++c){var h=i[c],d=h.name,f=u[d];if(void 0!==f)++f.referenceCount,a[c]=f;else{if(void 0!==(f=a[c])){null===f._cacheIndex&&(++f.referenceCount,this._addInactiveBinding(f,s,d));continue}var p=t&&t._propertyBindings[c].binding.parsedPath;++(f=new sh(Ah.create(n,d,p),h.ValueTypeName,h.getValueSize())).referenceCount,this._addInactiveBinding(f,s,d),a[c]=f}o[c].resultBuffer=f.buffer}}},{key:"_activateAction",value:function(e){if(!this._isActiveAction(e)){if(null===e._cacheIndex){var t=(e._localRoot||this._root).uuid,n=e._clip.uuid,i=this._actionsByClip[n];this._bindAction(e,i&&i.knownActions[0]),this._addInactiveAction(e,n,t)}for(var r=e._propertyBindings,a=0,o=r.length;a!==o;++a){var s=r[a];0===s.useCount++&&(this._lendBinding(s),s.saveOriginalState())}this._lendAction(e)}}},{key:"_deactivateAction",value:function(e){if(this._isActiveAction(e)){for(var t=e._propertyBindings,n=0,i=t.length;n!==i;++n){var r=t[n];0===--r.useCount&&(r.restoreOriginalState(),this._takeBackBinding(r))}this._takeBackAction(e)}}},{key:"_initMemoryManager",value:function(){this._actions=[],this._nActiveActions=0,this._actionsByClip={},this._bindings=[],this._nActiveBindings=0,this._bindingsByRootAndName={},this._controlInterpolants=[],this._nActiveControlInterpolants=0;var e=this;this.stats={actions:{get total(){return e._actions.length},get inUse(){return e._nActiveActions}},bindings:{get total(){return e._bindings.length},get inUse(){return e._nActiveBindings}},controlInterpolants:{get total(){return e._controlInterpolants.length},get inUse(){return e._nActiveControlInterpolants}}}}},{key:"_isActiveAction",value:function(e){var t=e._cacheIndex;return null!==t&&t<this._nActiveActions}},{key:"_addInactiveAction",value:function(e,t,n){var i=this._actions,r=this._actionsByClip,a=r[t];if(void 0===a)a={knownActions:[e],actionByRoot:{}},e._byClipCacheIndex=0,r[t]=a;else{var o=a.knownActions;e._byClipCacheIndex=o.length,o.push(e)}e._cacheIndex=i.length,i.push(e),a.actionByRoot[n]=e}},{key:"_removeInactiveAction",value:function(e){var t=this._actions,n=t[t.length-1],i=e._cacheIndex;n._cacheIndex=i,t[i]=n,t.pop(),e._cacheIndex=null;var r=e._clip.uuid,a=this._actionsByClip,o=a[r],s=o.knownActions,l=s[s.length-1],u=e._byClipCacheIndex;l._byClipCacheIndex=u,s[u]=l,s.pop(),e._byClipCacheIndex=null,delete o.actionByRoot[(e._localRoot||this._root).uuid],0===s.length&&delete a[r],this._removeInactiveBindingsForAction(e)}},{key:"_removeInactiveBindingsForAction",value:function(e){for(var t=e._propertyBindings,n=0,i=t.length;n!==i;++n){var r=t[n];0===--r.referenceCount&&this._removeInactiveBinding(r)}}},{key:"_lendAction",value:function(e){var t=this._actions,n=e._cacheIndex,i=this._nActiveActions++,r=t[i];e._cacheIndex=i,t[i]=e,r._cacheIndex=n,t[n]=r}},{key:"_takeBackAction",value:function(e){var t=this._actions,n=e._cacheIndex,i=--this._nActiveActions,r=t[i];e._cacheIndex=i,t[i]=e,r._cacheIndex=n,t[n]=r}},{key:"_addInactiveBinding",value:function(e,t,n){var i=this._bindingsByRootAndName,r=this._bindings,a=i[t];void 0===a&&(a={},i[t]=a),a[n]=e,e._cacheIndex=r.length,r.push(e)}},{key:"_removeInactiveBinding",value:function(e){var t=this._bindings,n=e.binding,i=n.rootNode.uuid,r=n.path,a=this._bindingsByRootAndName,o=a[i],s=t[t.length-1],l=e._cacheIndex;s._cacheIndex=l,t[l]=s,t.pop(),delete o[r],0===Object.keys(o).length&&delete a[i]}},{key:"_lendBinding",value:function(e){var t=this._bindings,n=e._cacheIndex,i=this._nActiveBindings++,r=t[i];e._cacheIndex=i,t[i]=e,r._cacheIndex=n,t[n]=r}},{key:"_takeBackBinding",value:function(e){var t=this._bindings,n=e._cacheIndex,i=--this._nActiveBindings,r=t[i];e._cacheIndex=i,t[i]=e,r._cacheIndex=n,t[n]=r}},{key:"_lendControlInterpolant",value:function(){var e=this._controlInterpolants,t=this._nActiveControlInterpolants++,n=e[t];return void 0===n&&((n=new vc(new Float32Array(2),new Float32Array(2),1,gh)).__cacheIndex=t,e[t]=n),n}},{key:"_takeBackControlInterpolant",value:function(e){var t=this._controlInterpolants,n=e.__cacheIndex,i=--this._nActiveControlInterpolants,r=t[i];e.__cacheIndex=i,t[i]=e,r.__cacheIndex=n,t[n]=r}},{key:"clipAction",value:function(e,t,n){var i=t||this._root,r=i.uuid,a="string"===typeof e?Mc.findByName(i,e):e,o=null!==a?a.uuid:e,s=this._actionsByClip[o],l=null;if(void 0===n&&(n=null!==a?a.blendMode:Pt),void 0!==s){var u=s.actionByRoot[r];if(void 0!==u&&u.blendMode===n)return u;l=s.knownActions[0],null===a&&(a=l._clip)}if(null===a)return null;var c=new vh(this,a,t,n);return this._bindAction(c,l),this._addInactiveAction(c,o,r),c}},{key:"existingAction",value:function(e,t){var n=t||this._root,i=n.uuid,r="string"===typeof e?Mc.findByName(n,e):e,a=r?r.uuid:e,o=this._actionsByClip[a];return void 0!==o&&o.actionByRoot[i]||null}},{key:"stopAllAction",value:function(){for(var e=this._actions,t=this._nActiveActions-1;t>=0;--t)e[t].stop();return this}},{key:"update",value:function(e){e*=this.timeScale;for(var t=this._actions,n=this._nActiveActions,i=this.time+=e,r=Math.sign(e),a=this._accuIndex^=1,o=0;o!==n;++o){t[o]._update(i,e,r,a)}for(var s=this._bindings,l=this._nActiveBindings,u=0;u!==l;++u)s[u].apply(a);return this}},{key:"setTime",value:function(e){this.time=0;for(var t=0;t<this._actions.length;t++)this._actions[t].time=0;return this.update(e)}},{key:"getRoot",value:function(){return this._root}},{key:"uncacheClip",value:function(e){var t=this._actions,n=e.uuid,i=this._actionsByClip,r=i[n];if(void 0!==r){for(var a=r.knownActions,o=0,s=a.length;o!==s;++o){var l=a[o];this._deactivateAction(l);var u=l._cacheIndex,c=t[t.length-1];l._cacheIndex=null,l._byClipCacheIndex=null,c._cacheIndex=u,t[u]=c,t.pop(),this._removeInactiveBindingsForAction(l)}delete i[n]}}},{key:"uncacheRoot",value:function(e){var t=e.uuid,n=this._actionsByClip;for(var i in n){var r=n[i].actionByRoot[t];void 0!==r&&(this._deactivateAction(r),this._removeInactiveAction(r))}var a=this._bindingsByRootAndName[t];if(void 0!==a)for(var o in a){var s=a[o];s.restoreOriginalState(),this._removeInactiveBinding(s)}}},{key:"uncacheAction",value:function(e,t){var n=this.existingAction(e,t);null!==n&&(this._deactivateAction(n),this._removeInactiveAction(n))}}]),n}($t),yh=function(){function e(t,n){var i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0,r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:1/0;(0,v.Z)(this,e),this.ray=new yi(t,n),this.near=i,this.far=r,this.camera=null,this.layers=new Ti,this.params={Mesh:{},Line:{threshold:1},LOD:{},Points:{threshold:1},Sprite:{}}}return(0,g.Z)(e,[{key:"set",value:function(e,t){this.ray.set(e,t)}},{key:"setFromCamera",value:function(e,t){t.isPerspectiveCamera?(this.ray.origin.setFromMatrixPosition(t.matrixWorld),this.ray.direction.set(e.x,e.y,.5).unproject(t).sub(this.ray.origin).normalize(),this.camera=t):t.isOrthographicCamera?(this.ray.origin.set(e.x,e.y,(t.near+t.far)/(t.near-t.far)).unproject(t),this.ray.direction.set(0,0,-1).transformDirection(t.matrixWorld),this.camera=t):console.error("THREE.Raycaster: Unsupported camera type: "+t.type)}},{key:"intersectObject",value:function(e){var t=arguments.length>2&&void 0!==arguments[2]?arguments[2]:[];return wh(e,this,t,!(arguments.length>1&&void 0!==arguments[1])||arguments[1]),t.sort(xh),t}},{key:"intersectObjects",value:function(e){for(var t=!(arguments.length>1&&void 0!==arguments[1])||arguments[1],n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:[],i=0,r=e.length;i<r;i++)wh(e[i],this,n,t);return n.sort(xh),n}}]),e}();function xh(e,t){return e.distance-t.distance}function wh(e,t,n,i){if(e.layers.test(t.layers)&&e.raycast(t,n),!0===i)for(var r=e.children,a=0,o=r.length;a<o;a++)wh(r[a],t,n,!0)}var Ch=function(){function e(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0;return(0,v.Z)(this,e),this.radius=t,this.phi=n,this.theta=i,this}return(0,g.Z)(e,[{key:"set",value:function(e,t,n){return this.radius=e,this.phi=t,this.theta=n,this}},{key:"copy",value:function(e){return this.radius=e.radius,this.phi=e.phi,this.theta=e.theta,this}},{key:"makeSafe",value:function(){var e=1e-6;return this.phi=Math.max(e,Math.min(Math.PI-e,this.phi)),this}},{key:"setFromVector3",value:function(e){return this.setFromCartesianCoords(e.x,e.y,e.z)}},{key:"setFromCartesianCoords",value:function(e,t,n){return this.radius=Math.sqrt(e*e+t*t+n*n),0===this.radius?(this.theta=0,this.phi=0):(this.theta=Math.atan2(e,n),this.phi=Math.acos(on(t/this.radius,-1,1))),this}},{key:"clone",value:function(){return(new this.constructor).copy(this)}}]),e}(),bh=new An,_h=function(){function e(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:new An(1/0,1/0),n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:new An(-1/0,-1/0);(0,v.Z)(this,e),this.isBox2=!0,this.min=t,this.max=n}return(0,g.Z)(e,[{key:"set",value:function(e,t){return this.min.copy(e),this.max.copy(t),this}},{key:"setFromPoints",value:function(e){this.makeEmpty();for(var t=0,n=e.length;t<n;t++)this.expandByPoint(e[t]);return this}},{key:"setFromCenterAndSize",value:function(e,t){var n=bh.copy(t).multiplyScalar(.5);return this.min.copy(e).sub(n),this.max.copy(e).add(n),this}},{key:"clone",value:function(){return(new this.constructor).copy(this)}},{key:"copy",value:function(e){return this.min.copy(e.min),this.max.copy(e.max),this}},{key:"makeEmpty",value:function(){return this.min.x=this.min.y=1/0,this.max.x=this.max.y=-1/0,this}},{key:"isEmpty",value:function(){return this.max.x<this.min.x||this.max.y<this.min.y}},{key:"getCenter",value:function(e){return this.isEmpty()?e.set(0,0):e.addVectors(this.min,this.max).multiplyScalar(.5)}},{key:"getSize",value:function(e){return this.isEmpty()?e.set(0,0):e.subVectors(this.max,this.min)}},{key:"expandByPoint",value:function(e){return this.min.min(e),this.max.max(e),this}},{key:"expandByVector",value:function(e){return this.min.sub(e),this.max.add(e),this}},{key:"expandByScalar",value:function(e){return this.min.addScalar(-e),this.max.addScalar(e),this}},{key:"containsPoint",value:function(e){return!(e.x<this.min.x||e.x>this.max.x||e.y<this.min.y||e.y>this.max.y)}},{key:"containsBox",value:function(e){return this.min.x<=e.min.x&&e.max.x<=this.max.x&&this.min.y<=e.min.y&&e.max.y<=this.max.y}},{key:"getParameter",value:function(e,t){return t.set((e.x-this.min.x)/(this.max.x-this.min.x),(e.y-this.min.y)/(this.max.y-this.min.y))}},{key:"intersectsBox",value:function(e){return!(e.max.x<this.min.x||e.min.x>this.max.x||e.max.y<this.min.y||e.min.y>this.max.y)}},{key:"clampPoint",value:function(e,t){return t.copy(e).clamp(this.min,this.max)}},{key:"distanceToPoint",value:function(e){return bh.copy(e).clamp(this.min,this.max).sub(e).length()}},{key:"intersect",value:function(e){return this.min.max(e.min),this.max.min(e.max),this}},{key:"union",value:function(e){return this.min.min(e.min),this.max.max(e.max),this}},{key:"translate",value:function(e){return this.min.add(e),this.max.add(e),this}},{key:"equals",value:function(e){return e.min.equals(this.min)&&e.max.equals(this.max)}}]),e}();var Eh=function(e){(0,d.Z)(n,e);var t=(0,f.Z)(n);function n(){var e,i=arguments.length>0&&void 0!==arguments[0]?arguments[0]:10,r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:10,a=arguments.length>2&&void 0!==arguments[2]?arguments[2]:4473924,o=arguments.length>3&&void 0!==arguments[3]?arguments[3]:8947848;(0,v.Z)(this,n),a=new Rn(a),o=new Rn(o);for(var s=r/2,l=i/r,u=i/2,c=[],h=[],d=0,f=0,p=-u;d<=r;d++,p+=l){c.push(-u,0,p,u,0,p),c.push(p,0,-u,p,0,u);var A=d===s?a:o;A.toArray(h,f),f+=3,A.toArray(h,f),f+=3,A.toArray(h,f),f+=3,A.toArray(h,f),f+=3}var g=new xr;g.setAttribute("position",new dr(c,3)),g.setAttribute("color",new dr(h,3));var m=new bl({vertexColors:!0,toneMapped:!1});return(e=t.call(this,g,m)).type="GridHelper",e}return(0,g.Z)(n,[{key:"dispose",value:function(){this.geometry.dispose(),this.material.dispose()}}]),n}(Dl);var Mh=function(){function e(){(0,v.Z)(this,e),this.type="ShapePath",this.color=new Rn,this.subPaths=[],this.currentPath=null}return(0,g.Z)(e,[{key:"moveTo",value:function(e,t){return this.currentPath=new hu,this.subPaths.push(this.currentPath),this.currentPath.moveTo(e,t),this}},{key:"lineTo",value:function(e,t){return this.currentPath.lineTo(e,t),this}},{key:"quadraticCurveTo",value:function(e,t,n,i){return this.currentPath.quadraticCurveTo(e,t,n,i),this}},{key:"bezierCurveTo",value:function(e,t,n,i,r,a){return this.currentPath.bezierCurveTo(e,t,n,i,r,a),this}},{key:"splineThru",value:function(e){return this.currentPath.splineThru(e),this}},{key:"toShapes",value:function(e){function t(e,t){for(var n=t.length,i=!1,r=n-1,a=0;a<n;r=a++){var o=t[r],s=t[a],l=s.x-o.x,u=s.y-o.y;if(Math.abs(u)>Number.EPSILON){if(u<0&&(o=t[a],l=-l,s=t[r],u=-u),e.y<o.y||e.y>s.y)continue;if(e.y===o.y){if(e.x===o.x)return!0}else{var c=u*(e.x-o.x)-l*(e.y-o.y);if(0===c)return!0;if(c<0)continue;i=!i}}else{if(e.y!==o.y)continue;if(s.x<=e.x&&e.x<=o.x||o.x<=e.x&&e.x<=s.x)return!0}}return i}var n,i,r,a=Hu.isClockWise,o=this.subPaths;if(0===o.length)return[];var s=[];if(1===o.length)return i=o[0],(r=new yu).curves=i.curves,s.push(r),s;var l=!a(o[0].getPoints());l=e?!l:l;var u,c,h=[],d=[],f=[],p=0;d[p]=void 0,f[p]=[];for(var A=0,v=o.length;A<v;A++)n=a(u=(i=o[A]).getPoints()),(n=e?!n:n)?(!l&&d[p]&&p++,d[p]={s:new yu,p:u},d[p].s.curves=i.curves,l&&p++,f[p]=[]):f[p].push({h:i,p:u[0]});if(!d[0])return function(e){for(var t=[],n=0,i=e.length;n<i;n++){var r=e[n],a=new yu;a.curves=r.curves,t.push(a)}return t}(o);if(d.length>1){for(var g=!1,m=0,y=0,x=d.length;y<x;y++)h[y]=[];for(var w=0,C=d.length;w<C;w++)for(var b=f[w],_=0;_<b.length;_++){for(var E=b[_],M=!0,I=0;I<d.length;I++)t(E.p,d[I].p)&&(w!==I&&m++,M?(M=!1,h[I].push(E)):g=!0);M&&h[w].push(E)}m>0&&!1===g&&(f=h)}for(var S=0,k=d.length;S<k;S++){r=d[S].s,s.push(r);for(var B=0,T=(c=f[S]).length;B<T;B++)r.holes.push(c[B].h)}return s}}]),e}(),Ih=Sh();function Sh(){for(var e=new ArrayBuffer(4),t=new Float32Array(e),n=new Uint32Array(e),i=new Uint32Array(512),r=new Uint32Array(512),a=0;a<256;++a){var o=a-127;o<-27?(i[a]=0,i[256|a]=32768,r[a]=24,r[256|a]=24):o<-14?(i[a]=1024>>-o-14,i[256|a]=1024>>-o-14|32768,r[a]=-o-1,r[256|a]=-o-1):o<=15?(i[a]=o+15<<10,i[256|a]=o+15<<10|32768,r[a]=13,r[256|a]=13):o<128?(i[a]=31744,i[256|a]=64512,r[a]=24,r[256|a]=24):(i[a]=31744,i[256|a]=64512,r[a]=13,r[256|a]=13)}for(var s=new Uint32Array(2048),l=new Uint32Array(64),u=new Uint32Array(64),c=1;c<1024;++c){for(var h=c<<13,d=0;0===(8388608&h);)h<<=1,d-=8388608;h&=-8388609,d+=947912704,s[c]=h|d}for(var f=1024;f<2048;++f)s[f]=939524096+(f-1024<<13);for(var p=1;p<31;++p)l[p]=p<<23;l[31]=1199570944,l[32]=2147483648;for(var A=33;A<63;++A)l[A]=2147483648+(A-32<<23);l[63]=3347054592;for(var v=1;v<64;++v)32!==v&&(u[v]=1024);return{floatView:t,uint32View:n,baseTable:i,shiftTable:r,mantissaTable:s,exponentTable:l,offsetTable:u}}var kh=Object.freeze({__proto__:null,fromHalfFloat:function(e){var t=e>>10;return Ih.uint32View[0]=Ih.mantissaTable[Ih.offsetTable[t]+(1023&e)]+Ih.exponentTable[t],Ih.floatView[0]},toHalfFloat:function(e){Math.abs(e)>65504&&console.warn("THREE.DataUtils.toHalfFloat(): Value out of range."),e=on(e,-65504,65504),Ih.floatView[0]=e;var t=Ih.uint32View[0],n=t>>23&511;return Ih.baseTable[n]+((8388607&t)>>Ih.shiftTable[n])}});"undefined"!==typeof Kt&&Kt.dispatchEvent(new CustomEvent("register",{detail:{revision:m}})),"undefined"!==typeof window&&(window.__THREE__?console.warn("WARNING: Multiple instances of Three.js being imported."):window.__THREE__=m)},66618:function(e,t,n){n.d(t,{GZ:function(){return Ae},HT:function(){return te},T8:function(){return se},TD:function(){return oe},Xo:function(){return pe}});var i=function(e){return URL.createObjectURL(new Blob([e],{type:"text/javascript"}))};try{URL.revokeObjectURL(i(""))}catch(ve){i=function(e){return"data:application/javascript;charset=UTF-8,"+encodeURI(e)},function(e){return new Worker(e,{type:"module"})}}var r=Uint8Array,a=Uint16Array,o=Uint32Array,s=new r([0,0,0,0,0,0,0,0,1,1,1,1,2,2,2,2,3,3,3,3,4,4,4,4,5,5,5,5,0,0,0,0]),l=new r([0,0,0,0,1,1,2,2,3,3,4,4,5,5,6,6,7,7,8,8,9,9,10,10,11,11,12,12,13,13,0,0]),u=new r([16,17,18,0,8,7,9,6,10,5,11,4,12,3,13,2,14,1,15]),c=function(e,t){for(var n=new a(31),i=0;i<31;++i)n[i]=t+=1<<e[i-1];var r=new o(n[30]);for(i=1;i<30;++i)for(var s=n[i];s<n[i+1];++s)r[s]=s-n[i]<<5|i;return[n,r]},h=c(s,2),d=h[0],f=h[1];d[28]=258,f[258]=28;for(var p=c(l,0),A=p[0],v=p[1],g=new a(32768),m=0;m<32768;++m){var y=(43690&m)>>>1|(21845&m)<<1;y=(61680&(y=(52428&y)>>>2|(13107&y)<<2))>>>4|(3855&y)<<4,g[m]=((65280&y)>>>8|(255&y)<<8)>>>1}var x=function(e,t,n){for(var i=e.length,r=0,o=new a(t);r<i;++r)++o[e[r]-1];var s,l=new a(t);for(r=0;r<t;++r)l[r]=l[r-1]+o[r-1]<<1;if(n){s=new a(1<<t);var u=15-t;for(r=0;r<i;++r)if(e[r])for(var c=r<<4|e[r],h=t-e[r],d=l[e[r]-1]++<<h,f=d|(1<<h)-1;d<=f;++d)s[g[d]>>>u]=c}else for(s=new a(i),r=0;r<i;++r)e[r]&&(s[r]=g[l[e[r]-1]++]>>>15-e[r]);return s},w=new r(288);for(m=0;m<144;++m)w[m]=8;for(m=144;m<256;++m)w[m]=9;for(m=256;m<280;++m)w[m]=7;for(m=280;m<288;++m)w[m]=8;var C=new r(32);for(m=0;m<32;++m)C[m]=5;var b=x(w,9,0),_=x(w,9,1),E=x(C,5,0),M=x(C,5,1),I=function(e){for(var t=e[0],n=1;n<e.length;++n)e[n]>t&&(t=e[n]);return t},S=function(e,t,n){var i=t/8|0;return(e[i]|e[i+1]<<8)>>(7&t)&n},k=function(e,t){var n=t/8|0;return(e[n]|e[n+1]<<8|e[n+2]<<16)>>(7&t)},B=function(e){return(e/8|0)+(7&e&&1)},T=function(e,t,n){(null==t||t<0)&&(t=0),(null==n||n>e.length)&&(n=e.length);var i=new(e instanceof a?a:e instanceof o?o:r)(n-t);return i.set(e.subarray(t,n)),i},D=function(e,t,n){var i=e.length;if(!i||n&&!n.l&&i<5)return t||new r(0);var a=!t||n,o=!n||n.i;n||(n={}),t||(t=new r(3*i));var c=function(e){var n=t.length;if(e>n){var i=new r(Math.max(2*n,e));i.set(t),t=i}},h=n.f||0,f=n.p||0,p=n.b||0,v=n.l,g=n.d,m=n.m,y=n.n,w=8*i;do{if(!v){n.f=h=S(e,f,1);var C=S(e,f+1,3);if(f+=3,!C){var b=e[(j=B(f)+4)-4]|e[j-3]<<8,E=j+b;if(E>i){if(o)throw"unexpected EOF";break}a&&c(p+b),t.set(e.subarray(j,E),p),n.b=p+=b,n.p=f=8*E;continue}if(1==C)v=_,g=M,m=9,y=5;else{if(2!=C)throw"invalid block type";var D=S(e,f,31)+257,R=S(e,f+10,15)+4,P=D+S(e,f+5,31)+1;f+=14;for(var L=new r(P),Q=new r(19),Z=0;Z<R;++Z)Q[u[Z]]=S(e,f+3*Z,7);f+=3*R;var N=I(Q),F=(1<<N)-1,U=x(Q,N,1);for(Z=0;Z<P;){var j,O=U[S(e,f,F)];if(f+=15&O,(j=O>>>4)<16)L[Z++]=j;else{var z=0,G=0;for(16==j?(G=3+S(e,f,3),f+=2,z=L[Z-1]):17==j?(G=3+S(e,f,7),f+=3):18==j&&(G=11+S(e,f,127),f+=7);G--;)L[Z++]=z}}var H=L.subarray(0,D),V=L.subarray(D);m=I(H),y=I(V),v=x(H,m,1),g=x(V,y,1)}if(f>w){if(o)throw"unexpected EOF";break}}a&&c(p+131072);for(var W=(1<<m)-1,q=(1<<y)-1,Y=f;;Y=f){var J=(z=v[k(e,f)&W])>>>4;if((f+=15&z)>w){if(o)throw"unexpected EOF";break}if(!z)throw"invalid length/literal";if(J<256)t[p++]=J;else{if(256==J){Y=f,v=null;break}var X=J-254;if(J>264){var K=s[Z=J-257];X=S(e,f,(1<<K)-1)+d[Z],f+=K}var $=g[k(e,f)&q],ee=$>>>4;if(!$)throw"invalid distance";f+=15&$;V=A[ee];if(ee>3){K=l[ee];V+=k(e,f)&(1<<K)-1,f+=K}if(f>w){if(o)throw"unexpected EOF";break}a&&c(p+131072);for(var te=p+X;p<te;p+=4)t[p]=t[p-V],t[p+1]=t[p+1-V],t[p+2]=t[p+2-V],t[p+3]=t[p+3-V];p=te}}n.l=v,n.p=Y,n.b=p,v&&(h=1,n.m=m,n.d=g,n.n=y)}while(!h);return p==t.length?t:T(t,0,p)},R=function(e,t,n){n<<=7&t;var i=t/8|0;e[i]|=n,e[i+1]|=n>>>8},P=function(e,t,n){n<<=7&t;var i=t/8|0;e[i]|=n,e[i+1]|=n>>>8,e[i+2]|=n>>>16},L=function(e,t){for(var n=[],i=0;i<e.length;++i)e[i]&&n.push({s:i,f:e[i]});var o=n.length,s=n.slice();if(!o)return[O,0];if(1==o){var l=new r(n[0].s+1);return l[n[0].s]=1,[l,1]}n.sort((function(e,t){return e.f-t.f})),n.push({s:-1,f:25001});var u=n[0],c=n[1],h=0,d=1,f=2;for(n[0]={s:-1,f:u.f+c.f,l:u,r:c};d!=o-1;)u=n[n[h].f<n[f].f?h++:f++],c=n[h!=d&&n[h].f<n[f].f?h++:f++],n[d++]={s:-1,f:u.f+c.f,l:u,r:c};var p=s[0].s;for(i=1;i<o;++i)s[i].s>p&&(p=s[i].s);var A=new a(p+1),v=Q(n[d-1],A,0);if(v>t){i=0;var g=0,m=v-t,y=1<<m;for(s.sort((function(e,t){return A[t.s]-A[e.s]||e.f-t.f}));i<o;++i){var x=s[i].s;if(!(A[x]>t))break;g+=y-(1<<v-A[x]),A[x]=t}for(g>>>=m;g>0;){var w=s[i].s;A[w]<t?g-=1<<t-A[w]++-1:++i}for(;i>=0&&g;--i){var C=s[i].s;A[C]==t&&(--A[C],++g)}v=t}return[new r(A),v]},Q=function e(t,n,i){return-1==t.s?Math.max(e(t.l,n,i+1),e(t.r,n,i+1)):n[t.s]=i},Z=function(e){for(var t=e.length;t&&!e[--t];);for(var n=new a(++t),i=0,r=e[0],o=1,s=function(e){n[i++]=e},l=1;l<=t;++l)if(e[l]==r&&l!=t)++o;else{if(!r&&o>2){for(;o>138;o-=138)s(32754);o>2&&(s(o>10?o-11<<5|28690:o-3<<5|12305),o=0)}else if(o>3){for(s(r),--o;o>6;o-=6)s(8304);o>2&&(s(o-3<<5|8208),o=0)}for(;o--;)s(r);o=1,r=e[l]}return[n.subarray(0,i),t]},N=function(e,t){for(var n=0,i=0;i<t.length;++i)n+=e[i]*t[i];return n},F=function(e,t,n){var i=n.length,r=B(t+2);e[r]=255&i,e[r+1]=i>>>8,e[r+2]=255^e[r],e[r+3]=255^e[r+1];for(var a=0;a<i;++a)e[r+a+4]=n[a];return 8*(r+4+i)},U=function(e,t,n,i,r,o,c,h,d,f,p){R(t,p++,n),++r[256];for(var A=L(r,15),v=A[0],g=A[1],m=L(o,15),y=m[0],_=m[1],M=Z(v),I=M[0],S=M[1],k=Z(y),B=k[0],T=k[1],D=new a(19),Q=0;Q<I.length;++Q)D[31&I[Q]]++;for(Q=0;Q<B.length;++Q)D[31&B[Q]]++;for(var U=L(D,7),j=U[0],O=U[1],z=19;z>4&&!j[u[z-1]];--z);var G,H,V,W,q=f+5<<3,Y=N(r,w)+N(o,C)+c,J=N(r,v)+N(o,y)+c+14+3*z+N(D,j)+(2*D[16]+3*D[17]+7*D[18]);if(q<=Y&&q<=J)return F(t,p,e.subarray(d,d+f));if(R(t,p,1+(J<Y)),p+=2,J<Y){G=x(v,g,0),H=v,V=x(y,_,0),W=y;var X=x(j,O,0);R(t,p,S-257),R(t,p+5,T-1),R(t,p+10,z-4),p+=14;for(Q=0;Q<z;++Q)R(t,p+3*Q,j[u[Q]]);p+=3*z;for(var K=[I,B],$=0;$<2;++$){var ee=K[$];for(Q=0;Q<ee.length;++Q){var te=31&ee[Q];R(t,p,X[te]),p+=j[te],te>15&&(R(t,p,ee[Q]>>>5&127),p+=ee[Q]>>>12)}}}else G=b,H=w,V=E,W=C;for(Q=0;Q<h;++Q)if(i[Q]>255){te=i[Q]>>>18&31;P(t,p,G[te+257]),p+=H[te+257],te>7&&(R(t,p,i[Q]>>>23&31),p+=s[te]);var ne=31&i[Q];P(t,p,V[ne]),p+=W[ne],ne>3&&(P(t,p,i[Q]>>>5&8191),p+=l[ne])}else P(t,p,G[i[Q]]),p+=H[i[Q]];return P(t,p,G[256]),p+H[256]},j=new o([65540,131080,131088,131104,262176,1048704,1048832,2114560,2117632]),O=new r(0),z=function(e,t,n,i,u,c){var h=e.length,d=new r(i+h+5*(1+Math.ceil(h/7e3))+u),p=d.subarray(i,d.length-u),A=0;if(!t||h<8)for(var g=0;g<=h;g+=65535){var m=g+65535;m<h?A=F(p,A,e.subarray(g,m)):(p[g]=c,A=F(p,A,e.subarray(g,h)))}else{for(var y=j[t-1],x=y>>>13,w=8191&y,C=(1<<n)-1,b=new a(32768),_=new a(C+1),E=Math.ceil(n/3),M=2*E,I=function(t){return(e[t]^e[t+1]<<E^e[t+2]<<M)&C},S=new o(25e3),k=new a(288),D=new a(32),R=0,P=0,L=(g=0,0),Q=0,Z=0;g<h;++g){var N=I(g),z=32767&g,G=_[N];if(b[z]=G,_[N]=z,Q<=g){var H=h-g;if((R>7e3||L>24576)&&H>423){A=U(e,p,0,S,k,D,P,L,Z,g-Z,A),L=R=P=0,Z=g;for(var V=0;V<286;++V)k[V]=0;for(V=0;V<30;++V)D[V]=0}var W=2,q=0,Y=w,J=z-G&32767;if(H>2&&N==I(g-J))for(var X=Math.min(x,H)-1,K=Math.min(32767,g),$=Math.min(258,H);J<=K&&--Y&&z!=G;){if(e[g+W]==e[g+W-J]){for(var ee=0;ee<$&&e[g+ee]==e[g+ee-J];++ee);if(ee>W){if(W=ee,q=J,ee>X)break;var te=Math.min(J,ee-2),ne=0;for(V=0;V<te;++V){var ie=g-J+V+32768&32767,re=ie-b[ie]+32768&32767;re>ne&&(ne=re,G=ie)}}}J+=(z=G)-(G=b[z])+32768&32767}if(q){S[L++]=268435456|f[W]<<18|v[q];var ae=31&f[W],oe=31&v[q];P+=s[ae]+l[oe],++k[257+ae],++D[oe],Q=g+W,++R}else S[L++]=e[g],++k[e[g]]}}A=U(e,p,c,S,k,D,P,L,Z,g-Z,A),!c&&7&A&&(A=F(p,A+1,O))}return T(d,0,i+B(A)+u)},G=function(){for(var e=new o(256),t=0;t<256;++t){for(var n=t,i=9;--i;)n=(1&n&&3988292384)^n>>>1;e[t]=n}return e}(),H=function(){var e=-1;return{p:function(t){for(var n=e,i=0;i<t.length;++i)n=G[255&n^t[i]]^n>>>8;e=n},d:function(){return~e}}},V=function(e,t,n,i,r){return z(e,null==t.level?6:t.level,null==t.mem?Math.ceil(1.5*Math.max(8,Math.min(13,Math.log(e.length)))):12+t.mem,n,i,!r)},W=function(e,t){var n={};for(var i in e)n[i]=e[i];for(var i in t)n[i]=t[i];return n},q=function(e,t){return e[t]|e[t+1]<<8},Y=function(e,t){return(e[t]|e[t+1]<<8|e[t+2]<<16|e[t+3]<<24)>>>0},J=function(e,t){return Y(e,t)+4294967296*Y(e,t+4)},X=function(e,t,n){for(;n;++t)e[t]=n,n>>>=8},K=function(e){if(8!=(15&e[0])||e[0]>>>4>7||(e[0]<<8|e[1])%31)throw"invalid zlib data";if(32&e[1])throw"invalid zlib data: preset dictionaries not supported"};function $(e,t){return V(e,t||{},0,0)}function ee(e,t){return D(e,t)}function te(e,t){return D((K(e),e.subarray(2,-4)),t)}var ne=function e(t,n,i,a){for(var o in t){var s=t[o],l=n+o;s instanceof r?i[l]=[s,a]:Array.isArray(s)?i[l]=[s[0],W(a,s[1])]:e(s,l+"/",i,a)}},ie="undefined"!=typeof TextEncoder&&new TextEncoder,re="undefined"!=typeof TextDecoder&&new TextDecoder;try{re.decode(O,{stream:!0}),1}catch(ve){}var ae=function(e){for(var t="",n=0;;){var i=e[n++],r=(i>127)+(i>223)+(i>239);if(n+r>e.length)return[t,T(e,n-1)];r?3==r?(i=((15&i)<<18|(63&e[n++])<<12|(63&e[n++])<<6|63&e[n++])-65536,t+=String.fromCharCode(55296|i>>10,56320|1023&i)):t+=1&r?String.fromCharCode((31&i)<<6|63&e[n++]):String.fromCharCode((15&i)<<12|(63&e[n++])<<6|63&e[n++]):t+=String.fromCharCode(i)}};function oe(e,t){if(t){for(var n=new r(e.length),i=0;i<e.length;++i)n[i]=e.charCodeAt(i);return n}if(ie)return ie.encode(e);var a=e.length,o=new r(e.length+(e.length>>1)),s=0,l=function(e){o[s++]=e};for(i=0;i<a;++i){if(s+5>o.length){var u=new r(s+8+(a-i<<1));u.set(o),o=u}var c=e.charCodeAt(i);c<128||t?l(c):c<2048?(l(192|c>>6),l(128|63&c)):c>55295&&c<57344?(l(240|(c=65536+(1047552&c)|1023&e.charCodeAt(++i))>>18),l(128|c>>12&63),l(128|c>>6&63),l(128|63&c)):(l(224|c>>12),l(128|c>>6&63),l(128|63&c))}return T(o,0,s)}function se(e,t){if(t){for(var n="",i=0;i<e.length;i+=16384)n+=String.fromCharCode.apply(null,e.subarray(i,i+16384));return n}if(re)return re.decode(e);var r=ae(e),a=r[0];if(r[1].length)throw"invalid utf-8 data";return a}var le=function(e,t){return t+30+q(e,t+26)+q(e,t+28)},ue=function(e,t,n){var i=q(e,t+28),r=se(e.subarray(t+46,t+46+i),!(2048&q(e,t+8))),a=t+46+i,o=Y(e,t+20),s=n&&4294967295==o?ce(e,a):[o,Y(e,t+24),Y(e,t+42)],l=s[0],u=s[1],c=s[2];return[q(e,t+10),l,u,r,a+q(e,t+30)+q(e,t+32),c]},ce=function(e,t){for(;1!=q(e,t);t+=4+q(e,t+2));return[J(e,t+12),J(e,t+4),J(e,t+20)]},he=function(e){var t=0;if(e)for(var n in e){var i=e[n].length;if(i>65535)throw"extra field too long";t+=i+4}return t},de=function(e,t,n,i,r,a,o,s){var l=i.length,u=n.extra,c=s&&s.length,h=he(u);X(e,t,null!=o?33639248:67324752),t+=4,null!=o&&(e[t++]=20,e[t++]=n.os),e[t]=20,t+=2,e[t++]=n.flag<<1|(null==a&&8),e[t++]=r&&8,e[t++]=255&n.compression,e[t++]=n.compression>>8;var d=new Date(null==n.mtime?Date.now():n.mtime),f=d.getFullYear()-1980;if(f<0||f>119)throw"date not in range 1980-2099";if(X(e,t,f<<25|d.getMonth()+1<<21|d.getDate()<<16|d.getHours()<<11|d.getMinutes()<<5|d.getSeconds()>>>1),t+=4,null!=a&&(X(e,t,n.crc),X(e,t+4,a),X(e,t+8,n.size)),X(e,t+12,l),X(e,t+14,h),t+=16,null!=o&&(X(e,t,c),X(e,t+6,n.attrs),X(e,t+10,o),t+=14),e.set(i,t),t+=l,h)for(var p in u){var A=u[p],v=A.length;X(e,t,+p),X(e,t+2,v),e.set(A,t+4),t+=4+v}return c&&(e.set(s,t),t+=c),t},fe=function(e,t,n,i,r){X(e,t,101010256),X(e,t+8,n),X(e,t+10,n),X(e,t+12,i),X(e,t+16,r)};function pe(e,t){t||(t={});var n={},i=[];ne(e,"",n,t);var a=0,o=0;for(var s in n){var l=n[s],u=l[0],c=l[1],h=0==c.level?0:8,d=(_=oe(s)).length,f=c.comment,p=f&&oe(f),A=p&&p.length,v=he(c.extra);if(d>65535)throw"filename too long";var g=h?$(u,c):u,m=g.length,y=H();y.p(u),i.push(W(c,{size:u.length,crc:y.d(),c:g,f:_,m:p,u:d!=s.length||p&&f.length!=A,o:a,compression:h})),a+=30+d+v+m,o+=76+2*(d+v)+(A||0)+m}for(var x=new r(o+22),w=a,C=o-a,b=0;b<i.length;++b){var _=i[b];de(x,_.o,_,_.f,_.u,_.c.length);var E=30+_.f.length+he(_.extra);x.set(_.c,_.o+E),de(x,a,_,_.f,_.u,_.c.length,_.o,_.m),a+=16+E+(_.m?_.m.length:0)}return fe(x,a,i.length,C,w),x}function Ae(e){for(var t={},n=e.length-22;101010256!=Y(e,n);--n)if(!n||e.length-n>65558)throw"invalid zip file";var i=q(e,n+8);if(!i)return{};var a=Y(e,n+16),o=4294967295==a;if(o){if(n=Y(e,n-12),101075792!=Y(e,n))throw"invalid zip file";i=Y(e,n+32),a=Y(e,n+48)}for(var s=0;s<i;++s){var l=ue(e,a,o),u=l[0],c=l[1],h=l[2],d=l[3],f=l[4],p=l[5],A=le(e,p);if(a=f,u){if(8!=u)throw"unknown compression type "+u;t[d]=ee(e.subarray(A,A+c),new r(h))}else t[d]=T(e,A,A+c)}return t}},2969:function(e,t,n){n.r(t),n.d(t,{DRACOLoader:function(){return u}});var i=n(15671),r=n(43144),a=n(60136),o=n(29388),s=n(70804),l=new WeakMap,u=function(e){(0,a.Z)(n,e);var t=(0,o.Z)(n);function n(e){var r;return(0,i.Z)(this,n),(r=t.call(this,e)).decoderPath="",r.decoderConfig={},r.decoderBinary=null,r.decoderPending=null,r.workerLimit=4,r.workerPool=[],r.workerNextTaskID=1,r.workerSourceURL="",r.defaultAttributeIDs={position:"POSITION",normal:"NORMAL",color:"COLOR",uv:"TEX_COORD"},r.defaultAttributeTypes={position:"Float32Array",normal:"Float32Array",color:"Float32Array",uv:"Float32Array"},r}return(0,r.Z)(n,[{key:"setDecoderPath",value:function(e){return this.decoderPath=e,this}},{key:"setDecoderConfig",value:function(e){return this.decoderConfig=e,this}},{key:"setWorkerLimit",value:function(e){return this.workerLimit=e,this}},{key:"load",value:function(e,t,n,i){var r=this,a=new s.hH6(this.manager);a.setPath(this.path),a.setResponseType("arraybuffer"),a.setRequestHeader(this.requestHeader),a.setWithCredentials(this.withCredentials),a.load(e,(function(e){r.decodeDracoFile(e,t).catch(i)}),n,i)}},{key:"parse",value:function(e,t,n){this.decodeDracoFile(e,t).catch(n)}},{key:"decodeDracoFile",value:function(e,t,n,i){var r={attributeIDs:n||this.defaultAttributeIDs,attributeTypes:i||this.defaultAttributeTypes,useUniqueIDs:!!n};return this.decodeGeometry(e,r).then(t)}},{key:"decodeGeometry",value:function(e,t){var n,i=this,r=JSON.stringify(t);if(l.has(e)){var a=l.get(e);if(a.key===r)return a.promise;if(0===e.byteLength)throw new Error("THREE.DRACOLoader: Unable to re-decode a buffer with different settings. Buffer has already been transferred.")}var o=this.workerNextTaskID++,s=e.byteLength,u=this._getWorker(o,s).then((function(i){return n=i,new Promise((function(i,r){n._callbacks[o]={resolve:i,reject:r},n.postMessage({type:"decode",id:o,taskConfig:t,buffer:e},[e])}))})).then((function(e){return i._createGeometry(e.geometry)}));return u.catch((function(){return!0})).then((function(){n&&o&&i._releaseTask(n,o)})),l.set(e,{key:r,promise:u}),u}},{key:"_createGeometry",value:function(e){var t=new s.u9r;e.index&&t.setIndex(new s.TlE(e.index.array,1));for(var n=0;n<e.attributes.length;n++){var i=e.attributes[n],r=i.name,a=i.array,o=i.itemSize;t.setAttribute(r,new s.TlE(a,o))}return t}},{key:"_loadLibrary",value:function(e,t){var n=new s.hH6(this.manager);return n.setPath(this.decoderPath),n.setResponseType(t),n.setWithCredentials(this.withCredentials),new Promise((function(t,i){n.load(e,t,void 0,i)}))}},{key:"preload",value:function(){return this._initDecoder(),this}},{key:"_initDecoder",value:function(){var e=this;if(this.decoderPending)return this.decoderPending;var t="object"!==typeof WebAssembly||"js"===this.decoderConfig.type,n=[];return t?n.push(this._loadLibrary("draco_decoder.js","text")):(n.push(this._loadLibrary("draco_wasm_wrapper.js","text")),n.push(this._loadLibrary("draco_decoder.wasm","arraybuffer"))),this.decoderPending=Promise.all(n).then((function(n){var i=n[0];t||(e.decoderConfig.wasmBinary=n[1]);var r=c.toString(),a=["/* draco decoder */",i,"","/* worker */",r.substring(r.indexOf("{")+1,r.lastIndexOf("}"))].join("\n");e.workerSourceURL=URL.createObjectURL(new Blob([a]))})),this.decoderPending}},{key:"_getWorker",value:function(e,t){var n=this;return this._initDecoder().then((function(){if(n.workerPool.length<n.workerLimit){var i=new Worker(n.workerSourceURL);i._callbacks={},i._taskCosts={},i._taskLoad=0,i.postMessage({type:"init",decoderConfig:n.decoderConfig}),i.onmessage=function(e){var t=e.data;switch(t.type){case"decode":i._callbacks[t.id].resolve(t);break;case"error":i._callbacks[t.id].reject(t);break;default:console.error('THREE.DRACOLoader: Unexpected message, "'+t.type+'"')}},n.workerPool.push(i)}else n.workerPool.sort((function(e,t){return e._taskLoad>t._taskLoad?-1:1}));var r=n.workerPool[n.workerPool.length-1];return r._taskCosts[e]=t,r._taskLoad+=t,r}))}},{key:"_releaseTask",value:function(e,t){e._taskLoad-=e._taskCosts[t],delete e._callbacks[t],delete e._taskCosts[t]}},{key:"debug",value:function(){console.log("Task load: ",this.workerPool.map((function(e){return e._taskLoad})))}},{key:"dispose",value:function(){for(var e=0;e<this.workerPool.length;++e)this.workerPool[e].terminate();return this.workerPool.length=0,""!==this.workerSourceURL&&URL.revokeObjectURL(this.workerSourceURL),this}}]),n}(s.aNw);function c(){var e,t;function n(e,t,n,i,r,a){var o=a.num_components(),s=n.num_points()*o,l=s*r.BYTES_PER_ELEMENT,u=function(e,t){switch(t){case Float32Array:return e.DT_FLOAT32;case Int8Array:return e.DT_INT8;case Int16Array:return e.DT_INT16;case Int32Array:return e.DT_INT32;case Uint8Array:return e.DT_UINT8;case Uint16Array:return e.DT_UINT16;case Uint32Array:return e.DT_UINT32}}(e,r),c=e._malloc(l);t.GetAttributeDataArrayForAllPoints(n,a,u,l,c);var h=new r(e.HEAPF32.buffer,c,s).slice();return e._free(c),{name:i,array:h,itemSize:o}}onmessage=function(i){var r=i.data;switch(r.type){case"init":e=r.decoderConfig,t=new Promise((function(t){e.onModuleLoaded=function(e){t({draco:e})},DracoDecoderModule(e)}));break;case"decode":var a=r.buffer,o=r.taskConfig;t.then((function(e){var t=e.draco,i=new t.Decoder,s=new t.DecoderBuffer;s.Init(new Int8Array(a),a.byteLength);try{var l=function(e,t,i,r){var a,o,s=r.attributeIDs,l=r.attributeTypes,u=t.GetEncodedGeometryType(i);if(u===e.TRIANGULAR_MESH)a=new e.Mesh,o=t.DecodeBufferToMesh(i,a);else{if(u!==e.POINT_CLOUD)throw new Error("THREE.DRACOLoader: Unexpected geometry type.");a=new e.PointCloud,o=t.DecodeBufferToPointCloud(i,a)}if(!o.ok()||0===a.ptr)throw new Error("THREE.DRACOLoader: Decoding failed: "+o.error_msg());var c={index:null,attributes:[]};for(var h in s){var d=self[l[h]],f=void 0,p=void 0;if(r.useUniqueIDs)p=s[h],f=t.GetAttributeByUniqueId(a,p);else{if(-1===(p=t.GetAttributeId(a,e[s[h]])))continue;f=t.GetAttribute(a,p)}c.attributes.push(n(e,t,a,h,d,f))}u===e.TRIANGULAR_MESH&&(c.index=function(e,t,n){var i=n.num_faces(),r=3*i,a=4*r,o=e._malloc(a);t.GetTrianglesUInt32Array(n,a,o);var s=new Uint32Array(e.HEAPF32.buffer,o,r).slice();return e._free(o),{array:s,itemSize:1}}(e,t,a));return e.destroy(a),c}(t,i,s,o),u=l.attributes.map((function(e){return e.array.buffer}));l.index&&u.push(l.index.array.buffer),self.postMessage({type:"decode",id:r.id,geometry:l},u)}catch(c){console.error(c),self.postMessage({type:"error",id:r.id,error:c.message})}finally{t.destroy(s),t.destroy(i)}}))}}}},20125:function(e,t,n){n.r(t),n.d(t,{GLTFLoader:function(){return A},revokeTextureUrls:function(){return p}});var i=n(29439),r=n(11752),a=n(61120),o=n(37762),s=n(15671),l=n(43144),u=n(60136),c=n(29388),h=n(70804),d=n(51925),f=!0;function p(e){f=e}var A=function(e){(0,u.Z)(n,e);var t=(0,c.Z)(n);function n(e){var i;return(0,s.Z)(this,n),(i=t.call(this,e)).dracoLoader=null,i.ktx2Loader=null,i.meshoptDecoder=null,i.pluginCallbacks=[],i.register((function(e){return new w(e)})),i.register((function(e){return new S(e)})),i.register((function(e){return new k(e)})),i.register((function(e){return new b(e)})),i.register((function(e){return new _(e)})),i.register((function(e){return new E(e)})),i.register((function(e){return new M(e)})),i.register((function(e){return new x(e)})),i.register((function(e){return new I(e)})),i.register((function(e){return new C(e)})),i.register((function(e){return new m(e)})),i.register((function(e){return new B(e)})),i.register((function(e){return new T(e)})),i}return(0,l.Z)(n,[{key:"load",value:function(e,t,n,i){var r,a=this;r=""!==this.resourcePath?this.resourcePath:""!==this.path?this.path:h.Zp0.extractUrlBase(e),this.manager.itemStart(e);var o=function(t){i?i(t):console.error(t),a.manager.itemError(e),a.manager.itemEnd(e)},s=new h.hH6(this.manager);s.setPath(this.path),s.setResponseType("arraybuffer"),s.setRequestHeader(this.requestHeader),s.setWithCredentials(this.withCredentials),s.load(e,(function(n){try{a.parse(n,r,(function(n){t(n),a.manager.itemEnd(e)}),o)}catch(i){o(i)}}),n,o)}},{key:"setDRACOLoader",value:function(e){return this.dracoLoader=e,this}},{key:"setDDSLoader",value:function(){throw new Error('THREE.GLTFLoader: "MSFT_texture_dds" no longer supported. Please update to "KHR_texture_basisu".')}},{key:"setKTX2Loader",value:function(e){return this.ktx2Loader=e,this}},{key:"setMeshoptDecoder",value:function(e){return this.meshoptDecoder=e,this}},{key:"register",value:function(e){return-1===this.pluginCallbacks.indexOf(e)&&this.pluginCallbacks.push(e),this}},{key:"unregister",value:function(e){return-1!==this.pluginCallbacks.indexOf(e)&&this.pluginCallbacks.splice(this.pluginCallbacks.indexOf(e),1),this}},{key:"parse",value:function(e,t,n,i){var r,a={},o={},s=new TextDecoder;if("string"===typeof e)r=JSON.parse(e);else if(e instanceof ArrayBuffer){if(s.decode(new Uint8Array(e,0,4))===D){try{a[g.KHR_BINARY_GLTF]=new L(e)}catch(p){return void(i&&i(p))}r=JSON.parse(a[g.KHR_BINARY_GLTF].content)}else r=JSON.parse(s.decode(e))}else r=e;if(void 0===r.asset||r.asset.version[0]<2)i&&i(new Error("THREE.GLTFLoader: Unsupported asset. glTF versions >=2.0 are supported."));else{var l=new oe(r,{path:t||this.resourcePath||"",crossOrigin:this.crossOrigin,requestHeader:this.requestHeader,manager:this.manager,ktx2Loader:this.ktx2Loader,meshoptDecoder:this.meshoptDecoder});l.fileLoader.setRequestHeader(this.requestHeader);for(var u=0;u<this.pluginCallbacks.length;u++){var c=this.pluginCallbacks[u](l);o[c.name]=c,a[c.name]=!0}if(r.extensionsUsed)for(var h=0;h<r.extensionsUsed.length;++h){var d=r.extensionsUsed[h],f=r.extensionsRequired||[];switch(d){case g.KHR_MATERIALS_UNLIT:a[d]=new y;break;case g.KHR_DRACO_MESH_COMPRESSION:a[d]=new Q(r,this.dracoLoader);break;case g.KHR_TEXTURE_TRANSFORM:a[d]=new Z;break;case g.KHR_MESH_QUANTIZATION:a[d]=new N;break;default:f.indexOf(d)>=0&&void 0===o[d]&&console.warn('THREE.GLTFLoader: Unknown extension "'+d+'".')}}l.setExtensions(a),l.setPlugins(o),l.parse(n,i)}}},{key:"parseAsync",value:function(e,t){var n=this;return new Promise((function(i,r){n.parse(e,t,i,r)}))}}]),n}(h.aNw);function v(){var e={};return{get:function(t){return e[t]},add:function(t,n){e[t]=n},remove:function(t){delete e[t]},removeAll:function(){e={}}}}var g={KHR_BINARY_GLTF:"KHR_binary_glTF",KHR_DRACO_MESH_COMPRESSION:"KHR_draco_mesh_compression",KHR_LIGHTS_PUNCTUAL:"KHR_lights_punctual",KHR_MATERIALS_CLEARCOAT:"KHR_materials_clearcoat",KHR_MATERIALS_IOR:"KHR_materials_ior",KHR_MATERIALS_SHEEN:"KHR_materials_sheen",KHR_MATERIALS_SPECULAR:"KHR_materials_specular",KHR_MATERIALS_TRANSMISSION:"KHR_materials_transmission",KHR_MATERIALS_IRIDESCENCE:"KHR_materials_iridescence",KHR_MATERIALS_UNLIT:"KHR_materials_unlit",KHR_MATERIALS_VOLUME:"KHR_materials_volume",KHR_TEXTURE_BASISU:"KHR_texture_basisu",KHR_TEXTURE_TRANSFORM:"KHR_texture_transform",KHR_MESH_QUANTIZATION:"KHR_mesh_quantization",KHR_MATERIALS_EMISSIVE_STRENGTH:"KHR_materials_emissive_strength",EXT_TEXTURE_WEBP:"EXT_texture_webp",EXT_MESHOPT_COMPRESSION:"EXT_meshopt_compression",EXT_MESH_GPU_INSTANCING:"EXT_mesh_gpu_instancing"},m=function(){function e(t){(0,s.Z)(this,e),this.parser=t,this.name=g.KHR_LIGHTS_PUNCTUAL,this.cache={refs:{},uses:{}}}return(0,l.Z)(e,[{key:"_markDefs",value:function(){for(var e=this.parser,t=this.parser.json.nodes||[],n=0,i=t.length;n<i;n++){var r=t[n];r.extensions&&r.extensions[this.name]&&void 0!==r.extensions[this.name].light&&e._addNodeRef(this.cache,r.extensions[this.name].light)}}},{key:"_loadLight",value:function(e){var t=this.parser,n="light:"+e,i=t.cache.get(n);if(i)return i;var r,a=t.json,o=((a.extensions&&a.extensions[this.name]||{}).lights||[])[e],s=new h.Ilk(16777215);void 0!==o.color&&s.fromArray(o.color);var l=void 0!==o.range?o.range:0;switch(o.type){case"directional":(r=new h.Ox3(s)).target.position.set(0,0,0),r.add(r.target);break;case"point":(r=new h.cek(s)).distance=l;break;case"spot":(r=new h.PMe(s)).distance=l,o.spot=o.spot||{},o.spot.innerConeAngle=void 0!==o.spot.innerConeAngle?o.spot.innerConeAngle:0,o.spot.outerConeAngle=void 0!==o.spot.outerConeAngle?o.spot.outerConeAngle:Math.PI/4,r.angle=o.spot.outerConeAngle,r.penumbra=1-o.spot.innerConeAngle/o.spot.outerConeAngle,r.target.position.set(0,0,0),r.add(r.target);break;default:throw new Error("THREE.GLTFLoader: Unexpected light type: "+o.type)}return r.position.set(0,0,0),r.decay=2,ee(r,o),void 0!==o.intensity&&(r.intensity=o.intensity),r.name=t.createUniqueName(o.name||"light_"+e),i=Promise.resolve(r),t.cache.add(n,i),i}},{key:"getDependency",value:function(e,t){if("light"===e)return this._loadLight(t)}},{key:"createNodeAttachment",value:function(e){var t=this,n=this.parser,i=n.json.nodes[e],r=(i.extensions&&i.extensions[this.name]||{}).light;return void 0===r?null:this._loadLight(r).then((function(e){return n._getNodeRef(t.cache,r,e)}))}}]),e}(),y=function(){function e(){(0,s.Z)(this,e),this.name=g.KHR_MATERIALS_UNLIT}return(0,l.Z)(e,[{key:"getMaterialType",value:function(){return h.vBJ}},{key:"extendParams",value:function(e,t,n){var i=[];e.color=new h.Ilk(1,1,1),e.opacity=1;var r=t.pbrMetallicRoughness;if(r){if(Array.isArray(r.baseColorFactor)){var a=r.baseColorFactor;e.color.fromArray(a),e.opacity=a[3]}void 0!==r.baseColorTexture&&i.push(n.assignTexture(e,"map",r.baseColorTexture,h.knz))}return Promise.all(i)}}]),e}(),x=function(){function e(t){(0,s.Z)(this,e),this.parser=t,this.name=g.KHR_MATERIALS_EMISSIVE_STRENGTH}return(0,l.Z)(e,[{key:"extendMaterialParams",value:function(e,t){var n=this.parser.json.materials[e];if(!n.extensions||!n.extensions[this.name])return Promise.resolve();var i=n.extensions[this.name].emissiveStrength;return void 0!==i&&(t.emissiveIntensity=i),Promise.resolve()}}]),e}(),w=function(){function e(t){(0,s.Z)(this,e),this.parser=t,this.name=g.KHR_MATERIALS_CLEARCOAT}return(0,l.Z)(e,[{key:"getMaterialType",value:function(e){var t=this.parser.json.materials[e];return t.extensions&&t.extensions[this.name]?h.EJi:null}},{key:"extendMaterialParams",value:function(e,t){var n=this.parser,i=n.json.materials[e];if(!i.extensions||!i.extensions[this.name])return Promise.resolve();var r=[],a=i.extensions[this.name];if(void 0!==a.clearcoatFactor&&(t.clearcoat=a.clearcoatFactor),void 0!==a.clearcoatTexture&&r.push(n.assignTexture(t,"clearcoatMap",a.clearcoatTexture)),void 0!==a.clearcoatRoughnessFactor&&(t.clearcoatRoughness=a.clearcoatRoughnessFactor),void 0!==a.clearcoatRoughnessTexture&&r.push(n.assignTexture(t,"clearcoatRoughnessMap",a.clearcoatRoughnessTexture)),void 0!==a.clearcoatNormalTexture&&(r.push(n.assignTexture(t,"clearcoatNormalMap",a.clearcoatNormalTexture)),void 0!==a.clearcoatNormalTexture.scale)){var o=a.clearcoatNormalTexture.scale;t.clearcoatNormalScale=new h.FM8(o,o)}return Promise.all(r)}}]),e}(),C=function(){function e(t){(0,s.Z)(this,e),this.parser=t,this.name=g.KHR_MATERIALS_IRIDESCENCE}return(0,l.Z)(e,[{key:"getMaterialType",value:function(e){var t=this.parser.json.materials[e];return t.extensions&&t.extensions[this.name]?h.EJi:null}},{key:"extendMaterialParams",value:function(e,t){var n=this.parser,i=n.json.materials[e];if(!i.extensions||!i.extensions[this.name])return Promise.resolve();var r=[],a=i.extensions[this.name];return void 0!==a.iridescenceFactor&&(t.iridescence=a.iridescenceFactor),void 0!==a.iridescenceTexture&&r.push(n.assignTexture(t,"iridescenceMap",a.iridescenceTexture)),void 0!==a.iridescenceIor&&(t.iridescenceIOR=a.iridescenceIor),void 0===t.iridescenceThicknessRange&&(t.iridescenceThicknessRange=[100,400]),void 0!==a.iridescenceThicknessMinimum&&(t.iridescenceThicknessRange[0]=a.iridescenceThicknessMinimum),void 0!==a.iridescenceThicknessMaximum&&(t.iridescenceThicknessRange[1]=a.iridescenceThicknessMaximum),void 0!==a.iridescenceThicknessTexture&&r.push(n.assignTexture(t,"iridescenceThicknessMap",a.iridescenceThicknessTexture)),Promise.all(r)}}]),e}(),b=function(){function e(t){(0,s.Z)(this,e),this.parser=t,this.name=g.KHR_MATERIALS_SHEEN}return(0,l.Z)(e,[{key:"getMaterialType",value:function(e){var t=this.parser.json.materials[e];return t.extensions&&t.extensions[this.name]?h.EJi:null}},{key:"extendMaterialParams",value:function(e,t){var n=this.parser,i=n.json.materials[e];if(!i.extensions||!i.extensions[this.name])return Promise.resolve();var r=[];t.sheenColor=new h.Ilk(0,0,0),t.sheenRoughness=0,t.sheen=1;var a=i.extensions[this.name];return void 0!==a.sheenColorFactor&&t.sheenColor.fromArray(a.sheenColorFactor),void 0!==a.sheenRoughnessFactor&&(t.sheenRoughness=a.sheenRoughnessFactor),void 0!==a.sheenColorTexture&&r.push(n.assignTexture(t,"sheenColorMap",a.sheenColorTexture,h.knz)),void 0!==a.sheenRoughnessTexture&&r.push(n.assignTexture(t,"sheenRoughnessMap",a.sheenRoughnessTexture)),Promise.all(r)}}]),e}(),_=function(){function e(t){(0,s.Z)(this,e),this.parser=t,this.name=g.KHR_MATERIALS_TRANSMISSION}return(0,l.Z)(e,[{key:"getMaterialType",value:function(e){var t=this.parser.json.materials[e];return t.extensions&&t.extensions[this.name]?h.EJi:null}},{key:"extendMaterialParams",value:function(e,t){var n=this.parser,i=n.json.materials[e];if(!i.extensions||!i.extensions[this.name])return Promise.resolve();var r=[],a=i.extensions[this.name];return void 0!==a.transmissionFactor&&(t.transmission=a.transmissionFactor),void 0!==a.transmissionTexture&&r.push(n.assignTexture(t,"transmissionMap",a.transmissionTexture)),Promise.all(r)}}]),e}(),E=function(){function e(t){(0,s.Z)(this,e),this.parser=t,this.name=g.KHR_MATERIALS_VOLUME}return(0,l.Z)(e,[{key:"getMaterialType",value:function(e){var t=this.parser.json.materials[e];return t.extensions&&t.extensions[this.name]?h.EJi:null}},{key:"extendMaterialParams",value:function(e,t){var n=this.parser,i=n.json.materials[e];if(!i.extensions||!i.extensions[this.name])return Promise.resolve();var r=[],a=i.extensions[this.name];t.thickness=void 0!==a.thicknessFactor?a.thicknessFactor:0,void 0!==a.thicknessTexture&&r.push(n.assignTexture(t,"thicknessMap",a.thicknessTexture)),t.attenuationDistance=a.attenuationDistance||1/0;var o=a.attenuationColor||[1,1,1];return t.attenuationColor=new h.Ilk(o[0],o[1],o[2]),Promise.all(r)}}]),e}(),M=function(){function e(t){(0,s.Z)(this,e),this.parser=t,this.name=g.KHR_MATERIALS_IOR}return(0,l.Z)(e,[{key:"getMaterialType",value:function(e){var t=this.parser.json.materials[e];return t.extensions&&t.extensions[this.name]?h.EJi:null}},{key:"extendMaterialParams",value:function(e,t){var n=this.parser.json.materials[e];if(!n.extensions||!n.extensions[this.name])return Promise.resolve();var i=n.extensions[this.name];return t.ior=void 0!==i.ior?i.ior:1.5,Promise.resolve()}}]),e}(),I=function(){function e(t){(0,s.Z)(this,e),this.parser=t,this.name=g.KHR_MATERIALS_SPECULAR}return(0,l.Z)(e,[{key:"getMaterialType",value:function(e){var t=this.parser.json.materials[e];return t.extensions&&t.extensions[this.name]?h.EJi:null}},{key:"extendMaterialParams",value:function(e,t){var n=this.parser,i=n.json.materials[e];if(!i.extensions||!i.extensions[this.name])return Promise.resolve();var r=[],a=i.extensions[this.name];t.specularIntensity=void 0!==a.specularFactor?a.specularFactor:1,void 0!==a.specularTexture&&r.push(n.assignTexture(t,"specularIntensityMap",a.specularTexture));var o=a.specularColorFactor||[1,1,1];return t.specularColor=new h.Ilk(o[0],o[1],o[2]),void 0!==a.specularColorTexture&&r.push(n.assignTexture(t,"specularColorMap",a.specularColorTexture,h.knz)),Promise.all(r)}}]),e}(),S=function(){function e(t){(0,s.Z)(this,e),this.parser=t,this.name=g.KHR_TEXTURE_BASISU}return(0,l.Z)(e,[{key:"loadTexture",value:function(e){var t=this.parser,n=t.json,i=n.textures[e];if(!i.extensions||!i.extensions[this.name])return null;var r=i.extensions[this.name],a=t.options.ktx2Loader;if(!a){if(n.extensionsRequired&&n.extensionsRequired.indexOf(this.name)>=0)throw new Error("THREE.GLTFLoader: setKTX2Loader must be called before loading KTX2 textures");return null}return t.loadTextureImage(e,r.source,a)}}]),e}(),k=function(){function e(t){(0,s.Z)(this,e),this.parser=t,this.name=g.EXT_TEXTURE_WEBP,this.isSupported=null}return(0,l.Z)(e,[{key:"loadTexture",value:function(e){var t=this.name,n=this.parser,i=n.json,r=i.textures[e];if(!r.extensions||!r.extensions[t])return null;var a=r.extensions[t],o=i.images[a.source],s=n.textureLoader;if(o.uri){var l=n.options.manager.getHandler(o.uri);null!==l&&(s=l)}return this.detectSupport().then((function(r){if(r)return n.loadTextureImage(e,a.source,s);if(i.extensionsRequired&&i.extensionsRequired.indexOf(t)>=0)throw new Error("THREE.GLTFLoader: WebP required by asset but unsupported.");return n.loadTexture(e)}))}},{key:"detectSupport",value:function(){return this.isSupported||(this.isSupported=new Promise((function(e){var t=new Image;t.src="data:image/webp;base64,UklGRiIAAABXRUJQVlA4IBYAAAAwAQCdASoBAAEADsD+JaQAA3AAAAAA",t.onload=t.onerror=function(){e(1===t.height)}}))),this.isSupported}}]),e}(),B=function(){function e(t){(0,s.Z)(this,e),this.name=g.EXT_MESHOPT_COMPRESSION,this.parser=t}return(0,l.Z)(e,[{key:"loadBufferView",value:function(e){var t=this.parser.json,n=t.bufferViews[e];if(n.extensions&&n.extensions[this.name]){var i=n.extensions[this.name],r=this.parser.getDependency("buffer",i.buffer),a=this.parser.options.meshoptDecoder;if(!a||!a.supported){if(t.extensionsRequired&&t.extensionsRequired.indexOf(this.name)>=0)throw new Error("THREE.GLTFLoader: setMeshoptDecoder must be called before loading compressed files");return null}return r.then((function(e){var t=i.byteOffset||0,n=i.byteLength||0,r=i.count,o=i.byteStride,s=new Uint8Array(e,t,n);return a.decodeGltfBufferAsync?a.decodeGltfBufferAsync(r,o,s,i.mode,i.filter).then((function(e){return e.buffer})):a.ready.then((function(){var e=new ArrayBuffer(r*o);return a.decodeGltfBuffer(new Uint8Array(e),r,o,s,i.mode,i.filter),e}))}))}return null}}]),e}(),T=function(){function e(t){(0,s.Z)(this,e),this.name=g.EXT_MESH_GPU_INSTANCING,this.parser=t}return(0,l.Z)(e,[{key:"createNodeMesh",value:function(e){var t=this,n=this.parser.json,i=n.nodes[e];if(!i.extensions||!i.extensions[this.name]||void 0===i.mesh)return null;var r,a=n.meshes[i.mesh],s=(0,o.Z)(a.primitives);try{for(s.s();!(r=s.n()).done;){var l=r.value;if(l.mode!==O.TRIANGLES&&l.mode!==O.TRIANGLE_STRIP&&l.mode!==O.TRIANGLE_FAN&&void 0!==l.mode)return null}}catch(A){s.e(A)}finally{s.f()}var u=i.extensions[this.name].attributes,c=[],d={},f=function(e){c.push(t.parser.getDependency("accessor",u[e]).then((function(t){return d[e]=t,d[e]})))};for(var p in u)f(p);return c.length<1?null:(c.push(this.parser.createNodeMesh(e)),Promise.all(c).then((function(e){var n,i=e.pop(),r=i.isGroup?i.children:[i],a=e[0].count,s=[],l=(0,o.Z)(r);try{for(l.s();!(n=l.n()).done;){for(var u=n.value,c=new h.yGw,f=new h.Pa4,p=new h._fP,v=new h.Pa4(1,1,1),g=new h.SPe(u.geometry,u.material,a),m=0;m<a;m++)d.TRANSLATION&&f.fromBufferAttribute(d.TRANSLATION,m),d.ROTATION&&p.fromBufferAttribute(d.ROTATION,m),d.SCALE&&v.fromBufferAttribute(d.SCALE,m),g.setMatrixAt(m,c.compose(f,p,v));for(var y in d)"TRANSLATION"!==y&&"ROTATION"!==y&&"SCALE"!==y&&u.geometry.setAttribute(y,d[y]);h.Tme.prototype.copy.call(g,u),g.frustumCulled=!1,t.parser.assignFinalMaterial(g),s.push(g)}}catch(A){l.e(A)}finally{l.f()}return i.isGroup?(i.clear(),i.add.apply(i,s),i):s[0]})))}}]),e}(),D="glTF",R=1313821514,P=5130562,L=(0,l.Z)((function e(t){(0,s.Z)(this,e),this.name=g.KHR_BINARY_GLTF,this.content=null,this.body=null;var n=new DataView(t,0,12),i=new TextDecoder;if(this.header={magic:i.decode(new Uint8Array(t.slice(0,4))),version:n.getUint32(4,!0),length:n.getUint32(8,!0)},this.header.magic!==D)throw new Error("THREE.GLTFLoader: Unsupported glTF-Binary header.");if(this.header.version<2)throw new Error("THREE.GLTFLoader: Legacy binary file detected.");for(var r=this.header.length-12,a=new DataView(t,12),o=0;o<r;){var l=a.getUint32(o,!0);o+=4;var u=a.getUint32(o,!0);if(o+=4,u===R){var c=new Uint8Array(t,12+o,l);this.content=i.decode(c)}else if(u===P){var h=12+o;this.body=t.slice(h,h+l)}o+=l}if(null===this.content)throw new Error("THREE.GLTFLoader: JSON content not found.")})),Q=function(){function e(t,n){if((0,s.Z)(this,e),!n)throw new Error("THREE.GLTFLoader: No DRACOLoader instance provided.");this.name=g.KHR_DRACO_MESH_COMPRESSION,this.json=t,this.dracoLoader=n,this.dracoLoader.preload()}return(0,l.Z)(e,[{key:"decodePrimitive",value:function(e,t){var n=this.json,i=this.dracoLoader,r=e.extensions[this.name].bufferView,a=e.extensions[this.name].attributes,o={},s={},l={};for(var u in a){var c=W[u]||u.toLowerCase();o[c]=a[u]}for(var h in e.attributes){var d=W[h]||h.toLowerCase();if(void 0!==a[h]){var f=n.accessors[e.attributes[h]],p=z[f.componentType];l[d]=p.name,s[d]=!0===f.normalized}}return t.getDependency("bufferView",r).then((function(e){return new Promise((function(t){i.decodeDracoFile(e,(function(e){for(var n in e.attributes){var i=e.attributes[n],r=s[n];void 0!==r&&(i.normalized=r)}t(e)}),o,l)}))}))}}]),e}(),Z=function(){function e(){(0,s.Z)(this,e),this.name=g.KHR_TEXTURE_TRANSFORM}return(0,l.Z)(e,[{key:"extendTexture",value:function(e,t){return void 0!==t.texCoord&&console.warn('THREE.GLTFLoader: Custom UV sets in "'+this.name+'" extension not yet supported.'),void 0===t.offset&&void 0===t.rotation&&void 0===t.scale||(e=e.clone(),void 0!==t.offset&&e.offset.fromArray(t.offset),void 0!==t.rotation&&(e.rotation=t.rotation),void 0!==t.scale&&e.repeat.fromArray(t.scale),e.needsUpdate=!0),e}}]),e}(),N=(0,l.Z)((function e(){(0,s.Z)(this,e),this.name=g.KHR_MESH_QUANTIZATION})),F=function(e){(0,u.Z)(n,e);var t=(0,c.Z)(n);function n(e,i,r,a){return(0,s.Z)(this,n),t.call(this,e,i,r,a)}return(0,l.Z)(n,[{key:"copySampleValue_",value:function(e){for(var t=this.resultBuffer,n=this.sampleValues,i=this.valueSize,r=e*i*3+i,a=0;a!==i;a++)t[a]=n[r+a];return t}},{key:"interpolate_",value:function(e,t,n,i){for(var r=this.resultBuffer,a=this.sampleValues,o=this.valueSize,s=2*o,l=3*o,u=i-t,c=(n-t)/u,h=c*c,d=h*c,f=e*l,p=f-l,A=-2*d+3*h,v=d-h,g=1-A,m=v-h+c,y=0;y!==o;y++){var x=a[p+y+o],w=a[p+y+s]*u,C=a[f+y+o],b=a[f+y]*u;r[y]=g*x+m*w+A*C+v*b}return r}}]),n}(h._C8),U=new h._fP,j=function(e){(0,u.Z)(n,e);var t=(0,c.Z)(n);function n(){return(0,s.Z)(this,n),t.apply(this,arguments)}return(0,l.Z)(n,[{key:"interpolate_",value:function(e,t,i,o){var s=(0,r.Z)((0,a.Z)(n.prototype),"interpolate_",this).call(this,e,t,i,o);return U.fromArray(s).normalize().toArray(s),s}}]),n}(F),O={FLOAT:5126,FLOAT_MAT3:35675,FLOAT_MAT4:35676,FLOAT_VEC2:35664,FLOAT_VEC3:35665,FLOAT_VEC4:35666,LINEAR:9729,REPEAT:10497,SAMPLER_2D:35678,POINTS:0,LINES:1,LINE_LOOP:2,LINE_STRIP:3,TRIANGLES:4,TRIANGLE_STRIP:5,TRIANGLE_FAN:6,UNSIGNED_BYTE:5121,UNSIGNED_SHORT:5123},z={5120:Int8Array,5121:Uint8Array,5122:Int16Array,5123:Uint16Array,5125:Uint32Array,5126:Float32Array},G={9728:h.TyD,9729:h.wem,9984:h.YLQ,9985:h.qyh,9986:h.aH4,9987:h.D1R},H={33071:h.uWy,33648:h.OoA,10497:h.rpg},V={SCALAR:1,VEC2:2,VEC3:3,VEC4:4,MAT2:4,MAT3:9,MAT4:16},W={POSITION:"position",NORMAL:"normal",TANGENT:"tangent",TEXCOORD_0:"uv",TEXCOORD_1:"uv2",COLOR_0:"color",WEIGHTS_0:"skinWeight",JOINTS_0:"skinIndex"},q={scale:"scale",translation:"position",rotation:"quaternion",weights:"morphTargetInfluences"},Y={CUBICSPLINE:void 0,LINEAR:h.NMF,STEP:h.Syv},J="OPAQUE",X="MASK",K="BLEND";function $(e,t,n){for(var i in n.extensions)void 0===e[i]&&(t.userData.gltfExtensions=t.userData.gltfExtensions||{},t.userData.gltfExtensions[i]=n.extensions[i])}function ee(e,t){void 0!==t.extras&&("object"===typeof t.extras?Object.assign(e.userData,t.extras):console.warn("THREE.GLTFLoader: Ignoring primitive type .extras, "+t.extras))}function te(e,t){if(e.updateMorphTargets(),void 0!==t.weights)for(var n=0,i=t.weights.length;n<i;n++)e.morphTargetInfluences[n]=t.weights[n];if(t.extras&&Array.isArray(t.extras.targetNames)){var r=t.extras.targetNames;if(e.morphTargetInfluences.length===r.length){e.morphTargetDictionary={};for(var a=0,o=r.length;a<o;a++)e.morphTargetDictionary[r[a]]=a}else console.warn("THREE.GLTFLoader: Invalid extras.targetNames length. Ignoring names.")}}function ne(e){var t=e.extensions&&e.extensions[g.KHR_DRACO_MESH_COMPRESSION];return t?"draco:"+t.bufferView+":"+t.indices+":"+ie(t.attributes):e.indices+":"+ie(e.attributes)+":"+e.mode}function ie(e){for(var t="",n=Object.keys(e).sort(),i=0,r=n.length;i<r;i++)t+=n[i]+":"+e[n[i]]+";";return t}function re(e){switch(e){case Int8Array:return 1/127;case Uint8Array:return 1/255;case Int16Array:return 1/32767;case Uint16Array:return 1/65535;default:throw new Error("THREE.GLTFLoader: Unsupported normalized accessor component type.")}}var ae=new h.yGw,oe=function(){function e(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};(0,s.Z)(this,e),this.json=t,this.extensions={},this.plugins={},this.options=n,this.cache=new v,this.associations=new Map,this.primitiveCache={},this.meshCache={refs:{},uses:{}},this.cameraCache={refs:{},uses:{}},this.lightCache={refs:{},uses:{}},this.sourceCache={},this.textureCache={},this.nodeNamesUsed={};var i=!1,r=!1,a=-1;"undefined"!==typeof navigator&&(i=!0===/^((?!chrome|android).)*safari/i.test(navigator.userAgent),a=(r=navigator.userAgent.indexOf("Firefox")>-1)?navigator.userAgent.match(/Firefox\/([0-9]+)\./)[1]:-1),"undefined"===typeof createImageBitmap||i||r&&a<98?this.textureLoader=new h.dpR(this.options.manager):this.textureLoader=new h.QRU(this.options.manager),this.textureLoader.setCrossOrigin(this.options.crossOrigin),this.textureLoader.setRequestHeader(this.options.requestHeader),this.fileLoader=new h.hH6(this.options.manager),this.fileLoader.setResponseType("arraybuffer"),"use-credentials"===this.options.crossOrigin&&this.fileLoader.setWithCredentials(!0)}return(0,l.Z)(e,[{key:"setExtensions",value:function(e){this.extensions=e}},{key:"setPlugins",value:function(e){this.plugins=e}},{key:"parse",value:function(e,t){var n=this,i=this.json,r=this.extensions;this.cache.removeAll(),this._invokeAll((function(e){return e._markDefs&&e._markDefs()})),Promise.all(this._invokeAll((function(e){return e.beforeRoot&&e.beforeRoot()}))).then((function(){return Promise.all([n.getDependencies("scene"),n.getDependencies("animation"),n.getDependencies("camera")])})).then((function(t){var a={scene:t[0][i.scene||0],scenes:t[0],animations:t[1],cameras:t[2],asset:i.asset,parser:n,userData:{}};$(r,a,i),ee(a,i),Promise.all(n._invokeAll((function(e){return e.afterRoot&&e.afterRoot(a)}))).then((function(){e(a)}))})).catch(t)}},{key:"_markDefs",value:function(){for(var e=this.json.nodes||[],t=this.json.skins||[],n=this.json.meshes||[],i=0,r=t.length;i<r;i++)for(var a=t[i].joints,o=0,s=a.length;o<s;o++)e[a[o]].isBone=!0;for(var l=0,u=e.length;l<u;l++){var c=e[l];void 0!==c.mesh&&(this._addNodeRef(this.meshCache,c.mesh),void 0!==c.skin&&(n[c.mesh].isSkinnedMesh=!0)),void 0!==c.camera&&this._addNodeRef(this.cameraCache,c.camera)}}},{key:"_addNodeRef",value:function(e,t){void 0!==t&&(void 0===e.refs[t]&&(e.refs[t]=e.uses[t]=0),e.refs[t]++)}},{key:"_getNodeRef",value:function(e,t,n){var r=this;if(e.refs[t]<=1)return n;var a=n.clone();return function e(t,n){var a=r.associations.get(t);null!=a&&r.associations.set(n,a);var s,l=(0,o.Z)(t.children.entries());try{for(l.s();!(s=l.n()).done;){var u=(0,i.Z)(s.value,2),c=u[0];e(u[1],n.children[c])}}catch(h){l.e(h)}finally{l.f()}}(n,a),a.name+="_instance_"+e.uses[t]++,a}},{key:"_invokeOne",value:function(e){var t=Object.values(this.plugins);t.push(this);for(var n=0;n<t.length;n++){var i=e(t[n]);if(i)return i}return null}},{key:"_invokeAll",value:function(e){var t=Object.values(this.plugins);t.unshift(this);for(var n=[],i=0;i<t.length;i++){var r=e(t[i]);r&&n.push(r)}return n}},{key:"getDependency",value:function(e,t){var n=e+":"+t,i=this.cache.get(n);if(!i){switch(e){case"scene":i=this.loadScene(t);break;case"node":i=this._invokeOne((function(e){return e.loadNode&&e.loadNode(t)}));break;case"mesh":i=this._invokeOne((function(e){return e.loadMesh&&e.loadMesh(t)}));break;case"accessor":i=this.loadAccessor(t);break;case"bufferView":i=this._invokeOne((function(e){return e.loadBufferView&&e.loadBufferView(t)}));break;case"buffer":i=this.loadBuffer(t);break;case"material":i=this._invokeOne((function(e){return e.loadMaterial&&e.loadMaterial(t)}));break;case"texture":i=this._invokeOne((function(e){return e.loadTexture&&e.loadTexture(t)}));break;case"skin":i=this.loadSkin(t);break;case"animation":i=this._invokeOne((function(e){return e.loadAnimation&&e.loadAnimation(t)}));break;case"camera":i=this.loadCamera(t);break;default:if(!(i=this._invokeOne((function(n){return n!=this&&n.getDependency&&n.getDependency(e,t)}))))throw new Error("Unknown type: "+e)}this.cache.add(n,i)}return i}},{key:"getDependencies",value:function(e){var t=this.cache.get(e);if(!t){var n=this,i=this.json[e+("mesh"===e?"es":"s")]||[];t=Promise.all(i.map((function(t,i){return n.getDependency(e,i)}))),this.cache.add(e,t)}return t}},{key:"loadBuffer",value:function(e){var t=this.json.buffers[e],n=this.fileLoader;if(t.type&&"arraybuffer"!==t.type)throw new Error("THREE.GLTFLoader: "+t.type+" buffer type is not supported.");if(void 0===t.uri&&0===e)return Promise.resolve(this.extensions[g.KHR_BINARY_GLTF].body);var i=this.options;return new Promise((function(e,r){n.load(h.Zp0.resolveURL(t.uri,i.path),e,void 0,(function(){r(new Error('THREE.GLTFLoader: Failed to load buffer "'+t.uri+'".'))}))}))}},{key:"loadBufferView",value:function(e){var t=this.json.bufferViews[e];return this.getDependency("buffer",t.buffer).then((function(e){var n=t.byteLength||0,i=t.byteOffset||0;return e.slice(i,i+n)}))}},{key:"loadAccessor",value:function(e){var t=this,n=this.json,i=this.json.accessors[e];if(void 0===i.bufferView&&void 0===i.sparse){var r=V[i.type],a=z[i.componentType],o=!0===i.normalized,s=new a(i.count*r);return Promise.resolve(new h.TlE(s,r,o))}var l=[];return void 0!==i.bufferView?l.push(this.getDependency("bufferView",i.bufferView)):l.push(null),void 0!==i.sparse&&(l.push(this.getDependency("bufferView",i.sparse.indices.bufferView)),l.push(this.getDependency("bufferView",i.sparse.values.bufferView))),Promise.all(l).then((function(e){var r,a,o=e[0],s=V[i.type],l=z[i.componentType],u=l.BYTES_PER_ELEMENT,c=u*s,d=i.byteOffset||0,f=void 0!==i.bufferView?n.bufferViews[i.bufferView].byteStride:void 0,p=!0===i.normalized;if(f&&f!==c){var A=Math.floor(d/f),v="InterleavedBuffer:"+i.bufferView+":"+i.componentType+":"+A+":"+i.count,g=t.cache.get(v);g||(r=new l(o,A*f,i.count*f/u),g=new h.vpT(r,f/u),t.cache.add(v,g)),a=new h.kB5(g,s,d%f/u,p)}else r=null===o?new l(i.count*s):new l(o,d,i.count*s),a=new h.TlE(r,s,p);if(void 0!==i.sparse){var m=V.SCALAR,y=z[i.sparse.indices.componentType],x=i.sparse.indices.byteOffset||0,w=i.sparse.values.byteOffset||0,C=new y(e[1],x,i.sparse.count*m),b=new l(e[2],w,i.sparse.count*s);null!==o&&(a=new h.TlE(a.array.slice(),a.itemSize,a.normalized));for(var _=0,E=C.length;_<E;_++){var M=C[_];if(a.setX(M,b[_*s]),s>=2&&a.setY(M,b[_*s+1]),s>=3&&a.setZ(M,b[_*s+2]),s>=4&&a.setW(M,b[_*s+3]),s>=5)throw new Error("THREE.GLTFLoader: Unsupported itemSize in sparse BufferAttribute.")}}return a}))}},{key:"loadTexture",value:function(e){var t=this.json,n=this.options,i=t.textures[e].source,r=t.images[i],a=this.textureLoader;if(r.uri){var o=n.manager.getHandler(r.uri);null!==o&&(a=o)}return this.loadTextureImage(e,i,a)}},{key:"loadTextureImage",value:function(e,t,n){var i=this,r=this.json,a=r.textures[e],o=r.images[t],s=(o.uri||o.bufferView)+":"+a.sampler;if(this.textureCache[s])return this.textureCache[s];var l=this.loadImageSource(t,n).then((function(t){t.flipY=!1,t.name=a.name||o.name||"";var n=(r.samplers||{})[a.sampler]||{};return t.magFilter=G[n.magFilter]||h.wem,t.minFilter=G[n.minFilter]||h.D1R,t.wrapS=H[n.wrapS]||h.rpg,t.wrapT=H[n.wrapT]||h.rpg,i.associations.set(t,{textures:e}),t})).catch((function(){return null}));return this.textureCache[s]=l,l}},{key:"loadImageSource",value:function(e,t){var n=this.json,i=this.options;if(void 0!==this.sourceCache[e])return this.sourceCache[e].then((function(e){return e.clone()}));var r=n.images[e],a=self.URL||self.webkitURL,o=r.uri||"",s=!1;if(void 0!==r.bufferView)o=this.getDependency("bufferView",r.bufferView).then((function(e){s=!0;var t=new Blob([e],{type:r.mimeType});return o=a.createObjectURL(t)}));else if(void 0===r.uri)throw new Error("THREE.GLTFLoader: Image "+e+" is missing URI and bufferView");var l=Promise.resolve(o).then((function(e){return new Promise((function(n,r){var a=n;!0===t.isImageBitmapLoader&&(a=function(e){var t=new h.xEZ(e);t.needsUpdate=!0,n(t)}),t.load(h.Zp0.resolveURL(e,i.path),a,void 0,r)}))})).then((function(e){var t;return!0===s&&(f?a.revokeObjectURL(o):e.image.src=o),e.userData.mimeType=r.mimeType||((t=r.uri).search(/\.jpe?g($|\?)/i)>0||0===t.search(/^data\:image\/jpeg/)?"image/jpeg":t.search(/\.webp($|\?)/i)>0||0===t.search(/^data\:image\/webp/)?"image/webp":"image/png"),e})).catch((function(e){throw console.error("THREE.GLTFLoader: Couldn't load texture",o),e}));return this.sourceCache[e]=l,l}},{key:"assignTexture",value:function(e,t,n,i){var r=this;return this.getDependency("texture",n.index).then((function(a){if(!a)return null;if(void 0===n.texCoord||0==n.texCoord||"aoMap"===t&&1==n.texCoord||console.warn("THREE.GLTFLoader: Custom UV set "+n.texCoord+" for texture "+t+" not yet supported."),r.extensions[g.KHR_TEXTURE_TRANSFORM]){var o=void 0!==n.extensions?n.extensions[g.KHR_TEXTURE_TRANSFORM]:void 0;if(o){var s=r.associations.get(a);a=r.extensions[g.KHR_TEXTURE_TRANSFORM].extendTexture(a,o),r.associations.set(a,s)}}return void 0!==i&&(a.encoding=i),e[t]=a,a}))}},{key:"assignFinalMaterial",value:function(e){var t=e.geometry,n=e.material,i=void 0===t.attributes.tangent,r=void 0!==t.attributes.color,a=void 0===t.attributes.normal;if(e.isPoints){var o="PointsMaterial:"+n.uuid,s=this.cache.get(o);s||(s=new h.UY4,h.F5T.prototype.copy.call(s,n),s.color.copy(n.color),s.map=n.map,s.sizeAttenuation=!1,this.cache.add(o,s)),n=s}else if(e.isLine){var l="LineBasicMaterial:"+n.uuid,u=this.cache.get(l);u||(u=new h.nls,h.F5T.prototype.copy.call(u,n),u.color.copy(n.color),this.cache.add(l,u)),n=u}if(i||r||a){var c="ClonedMaterial:"+n.uuid+":";i&&(c+="derivative-tangents:"),r&&(c+="vertex-colors:"),a&&(c+="flat-shading:");var d=this.cache.get(c);d||(d=n.clone(),r&&(d.vertexColors=!0),a&&(d.flatShading=!0),i&&(d.normalScale&&(d.normalScale.y*=-1),d.clearcoatNormalScale&&(d.clearcoatNormalScale.y*=-1)),this.cache.add(c,d),this.associations.set(d,this.associations.get(n))),n=d}n.aoMap&&void 0===t.attributes.uv2&&void 0!==t.attributes.uv&&t.setAttribute("uv2",t.attributes.uv),e.material=n}},{key:"getMaterialType",value:function(){return h.Wid}},{key:"loadMaterial",value:function(e){var t,n=this,i=this.json,r=this.extensions,a=i.materials[e],o={},s=[];if((a.extensions||{})[g.KHR_MATERIALS_UNLIT]){var l=r[g.KHR_MATERIALS_UNLIT];t=l.getMaterialType(),s.push(l.extendParams(o,a,n))}else{var u=a.pbrMetallicRoughness||{};if(o.color=new h.Ilk(1,1,1),o.opacity=1,Array.isArray(u.baseColorFactor)){var c=u.baseColorFactor;o.color.fromArray(c),o.opacity=c[3]}void 0!==u.baseColorTexture&&s.push(n.assignTexture(o,"map",u.baseColorTexture,h.knz)),o.metalness=void 0!==u.metallicFactor?u.metallicFactor:1,o.roughness=void 0!==u.roughnessFactor?u.roughnessFactor:1,void 0!==u.metallicRoughnessTexture&&(s.push(n.assignTexture(o,"metalnessMap",u.metallicRoughnessTexture)),s.push(n.assignTexture(o,"roughnessMap",u.metallicRoughnessTexture))),t=this._invokeOne((function(t){return t.getMaterialType&&t.getMaterialType(e)})),s.push(Promise.all(this._invokeAll((function(t){return t.extendMaterialParams&&t.extendMaterialParams(e,o)}))))}!0===a.doubleSided&&(o.side=h.ehD);var d=a.alphaMode||J;if(d===K?(o.transparent=!0,o.depthWrite=!1):(o.transparent=!1,d===X&&(o.alphaTest=void 0!==a.alphaCutoff?a.alphaCutoff:.5)),void 0!==a.normalTexture&&t!==h.vBJ&&(s.push(n.assignTexture(o,"normalMap",a.normalTexture)),o.normalScale=new h.FM8(1,1),void 0!==a.normalTexture.scale)){var f=a.normalTexture.scale;o.normalScale.set(f,f)}return void 0!==a.occlusionTexture&&t!==h.vBJ&&(s.push(n.assignTexture(o,"aoMap",a.occlusionTexture)),void 0!==a.occlusionTexture.strength&&(o.aoMapIntensity=a.occlusionTexture.strength)),void 0!==a.emissiveFactor&&t!==h.vBJ&&(o.emissive=(new h.Ilk).fromArray(a.emissiveFactor)),void 0!==a.emissiveTexture&&t!==h.vBJ&&s.push(n.assignTexture(o,"emissiveMap",a.emissiveTexture,h.knz)),Promise.all(s).then((function(){var i=new t(o);return a.name&&(i.name=a.name),ee(i,a),n.associations.set(i,{materials:e}),a.extensions&&$(r,i,a),i}))}},{key:"createUniqueName",value:function(e){for(var t=h.iUV.sanitizeNodeName(e||""),n=t,i=1;this.nodeNamesUsed[n];++i)n=t+"_"+i;return this.nodeNamesUsed[n]=!0,n}},{key:"loadGeometries",value:function(e){var t=this,n=this.extensions,i=this.primitiveCache;function r(e){return n[g.KHR_DRACO_MESH_COMPRESSION].decodePrimitive(e,t).then((function(n){return se(n,e,t)}))}for(var a=[],o=0,s=e.length;o<s;o++){var l=e[o],u=ne(l),c=i[u];if(c)a.push(c.promise);else{var d=void 0;d=l.extensions&&l.extensions[g.KHR_DRACO_MESH_COMPRESSION]?r(l):se(new h.u9r,l,t),i[u]={primitive:l,promise:d},a.push(d)}}return Promise.all(a)}},{key:"loadMesh",value:function(e){for(var t,n=this,i=this.json,r=this.extensions,a=i.meshes[e],o=a.primitives,s=[],l=0,u=o.length;l<u;l++){var c=void 0===o[l].material?(void 0===(t=this.cache).DefaultMaterial&&(t.DefaultMaterial=new h.Wid({color:16777215,emissive:0,metalness:1,roughness:1,transparent:!1,depthTest:!0,side:h.Wl3})),t.DefaultMaterial):this.getDependency("material",o[l].material);s.push(c)}return s.push(n.loadGeometries(o)),Promise.all(s).then((function(t){for(var i=t.slice(0,t.length-1),s=t[t.length-1],l=[],u=0,c=s.length;u<c;u++){var f=s[u],p=o[u],A=void 0,v=i[u];if(p.mode===O.TRIANGLES||p.mode===O.TRIANGLE_STRIP||p.mode===O.TRIANGLE_FAN||void 0===p.mode)!0!==(A=!0===a.isSkinnedMesh?new h.TUv(f,v):new h.Kj0(f,v)).isSkinnedMesh||A.geometry.attributes.skinWeight.normalized||A.normalizeSkinWeights(),p.mode===O.TRIANGLE_STRIP?A.geometry=(0,d.Vs)(A.geometry,h.UlW):p.mode===O.TRIANGLE_FAN&&(A.geometry=(0,d.Vs)(A.geometry,h.z$h));else if(p.mode===O.LINES)A=new h.ejS(f,v);else if(p.mode===O.LINE_STRIP)A=new h.x12(f,v);else if(p.mode===O.LINE_LOOP)A=new h.blk(f,v);else{if(p.mode!==O.POINTS)throw new Error("THREE.GLTFLoader: Primitive mode unsupported: "+p.mode);A=new h.woe(f,v)}Object.keys(A.geometry.morphAttributes).length>0&&te(A,a),A.name=n.createUniqueName(a.name||"mesh_"+e),ee(A,a),p.extensions&&$(r,A,p),n.assignFinalMaterial(A),l.push(A)}for(var g=0,m=l.length;g<m;g++)n.associations.set(l[g],{meshes:e,primitives:g});if(1===l.length)return l[0];var y=new h.ZAu;n.associations.set(y,{meshes:e});for(var x=0,w=l.length;x<w;x++)y.add(l[x]);return y}))}},{key:"loadCamera",value:function(e){var t,n=this.json.cameras[e],i=n[n.type];if(i)return"perspective"===n.type?t=new h.cPb(h.M8C.radToDeg(i.yfov),i.aspectRatio||1,i.znear||1,i.zfar||2e6):"orthographic"===n.type&&(t=new h.iKG(-i.xmag,i.xmag,i.ymag,-i.ymag,i.znear,i.zfar)),n.name&&(t.name=this.createUniqueName(n.name)),ee(t,n),Promise.resolve(t);console.warn("THREE.GLTFLoader: Missing camera parameters.")}},{key:"loadSkin",value:function(e){for(var t=this.json.skins[e],n=[],i=0,r=t.joints.length;i<r;i++)n.push(this.getDependency("node",t.joints[i]));return void 0!==t.inverseBindMatrices?n.push(this.getDependency("accessor",t.inverseBindMatrices)):n.push(null),Promise.all(n).then((function(e){for(var n=e.pop(),i=e,r=[],a=[],o=0,s=i.length;o<s;o++){var l=i[o];if(l){r.push(l);var u=new h.yGw;null!==n&&u.fromArray(n.array,16*o),a.push(u)}else console.warn('THREE.GLTFLoader: Joint "%s" could not be found.',t.joints[o])}return new h.OdW(r,a)}))}},{key:"loadAnimation",value:function(e){for(var t=this.json.animations[e],n=[],i=[],r=[],a=[],o=[],s=0,l=t.channels.length;s<l;s++){var u=t.channels[s],c=t.samplers[u.sampler],d=u.target,f=d.node,p=void 0!==t.parameters?t.parameters[c.input]:c.input,A=void 0!==t.parameters?t.parameters[c.output]:c.output;n.push(this.getDependency("node",f)),i.push(this.getDependency("accessor",p)),r.push(this.getDependency("accessor",A)),a.push(c),o.push(d)}return Promise.all([Promise.all(n),Promise.all(i),Promise.all(r),Promise.all(a),Promise.all(o)]).then((function(n){for(var i=n[0],r=n[1],a=n[2],o=n[3],s=n[4],l=[],u=function(){var e,t=i[c],n=r[c],u=a[c],d=o[c],f=s[c];if(void 0===t)return"continue";switch(t.updateMatrix(),q[f.path]){case q.weights:e=h.dUE;break;case q.rotation:e=h.iLg;break;default:e=h.yC1}var p=t.name?t.name:t.uuid,A=void 0!==d.interpolation?Y[d.interpolation]:h.NMF,v=[];q[f.path]===q.weights?t.traverse((function(e){e.morphTargetInfluences&&v.push(e.name?e.name:e.uuid)})):v.push(p);var g=u.array;if(u.normalized){for(var m=re(g.constructor),y=new Float32Array(g.length),x=0,w=g.length;x<w;x++)y[x]=g[x]*m;g=y}for(var C=0,b=v.length;C<b;C++){var _=new e(v[C]+"."+q[f.path],n.array,g,A);"CUBICSPLINE"===d.interpolation&&(_.createInterpolant=function(e){return new(this instanceof h.iLg?j:F)(this.times,this.values,this.getValueSize()/3,e)},_.createInterpolant.isInterpolantFactoryMethodGLTFCubicSpline=!0),l.push(_)}},c=0,d=i.length;c<d;c++)u();var f=t.name?t.name:"animation_"+e;return new h.m7l(f,void 0,l)}))}},{key:"createNodeMesh",value:function(e){var t=this.json,n=this,i=t.nodes[e];return void 0===i.mesh?null:n.getDependency("mesh",i.mesh).then((function(e){var t=n._getNodeRef(n.meshCache,i.mesh,e);return void 0!==i.weights&&t.traverse((function(e){if(e.isMesh)for(var t=0,n=i.weights.length;t<n;t++)e.morphTargetInfluences[t]=i.weights[t]})),t}))}},{key:"loadNode",value:function(e){var t=this.json,n=this.extensions,i=this,r=t.nodes[e],a=r.name?i.createUniqueName(r.name):"";return function(){var t=[],n=i._invokeOne((function(t){return t.createNodeMesh&&t.createNodeMesh(e)}));n&&t.push(n),void 0!==r.camera&&t.push(i.getDependency("camera",r.camera).then((function(e){return i._getNodeRef(i.cameraCache,r.camera,e)}))),i._invokeAll((function(t){return t.createNodeAttachment&&t.createNodeAttachment(e)})).forEach((function(e){t.push(e)}));for(var a=[],o=r.children||[],s=0,l=o.length;s<l;s++)a.push(i.getDependency("node",o[s]));var u=void 0===r.skin?Promise.resolve(null):i.getDependency("skin",r.skin);return Promise.all([Promise.all(t),Promise.all(a),u])}().then((function(t){var o,s=t[0],l=t[1],u=t[2];if((o=!0===r.isBone?new h.N$j:s.length>1?new h.ZAu:1===s.length?s[0]:new h.Tme)!==s[0])for(var c=0,d=s.length;c<d;c++)o.add(s[c]);if(r.name&&(o.userData.name=r.name,o.name=a),ee(o,r),r.extensions&&$(n,o,r),void 0!==r.matrix){var f=new h.yGw;f.fromArray(r.matrix),o.applyMatrix4(f)}else void 0!==r.translation&&o.position.fromArray(r.translation),void 0!==r.rotation&&o.quaternion.fromArray(r.rotation),void 0!==r.scale&&o.scale.fromArray(r.scale);i.associations.has(o)||i.associations.set(o,{}),i.associations.get(o).nodes=e,null!==u&&o.traverse((function(e){e.isSkinnedMesh&&e.bind(u,ae)}));for(var p=0,A=l.length;p<A;p++)o.add(l[p]);return o}))}},{key:"loadScene",value:function(e){var t=this.extensions,n=this.json.scenes[e],r=this,a=new h.ZAu;n.name&&(a.name=r.createUniqueName(n.name)),ee(a,n),n.extensions&&$(t,a,n);for(var s=n.nodes||[],l=[],u=0,c=s.length;u<c;u++)l.push(r.getDependency("node",s[u]));return Promise.all(l).then((function(e){for(var t=0,n=e.length;t<n;t++)a.add(e[t]);return r.associations=function(e){var t,n=new Map,a=(0,o.Z)(r.associations);try{for(a.s();!(t=a.n()).done;){var s=(0,i.Z)(t.value,2),l=s[0],u=s[1];(l instanceof h.F5T||l instanceof h.xEZ)&&n.set(l,u)}}catch(c){a.e(c)}finally{a.f()}return e.traverse((function(e){var t=r.associations.get(e);null!=t&&n.set(e,t)})),n}(a),a}))}}]),e}();function se(e,t,n){var i=t.attributes,r=[];function a(t,i){return n.getDependency("accessor",t).then((function(t){e.setAttribute(i,t)}))}for(var o in i){var s=W[o]||o.toLowerCase();s in e.attributes||r.push(a(i[o],s))}if(void 0!==t.indices&&!e.index){var l=n.getDependency("accessor",t.indices).then((function(t){e.setIndex(t)}));r.push(l)}return ee(e,t),function(e,t,n){var i=t.attributes,r=new h.ZzF;if(void 0!==i.POSITION){var a=n.json.accessors[i.POSITION],o=a.min,s=a.max;if(void 0!==o&&void 0!==s){if(r.set(new h.Pa4(o[0],o[1],o[2]),new h.Pa4(s[0],s[1],s[2])),a.normalized){var l=re(z[a.componentType]);r.min.multiplyScalar(l),r.max.multiplyScalar(l)}var u=t.targets;if(void 0!==u){for(var c=new h.Pa4,d=new h.Pa4,f=0,p=u.length;f<p;f++){var A=u[f];if(void 0!==A.POSITION){var v=n.json.accessors[A.POSITION],g=v.min,m=v.max;if(void 0!==g&&void 0!==m){if(d.setX(Math.max(Math.abs(g[0]),Math.abs(m[0]))),d.setY(Math.max(Math.abs(g[1]),Math.abs(m[1]))),d.setZ(Math.max(Math.abs(g[2]),Math.abs(m[2]))),v.normalized){var y=re(z[v.componentType]);d.multiplyScalar(y)}c.max(d)}else console.warn("THREE.GLTFLoader: Missing min/max properties for accessor POSITION.")}}r.expandByVector(c)}e.boundingBox=r;var x=new h.aLr;r.getCenter(x.center),x.radius=r.min.distanceTo(r.max)/2,e.boundingSphere=x}else console.warn("THREE.GLTFLoader: Missing min/max properties for accessor POSITION.")}}(e,t,n),Promise.all(r).then((function(){return void 0!==t.targets?function(e,t,n){for(var i=!1,r=!1,a=!1,o=0,s=t.length;o<s;o++){var l=t[o];if(void 0!==l.POSITION&&(i=!0),void 0!==l.NORMAL&&(r=!0),void 0!==l.COLOR_0&&(a=!0),i&&r&&a)break}if(!i&&!r&&!a)return Promise.resolve(e);for(var u=[],c=[],h=[],d=0,f=t.length;d<f;d++){var p=t[d];if(i){var A=void 0!==p.POSITION?n.getDependency("accessor",p.POSITION):e.attributes.position;u.push(A)}if(r){var v=void 0!==p.NORMAL?n.getDependency("accessor",p.NORMAL):e.attributes.normal;c.push(v)}if(a){var g=void 0!==p.COLOR_0?n.getDependency("accessor",p.COLOR_0):e.attributes.color;h.push(g)}}return Promise.all([Promise.all(u),Promise.all(c),Promise.all(h)]).then((function(t){var n=t[0],o=t[1],s=t[2];return i&&(e.morphAttributes.position=n),r&&(e.morphAttributes.normal=o),a&&(e.morphAttributes.color=s),e.morphTargetsRelative=!0,e}))}(e,t.targets,n):e}))}},70995:function(e,t,n){n.r(t),n.d(t,{KTX2Loader:function(){return R}});var i=n(4942),r=n(37762),a=n(74165),o=n(15861),s=n(29439),l=n(15671),u=n(43144),c=n(60136),h=n(29388),d=n(70804),f=function(){function e(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:4;(0,l.Z)(this,e),this.pool=t,this.queue=[],this.workers=[],this.workersResolve=[],this.workerStatus=0}return(0,u.Z)(e,[{key:"_initWorker",value:function(e){if(!this.workers[e]){var t=this.workerCreator();t.addEventListener("message",this._onMessage.bind(this,e)),this.workers[e]=t}}},{key:"_getIdleWorker",value:function(){for(var e=0;e<this.pool;e++)if(!(this.workerStatus&1<<e))return e;return-1}},{key:"_onMessage",value:function(e,t){var n=this.workersResolve[e];if(n&&n(t),this.queue.length){var i=this.queue.shift(),r=i.resolve,a=i.msg,o=i.transfer;this.workersResolve[e]=r,this.workers[e].postMessage(a,o)}else this.workerStatus^=1<<e}},{key:"setWorkerCreator",value:function(e){this.workerCreator=e}},{key:"setWorkerLimit",value:function(e){this.pool=e}},{key:"postMessage",value:function(e,t){var n=this;return new Promise((function(i){var r=n._getIdleWorker();-1!==r?(n._initWorker(r),n.workerStatus|=1<<r,n.workersResolve[r]=i,n.workers[r].postMessage(e,t)):n.queue.push({resolve:i,msg:e,transfer:t})}))}},{key:"dispose",value:function(){this.workers.forEach((function(e){return e.terminate()})),this.workersResolve.length=0,this.workers.length=0,this.queue.length=0,this.workerStatus=0}}]),e}(),p=0,A=2,v=(0,u.Z)((function e(){(0,l.Z)(this,e),this.vkFormat=0,this.typeSize=1,this.pixelWidth=0,this.pixelHeight=0,this.pixelDepth=0,this.layerCount=0,this.faceCount=1,this.supercompressionScheme=0,this.levels=[],this.dataFormatDescriptor=[{vendorId:0,descriptorType:0,descriptorBlockSize:0,versionNumber:2,colorModel:0,colorPrimaries:1,transferFunction:2,flags:0,texelBlockDimension:[0,0,0,0],bytesPlane:[0,0,0,0,0,0,0,0],samples:[]}],this.keyValue={},this.globalData=null})),g=function(){function e(t,n,i,r){(0,l.Z)(this,e),this._dataView=new DataView(t.buffer,t.byteOffset+n,i),this._littleEndian=r,this._offset=0}return(0,u.Z)(e,[{key:"_nextUint8",value:function(){var e=this._dataView.getUint8(this._offset);return this._offset+=1,e}},{key:"_nextUint16",value:function(){var e=this._dataView.getUint16(this._offset,this._littleEndian);return this._offset+=2,e}},{key:"_nextUint32",value:function(){var e=this._dataView.getUint32(this._offset,this._littleEndian);return this._offset+=4,e}},{key:"_nextUint64",value:function(){var e=this._dataView.getUint32(this._offset,this._littleEndian)+Math.pow(2,32)*this._dataView.getUint32(this._offset+4,this._littleEndian);return this._offset+=8,e}},{key:"_nextInt32",value:function(){var e=this._dataView.getInt32(this._offset,this._littleEndian);return this._offset+=4,e}},{key:"_skip",value:function(e){return this._offset+=e,this}},{key:"_scan",value:function(e){for(var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,n=this._offset,i=0;this._dataView.getUint8(this._offset)!==t&&i<e;)i++,this._offset++;return i<e&&this._offset++,new Uint8Array(this._dataView.buffer,this._dataView.byteOffset+n,i)}}]),e}(),m=(new Uint8Array([0]),[171,75,84,88,32,50,48,187,13,10,26,10]);function y(e){return"undefined"!=typeof TextDecoder?(new TextDecoder).decode(e):Buffer.from(e).toString("utf8")}function x(e){var t=new Uint8Array(e.buffer,e.byteOffset,m.length);if(t[0]!==m[0]||t[1]!==m[1]||t[2]!==m[2]||t[3]!==m[3]||t[4]!==m[4]||t[5]!==m[5]||t[6]!==m[6]||t[7]!==m[7]||t[8]!==m[8]||t[9]!==m[9]||t[10]!==m[10]||t[11]!==m[11])throw new Error("Missing KTX 2.0 identifier.");var n=new v,i=17*Uint32Array.BYTES_PER_ELEMENT,r=new g(e,m.length,i,!0);n.vkFormat=r._nextUint32(),n.typeSize=r._nextUint32(),n.pixelWidth=r._nextUint32(),n.pixelHeight=r._nextUint32(),n.pixelDepth=r._nextUint32(),n.layerCount=r._nextUint32(),n.faceCount=r._nextUint32();var a=r._nextUint32();n.supercompressionScheme=r._nextUint32();for(var o=r._nextUint32(),s=r._nextUint32(),l=r._nextUint32(),u=r._nextUint32(),c=r._nextUint64(),h=r._nextUint64(),d=new g(e,m.length+i,3*a*8,!0),f=0;f<a;f++)n.levels.push({levelData:new Uint8Array(e.buffer,e.byteOffset+d._nextUint64(),d._nextUint64()),uncompressedByteLength:d._nextUint64()});for(var p=new g(e,o,s,!0),A={vendorId:p._skip(4)._nextUint16(),descriptorType:p._nextUint16(),versionNumber:p._nextUint16(),descriptorBlockSize:p._nextUint16(),colorModel:p._nextUint8(),colorPrimaries:p._nextUint8(),transferFunction:p._nextUint8(),flags:p._nextUint8(),texelBlockDimension:[p._nextUint8(),p._nextUint8(),p._nextUint8(),p._nextUint8()],bytesPlane:[p._nextUint8(),p._nextUint8(),p._nextUint8(),p._nextUint8(),p._nextUint8(),p._nextUint8(),p._nextUint8(),p._nextUint8()],samples:[]},x=(A.descriptorBlockSize/4-6)/4,w=0;w<x;w++){var C={bitOffset:p._nextUint16(),bitLength:p._nextUint8(),channelType:p._nextUint8(),samplePosition:[p._nextUint8(),p._nextUint8(),p._nextUint8(),p._nextUint8()],sampleLower:-1/0,sampleUpper:1/0};64&C.channelType?(C.sampleLower=p._nextInt32(),C.sampleUpper=p._nextInt32()):(C.sampleLower=p._nextUint32(),C.sampleUpper=p._nextUint32()),A.samples[w]=C}n.dataFormatDescriptor.length=0,n.dataFormatDescriptor.push(A);for(var b=new g(e,l,u,!0);b._offset<u;){var _=b._nextUint32(),E=b._scan(_),M=y(E),I=b._scan(_-E.byteLength);n.keyValue[M]=M.match(/^ktx/i)?y(I):I,b._offset%4&&b._skip(4-b._offset%4)}if(h<=0)return n;for(var S=new g(e,c,h,!0),k=S._nextUint16(),B=S._nextUint16(),T=S._nextUint32(),D=S._nextUint32(),R=S._nextUint32(),P=S._nextUint32(),L=[],Q=0;Q<a;Q++)L.push({imageFlags:S._nextUint32(),rgbSliceByteOffset:S._nextUint32(),rgbSliceByteLength:S._nextUint32(),alphaSliceByteOffset:S._nextUint32(),alphaSliceByteLength:S._nextUint32()});var Z=c+S._offset,N=Z+T,F=N+D,U=F+R,j=new Uint8Array(e.buffer,e.byteOffset+Z,T),O=new Uint8Array(e.buffer,e.byteOffset+N,D),z=new Uint8Array(e.buffer,e.byteOffset+F,R),G=new Uint8Array(e.buffer,e.byteOffset+U,P);return n.globalData={endpointCount:k,selectorCount:B,imageDescs:L,endpointsData:j,selectorsData:O,tablesData:z,extendedData:G},n}var w,C,b;var _,E,M,I,S={env:{emscripten_notify_memory_growth:function(e){b=new Uint8Array(C.exports.memory.buffer)}}},k=function(){function e(){(0,l.Z)(this,e)}return(0,u.Z)(e,[{key:"init",value:function(){return w||(w="undefined"!=typeof fetch?fetch("data:application/wasm;base64,"+B).then((function(e){return e.arrayBuffer()})).then((function(e){return WebAssembly.instantiate(e,S)})).then(this._init):WebAssembly.instantiate(Buffer.from(B,"base64"),S).then(this._init),w)}},{key:"_init",value:function(e){C=e.instance,S.env.emscripten_notify_memory_growth(0)}},{key:"decode",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;if(!C)throw new Error("ZSTDDecoder: Await .init() before decoding.");var n=e.byteLength,i=C.exports.malloc(n);b.set(e,i),t=t||Number(C.exports.ZSTD_findDecompressedSize(i,n));var r=C.exports.malloc(t),a=C.exports.ZSTD_decompress(r,t,i,n),o=b.slice(r,r+a);return C.exports.free(i),C.exports.free(r),o}}]),e}(),B="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IAMNACAEQQNxBEADQCACRQ0FIAAgAkF/aiICaiIDIAEgAmotAAA6AAAgA0EDcQ0ACwsgAkEDTQ0AA0AgACACQXxqIgJqIAEgAmooAgA2AgAgAkEDSw0ACwsgAkUNAgNAIAAgAkF/aiICaiABIAJqLQAAOgAAIAINAAsMAgsgAkEDTQ0AIAIhBANAIAMgASgCADYCACABQQRqIQEgA0EEaiEDIARBfGoiBEEDSw0ACyACQQNxIQILIAJFDQADQCADIAEtAAA6AAAgA0EBaiEDIAFBAWohASACQX9qIgINAAsLIAAL8wICAn8BfgJAIAJFDQAgACACaiIDQX9qIAE6AAAgACABOgAAIAJBA0kNACADQX5qIAE6AAAgACABOgABIANBfWogAToAACAAIAE6AAIgAkEHSQ0AIANBfGogAToAACAAIAE6AAMgAkEJSQ0AIABBACAAa0EDcSIEaiIDIAFB/wFxQYGChAhsIgE2AgAgAyACIARrQXxxIgRqIgJBfGogATYCACAEQQlJDQAgAyABNgIIIAMgATYCBCACQXhqIAE2AgAgAkF0aiABNgIAIARBGUkNACADIAE2AhggAyABNgIUIAMgATYCECADIAE2AgwgAkFwaiABNgIAIAJBbGogATYCACACQWhqIAE2AgAgAkFkaiABNgIAIAQgA0EEcUEYciIEayICQSBJDQAgAa0iBUIghiAFhCEFIAMgBGohAQNAIAEgBTcDGCABIAU3AxAgASAFNwMIIAEgBTcDACABQSBqIQEgAkFgaiICQR9LDQALCyAACy8BAn8gACgCBCAAKAIAQQJ0aiICLQACIQMgACACLwEAIAEgAi0AAxAIajYCACADCy8BAn8gACgCBCAAKAIAQQJ0aiICLQACIQMgACACLwEAIAEgAi0AAxAFajYCACADCx8AIAAgASACKAIEEAg2AgAgARAEGiAAIAJBCGo2AgQLCAAgAGdBH3MLugUBDX8jAEEQayIKJAACfyAEQQNNBEAgCkEANgIMIApBDGogAyAEEAsaIAAgASACIApBDGpBBBAVIgBBbCAAEAMbIAAgACAESxsMAQsgAEEAIAEoAgBBAXRBAmoQECENQVQgAygAACIGQQ9xIgBBCksNABogAiAAQQVqNgIAIAMgBGoiAkF8aiEMIAJBeWohDiACQXtqIRAgAEEGaiELQQQhBSAGQQR2IQRBICAAdCIAQQFyIQkgASgCACEPQQAhAiADIQYCQANAIAlBAkggAiAPS3JFBEAgAiEHAkAgCARAA0AgBEH//wNxQf//A0YEQCAHQRhqIQcgBiAQSQR/IAZBAmoiBigAACAFdgUgBUEQaiEFIARBEHYLIQQMAQsLA0AgBEEDcSIIQQNGBEAgBUECaiEFIARBAnYhBCAHQQNqIQcMAQsLIAcgCGoiByAPSw0EIAVBAmohBQNAIAIgB0kEQCANIAJBAXRqQQA7AQAgAkEBaiECDAELCyAGIA5LQQAgBiAFQQN1aiIHIAxLG0UEQCAHKAAAIAVBB3EiBXYhBAwCCyAEQQJ2IQQLIAYhBwsCfyALQX9qIAQgAEF/anEiBiAAQQF0QX9qIgggCWsiEUkNABogBCAIcSIEQQAgESAEIABIG2shBiALCyEIIA0gAkEBdGogBkF/aiIEOwEAIAlBASAGayAEIAZBAUgbayEJA0AgCSAASARAIABBAXUhACALQX9qIQsMAQsLAn8gByAOS0EAIAcgBSAIaiIFQQN1aiIGIAxLG0UEQCAFQQdxDAELIAUgDCIGIAdrQQN0awshBSACQQFqIQIgBEUhCCAGKAAAIAVBH3F2IQQMAQsLQWwgCUEBRyAFQSBKcg0BGiABIAJBf2o2AgAgBiAFQQdqQQN1aiADawwBC0FQCyEAIApBEGokACAACwkAQQFBBSAAGwsMACAAIAEoAAA2AAALqgMBCn8jAEHwAGsiCiQAIAJBAWohDiAAQQhqIQtBgIAEIAVBf2p0QRB1IQxBACECQQEhBkEBIAV0IglBf2oiDyEIA0AgAiAORkUEQAJAIAEgAkEBdCINai8BACIHQf//A0YEQCALIAhBA3RqIAI2AgQgCEF/aiEIQQEhBwwBCyAGQQAgDCAHQRB0QRB1ShshBgsgCiANaiAHOwEAIAJBAWohAgwBCwsgACAFNgIEIAAgBjYCACAJQQN2IAlBAXZqQQNqIQxBACEAQQAhBkEAIQIDQCAGIA5GBEADQAJAIAAgCUYNACAKIAsgAEEDdGoiASgCBCIGQQF0aiICIAIvAQAiAkEBajsBACABIAUgAhAUayIIOgADIAEgAiAIQf8BcXQgCWs7AQAgASAEIAZBAnQiAmooAgA6AAIgASACIANqKAIANgIEIABBAWohAAwBCwsFIAEgBkEBdGouAQAhDUEAIQcDQCAHIA1ORQRAIAsgAkEDdGogBjYCBANAIAIgDGogD3EiAiAISw0ACyAHQQFqIQcMAQsLIAZBAWohBgwBCwsgCkHwAGokAAsjAEIAIAEQCSAAhUKHla+vmLbem55/fkLj3MqV/M7y9YV/fAsQACAAQn43AwggACABNgIACyQBAX8gAARAIAEoAgQiAgRAIAEoAgggACACEQEADwsgABAmCwsfACAAIAEgAi8BABAINgIAIAEQBBogACACQQRqNgIEC0oBAX9BoCAoAgAiASAAaiIAQX9MBEBBiCBBMDYCAEF/DwsCQCAAPwBBEHRNDQAgABBmDQBBiCBBMDYCAEF/DwtBoCAgADYCACABC9cBAQh/Qbp/IQoCQCACKAIEIgggAigCACIJaiIOIAEgAGtLDQBBbCEKIAkgBCADKAIAIgtrSw0AIAAgCWoiBCACKAIIIgxrIQ0gACABQWBqIg8gCyAJQQAQKSADIAkgC2o2AgACQAJAIAwgBCAFa00EQCANIQUMAQsgDCAEIAZrSw0CIAcgDSAFayIAaiIBIAhqIAdNBEAgBCABIAgQDxoMAgsgBCABQQAgAGsQDyEBIAIgACAIaiIINgIEIAEgAGshBAsgBCAPIAUgCEEBECkLIA4hCgsgCgubAgEBfyMAQYABayINJAAgDSADNgJ8AkAgAkEDSwRAQX8hCQwBCwJAAkACQAJAIAJBAWsOAwADAgELIAZFBEBBuH8hCQwEC0FsIQkgBS0AACICIANLDQMgACAHIAJBAnQiAmooAgAgAiAIaigCABA7IAEgADYCAEEBIQkMAwsgASAJNgIAQQAhCQwCCyAKRQRAQWwhCQwCC0EAIQkgC0UgDEEZSHINAUEIIAR0QQhqIQBBACECA0AgAiAATw0CIAJBQGshAgwAAAsAC0FsIQkgDSANQfwAaiANQfgAaiAFIAYQFSICEAMNACANKAJ4IgMgBEsNACAAIA0gDSgCfCAHIAggAxAYIAEgADYCACACIQkLIA1BgAFqJAAgCQsLACAAIAEgAhALGgsQACAALwAAIAAtAAJBEHRyCy8AAn9BuH8gAUEISQ0AGkFyIAAoAAQiAEF3Sw0AGkG4fyAAQQhqIgAgACABSxsLCwkAIAAgATsAAAsDAAELigYBBX8gACAAKAIAIgVBfnE2AgBBACAAIAVBAXZqQYQgKAIAIgQgAEYbIQECQAJAIAAoAgQiAkUNACACKAIAIgNBAXENACACQQhqIgUgA0EBdkF4aiIDQQggA0EISxtnQR9zQQJ0QYAfaiIDKAIARgRAIAMgAigCDDYCAAsgAigCCCIDBEAgAyACKAIMNgIECyACKAIMIgMEQCADIAIoAgg2AgALIAIgAigCACAAKAIAQX5xajYCAEGEICEAAkACQCABRQ0AIAEgAjYCBCABKAIAIgNBAXENASADQQF2QXhqIgNBCCADQQhLG2dBH3NBAnRBgB9qIgMoAgAgAUEIakYEQCADIAEoAgw2AgALIAEoAggiAwRAIAMgASgCDDYCBAsgASgCDCIDBEAgAyABKAIINgIAQYQgKAIAIQQLIAIgAigCACABKAIAQX5xajYCACABIARGDQAgASABKAIAQQF2akEEaiEACyAAIAI2AgALIAIoAgBBAXZBeGoiAEEIIABBCEsbZ0Efc0ECdEGAH2oiASgCACEAIAEgBTYCACACIAA2AgwgAkEANgIIIABFDQEgACAFNgIADwsCQCABRQ0AIAEoAgAiAkEBcQ0AIAJBAXZBeGoiAkEIIAJBCEsbZ0Efc0ECdEGAH2oiAigCACABQQhqRgRAIAIgASgCDDYCAAsgASgCCCICBEAgAiABKAIMNgIECyABKAIMIgIEQCACIAEoAgg2AgBBhCAoAgAhBAsgACAAKAIAIAEoAgBBfnFqIgI2AgACQCABIARHBEAgASABKAIAQQF2aiAANgIEIAAoAgAhAgwBC0GEICAANgIACyACQQF2QXhqIgFBCCABQQhLG2dBH3NBAnRBgB9qIgIoAgAhASACIABBCGoiAjYCACAAIAE2AgwgAEEANgIIIAFFDQEgASACNgIADwsgBUEBdkF4aiIBQQggAUEISxtnQR9zQQJ0QYAfaiICKAIAIQEgAiAAQQhqIgI2AgAgACABNgIMIABBADYCCCABRQ0AIAEgAjYCAAsLDgAgAARAIABBeGoQJQsLgAIBA38CQCAAQQ9qQXhxQYQgKAIAKAIAQQF2ayICEB1Bf0YNAAJAQYQgKAIAIgAoAgAiAUEBcQ0AIAFBAXZBeGoiAUEIIAFBCEsbZ0Efc0ECdEGAH2oiASgCACAAQQhqRgRAIAEgACgCDDYCAAsgACgCCCIBBEAgASAAKAIMNgIECyAAKAIMIgFFDQAgASAAKAIINgIAC0EBIQEgACAAKAIAIAJBAXRqIgI2AgAgAkEBcQ0AIAJBAXZBeGoiAkEIIAJBCEsbZ0Efc0ECdEGAH2oiAygCACECIAMgAEEIaiIDNgIAIAAgAjYCDCAAQQA2AgggAkUNACACIAM2AgALIAELtwIBA38CQAJAIABBASAAGyICEDgiAA0AAkACQEGEICgCACIARQ0AIAAoAgAiA0EBcQ0AIAAgA0EBcjYCACADQQF2QXhqIgFBCCABQQhLG2dBH3NBAnRBgB9qIgEoAgAgAEEIakYEQCABIAAoAgw2AgALIAAoAggiAQRAIAEgACgCDDYCBAsgACgCDCIBBEAgASAAKAIINgIACyACECchAkEAIQFBhCAoAgAhACACDQEgACAAKAIAQX5xNgIAQQAPCyACQQ9qQXhxIgMQHSICQX9GDQIgAkEHakF4cSIAIAJHBEAgACACaxAdQX9GDQMLAkBBhCAoAgAiAUUEQEGAICAANgIADAELIAAgATYCBAtBhCAgADYCACAAIANBAXRBAXI2AgAMAQsgAEUNAQsgAEEIaiEBCyABC7kDAQJ/IAAgA2ohBQJAIANBB0wEQANAIAAgBU8NAiAAIAItAAA6AAAgAEEBaiEAIAJBAWohAgwAAAsACyAEQQFGBEACQCAAIAJrIgZBB00EQCAAIAItAAA6AAAgACACLQABOgABIAAgAi0AAjoAAiAAIAItAAM6AAMgAEEEaiACIAZBAnQiBkHAHmooAgBqIgIQFyACIAZB4B5qKAIAayECDAELIAAgAhAMCyACQQhqIQIgAEEIaiEACwJAAkACQAJAIAUgAU0EQCAAIANqIQEgBEEBRyAAIAJrQQ9Kcg0BA0AgACACEAwgAkEIaiECIABBCGoiACABSQ0ACwwFCyAAIAFLBEAgACEBDAQLIARBAUcgACACa0EPSnINASAAIQMgAiEEA0AgAyAEEAwgBEEIaiEEIANBCGoiAyABSQ0ACwwCCwNAIAAgAhAHIAJBEGohAiAAQRBqIgAgAUkNAAsMAwsgACEDIAIhBANAIAMgBBAHIARBEGohBCADQRBqIgMgAUkNAAsLIAIgASAAa2ohAgsDQCABIAVPDQEgASACLQAAOgAAIAFBAWohASACQQFqIQIMAAALAAsLQQECfyAAIAAoArjgASIDNgLE4AEgACgCvOABIQQgACABNgK84AEgACABIAJqNgK44AEgACABIAQgA2tqNgLA4AELpgEBAX8gACAAKALs4QEQFjYCyOABIABCADcD+OABIABCADcDuOABIABBwOABakIANwMAIABBqNAAaiIBQYyAgOAANgIAIABBADYCmOIBIABCADcDiOEBIABCAzcDgOEBIABBrNABakHgEikCADcCACAAQbTQAWpB6BIoAgA2AgAgACABNgIMIAAgAEGYIGo2AgggACAAQaAwajYCBCAAIABBEGo2AgALYQEBf0G4fyEDAkAgAUEDSQ0AIAIgABAhIgFBA3YiADYCCCACIAFBAXE2AgQgAiABQQF2QQNxIgM2AgACQCADQX9qIgFBAksNAAJAIAFBAWsOAgEAAgtBbA8LIAAhAwsgAwsMACAAIAEgAkEAEC4LiAQCA38CfiADEBYhBCAAQQBBKBAQIQAgBCACSwRAIAQPCyABRQRAQX8PCwJAAkAgA0EBRg0AIAEoAAAiBkGo6r5pRg0AQXYhAyAGQXBxQdDUtMIBRw0BQQghAyACQQhJDQEgAEEAQSgQECEAIAEoAAQhASAAQQE2AhQgACABrTcDAEEADwsgASACIAMQLyIDIAJLDQAgACADNgIYQXIhAyABIARqIgVBf2otAAAiAkEIcQ0AIAJBIHEiBkUEQEFwIQMgBS0AACIFQacBSw0BIAVBB3GtQgEgBUEDdkEKaq2GIgdCA4h+IAd8IQggBEEBaiEECyACQQZ2IQMgAkECdiEFAkAgAkEDcUF/aiICQQJLBEBBACECDAELAkACQAJAIAJBAWsOAgECAAsgASAEai0AACECIARBAWohBAwCCyABIARqLwAAIQIgBEECaiEEDAELIAEgBGooAAAhAiAEQQRqIQQLIAVBAXEhBQJ+AkACQAJAIANBf2oiA0ECTQRAIANBAWsOAgIDAQtCfyAGRQ0DGiABIARqMQAADAMLIAEgBGovAACtQoACfAwCCyABIARqKAAArQwBCyABIARqKQAACyEHIAAgBTYCICAAIAI2AhwgACAHNwMAQQAhAyAAQQA2AhQgACAHIAggBhsiBzcDCCAAIAdCgIAIIAdCgIAIVBs+AhALIAMLWwEBf0G4fyEDIAIQFiICIAFNBH8gACACakF/ai0AACIAQQNxQQJ0QaAeaigC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C0Egak8NAQsgByAHKQNoNwMQIAcgBykDYDcDCCAEIA0gB0EIaiAHQdwAaiAPIA4gESAQEB4hCwwBCyACIARqIQggBCAKEAcgAkERTwRAIARBEGohAgNAIAIgCkEQaiIKEAcgAkEQaiICIAhJDQALCyAIIAlrIQIgByATNgJcIAkgCCAOa0sEQCAJIAggEWtLBEBBbCELDAILIBAgAiAOayICaiIKIANqIBBNBEAgCCAKIAMQDxoMAgsgCCAKQQAgAmsQDyEIIAcgAiADaiIDNgJkIAggAmshCCAOIQILIAlBEE8EQCADIAhqIQMDQCAIIAIQByACQRBqIQIgCEEQaiIIIANJDQALDAELAkAgCUEHTQRAIAggAi0AADoAACAIIAItAAE6AAEgCCACLQACOgACIAggAi0AAzoAAyAIQQRqIAIgCUECdCIDQcAeaigCAGoiAhAXIAIgA0HgHmooAgBrIQIgBygCZCEDDAELIAggAhAMCyADQQlJDQAgAyAIaiEDIAhBCGoiCCACQQhqIgJrQQ9MBEADQCAIIAIQDCACQQhqIQIgCEEIaiIIIANJDQAMAgALAAsDQCAIIAIQByACQRBqIQIgCEEQaiIIIANJDQALCyAHQRhqEAQaIAsgDCALEAMiAhshDCAEIAQgC2ogAhshBCAFQX9qIgUNAAsgDBADDQFBbCEMIAdBGGoQBEECSQ0BQQAhCANAIAhBA0cEQCAAIAhBAnQiAmpBrNABaiACIAdqKAJENgIAIAhBAWohCAwBCwsgBygCXCEIC0G6fyEMIA8gCGsiACANIARrSw0AIAQEfyAEIAggABALIABqBUEACyABayEMCyAHQfAAaiQAIAwLkRcCFn8FfiMAQdABayIHJAAgByAAKALw4QEiCDYCvAEgASACaiESIAggACgCgOIBaiETAkACQCAFRQRAIAEhAwwBCyAAKALE4AEhESAAKALA4AEhFSAAKAK84AEhDyAAQQE2AozhAUEAIQgDQCAIQQNHBEAgByAIQQJ0IgJqIAAgAmpBrNABaigCADYCVCAIQQFqIQgMAQsLIAcgETYCZCAHIA82AmAgByABIA9rNgJoQWwhECAHQShqIAMgBBAGEAMNASAFQQQgBUEESBshFyAHQTxqIAdBKGogACgCABATIAdBxABqIAdBKGogACgCCBATIAdBzABqIAdB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IAdB0AFqJAAgEAslACAAQgA3AgAgAEEAOwEIIABBADoACyAAIAE2AgwgACACOgAKC7QFAQN/IwBBMGsiBCQAIABB/wFqIgVBfWohBgJAIAMvAQIEQCAEQRhqIAEgAhAGIgIQAw0BIARBEGogBEEYaiADEBwgBEEIaiAEQRhqIAMQHCAAIQMDQAJAIARBGGoQBCADIAZPckUEQCADIARBEGogBEEYahASOgAAIAMgBEEIaiAEQRhqEBI6AAEgBEEYahAERQ0BIANBAmohAwsgBUF+aiEFAn8DQEG6fyECIAMiASAFSw0FIAEgBEEQaiAEQRhqEBI6AAAgAUEBaiEDIARBGGoQBEEDRgRAQQIhAiAEQQhqDAILIAMgBUsNBSABIARBCGogBEEYahASOgABIAFBAmohA0EDIQIgBEEYahAEQQNHDQALIARBEGoLIQUgAyAFIARBGGoQEjoAACABIAJqIABrIQIMAwsgAyAEQRBqIARBGGoQEjoAAiADIARBCGogBEEYahASOgADIANBBGohAwwAAAsACyAEQRhqIAEgAhAGIgIQAw0AIARBEGogBEEYaiADEBwgBEEIaiAEQRhqIAMQHCAAIQMDQAJAIARBGGoQBCADIAZPckUEQCADIARBEGogBEEYahAROgAAIAMgBEEIaiAEQRhqEBE6AAEgBEEYahAERQ0BIANBAmohAwsgBUF+aiEFAn8DQEG6fyECIAMiASAFSw0EIAEgBEEQaiAEQRhqEBE6AAAgAUEBaiEDIARBGGoQBEEDRgRAQQIhAiAEQQhqDAILIAMgBUsNBCABIARBCGogBEEYahAROgABIAFBAmohA0EDIQIgBEEYahAEQQNHDQALIARBEGoLIQUgAyAFIARBGGoQEToAACABIAJqIABrIQIMAgsgAyAEQRBqIARBGGoQEToAAiADIARBCGogBEEYahAROgADIANBBGohAwwAAAsACyAEQTBqJAAgAgtpAQF/An8CQAJAIAJBB00NACABKAAAQbfIwuF+Rw0AIAAgASgABDYCmOIBQWIgAEEQaiABIAIQPiIDEAMNAhogAEKBgICAEDcDiOEBIAAgASADaiACIANrECoMAQsgACABIAIQKgtBAAsLrQMBBn8jAEGAAWsiAyQAQWIhCAJAIAJBCUkNACAAQZjQAGogAUEIaiIEIAJBeGogAEGY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wOABCwutAgIEfwF+IwBBQGoiBCQAAkACQCACQQhJDQAgASgAAEFwcUHQ1LTCAUcNACABIAIQIiEBIABCADcDCCAAQQA2AgQgACABNgIADAELIARBGGogASACEC0iAxADBEAgACADEBoMAQsgAwRAIABBuH8QGgwBCyACIAQoAjAiA2shAiABIANqIQMDQAJAIAAgAyACIARBCGoQLCIFEAMEfyAFBSACIAVBA2oiBU8NAUG4fwsQGgwCCyAGQQFqIQYgAiAFayECIAMgBWohAyAEKAIMRQ0ACyAEKAI4BEAgAkEDTQRAIABBuH8QGgwCCyADQQRqIQMLIAQoAighAiAEKQMYIQcgAEEANgIEIAAgAyABazYCACAAIAIgBmytIAcgB0J/URs3AwgLIARBQGskAAslAQF/IwBBEGsiAiQAIAIgACABEFEgAigCACEAIAJBEGokACAAC30BBH8jAEGQBGsiBCQAIARB/wE2AggCQCAEQRBqIARBCGogBEEMaiABIAIQFSIGEAMEQCAGIQUMAQtBVCEFIAQoAgwiB0EGSw0AIAMgBEEQaiAEKAIIIAcQQSIFEAMNACAAIAEgBmogAiAGayADEDwhBQsgBEGQBGokACAFC4cBAgJ/An5BABAWIQMCQANAIAEgA08EQAJAIAAoAABBcHFB0NS0wgFGBEAgACABECIiAhADRQ0BQn4PCyAAIAEQVSIEQn1WDQMgBCAFfCIFIARUIQJCfiEEIAINAyAAIAEQUiICEAMNAwsgASACayEBIAAgAmohAAwBCwtCfiAFIAEbIQQLIAQLPwIBfwF+IwBBMGsiAiQAAn5CfiACQQhqIAAgARAtDQAaQgAgAigCHEEBRg0AGiACKQMICyEDIAJBMGokACADC40BAQJ/IwBBMGsiASQAAkAgAEUNACAAKAKI4gENACABIABB/OEBaigCADYCKCABIAApAvThATcDICAAEDAgACgCqOIBIQIgASABKAIoNgIYIAEgASkDIDcDECACIAFBEGoQGyAAQQA2AqjiASABIAEoAig2AgggASABKQMgNwMAIAAgARAbCyABQTBqJAALKgECfyMAQRBrIgAkACAAQQA2AgggAEIANwMAIAAQWCEBIABBEGokACABC4cBAQN/IwBBEGsiAiQAAkAgACgCAEUgACgCBEVzDQAgAiAAKAIINgIIIAIgACkCADcDAAJ/IAIoAgAiAQRAIAIoAghBqOMJIAERBQAMAQtBqOMJECgLIgFFDQAgASAAKQIANwL04QEgAUH84QFqIAAoAgg2AgAgARBZIAEhAwsgAkEQaiQAIAMLywEBAn8jAEEgayIBJAAgAEGBgIDAADYCtOIBIABBADYCiOIBIABBADYC7OEBIABCADcDkOIBIABBADYCpOMJIABBADYC3OIBIABCADcCzOIBIABBADYCvOIBIABBADYCxOABIABCADcCnOIBIABBpOIBakIANwIAIABBrOIBakEANgIAIAFCADcCECABQgA3AhggASABKQMYNwMIIAEgASkDEDcDACABKAIIQQh2QQFxIQIgAEEANgLg4gEgACACNgKM4gEgAUEgaiQAC3YBA38jAEEwayIBJAAgAARAIAEgAEHE0AFqIgIoAgA2AiggASAAKQK80AE3AyAgACgCACEDIAEgAigCADYCGCABIAApArzQATcDECADIAFBEGoQGyABIAEoAig2AgggASABKQMgNwMAIAAgARAbCyABQTBqJAALzAEBAX8gACABKAK00AE2ApjiASAAIAEoAgQiAjYCwOABIAAgAjYCvOABIAAgAiABKAIIaiICNgK44AEgACACNgLE4AEgASgCuNABBEAgAEKBgICAEDcDiOEBIAAgAUGk0ABqNgIMIAAgAUGUIGo2AgggACABQZwwajYCBCAAIAFBDGo2AgAgAEGs0AFqIAFBqNABaigCADYCACAAQbDQAWogAUGs0AFqKAIANgIAIABBtNABaiABQbDQAWooAgA2AgAPCyAAQgA3A4jhAQs7ACACRQRAQbp/DwsgBEUEQEFsDwsgAiAEEGAEQCAAIAEgAiADIAQgBRBhDwsgACABIAIgAyAEIAUQZQtGAQF/IwBBEGsiBSQAIAVBCGogBBAOAn8gBS0ACQRAIAAgASACIAMgBBAyDAELIAAgASACIAMgBBA0CyEAIAVBEGokACAACzQAIAAgAyAEIAUQNiIFEAMEQCAFDwsgBSAESQR/IAEgAiADIAVqIAQgBWsgABA1BUG4fwsLRgEBfyMAQRBrIgUkACAFQQhqIAQQDgJ/IAUtAAkEQCAAIAEgAiADIAQQYgwBCyAAIAEgAiADIAQQNQshACAFQRBqJAAgAAtZAQF/QQ8hAiABIABJBEAgAUEE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",T=new WeakMap,D=0,R=function(e){(0,c.Z)(n,e);var t=(0,h.Z)(n);function n(e){var i;return(0,l.Z)(this,n),(i=t.call(this,e)).transcoderPath="",i.transcoderBinary=null,i.transcoderPending=null,i.workerPool=new f,i.workerSourceURL="",i.workerConfig=null,"undefined"!==typeof MSC_TRANSCODER&&console.warn('THREE.KTX2Loader: Please update to latest "basis_transcoder". "msc_basis_transcoder" is no longer supported in three.js r125+.'),i}return(0,u.Z)(n,[{key:"setTranscoderPath",value:function(e){return this.transcoderPath=e,this}},{key:"setWorkerLimit",value:function(e){return this.workerPool.setWorkerLimit(e),this}},{key:"detectSupport",value:function(e){return this.workerConfig={astcSupported:e.extensions.has("WEBGL_compressed_texture_astc"),etc1Supported:e.extensions.has("WEBGL_compressed_texture_etc1"),etc2Supported:e.extensions.has("WEBGL_compressed_texture_etc"),dxtSupported:e.extensions.has("WEBGL_compressed_texture_s3tc"),bptcSupported:e.extensions.has("EXT_texture_compression_bptc"),pvrtcSupported:e.extensions.has("WEBGL_compressed_texture_pvrtc")||e.extensions.has("WEBKIT_WEBGL_compressed_texture_pvrtc")},e.capabilities.isWebGL2&&(this.workerConfig.etc1Supported=!1),this}},{key:"init",value:function(){var e=this;if(!this.transcoderPending){var t=new d.hH6(this.manager);t.setPath(this.transcoderPath),t.setWithCredentials(this.withCredentials);var i=t.loadAsync("basis_transcoder.js"),r=new d.hH6(this.manager);r.setPath(this.transcoderPath),r.setResponseType("arraybuffer"),r.setWithCredentials(this.withCredentials);var a=r.loadAsync("basis_transcoder.wasm");this.transcoderPending=Promise.all([i,a]).then((function(t){var i=(0,s.Z)(t,2),r=i[0],a=i[1],o=n.BasisWorker.toString(),l=["/* constants */","let _EngineFormat = "+JSON.stringify(n.EngineFormat),"let _TranscoderFormat = "+JSON.stringify(n.TranscoderFormat),"let _BasisFormat = "+JSON.stringify(n.BasisFormat),"/* basis_transcoder.js */",r,"/* worker */",o.substring(o.indexOf("{")+1,o.lastIndexOf("}"))].join("\n");e.workerSourceURL=URL.createObjectURL(new Blob([l])),e.transcoderBinary=a,e.workerPool.setWorkerCreator((function(){var t=new Worker(e.workerSourceURL),n=e.transcoderBinary.slice(0);return t.postMessage({type:"init",config:e.workerConfig,transcoderBinary:n},[n]),t}))})),D>0&&console.warn("THREE.KTX2Loader: Multiple active KTX2 loaders may cause performance issues. Use a single KTX2Loader instance, or call .dispose() on old instances."),D++}return this.transcoderPending}},{key:"load",value:function(e,t,n,i){var r=this;if(null===this.workerConfig)throw new Error("THREE.KTX2Loader: Missing initialization with `.detectSupport( renderer )`.");var a=new d.hH6(this.manager);a.setResponseType("arraybuffer"),a.setWithCredentials(this.withCredentials),a.load(e,(function(e){if(T.has(e))return T.get(e).promise.then(t).catch(i);r._createTexture(e).then((function(e){return t?t(e):null})).catch(i)}),n,i)}},{key:"_createTextureFrom",value:function(e,t){var n=e.mipmaps,i=e.width,r=e.height,a=e.format,o=e.type,s=e.error,l=e.dfdTransferFn,u=e.dfdFlags;if("error"===o)return Promise.reject(s);var c=t.layerCount>1?new d.Z_g(n,i,r,t.layerCount,a,d.ywz):new d.EB7(n,i,r,a,d.ywz);return c.minFilter=1===n.length?d.wem:d.D1R,c.magFilter=d.wem,c.generateMipmaps=!1,c.needsUpdate=!0,c.encoding=2===l?d.knz:d.rnI,c.premultiplyAlpha=!!(1&u),c}},{key:"_createTexture",value:function(){var e=(0,o.Z)((0,a.Z)().mark((function e(t){var n,i,r,o,s=this,l=arguments;return(0,a.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(n=l.length>1&&void 0!==l[1]?l[1]:{},0===(i=x(new Uint8Array(t))).vkFormat){e.next=4;break}return e.abrupt("return",Z(i));case 4:return r=n,o=this.init().then((function(){return s.workerPool.postMessage({type:"transcode",buffer:t,taskConfig:r},[t])})).then((function(e){return s._createTextureFrom(e.data,i)})),T.set(t,{promise:o}),e.abrupt("return",o);case 8:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()},{key:"dispose",value:function(){return this.workerPool.dispose(),this.workerSourceURL&&URL.revokeObjectURL(this.workerSourceURL),D--,this}}]),n}(d.aNw);R.BasisFormat={ETC1S:0,UASTC_4x4:1},R.TranscoderFormat={ETC1:0,ETC2:1,BC1:2,BC3:3,BC4:4,BC5:5,BC7_M6_OPAQUE_ONLY:6,BC7_M5:7,PVRTC1_4_RGB:8,PVRTC1_4_RGBA:9,ASTC_4x4:10,ATC_RGB:11,ATC_RGBA_INTERPOLATED_ALPHA:12,RGBA32:13,RGB565:14,BGR565:15,RGBA4444:16},R.EngineFormat={RGBAFormat:d.wk1,RGBA_ASTC_4x4_Format:d.ptH,RGBA_BPTC_Format:d.bsb,RGBA_ETC2_EAC_Format:d.ekQ,RGBA_PVRTC_4BPPV1_Format:d.eaV,RGBA_S3TC_DXT5_Format:d.ILR,RGB_ETC1_Format:d.fto,RGB_ETC2_Format:d.l0P,RGB_PVRTC_4BPPV1_Format:d._AM,RGB_S3TC_DXT1_Format:d.wuA},R.BasisWorker=function(){var e,t,n,i=_EngineFormat,a=_TranscoderFormat,o=_BasisFormat;self.addEventListener("message",(function(r){var s,d=r.data;switch(d.type){case"init":e=d.config,s=d.transcoderBinary,t=new Promise((function(e){n={wasmBinary:s,onRuntimeInitialized:e},BASIS(n)})).then((function(){n.initializeBasis(),void 0===n.KTX2File&&console.warn("THREE.KTX2Loader: Please update Basis Universal transcoder.")}));break;case"transcode":t.then((function(){try{for(var t=function(t){var r=new n.KTX2File(new Uint8Array(t));function s(){r.close(),r.delete()}if(!r.isValid())throw s(),new Error("THREE.KTX2Loader:\tInvalid or unsupported .ktx2 file");var d=r.isUASTC()?o.UASTC_4x4:o.ETC1S,f=r.getWidth(),p=r.getHeight(),A=r.getLayers()||1,v=r.getLevels(),g=r.getHasAlpha(),m=r.getDFDTransferFunc(),y=r.getDFDFlags(),x=function(t,n,r,s){for(var h,d,f=t===o.ETC1S?l:u,p=0;p<f.length;p++){var A=f[p];if(e[A.if]&&(A.basisFormat.includes(t)&&!(s&&A.transcoderFormat.length<2)&&(!A.needsPowerOfTwo||c(n)&&c(r))))return{transcoderFormat:h=A.transcoderFormat[s?1:0],engineFormat:d=A.engineFormat[s?1:0]}}return console.warn("THREE.KTX2Loader: No suitable compressed texture format found. Decoding to RGBA32."),h=a.RGBA32,d=i.RGBAFormat,{transcoderFormat:h,engineFormat:d}}(d,f,p,g),w=x.transcoderFormat,C=x.engineFormat;if(!f||!p||!v)throw s(),new Error("THREE.KTX2Loader:\tInvalid texture");if(!r.startTranscoding())throw s(),new Error("THREE.KTX2Loader: .startTranscoding failed");for(var b=[],_=0;_<v;_++){for(var E=[],M=void 0,I=void 0,S=0;S<A;S++){var k=r.getImageLevelInfo(_,S,0);M=k.origWidth,I=k.origHeight;var B=new Uint8Array(r.getImageTranscodedSizeInBytes(_,S,0,w));if(!r.transcodeImage(B,_,S,0,w,0,-1,-1))throw s(),new Error("THREE.KTX2Loader: .transcodeImage failed.");E.push(B)}b.push({data:h(E),width:M,height:I})}return s(),{width:f,height:p,hasAlpha:g,mipmaps:b,format:C,dfdTransferFn:m,dfdFlags:y}}(d.buffer),r=t.width,s=t.height,f=t.hasAlpha,p=t.mipmaps,A=t.format,v=t.dfdTransferFn,g=t.dfdFlags,m=[],y=0;y<p.length;++y)m.push(p[y].data.buffer);self.postMessage({type:"transcode",id:d.id,width:r,height:s,hasAlpha:f,mipmaps:p,format:A,dfdTransferFn:v,dfdFlags:g},m)}catch(x){console.error(x),self.postMessage({type:"error",id:d.id,error:x.message})}}))}}));var s=[{if:"astcSupported",basisFormat:[o.UASTC_4x4],transcoderFormat:[a.ASTC_4x4,a.ASTC_4x4],engineFormat:[i.RGBA_ASTC_4x4_Format,i.RGBA_ASTC_4x4_Format],priorityETC1S:1/0,priorityUASTC:1,needsPowerOfTwo:!1},{if:"bptcSupported",basisFormat:[o.ETC1S,o.UASTC_4x4],transcoderFormat:[a.BC7_M5,a.BC7_M5],engineFormat:[i.RGBA_BPTC_Format,i.RGBA_BPTC_Format],priorityETC1S:3,priorityUASTC:2,needsPowerOfTwo:!1},{if:"dxtSupported",basisFormat:[o.ETC1S,o.UASTC_4x4],transcoderFormat:[a.BC1,a.BC3],engineFormat:[i.RGB_S3TC_DXT1_Format,i.RGBA_S3TC_DXT5_Format],priorityETC1S:4,priorityUASTC:5,needsPowerOfTwo:!1},{if:"etc2Supported",basisFormat:[o.ETC1S,o.UASTC_4x4],transcoderFormat:[a.ETC1,a.ETC2],engineFormat:[i.RGB_ETC2_Format,i.RGBA_ETC2_EAC_Format],priorityETC1S:1,priorityUASTC:3,needsPowerOfTwo:!1},{if:"etc1Supported",basisFormat:[o.ETC1S,o.UASTC_4x4],transcoderFormat:[a.ETC1],engineFormat:[i.RGB_ETC1_Format],priorityETC1S:2,priorityUASTC:4,needsPowerOfTwo:!1},{if:"pvrtcSupported",basisFormat:[o.ETC1S,o.UASTC_4x4],transcoderFormat:[a.PVRTC1_4_RGB,a.PVRTC1_4_RGBA],engineFormat:[i.RGB_PVRTC_4BPPV1_Format,i.RGBA_PVRTC_4BPPV1_Format],priorityETC1S:5,priorityUASTC:6,needsPowerOfTwo:!0}],l=s.sort((function(e,t){return e.priorityETC1S-t.priorityETC1S})),u=s.sort((function(e,t){return e.priorityUASTC-t.priorityUASTC}));function c(e){return e<=2||0===(e&e-1)&&0!==e}function h(e){var t,n=0,i=(0,r.Z)(e);try{for(i.s();!(t=i.n()).done;){n+=t.value.byteLength}}catch(c){i.e(c)}finally{i.f()}var a,o=new Uint8Array(n),s=0,l=(0,r.Z)(e);try{for(l.s();!(a=l.n()).done;){var u=a.value;o.set(u,s),s+=u.byteLength}}catch(c){l.e(c)}finally{l.f()}return o}};var P=(_={},(0,i.Z)(_,109,d.wk1),(0,i.Z)(_,97,d.wk1),(0,i.Z)(_,37,d.wk1),(0,i.Z)(_,43,d.wk1),(0,i.Z)(_,103,d.av9),(0,i.Z)(_,83,d.av9),(0,i.Z)(_,16,d.av9),(0,i.Z)(_,22,d.av9),(0,i.Z)(_,100,d.hEm),(0,i.Z)(_,76,d.hEm),(0,i.Z)(_,15,d.hEm),(0,i.Z)(_,9,d.hEm),_),L=(E={},(0,i.Z)(E,109,d.VzW),(0,i.Z)(E,97,d.cLu),(0,i.Z)(E,37,d.ywz),(0,i.Z)(E,43,d.ywz),(0,i.Z)(E,103,d.VzW),(0,i.Z)(E,83,d.cLu),(0,i.Z)(E,16,d.ywz),(0,i.Z)(E,22,d.ywz),(0,i.Z)(E,100,d.VzW),(0,i.Z)(E,76,d.cLu),(0,i.Z)(E,15,d.ywz),(0,i.Z)(E,9,d.ywz),E),Q=(M={},(0,i.Z)(M,43,d.knz),(0,i.Z)(M,22,d.knz),(0,i.Z)(M,15,d.knz),M);function Z(e){return N.apply(this,arguments)}function N(){return(N=(0,o.Z)((0,a.Z)().mark((function e(t){var n,i,r,o,s,l,u,c;return(0,a.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(n=t.vkFormat,i=t.pixelWidth,r=t.pixelHeight,o=t.pixelDepth,void 0!==P[n]){e.next=3;break}throw new Error("THREE.KTX2Loader: Unsupported vkFormat.");case 3:if(s=t.levels[0],t.supercompressionScheme!==p){e.next=8;break}l=s.levelData,e.next=19;break;case 8:if(t.supercompressionScheme!==A){e.next=18;break}if(I){e.next=13;break}return I=new k,e.next=13,I.init();case 13:return e.next=15,I;case 15:l=e.sent.decode(s.levelData,s.uncompressedByteLength),e.next=19;break;case 18:throw new Error("THREE.KTX2Loader: Unsupported supercompressionScheme.");case 19:return u=L[n]===d.VzW?new Float32Array(l.buffer,l.byteOffset,l.byteLength/Float32Array.BYTES_PER_ELEMENT):L[n]===d.cLu?new Uint16Array(l.buffer,l.byteOffset,l.byteLength/Uint16Array.BYTES_PER_ELEMENT):l,(c=0===o?new d.IEO(u,i,r):new d.JUT(u,i,r,o)).type=L[n],c.format=P[n],c.encoding=Q[n]||d.rnI,c.needsUpdate=!0,e.abrupt("return",Promise.resolve(c));case 26:case"end":return e.stop()}}),e)})))).apply(this,arguments)}},12607:function(e,t,n){n.d(t,{U:function(){return l}});var i=n(15671),r=n(43144),a=n(60136),o=n(29388),s=n(70804),l=function(e){(0,a.Z)(n,e);var t=(0,o.Z)(n);function n(e){return(0,i.Z)(this,n),t.call(this,e)}return(0,r.Z)(n,[{key:"parse",value:function(e){var t=0,n=1,i=2,r=3,a=9,o=10,l=11,u=48,c=4,h=0,d=1,f=2,p=3;e.length<19&&console.error("THREE.TGALoader: Not enough data to contain header.");var A=0,v=new Uint8Array(e),g={id_length:v[A++],colormap_type:v[A++],image_type:v[A++],colormap_index:v[A++]|v[A++]<<8,colormap_length:v[A++]|v[A++]<<8,colormap_size:v[A++],origin:[v[A++]|v[A++]<<8,v[A++]|v[A++]<<8],width:v[A++]|v[A++]<<8,height:v[A++]|v[A++]<<8,pixel_size:v[A++],flags:v[A++]};!function(e){switch(e.image_type){case n:case a:(e.colormap_length>256||24!==e.colormap_size||1!==e.colormap_type)&&console.error("THREE.TGALoader: Invalid type colormap data for indexed type.");break;case i:case r:case o:case l:e.colormap_type&&console.error("THREE.TGALoader: Invalid type colormap data for colormap type.");break;case t:console.error("THREE.TGALoader: No data.");default:console.error('THREE.TGALoader: Invalid type "%s".',e.image_type)}(e.width<=0||e.height<=0)&&console.error("THREE.TGALoader: Invalid image size."),8!==e.pixel_size&&16!==e.pixel_size&&24!==e.pixel_size&&32!==e.pixel_size&&console.error('THREE.TGALoader: Invalid pixel size "%s".',e.pixel_size)}(g),g.id_length+A>e.length&&console.error("THREE.TGALoader: No data."),A+=g.id_length;var m=!1,y=!1,x=!1;switch(g.image_type){case a:m=!0,y=!0;break;case n:y=!0;break;case o:m=!0;break;case i:break;case l:m=!0,x=!0;break;case r:x=!0}var w=new Uint8Array(g.width*g.height*4),C=function(e,t,n,i,r){var a,o,s=n.pixel_size>>3,l=n.width*n.height*s;if(t&&(o=r.subarray(i,i+=n.colormap_length*(n.colormap_size>>3))),e){var u,c,h;a=new Uint8Array(l);for(var d=0,f=new Uint8Array(s);d<l;)if(c=1+(127&(u=r[i++])),128&u){for(h=0;h<s;++h)f[h]=r[i++];for(h=0;h<c;++h)a.set(f,d+h*s);d+=s*c}else{for(c*=s,h=0;h<c;++h)a[d+h]=r[i++];d+=c}}else a=r.subarray(i,i+=t?n.width*n.height:l);return{pixel_data:a,palettes:o}}(m,y,g,A,v);return function(e,t,n,i,r){var a,o,s,l,A,v;switch((g.flags&u)>>c){default:case f:a=0,s=1,A=t,o=0,l=1,v=n;break;case h:a=0,s=1,A=t,o=n-1,l=-1,v=-1;break;case p:a=t-1,s=-1,A=-1,o=0,l=1,v=n;break;case d:a=t-1,s=-1,A=-1,o=n-1,l=-1,v=-1}if(x)switch(g.pixel_size){case 8:!function(e,t,n,i,r,a,o,s){var l,u,c,h=0,d=g.width;for(c=t;c!==i;c+=n)for(u=r;u!==o;u+=a,h++)l=s[h],e[4*(u+d*c)+0]=l,e[4*(u+d*c)+1]=l,e[4*(u+d*c)+2]=l,e[4*(u+d*c)+3]=255}(e,o,l,v,a,s,A,i);break;case 16:!function(e,t,n,i,r,a,o,s){var l,u,c=0,h=g.width;for(u=t;u!==i;u+=n)for(l=r;l!==o;l+=a,c+=2)e[4*(l+h*u)+0]=s[c+0],e[4*(l+h*u)+1]=s[c+0],e[4*(l+h*u)+2]=s[c+0],e[4*(l+h*u)+3]=s[c+1]}(e,o,l,v,a,s,A,i);break;default:console.error("THREE.TGALoader: Format not supported.")}else switch(g.pixel_size){case 8:!function(e,t,n,i,r,a,o,s,l){var u,c,h,d=l,f=0,p=g.width;for(h=t;h!==i;h+=n)for(c=r;c!==o;c+=a,f++)u=s[f],e[4*(c+p*h)+3]=255,e[4*(c+p*h)+2]=d[3*u+0],e[4*(c+p*h)+1]=d[3*u+1],e[4*(c+p*h)+0]=d[3*u+2]}(e,o,l,v,a,s,A,i,r);break;case 16:!function(e,t,n,i,r,a,o,s){var l,u,c,h=0,d=g.width;for(c=t;c!==i;c+=n)for(u=r;u!==o;u+=a,h+=2)l=s[h+0]+(s[h+1]<<8),e[4*(u+d*c)+0]=(31744&l)>>7,e[4*(u+d*c)+1]=(992&l)>>2,e[4*(u+d*c)+2]=(31&l)<<3,e[4*(u+d*c)+3]=32768&l?0:255}(e,o,l,v,a,s,A,i);break;case 24:!function(e,t,n,i,r,a,o,s){var l,u,c=0,h=g.width;for(u=t;u!==i;u+=n)for(l=r;l!==o;l+=a,c+=3)e[4*(l+h*u)+3]=255,e[4*(l+h*u)+2]=s[c+0],e[4*(l+h*u)+1]=s[c+1],e[4*(l+h*u)+0]=s[c+2]}(e,o,l,v,a,s,A,i);break;case 32:!function(e,t,n,i,r,a,o,s){var l,u,c=0,h=g.width;for(u=t;u!==i;u+=n)for(l=r;l!==o;l+=a,c+=4)e[4*(l+h*u)+2]=s[c+0],e[4*(l+h*u)+1]=s[c+1],e[4*(l+h*u)+0]=s[c+2],e[4*(l+h*u)+3]=s[c+3]}(e,o,l,v,a,s,A,i);break;default:console.error("THREE.TGALoader: Format not supported.")}}(w,g.width,g.height,C.pixel_data,C.palettes),{data:w,width:g.width,height:g.height,flipY:!0,generateMipmaps:!0,minFilter:s.D1R}}}]),n}(s.yxD)},51925:function(e,t,n){n.d(t,{Vs:function(){return o},qf:function(){return r}});var i=n(70804);function r(e){for(var t=arguments.length>1&&void 0!==arguments[1]&&arguments[1],n=null!==e[0].index,r=new Set(Object.keys(e[0].attributes)),o=new Set(Object.keys(e[0].morphAttributes)),s={},l={},u=e[0].morphTargetsRelative,c=new i.u9r,h=0,d=0;d<e.length;++d){var f=e[d],p=0;if(n!==(null!==f.index))return console.error("THREE.BufferGeometryUtils: .mergeBufferGeometries() failed with geometry at index "+d+". All geometries must have compatible attributes; make sure index attribute exists among all geometries, or in none of them."),null;for(var A in f.attributes){if(!r.has(A))return console.error("THREE.BufferGeometryUtils: .mergeBufferGeometries() failed with geometry at index "+d+'. All geometries must have compatible attributes; make sure "'+A+'" attribute exists among all geometries, or in none of them.'),null;void 0===s[A]&&(s[A]=[]),s[A].push(f.attributes[A]),p++}if(p!==r.size)return console.error("THREE.BufferGeometryUtils: .mergeBufferGeometries() failed with geometry at index "+d+". Make sure all geometries have the same number of attributes."),null;if(u!==f.morphTargetsRelative)return console.error("THREE.BufferGeometryUtils: .mergeBufferGeometries() failed with geometry at index "+d+". .morphTargetsRelative must be consistent throughout all geometries."),null;for(var v in f.morphAttributes){if(!o.has(v))return console.error("THREE.BufferGeometryUtils: .mergeBufferGeometries() failed with geometry at index "+d+".  .morphAttributes must be consistent throughout all geometries."),null;void 0===l[v]&&(l[v]=[]),l[v].push(f.morphAttributes[v])}if(t){var g=void 0;if(n)g=f.index.count;else{if(void 0===f.attributes.position)return console.error("THREE.BufferGeometryUtils: .mergeBufferGeometries() failed with geometry at index "+d+". The geometry must have either an index or a position attribute"),null;g=f.attributes.position.count}c.addGroup(h,g,d),h+=g}}if(n){for(var m=0,y=[],x=0;x<e.length;++x){for(var w=e[x].index,C=0;C<w.count;++C)y.push(w.getX(C)+m);m+=e[x].attributes.position.count}c.setIndex(y)}for(var b in s){var _=a(s[b]);if(!_)return console.error("THREE.BufferGeometryUtils: .mergeBufferGeometries() failed while trying to merge the "+b+" attribute."),null;c.setAttribute(b,_)}for(var E in l){var M=l[E][0].length;if(0===M)break;c.morphAttributes=c.morphAttributes||{},c.morphAttributes[E]=[];for(var I=0;I<M;++I){for(var S=[],k=0;k<l[E].length;++k)S.push(l[E][k][I]);var B=a(S);if(!B)return console.error("THREE.BufferGeometryUtils: .mergeBufferGeometries() failed while trying to merge the "+E+" morphAttribute."),null;c.morphAttributes[E].push(B)}}return c}function a(e){for(var t,n,r,a=0,o=0;o<e.length;++o){var s=e[o];if(s.isInterleavedBufferAttribute)return console.error("THREE.BufferGeometryUtils: .mergeBufferAttributes() failed. InterleavedBufferAttributes are not supported."),null;if(void 0===t&&(t=s.array.constructor),t!==s.array.constructor)return console.error("THREE.BufferGeometryUtils: .mergeBufferAttributes() failed. BufferAttribute.array must be of consistent array types across matching attributes."),null;if(void 0===n&&(n=s.itemSize),n!==s.itemSize)return console.error("THREE.BufferGeometryUtils: .mergeBufferAttributes() failed. BufferAttribute.itemSize must be consistent across matching attributes."),null;if(void 0===r&&(r=s.normalized),r!==s.normalized)return console.error("THREE.BufferGeometryUtils: .mergeBufferAttributes() failed. BufferAttribute.normalized must be consistent across matching attributes."),null;a+=s.array.length}for(var l=new t(a),u=0,c=0;c<e.length;++c)l.set(e[c].array,u),u+=e[c].array.length;return new i.TlE(l,n,r)}function o(e,t){if(t===i.WwZ)return console.warn("THREE.BufferGeometryUtils.toTrianglesDrawMode(): Geometry already defined as triangles."),e;if(t===i.z$h||t===i.UlW){var n=e.getIndex();if(null===n){var r=[],a=e.getAttribute("position");if(void 0===a)return console.error("THREE.BufferGeometryUtils.toTrianglesDrawMode(): Undefined position attribute. Processing not possible."),e;for(var o=0;o<a.count;o++)r.push(o);e.setIndex(r),n=e.getIndex()}var s=n.count-2,l=[];if(t===i.z$h)for(var u=1;u<=s;u++)l.push(n.getX(0)),l.push(n.getX(u)),l.push(n.getX(u+1));else for(var c=0;c<s;c++)c%2===0?(l.push(n.getX(c)),l.push(n.getX(c+1)),l.push(n.getX(c+2))):(l.push(n.getX(c+2)),l.push(n.getX(c+1)),l.push(n.getX(c)));l.length/3!==s&&console.error("THREE.BufferGeometryUtils.toTrianglesDrawMode(): Unable to generate correct amount of triangles.");var h=e.clone();return h.setIndex(l),h.clearGroups(),h}return console.error("THREE.BufferGeometryUtils.toTrianglesDrawMode(): Unknown draw mode:",t),e}},32137:function(e,t,n){n.r(t),n.d(t,{default:function(){return Oa}});var i=n(15671),r=n(43144),a=n(60136),o=n(29388),s=n(72791),l=n(58121),u=n(80542),c=(n(37795),n(80184)),h=function(e){(0,a.Z)(n,e);var t=(0,o.Z)(n);function n(){var e;return(0,i.Z)(this,n),(e=t.call(this)).state={activeTabIndex:0},e}return(0,r.Z)(n,[{key:"render",value:function(){var e=this;return(0,c.jsxs)(s.Fragment,{children:[(0,c.jsx)("div",{className:"tab",children:this.props.tabs.map((function(t,n){return t.renderButton(e.state.activeTabIndex==n,(function(){return e.onTabButtonClick(t,n)}),n)}))}),(0,c.jsx)(s.Fragment,{children:this.props.tabs.length>0&&this.props.tabs[this.state.activeTabIndex].renderContent()})]})}},{key:"onTabButtonClick",value:function(e,t){var n=this;this.setState({activeTabIndex:t},(function(){n.props.onTabChanged&&n.props.onTabChanged(e,t)}))}}]),n}(s.Component),d=function(e){(0,a.Z)(n,e);var t=(0,o.Z)(n);function n(){return(0,i.Z)(this,n),t.apply(this,arguments)}return(0,r.Z)(n,[{key:"render",value:function(){return(0,c.jsx)("div",{className:"editor-sidebar",children:(0,c.jsx)(h,{tabs:this.props.tabs,onTabChanged:function(e){}})})}}]),n}(s.Component),f=n(74165),p=n(15861),A=n(51859),v=n(66532),g=n(17447),m=function(e){(0,a.Z)(n,e);var t=(0,o.Z)(n);function n(){var e;return(0,i.Z)(this,n),(e=t.call(this)).fileInputRef=s.createRef(),e.projectInputRef=s.createRef(),e.dirInputRef=s.createRef(),e}return(0,r.Z)(n,[{key:"render",value:function(){var e=this;return(0,c.jsxs)(s.Fragment,{children:[(0,c.jsxs)(v.Z,{anchorEl:this.props.anchorElem,anchorOrigin:{vertical:"bottom",horizontal:"right"},transformOrigin:{vertical:"top",horizontal:"center"},keepMounted:!0,open:Boolean(this.props.anchorElem&&!this.props.disabled),onClose:this.props.onClose,children:[(0,c.jsx)(A.Z,{onClick:function(){e.props.onClose(),e.props.editorViewModel.getUserResponse("Discard current project and lose changes?",(function(){e.props.fileCommands.execute("new project")}))},children:"New Project"}),(0,c.jsx)(A.Z,{onClick:function(){e.props.onClose(),e.props.editorViewModel.getUserResponse("Discard current project and lose changes?",(function(){e.projectInputRef.current.click()}))},children:"Load Project"}),(0,c.jsx)(A.Z,{onClick:(0,p.Z)((0,f.Z)().mark((function t(){return(0,f.Z)().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return e.props.onClose(),t.next=3,e.props.fileCommands.execute("export project");case 3:case"end":return t.stop()}}),t)}))),children:"Save Project"}),(0,c.jsx)(g.Z,{}),(0,c.jsx)(A.Z,{onClick:function(){e.props.onClose(),e.fileInputRef.current.click()},children:"Import 3D File"}),(0,c.jsx)(A.Z,{onClick:function(){e.props.onClose(),e.dirInputRef.current.click()},children:"Import Directory"}),(0,c.jsx)(A.Z,{onClick:function(){e.props.onClose(),e.props.fileCommands.execute("export glb")},children:"Export Glb File"}),(0,c.jsx)(A.Z,{onClick:function(){e.props.onClose(),e.props.fileCommands.execute("publish")},children:"Publish"}),(0,c.jsx)(A.Z,{onClick:function(){window.location="/"},children:"Exit"})]}),(0,c.jsx)("input",{ref:this.fileInputRef,type:"file",style:{display:"none"},onChange:function(t){e.props.fileCommands&&e.props.fileCommands.execute("import file",t.target.files)}}),(0,c.jsx)("input",{ref:this.projectInputRef,type:"file",style:{display:"none"},accept:".zip",onChange:function(t){e.props.fileCommands&&e.props.fileCommands.execute("import project",t.target.files[0]),e.projectInputRef.current.value=""}}),(0,c.jsx)("input",{ref:this.dirInputRef,type:"file",webkitdirectory:"",style:{display:"none"},onChange:function(t){e.props.fileCommands&&e.props.fileCommands.execute("import dir",t.target.files)}})]})}}]),n}(s.Component),y=n(97326),x=n(86065),w=n(54836),C=function(e){(0,a.Z)(n,e);var t=(0,o.Z)(n);function n(){return(0,i.Z)(this,n),t.apply(this,arguments)}return(0,r.Z)(n)}(w.Z),b=function(e){(0,a.Z)(n,e);var t=(0,o.Z)(n);function n(){return(0,i.Z)(this,n),t.apply(this,arguments)}return(0,r.Z)(n)}(w.Z),_=function(e){(0,a.Z)(n,e);var t=(0,o.Z)(n);function n(){return(0,i.Z)(this,n),t.apply(this,arguments)}return(0,r.Z)(n)}(w.Z),E=function(e){(0,a.Z)(n,e);var t=(0,o.Z)(n);function n(e){var r;return(0,i.Z)(this,n),(r=t.call(this)).domEvent=e,r}return(0,r.Z)(n)}(w.Z),M=function(e){(0,a.Z)(n,e);var t=(0,o.Z)(n);function n(e){var r;return(0,i.Z)(this,n),(r=t.call(this)).intersect=e,r}return(0,r.Z)(n)}(w.Z),I=function(e){(0,a.Z)(n,e);var t=(0,o.Z)(n);function n(e,r){var a;return(0,i.Z)(this,n),(a=t.call(this)).object=e,a.intersect=r,a}return(0,r.Z)(n)}(w.Z),S=function(e){(0,a.Z)(n,e);var t=(0,o.Z)(n);function n(e){var r;return(0,i.Z)(this,n),(r=t.call(this)).object=e,r}return(0,r.Z)(n)}(w.Z),k=function(e){(0,a.Z)(n,e);var t=(0,o.Z)(n);function n(e){var r;return(0,i.Z)(this,n),(r=t.call(this)).object=e,r}return(0,r.Z)(n)}(w.Z),B=function(e){(0,a.Z)(n,e);var t=(0,o.Z)(n);function n(e){var r;return(0,i.Z)(this,n),(r=t.call(this)).object=e,r}return(0,r.Z)(n)}(w.Z),T=function(e){(0,a.Z)(n,e);var t=(0,o.Z)(n);function n(e){var r;return(0,i.Z)(this,n),(r=t.call(this)).object=e,r}return(0,r.Z)(n)}(w.Z),D=function(e){(0,a.Z)(n,e);var t=(0,o.Z)(n);function n(){return(0,i.Z)(this,n),t.apply(this,arguments)}return(0,r.Z)(n)}(w.Z),R=function(e){(0,a.Z)(n,e);var t=(0,o.Z)(n);function n(e){var r;return(0,i.Z)(this,n),(r=t.call(this)).settings=e,r}return(0,r.Z)(n)}(w.Z),P=function(e){(0,a.Z)(n,e);var t=(0,o.Z)(n);function n(e){var r;return(0,i.Z)(this,n),(r=t.call(this)).type=e,r}return(0,r.Z)(n)}(w.Z),L=function(){function e(){(0,i.Z)(this,e),this.redoStack=[],this.undoStack=[]}return(0,r.Z)(e,[{key:"execute",value:function(){var e=(0,p.Z)((0,f.Z)().mark((function e(t){var n,i=arguments;return(0,f.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return n=!(i.length>1&&void 0!==i[1])||i[1],e.next=3,t.execute();case 3:n&&(this.redoStack=[],t.undoable&&this.undoStack.push(t),x.Z.instance.notifyAll(new C));case 4:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()},{key:"undo",value:function(){if(this.undoStack.length){var e=this.undoStack.pop();e.undo(),this.redoStack.push(e),x.Z.instance.notifyAll(new C)}}},{key:"redo",value:function(){if(this.redoStack.length){var e=this.redoStack.pop();e.redo(),this.undoStack.push(e),x.Z.instance.notifyAll(new C)}}},{key:"nextRedoCommand",get:function(){return this.redoStack.length?this.redoStack.slice(-1).pop():null}},{key:"nextUndoCommand",get:function(){return this.undoStack.length?this.undoStack.slice(-1).pop():null}}]),e}(),Q=new L,Z=function(e){(0,a.Z)(n,e);var t=(0,o.Z)(n);function n(e){var r;return(0,i.Z)(this,n),(r=t.call(this,e)).executeCommand=r.executeCommand.bind((0,y.Z)(r)),r.state={nextUndoCmd:null,nextRedoCmd:null,deleteEnabled:!1},x.Z.instance.subscribe(C,(function(){r.setState({nextUndoCmd:Q.nextUndoCommand,nextRedoCmd:Q.nextRedoCommand})})),x.Z.instance.subscribe(I,(function(){r.setState({deleteEnabled:!0})})),x.Z.instance.subscribe(S,(function(){r.setState({deleteEnabled:!1})})),r}return(0,r.Z)(n,[{key:"executeCommand",value:function(e){this.props.editCommands&&this.props.editCommands.execute(e),this.props.onClose()}},{key:"render",value:function(){var e,t,n,i,r=this;return(0,c.jsxs)(v.Z,{anchorEl:this.props.anchorElem,anchorOrigin:{vertical:"bottom",horizontal:"right"},transformOrigin:{vertical:"top",horizontal:"center"},keepMounted:!0,open:Boolean(this.props.anchorElem&&!this.props.disabled),onClose:this.props.onClose,children:[(0,c.jsx)(A.Z,{onClick:function(){return r.executeCommand("translate")},children:"Translate"}),(0,c.jsx)(A.Z,{onClick:function(){return r.executeCommand("rotate")},children:"Rotate"}),(0,c.jsx)(A.Z,{onClick:function(){return r.executeCommand("scale")},children:"Scale"}),(0,c.jsx)(g.Z,{}),(0,c.jsx)(A.Z,{disabled:!this.state.deleteEnabled,onClick:function(){return r.executeCommand("delete")},children:"Delete"}),(0,c.jsx)(g.Z,{}),(0,c.jsx)(A.Z,{disabled:!this.state.nextUndoCmd,onClick:function(){return r.executeCommand("undo")},children:"Undo "+(null!==(e=null===(t=this.state.nextUndoCmd)||void 0===t?void 0:t.name)&&void 0!==e?e:"")}),(0,c.jsx)(A.Z,{disabled:!this.state.nextRedoCmd,onClick:function(){return r.executeCommand("redo")},children:"Redo "+(null!==(n=null===(i=this.state.nextRedoCmd)||void 0===i?void 0:i.name)&&void 0!==n?n:"")})]})}}]),n}(s.PureComponent),N=function(e){(0,a.Z)(n,e);var t=(0,o.Z)(n);function n(e){return(0,i.Z)(this,n),t.call(this,e)}return(0,r.Z)(n,[{key:"render",value:function(){var e=this;return(0,c.jsxs)(v.Z,{anchorEl:this.props.anchorElem,anchorOrigin:{vertical:"bottom",horizontal:"right"},transformOrigin:{vertical:"top",horizontal:"center"},keepMounted:!0,open:Boolean(this.props.anchorElem&&!this.props.disabled),onClose:this.props.onClose,children:[(0,c.jsx)(A.Z,{onClick:function(){e.props.addCommands&&e.props.addCommands.execute("primitive.Sphere"),e.props.onClose()},children:"Sphere"}),(0,c.jsx)(A.Z,{onClick:function(){e.props.addCommands&&e.props.addCommands.execute("primitive.Box"),e.props.onClose()},children:"Box"}),(0,c.jsx)(A.Z,{onClick:function(){e.props.addCommands&&e.props.addCommands.execute("primitive.Cylinder"),e.props.onClose()},children:"Cylinder"}),(0,c.jsx)(A.Z,{onClick:function(){e.props.addCommands&&e.props.addCommands.execute("primitive.Torus"),e.props.onClose()},children:"Torus"}),(0,c.jsx)(A.Z,{onClick:function(){e.props.addCommands&&e.props.addCommands.execute("primitive.Capsule"),e.props.onClose()},children:"Capsule"}),(0,c.jsx)(A.Z,{onClick:function(){e.props.addCommands&&e.props.addCommands.execute("primitive.Tetrahedron"),e.props.onClose()},children:"Tetrahedron"}),(0,c.jsx)(A.Z,{onClick:function(){e.props.addCommands&&e.props.addCommands.execute("primitive.Sphere"),e.props.onClose()},children:"Sphere"}),(0,c.jsx)(A.Z,{onClick:function(){e.props.addCommands&&e.props.addCommands.execute("primitive.Icosahedron"),e.props.onClose()},children:"Icosahedron"}),(0,c.jsx)(A.Z,{onClick:function(){e.props.addCommands&&e.props.addCommands.execute("primitive.Tetrahedron"),e.props.onClose()},children:"Tetrahedron"}),(0,c.jsx)(A.Z,{onClick:function(){e.props.addCommands&&e.props.addCommands.execute("primitive.Dodecahedron"),e.props.onClose()},children:"Dodecahedron"}),(0,c.jsx)(A.Z,{onClick:function(){e.props.addCommands&&e.props.addCommands.execute("primitive.Lathe"),e.props.onClose()},children:"Lathe"}),(0,c.jsx)(A.Z,{onClick:function(){e.props.addCommands&&e.props.addCommands.execute("primitive.Plane"),e.props.onClose()},children:"Plane"}),(0,c.jsx)(A.Z,{onClick:function(){e.props.addCommands&&e.props.addCommands.execute("primitive.Circle"),e.props.onClose()},children:"Circle"}),(0,c.jsx)(A.Z,{onClick:function(){e.props.addCommands&&e.props.addCommands.execute("primitive.Ring"),e.props.onClose()},children:"Ring"}),(0,c.jsx)(A.Z,{onClick:function(){e.props.addCommands&&e.props.addCommands.execute("primitive.Tube"),e.props.onClose()},children:"Tube"}),(0,c.jsx)(g.Z,{}),(0,c.jsx)(A.Z,{onClick:function(){e.props.addCommands&&e.props.addCommands.execute("light.PointLight"),e.props.onClose()},children:"Point Light"}),(0,c.jsx)(A.Z,{onClick:function(){e.props.addCommands&&e.props.addCommands.execute("light.DirectionalLight"),e.props.onClose()},children:"Directional Light"}),(0,c.jsx)(A.Z,{onClick:function(){e.props.addCommands&&e.props.addCommands.execute("light.SpotLight"),e.props.onClose()},children:"Spotlight"}),(0,c.jsx)(A.Z,{onClick:function(){e.props.addCommands&&e.props.addCommands.execute("light.HemisphereLight"),e.props.onClose()},children:"Hemisphere Light"})]})}}]),n}(s.PureComponent),F=function(e){(0,a.Z)(n,e);var t=(0,o.Z)(n);function n(e){var r;return(0,i.Z)(this,n),(r=t.call(this,e)).executeCommand=r.executeCommand.bind((0,y.Z)(r)),r.state={},r}return(0,r.Z)(n,[{key:"executeCommand",value:function(e){this.props.viewCommands&&this.props.viewCommands.execute(e),this.props.onClose()}},{key:"render",value:function(){var e=this;return(0,c.jsxs)(v.Z,{anchorEl:this.props.anchorElem,anchorOrigin:{vertical:"bottom",horizontal:"right"},transformOrigin:{vertical:"top",horizontal:"center"},keepMounted:!0,open:Boolean(this.props.anchorElem),onClose:this.props.onClose,children:[(0,c.jsx)(A.Z,{onClick:function(){return e.executeCommand("frame scene")},children:"Frame Scene"}),(0,c.jsx)(A.Z,{onClick:function(){return e.executeCommand("frame selection")},children:"Frame Selection"})]})}}]),n}(s.PureComponent),U=function(e){(0,a.Z)(n,e);var t=(0,o.Z)(n);function n(e){var r;return(0,i.Z)(this,n),(r=t.call(this,e)).state={fileAnchorElem:null,editAnchorElem:null,addAnchorElem:null,viewAnchorElem:null},r.onFileMenuClick=r.onFileMenuClick.bind((0,y.Z)(r)),r.onEditMenuClick=r.onEditMenuClick.bind((0,y.Z)(r)),r.onAddMenuClick=r.onAddMenuClick.bind((0,y.Z)(r)),r.onViewMenuClick=r.onViewMenuClick.bind((0,y.Z)(r)),r}return(0,r.Z)(n,[{key:"render",value:function(){var e=this;return(0,c.jsxs)(s.Fragment,{children:[(0,c.jsxs)("div",{className:"main-menu",children:[(0,c.jsx)("div",{onClick:this.onFileMenuClick,children:"File"}),(0,c.jsx)("div",{onClick:this.onEditMenuClick,children:"Edit"}),(0,c.jsx)("div",{onClick:this.onAddMenuClick,children:"Add"}),(0,c.jsx)("div",{onClick:this.onViewMenuClick,children:"View"}),(0,c.jsx)("div",{children:(0,c.jsx)("a",{href:"/help/editing",target:"_blank",children:"Help"})})]}),(0,c.jsx)(m,{anchorElem:this.state.fileAnchorElem,disabled:!1,onClose:function(){e.setState({fileAnchorElem:null})},fileCommands:this.props.fileCommands,editorViewModel:this.props.editorViewModel}),(0,c.jsx)(Z,{anchorElem:this.state.editAnchorElem,disabled:!1,onClose:function(){e.setState({editAnchorElem:null})},editCommands:this.props.editCommands}),(0,c.jsx)(N,{anchorElem:this.state.addAnchorElem,disabled:!1,onClose:function(){e.setState({addAnchorElem:null})},addCommands:this.props.addCommands}),(0,c.jsx)(F,{anchorElem:this.state.viewAnchorElem,disabled:!1,onClose:function(){e.setState({viewAnchorElem:null})},viewCommands:this.props.viewCommands})]})}},{key:"onFileMenuClick",value:function(e){this.setState({fileAnchorElem:e.currentTarget})}},{key:"onEditMenuClick",value:function(e){this.setState({editAnchorElem:e.currentTarget})}},{key:"onAddMenuClick",value:function(e){this.setState({addAnchorElem:e.currentTarget})}},{key:"onViewMenuClick",value:function(e){this.setState({viewAnchorElem:e.currentTarget})}}]),n}(s.Component),j=function(e){(0,a.Z)(n,e);var t=(0,o.Z)(n);function n(e){var r;return(0,i.Z)(this,n),(r=t.call(this,e)).stickRef=s.createRef(),r.onPointerDown=r.onPointerDown.bind((0,y.Z)(r)),r.onPointerMove=r.onPointerMove.bind((0,y.Z)(r)),r.onPointerUp=r.onPointerUp.bind((0,y.Z)(r)),r}return(0,r.Z)(n,[{key:"render",value:function(){return(0,c.jsxs)("div",{style:{width:"128px",position:"absolute",left:"10px",top:"10px",touchAction:"none"},onPointerMove:this.onPointerMove,children:[(0,c.jsx)("img",{src:this.props.baseImageSrc,style:{"-webkit-user-drag":"none",userSelect:"none",width:"80px",height:"80px"}}),(0,c.jsx)("div",{ref:this.stickRef,style:{position:"absolute",left:"20px",top:"20px"},onPointerDown:this.onPointerDown,children:(0,c.jsx)("img",{src:this.props.stickImageSrc,style:{"-webkit-user-drag":"none",userSelect:"none",width:"40px",height:"40px"}})})]})}},{key:"componentDidMount",value:function(){this.dragStart=null,this.touchId=null,this.active=!1,document.addEventListener("pointerup",this.onPointerUp),document.addEventListener("pointerleave",this.onPointerUp)}},{key:"onPointerDown",value:function(e){e.stopPropagation(),this.active=!0,this.stickRef.current.style.transition="0s",e.preventDefault(),e.stopPropagation(),e.changedTouches?this.dragStart={x:e.changedTouches[0].clientX,y:e.changedTouches[0].clientY}:this.dragStart={x:e.clientX,y:e.clientY},e.changedTouches&&(this.touchId=e.changedTouches[0].identifier),this.onTouch&&this.onTouch()}},{key:"onPointerMove",value:function(e){if(e.stopPropagation(),this.active){var t=null;if(e.changedTouches){for(var n=0;n<e.changedTouches.length;n++)this.touchId==e.changedTouches[n].identifier&&(t=n,e.clientX=e.changedTouches[n].clientX,e.clientY=e.changedTouches[n].clientY);if(null==t)return}var i=e.clientX-this.dragStart.x,r=e.clientY-this.dragStart.y,a=Math.atan2(r,i),o=Math.min(this.props.maxDistance,Math.hypot(i,r)),s=o*Math.cos(a),l=o*Math.sin(a);this.stickRef.current.style.transform="translate3d(".concat(s,"px, ").concat(l,"px, 0px)");var u=o<this.props.deadzone?0:this.props.maxDistance/(this.props.maxDistance-this.props.deadzone)*(o-this.props.deadzone),c=u*Math.cos(a),h=u*Math.sin(a);this.props.onMove&&this.props.onMove(c,h)}}},{key:"onPointerUp",value:function(e){e.stopPropagation(),this.active&&(e.changedTouches&&this.touchId!=e.changedTouches[0].identifier||(this.stickRef.current.style.transition=".2s",this.stickRef.current.style.transform="translate3d(0px, 0px, 0px)",this.touchId=null,this.active=!1,this.props.onRelease&&this.props.onRelease()))}}]),n}(s.Component),O=n(14213),z=function(e){(0,a.Z)(h,e);var t=(0,o.Z)(h);function h(e){var n;return(0,i.Z)(this,h),(n=t.call(this,e)).state={responseDialogOpen:!1,responseDialogText:"",errorMsg:"",message:"",tabs:[]},n._initialized=!1,n}return(0,r.Z)(h,[{key:"componentDidMount",value:function(){this._initialized||(this.props.viewModel.initialize(this.props.canvasRef.current,this.props.containerRef.current),this._initialized=!0)}},{key:"renderCanvasContainer",value:function(e){return(0,c.jsx)(s.Fragment,{children:(0,c.jsxs)("div",{ref:this.props.containerRef,id:"editor-ezv-canvas-container",style:e,children:[(0,c.jsx)("canvas",{ref:this.props.canvasRef,style:{cursor:"crosshair"}}),this.state.showVirtualJoystick&&(0,c.jsx)(j,{maxDistance:20,deadzone:2,onMove:this.props.viewModel.onJoystickMove,onTouch:this.props.viewModel.onJoystickTouch,onRelease:this.props.viewModel.onJoystickRelease,baseImageSrc:n(86317),stickImageSrc:n(27399)})]})})}},{key:"renderMainContent",value:function(){return this.renderCanvasContainer({width:"100%"})}},{key:"render",value:function(){if(this.props.viewModel)return(0,c.jsxs)(s.Fragment,{children:[(0,c.jsx)("div",{className:"editor-app-bar",children:(0,c.jsx)(U,{fileCommands:this.state.fileCommands,addCommands:this.state.addCommands,editCommands:this.state.editCommands,viewCommands:this.state.viewCommands,editorViewModel:this.props.viewModel})}),(0,c.jsxs)("div",{className:"editor-container",children:[(0,c.jsx)("div",{className:"editor-main-container",children:this.renderMainContent()}),(0,c.jsx)("div",{className:"editor-sidebar-container",children:(0,c.jsx)(d,{tabs:this.state.tabs})})]}),(0,c.jsx)(l.Z,{severity:"error",message:this.state.errorMsg,open:this.state.errorMsg.length>0,onClose:this.props.viewModel.onErrorAlertClose}),(0,c.jsx)(l.Z,{severity:"success",message:this.state.message,open:this.state.message.length>0,onClose:this.props.viewModel.onMessageAlertClose}),(0,c.jsx)(O.Z,{open:Boolean(this.state.responseDialogOpen),message:this.state.responseDialogText,okText:"CONTINUE",onOk:this.props.viewModel.onResponseDialogOk,onCancel:this.props.viewModel.onResponseDialogCancel}),(0,c.jsx)(u.NL,{when:!0,message:"Are you sure you want to leave? Unsaved changes will be lost."})]})}}]),h}(s.Component),G=n(1413),H=function(){function e(){(0,i.Z)(this,e)}return(0,r.Z)(e,[{key:"update",value:function(e){Object.values(this).forEach((function(t){return t.update(e)}))}}]),e}(),V=1,W=2,q=2,Y=1,J=(0,r.Z)((function e(){(0,i.Z)(this,e),this._id=null,this.productId=null,this.textBoxes=[],this.imageBoxes=[],this.annotations={annotations:[],visibilityTest:!0,showNavButtons:!0},this.shadowsEnabled=!0,this.sceneOptions={hdrEnvMapping:!0,reflections:!1,environmentMapId:"10",refractionMapId:"0",backgroundColor:"#ffffff",backgroundType:V,backgroundGradientColor1:"#ffffff",backgroundGradientColor2:"#404040",skyBoxImageId:"2",skyBoxBlurFactor:0,groundPlaneId:"1",showGroundPlane:!1,groundPlaneSize:10,groundPlaneTextureRepeat:10,groundPlaneTransparent:!1,groundPlaneOpacity:1,groundPlaneColor:"#ffffff",fogColor:"#BABFD9",fogDensity:.02,fogNear:100,fogFar:1e3,fog:!1,fogType:W,refractionMapImages:[],skyBoxImages:[],groundPlanes:[],environmentMapImages:[],enableReflection:!1,reflectionColor:"#ffffff",reflectionFadeScale:3,reflectionType:q,blurReflection:!1,reflectionOpacity:1},this.modelOptions={rotationY:0,snapToGround:!0},this.renderOptions={bloom:!1,bloomRadius:.5,bloomThreshold:.5,bloomStrength:.5,dof:!1,dofAperture:.5,dofFocus:.5,dofBlur:.5},this.lighting={castShadowOnGround:!1,shadowsEnabled:!1,shadowLightness:.7,bakedShadow:!0,bakedShadowBlur:.7,bakedShadowLightness:.7,bakedShadowFalloff:0,lightingPresetId:0,lightsRotation:0,ambientLightColor:"#ffffff",ambientLightIntensity:.2,enablePresets:!0},this.colorVariants={variants:[]},this.colorVariantBar={tiles:[],box:{orientation:"horizontal",show:!1,xAlign:"center",yAlign:"bottom",style:{left:"auto",right:"auto",top:"auto",bottom:"30px",width:"auto",height:"auto"}}},this.cameraOptions={fov:50,minElevation:0,maxElevation:180,controllerType:Y,firstPersonControllerMoveSpeed:1},this.audioOptions={playAudio:!1},this.configuratorState={parts:[],options:{show:!1}},this.settings={enableAr:!0,enableVr:!1,useWebAr:!1,autoRotate:!0,autoRotateSpeed:1,startAnimation:"",loopStartAnimation:!0,showAnimationControl:!1,showDimensionsTool:!1,vrWalkSpeed:.5,vrRayGeometryTest:!0,vrRayPlaneTest:!0},this.animationSettings={startAnimation:"",loopStartAnimation:!1,showAnimationControl:!1}})),X=("".concat("https://www.ezyvue.com/file-service/api","/files/envmaps/royal_esplanade_512.hdr"),"".concat("https://www.ezyvue.com/file-service/api","/files/envmaps/royal_esplanade_thumb.jpg"),"".concat("https://www.ezyvue.com/file-service/api","/files/envmaps/venice_sunset_512.hdr"),"".concat("https://www.ezyvue.com/file-service/api","/files/envmaps/venice_sunset_thumb.jpg"),"".concat("https://www.ezyvue.com/file-service/api","/files/envmaps/cayley_interior_512.hdr"),"".concat("https://www.ezyvue.com/file-service/api","/files/envmaps/cayley_interior_thumb.jpg"),"".concat("https://www.ezyvue.com/file-service/api","/files/envmaps/chinese_garden_512.hdr"),"".concat("https://www.ezyvue.com/file-service/api","/files/envmaps/chinese_garden_thumb.jpg"),"".concat("https://www.ezyvue.com/file-service/api","/files/envmaps/canary_wharf_512.hdr"),"".concat("https://www.ezyvue.com/file-service/api","/files/envmaps/canary_wharf_thumb.jpg"),"".concat("https://www.ezyvue.com/file-service/api","/files/envmaps/sunny_vondelpark_512.hdr"),"".concat("https://www.ezyvue.com/file-service/api","/files/envmaps/sunny_vondelpark_thumb.jpg"),"".concat("https://www.ezyvue.com/file-service/api","/files/envmaps/venice_sunrise_512.hdr"),"".concat("https://www.ezyvue.com/file-service/api","/files/envmaps/venice_sunrise_thumb.jpg"),"".concat("https://www.ezyvue.com/file-service/api","/files/envmaps/studio_small_08_512.hdr"),"".concat("https://www.ezyvue.com/file-service/api","/files/envmaps/studio_small_08_thumb.jpg"),"".concat("https://www.ezyvue.com/file-service/api","/files/envmaps/studio_small_09_512.hdr"),"".concat("https://www.ezyvue.com/file-service/api","/files/envmaps/studio_small_09_thumb.jpg"),"".concat("https://www.ezyvue.com/file-service/api","/files/envmaps/Entrance_Area_Georgensgmund_512.hdr"),"".concat("https://www.ezyvue.com/file-service/api","/files/envmaps/Entrance_Area_Georgensgmund.jpg"),"".concat("https://www.ezyvue.com/file-service/api","/files/envmaps/none.png"),"".concat("https://www.ezyvue.com/file-service/api","/files/envmaps/royal_esplanade/"),"".concat("https://www.ezyvue.com/file-service/api","/files/envmaps/royal_esplanade_thumb.jpg"),"".concat("https://www.ezyvue.com/file-service/api","/files/envmaps/venice_sunset/"),"".concat("https://www.ezyvue.com/file-service/api","/files/envmaps/venice_sunset_thumb.jpg"),"".concat("https://www.ezyvue.com/file-service/api","/files/envmaps/cayley_interior/"),"".concat("https://www.ezyvue.com/file-service/api","/files/envmaps/cayley_interior_thumb.jpg"),"".concat("https://www.ezyvue.com/file-service/api","/files/envmaps/chinese_garden/"),"".concat("https://www.ezyvue.com/file-service/api","/files/envmaps/chinese_garden_thumb.jpg"),"".concat("https://www.ezyvue.com/file-service/api","/files/envmaps/canary_wharf/"),"".concat("https://www.ezyvue.com/file-service/api","/files/envmaps/canary_wharf_thumb.jpg"),"".concat("https://www.ezyvue.com/file-service/api","/files/envmaps/sunny_vondelpark/"),"".concat("https://www.ezyvue.com/file-service/api","/files/envmaps/sunny_vondelpark_thumb.jpg"),"".concat("https://www.ezyvue.com/file-service/api","/files/envmaps/venice_sunrise/"),"".concat("https://www.ezyvue.com/file-service/api","/files/envmaps/venice_sunrise_thumb.jpg"),"".concat("https://www.ezyvue.com/file-service/api","/files/envmaps/interior/"),"".concat("https://www.ezyvue.com/file-service/api","/files/envmaps/Entrance_Area_Georgensgmund.jpg"),"".concat("https://www.ezyvue.com/file-service/api","/files/envmaps/studio/"),"".concat("https://www.ezyvue.com/file-service/api","/files/envmaps/studio_small_08_thumb.jpg"),"".concat("https://www.ezyvue.com/file-service/api","/files/envmaps/studio1/"),"".concat("https://www.ezyvue.com/file-service/api","/files/envmaps/studio_small_09_thumb.jpg"),"".concat("https://www.ezyvue.com/file-service/api","/files/envmaps/royal_esplanade/"),"".concat("https://www.ezyvue.com/file-service/api","/files/envmaps/royal_esplanade_thumb.jpg"),"".concat("https://www.ezyvue.com/file-service/api","/files/envmaps/venice_sunset/"),"".concat("https://www.ezyvue.com/file-service/api","/files/envmaps/venice_sunset_thumb.jpg"),"".concat("https://www.ezyvue.com/file-service/api","/files/envmaps/cayley_interior/"),"".concat("https://www.ezyvue.com/file-service/api","/files/envmaps/cayley_interior_thumb.jpg"),"".concat("https://www.ezyvue.com/file-service/api","/files/envmaps/chinese_garden/"),"".concat("https://www.ezyvue.com/file-service/api","/files/envmaps/chinese_garden_thumb.jpg"),"".concat("https://www.ezyvue.com/file-service/api","/files/envmaps/canary_wharf/"),"".concat("https://www.ezyvue.com/file-service/api","/files/envmaps/canary_wharf_thumb.jpg"),"".concat("https://www.ezyvue.com/file-service/api","/files/envmaps/sunny_vondelpark/"),"".concat("https://www.ezyvue.com/file-service/api","/files/envmaps/sunny_vondelpark_thumb.jpg"),"".concat("https://www.ezyvue.com/file-service/api","/files/envmaps/venice_sunrise/"),"".concat("https://www.ezyvue.com/file-service/api","/files/envmaps/venice_sunrise_thumb.jpg"),"".concat("https://www.ezyvue.com/file-service/api","/files/envmaps/interior/"),"".concat("https://www.ezyvue.com/file-service/api","/files/envmaps/Entrance_Area_Georgensgmund.jpg"),"".concat("https://www.ezyvue.com/file-service/api","/files/envmaps/studio/"),"".concat("https://www.ezyvue.com/file-service/api","/files/envmaps/studio_small_08_thumb.jpg"),"".concat("https://www.ezyvue.com/file-service/api","/files/envmaps/studio1/"),"".concat("https://www.ezyvue.com/file-service/api","/files/envmaps/studio_small_09_thumb.jpg"),"".concat("https://www.ezyvue.com/file-service/api","/files/images/lighting_presets/white.jpg"),"".concat("https://www.ezyvue.com/file-service/api","/files/images/lighting_presets/bright.jpg"),"".concat("https://www.ezyvue.com/file-service/api","/files/images/lighting_presets/skyblue.jpg"),"".concat("https://www.ezyvue.com/file-service/api","/files/images/lighting_presets/coolgreen.jpg"),"".concat("https://www.ezyvue.com/file-service/api","/files/images/lighting_presets/red.jpg"),"".concat("https://www.ezyvue.com/file-service/api","/files/images/lighting_presets/desertsky.jpg"),"".concat("https://www.ezyvue.com/file-service/api","/files/images/lighting_presets/hemisphere.jpg"),"".concat("https://www.ezyvue.com/file-service/api","/files/images/lighting_presets/nolights.jpg"),"".concat("https://www.ezyvue.com/file-service/api","/files/textures/ground/wood1/kitchen_wood_diff_1k.jpg"),"".concat("https://www.ezyvue.com/file-service/api","/files/textures/ground/wood1/kitchen_wood_ao_1k.jpg"),"".concat("https://www.ezyvue.com/file-service/api","/files/textures/ground/wood1/kitchen_wood_nor_1k.jpg"),"".concat("https://www.ezyvue.com/file-service/api","/files/textures/ground/wood1/kitchen_wood_rough_1k.jpg"),"".concat("https://www.ezyvue.com/file-service/api","/files/textures/ground/wood2/fine_grained_wood_col_1k.jpg"),"".concat("https://www.ezyvue.com/file-service/api","/files/textures/ground/wood2/fine_grained_wood_ao_1k.jpg"),"".concat("https://www.ezyvue.com/file-service/api","/files/textures/ground/wood2/fine_grained_wood_normal_1k.jpg"),"".concat("https://www.ezyvue.com/file-service/api","/files/textures/ground/wood2/fine_grained_wood_rough_1k.jpg"),"".concat("https://www.ezyvue.com/file-service/api","/files/textures/ground/planks/green_rough_planks_diff_1k.jpg"),"".concat("https://www.ezyvue.com/file-service/api","/files/textures/ground/planks/green_rough_planks_ao_1k.jpg"),"".concat("https://www.ezyvue.com/file-service/api","/files/textures/ground/planks/green_rough_planks_nor_1k.jpg"),"".concat("https://www.ezyvue.com/file-service/api","/files/textures/ground/planks/green_rough_planks_rough_1k.jpg"),"".concat("https://www.ezyvue.com/file-service/api","/files/textures/ground/tiles/tiled_floor_001_diffuse_1k.jpg"),"".concat("https://www.ezyvue.com/file-service/api","/files/textures/ground/tiles/tiled_floor_001_AO_1k.jpg"),"".concat("https://www.ezyvue.com/file-service/api","/files/textures/ground/tiles/tiled_floor_001_nor_1k.jpg"),"".concat("https://www.ezyvue.com/file-service/api","/files/textures/ground/tiles/tiled_floor_001_rough_1k.jpg"),"".concat("https://www.ezyvue.com/file-service/api","/files/textures/ground/tiles2/floor_tiles_06_diff_1k.jpg"),"".concat("https://www.ezyvue.com/file-service/api","/files/textures/ground/tiles2/floor_tiles_06_AO_1k.jpg"),"".concat("https://www.ezyvue.com/file-service/api","/files/textures/ground/tiles2/floor_tiles_06_nor_1k.jpg"),"".concat("https://www.ezyvue.com/file-service/api","/files/textures/ground/tiles2/floor_tiles_06_rough_1k.jpg"),"".concat("https://www.ezyvue.com/file-service/api","/files/textures/ground/tiles1/floor_tiles_02_diff_1k.jpg"),"".concat("https://www.ezyvue.com/file-service/api","/files/textures/ground/tiles1/floor_tiles_02_ao_1k.jpg"),"".concat("https://www.ezyvue.com/file-service/api","/files/textures/ground/tiles1/floor_tiles_02_nor_1k.jpg"),"".concat("https://www.ezyvue.com/file-service/api","/files/textures/ground/tiles1/floor_tiles_02_rough_1k.jpg"),"".concat("https://www.ezyvue.com/file-service/api","/files/textures/ground/granite/Granite_001_COLOR.jpg"),"".concat("https://www.ezyvue.com/file-service/api","/files/textures/ground/granite/Granite_001_NORM.jpg"),"".concat("https://www.ezyvue.com/file-service/api","/files/textures/ground/granite/Granite_001_ROUGH.jpg"),"".concat("https://www.ezyvue.com/file-service/api","/files/textures/ground/dark_granite/Granite_002_COLOR_COLOR.jpg"),"".concat("https://www.ezyvue.com/file-service/api","/files/textures/ground/dark_granite/Granite_002_COLOR_NORM.jpg"),"".concat("https://www.ezyvue.com/file-service/api","/files/textures/ground/dark_granite/Granite_002_COLOR_ROUGH.jpg"),"".concat("https://www.ezyvue.com/file-service/api","/files/textures/ground/asphalt/Asphalt_002_COLOR.jpg"),"".concat("https://www.ezyvue.com/file-service/api","/files/textures/ground/asphalt/Asphalt_002_OCC.jpg"),"".concat("https://www.ezyvue.com/file-service/api","/files/textures/ground/asphalt/Asphalt_002_NORM.jpg"),"".concat("https://www.ezyvue.com/file-service/api","/files/textures/ground/ground/aerial_grass_rock_diff_1k.jpg"),"".concat("https://www.ezyvue.com/file-service/api","/files/textures/ground/ground/aerial_grass_rock_ao_1k.jpg"),"".concat("https://www.ezyvue.com/file-service/api","/files/textures/ground/ground/aerial_grass_rock_nor_1k.jpg"),"".concat("https://www.ezyvue.com/file-service/api","/files/textures/ground/ground/aerial_grass_rock_rough_1k.jpg"),n(93433)),K=n(70804),$=function(){function e(){(0,i.Z)(this,e),this.pluginCallbacks=[],this.register((function(e){return new ke(e)})),this.register((function(e){return new Be(e)})),this.register((function(e){return new Re(e)})),this.register((function(e){return new Pe(e)})),this.register((function(e){return new Le(e)})),this.register((function(e){return new Qe(e)})),this.register((function(e){return new Te(e)})),this.register((function(e){return new De(e)}))}return(0,r.Z)(e,[{key:"register",value:function(e){return-1===this.pluginCallbacks.indexOf(e)&&this.pluginCallbacks.push(e),this}},{key:"unregister",value:function(e){return-1!==this.pluginCallbacks.indexOf(e)&&this.pluginCallbacks.splice(this.pluginCallbacks.indexOf(e),1),this}},{key:"parse",value:function(e,t,n,i){for(var r=new Se,a=[],o=0,s=this.pluginCallbacks.length;o<s;o++)a.push(this.pluginCallbacks[o](r));r.setPlugins(a),r.write(e,t,i).catch(n)}},{key:"parseAsync",value:function(e,t){var n=this;return new Promise((function(i,r){n.parse(e,i,r,t)}))}}]),e}(),ee=0,te=1,ne=2,ie=3,re=4,ae=5121,oe=5123,se=5126,le=5125,ue=34962,ce=34963,he=9728,de=9729,fe=9984,pe=9985,Ae=9986,ve=9987,ge=33071,me=33648,ye=10497,xe={};xe[K.TyD]=he,xe[K.YLQ]=fe,xe[K.aH4]=Ae,xe[K.wem]=de,xe[K.qyh]=pe,xe[K.D1R]=ve,xe[K.uWy]=ge,xe[K.rpg]=ye,xe[K.OoA]=me;var we={scale:"scale",position:"translation",quaternion:"rotation",morphTargetInfluences:"weights"},Ce=new K.Ilk;function be(e,t){return e.length===t.length&&e.every((function(e,n){return e===t[n]}))}function _e(e){return 4*Math.ceil(e/4)}function Ee(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,n=_e(e.byteLength);if(n!==e.byteLength){var i=new Uint8Array(n);if(i.set(new Uint8Array(e)),0!==t)for(var r=e.byteLength;r<n;r++)i[r]=t;return i.buffer}return e}function Me(){return"undefined"===typeof document&&"undefined"!==typeof OffscreenCanvas?new OffscreenCanvas(1,1):document.createElement("canvas")}function Ie(e,t){return void 0!==e.toBlob?new Promise((function(n){return e.toBlob(n,t)})):("image/jpeg"===t?n=.92:"image/webp"===t&&(n=.8),e.convertToBlob({type:t,quality:n}));var n}var Se=function(){function e(){(0,i.Z)(this,e),this.plugins=[],this.options={},this.pending=[],this.buffers=[],this.byteOffset=0,this.buffers=[],this.nodeMap=new Map,this.skins=[],this.extensionsUsed={},this.uids=new Map,this.uid=0,this.json={asset:{version:"2.0",generator:"THREE.GLTFExporter"}},this.cache={meshes:new Map,attributes:new Map,attributesNormalized:new Map,materials:new Map,textures:new Map,images:new Map}}return(0,r.Z)(e,[{key:"setPlugins",value:function(e){this.plugins=e}},{key:"write",value:function(){var e=(0,p.Z)((0,f.Z)().mark((function e(t,n){var i,r,a,o,s,l,u,c,h,d=arguments;return(0,f.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return i=d.length>2&&void 0!==d[2]?d[2]:{},this.options=Object.assign({binary:!1,trs:!1,onlyVisible:!0,maxTextureSize:1/0,animations:[],includeCustomExtensions:!1},i),this.options.animations.length>0&&(this.options.trs=!0),this.processInput(t),e.next=6,Promise.all(this.pending);case 6:a=(r=this).buffers,o=r.json,i=r.options,s=r.extensionsUsed,l=new Blob(a,{type:"application/octet-stream"}),(u=Object.keys(s)).length>0&&(o.extensionsUsed=u),o.buffers&&o.buffers.length>0&&(o.buffers[0].byteLength=l.size),!0===i.binary?((c=new FileReader).readAsArrayBuffer(l),c.onloadend=function(){var e=Ee(c.result),t=new DataView(new ArrayBuffer(8));t.setUint32(0,e.byteLength,!0),t.setUint32(4,5130562,!0);var i,r=Ee((i=JSON.stringify(o),(new TextEncoder).encode(i).buffer),32),a=new DataView(new ArrayBuffer(8));a.setUint32(0,r.byteLength,!0),a.setUint32(4,1313821514,!0);var s=new ArrayBuffer(12),l=new DataView(s);l.setUint32(0,1179937895,!0),l.setUint32(4,2,!0);var u=12+a.byteLength+r.byteLength+t.byteLength+e.byteLength;l.setUint32(8,u,!0);var h=new Blob([s,a,r,t,e],{type:"application/octet-stream"}),d=new FileReader;d.readAsArrayBuffer(h),d.onloadend=function(){n(d.result)}}):o.buffers&&o.buffers.length>0?((h=new FileReader).readAsDataURL(l),h.onloadend=function(){var e=h.result;o.buffers[0].uri=e,n(o)}):n(o);case 16:case"end":return e.stop()}}),e,this)})));return function(t,n){return e.apply(this,arguments)}}()},{key:"serializeUserData",value:function(e,t){if(0!==Object.keys(e.userData).length){var n=this.options,i=this.extensionsUsed;try{var r=JSON.parse(JSON.stringify(e.userData));if(n.includeCustomExtensions&&r.gltfExtensions){for(var a in void 0===t.extensions&&(t.extensions={}),r.gltfExtensions)t.extensions[a]=r.gltfExtensions[a],i[a]=!0;delete r.gltfExtensions}Object.keys(r).length>0&&(t.extras=r)}catch(o){console.warn("THREE.GLTFExporter: userData of '"+e.name+"' won't be serialized because of JSON.stringify error - "+o.message)}}}},{key:"getUID",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]&&arguments[1];if(!1===this.uids.has(e)){var n=new Map;n.set(!0,this.uid++),n.set(!1,this.uid++),this.uids.set(e,n)}return this.uids.get(e).get(t)}},{key:"isNormalizedNormalAttribute",value:function(e){if(this.cache.attributesNormalized.has(e))return!1;for(var t=new K.Pa4,n=0,i=e.count;n<i;n++)if(Math.abs(t.fromBufferAttribute(e,n).length()-1)>5e-4)return!1;return!0}},{key:"createNormalizedNormalAttribute",value:function(e){var t=this.cache;if(t.attributesNormalized.has(e))return t.attributesNormalized.get(e);for(var n=e.clone(),i=new K.Pa4,r=0,a=n.count;r<a;r++)i.fromBufferAttribute(n,r),0===i.x&&0===i.y&&0===i.z?i.setX(1):i.normalize(),n.setXYZ(r,i.x,i.y,i.z);return t.attributesNormalized.set(e,n),n}},{key:"applyTextureTransform",value:function(e,t){var n=!1,i={};0===t.offset.x&&0===t.offset.y||(i.offset=t.offset.toArray(),n=!0),0!==t.rotation&&(i.rotation=t.rotation,n=!0),1===t.repeat.x&&1===t.repeat.y||(i.scale=t.repeat.toArray(),n=!0),n&&(e.extensions=e.extensions||{},e.extensions.KHR_texture_transform=i,this.extensionsUsed.KHR_texture_transform=!0)}},{key:"buildMetalRoughTexture",value:function(e,t){if(e===t)return e;function n(e){return e.encoding===K.knz?function(e){return e<.04045?.0773993808*e:Math.pow(.9478672986*e+.0521327014,2.4)}:function(e){return e}}console.warn("THREE.GLTFExporter: Merged metalnessMap and roughnessMap textures.");var i=e?e.image:null,r=t?t.image:null,a=Math.max(i?i.width:0,r?r.width:0),o=Math.max(i?i.height:0,r?r.height:0),s=Me();s.width=a,s.height=o;var l=s.getContext("2d");l.fillStyle="#00ffff",l.fillRect(0,0,a,o);var u=l.getImageData(0,0,a,o);if(i){l.drawImage(i,0,0,a,o);for(var c=n(e),h=l.getImageData(0,0,a,o).data,d=2;d<h.length;d+=4)u.data[d]=256*c(h[d]/256)}if(r){l.drawImage(r,0,0,a,o);for(var f=n(t),p=l.getImageData(0,0,a,o).data,A=1;A<p.length;A+=4)u.data[A]=256*f(p[A]/256)}l.putImageData(u,0,0);var v=(e||t).clone();return v.source=new K.Hw6(s),v.encoding=K.rnI,v}},{key:"processBuffer",value:function(e){var t=this.json,n=this.buffers;return t.buffers||(t.buffers=[{byteLength:0}]),n.push(e),0}},{key:"processBufferView",value:function(e,t,n,i,r){var a,o=this.json;o.bufferViews||(o.bufferViews=[]),a=t===ae?1:t===oe?2:4;for(var s=_e(i*e.itemSize*a),l=new DataView(new ArrayBuffer(s)),u=0,c=n;c<n+i;c++)for(var h=0;h<e.itemSize;h++){var d=void 0;e.itemSize>4?d=e.array[c*e.itemSize+h]:(0===h?d=e.getX(c):1===h?d=e.getY(c):2===h?d=e.getZ(c):3===h&&(d=e.getW(c)),!0===e.normalized&&(d=K.M8C.normalize(d,e.array))),t===se?l.setFloat32(u,d,!0):t===le?l.setUint32(u,d,!0):t===oe?l.setUint16(u,d,!0):t===ae&&l.setUint8(u,d),u+=a}var f={buffer:this.processBuffer(l.buffer),byteOffset:this.byteOffset,byteLength:s};return void 0!==r&&(f.target=r),r===ue&&(f.byteStride=e.itemSize*a),this.byteOffset+=s,o.bufferViews.push(f),{id:o.bufferViews.length-1,byteLength:0}}},{key:"processBufferViewImage",value:function(e){var t=this,n=t.json;return n.bufferViews||(n.bufferViews=[]),new Promise((function(i){var r=new FileReader;r.readAsArrayBuffer(e),r.onloadend=function(){var e=Ee(r.result),a={buffer:t.processBuffer(e),byteOffset:t.byteOffset,byteLength:e.byteLength};t.byteOffset+=e.byteLength,i(n.bufferViews.push(a)-1)}}))}},{key:"processAccessor",value:function(e,t,n,i){var r,a=this.json;if(e.array.constructor===Float32Array)r=se;else if(e.array.constructor===Uint32Array)r=le;else if(e.array.constructor===Uint16Array)r=oe;else{if(e.array.constructor!==Uint8Array)throw new Error("THREE.GLTFExporter: Unsupported bufferAttribute component type.");r=ae}if(void 0===n&&(n=0),void 0===i&&(i=e.count),0===i)return null;var o,s=function(e,t,n){for(var i={min:new Array(e.itemSize).fill(Number.POSITIVE_INFINITY),max:new Array(e.itemSize).fill(Number.NEGATIVE_INFINITY)},r=t;r<t+n;r++)for(var a=0;a<e.itemSize;a++){var o=void 0;e.itemSize>4?o=e.array[r*e.itemSize+a]:(0===a?o=e.getX(r):1===a?o=e.getY(r):2===a?o=e.getZ(r):3===a&&(o=e.getW(r)),!0===e.normalized&&(o=K.M8C.normalize(o,e.array))),i.min[a]=Math.min(i.min[a],o),i.max[a]=Math.max(i.max[a],o)}return i}(e,n,i);void 0!==t&&(o=e===t.index?ce:ue);var l=this.processBufferView(e,r,n,i,o),u={bufferView:l.id,byteOffset:l.byteOffset,componentType:r,count:i,max:s.max,min:s.min,type:{1:"SCALAR",2:"VEC2",3:"VEC3",4:"VEC4",16:"MAT4"}[e.itemSize]};return!0===e.normalized&&(u.normalized=!0),a.accessors||(a.accessors=[]),a.accessors.push(u)-1}},{key:"processImage",value:function(e,t,n){var i=arguments.length>3&&void 0!==arguments[3]?arguments[3]:"image/png";if(null!==e){var r=this,a=r.cache,o=r.json,s=r.options,l=r.pending;a.images.has(e)||a.images.set(e,{});var u=a.images.get(e),c=i+":flipY/"+n.toString();if(void 0!==u[c])return u[c];o.images||(o.images=[]);var h={mimeType:i},d=Me();d.width=Math.min(e.width,s.maxTextureSize),d.height=Math.min(e.height,s.maxTextureSize);var f=d.getContext("2d");if(!0===n&&(f.translate(0,d.height),f.scale(1,-1)),void 0!==e.data){t!==K.wk1&&console.error("GLTFExporter: Only RGBAFormat is supported."),(e.width>s.maxTextureSize||e.height>s.maxTextureSize)&&console.warn("GLTFExporter: Image size is bigger than maxTextureSize",e);for(var p=new Uint8ClampedArray(e.height*e.width*4),A=0;A<p.length;A+=4)p[A+0]=e.data[A+0],p[A+1]=e.data[A+1],p[A+2]=e.data[A+2],p[A+3]=e.data[A+3];f.putImageData(new ImageData(p,e.width,e.height),0,0)}else f.drawImage(e,0,0,d.width,d.height);!0===s.binary?l.push(Ie(d,i).then((function(e){return r.processBufferViewImage(e)})).then((function(e){h.bufferView=e}))):void 0!==d.toDataURL?h.uri=d.toDataURL(i):l.push(Ie(d,i).then((function(e){return(new FileReader).readAsDataURL(e)})).then((function(e){h.uri=e})));var v=o.images.push(h)-1;return u[c]=v,v}throw new Error("THREE.GLTFExporter: No valid image data found. Unable to process texture.")}},{key:"processSampler",value:function(e){var t=this.json;t.samplers||(t.samplers=[]);var n={magFilter:xe[e.magFilter],minFilter:xe[e.minFilter],wrapS:xe[e.wrapS],wrapT:xe[e.wrapT]};return t.samplers.push(n)-1}},{key:"processTexture",value:function(e){var t=this.cache,n=this.json;if(t.textures.has(e))return t.textures.get(e);n.textures||(n.textures=[]);var i=e.userData.mimeType;"image/webp"===i&&(i="image/png");var r={sampler:this.processSampler(e),source:this.processImage(e.image,e.format,e.flipY,i)};e.name&&(r.name=e.name),this._invokeAll((function(t){t.writeTexture&&t.writeTexture(e,r)}));var a=n.textures.push(r)-1;return t.textures.set(e,a),a}},{key:"processMaterial",value:function(e){var t=this.cache,n=this.json;if(t.materials.has(e))return t.materials.get(e);if(e.isShaderMaterial)return console.warn("GLTFExporter: THREE.ShaderMaterial not supported."),null;n.materials||(n.materials=[]);var i={pbrMetallicRoughness:{}};!0!==e.isMeshStandardMaterial&&!0!==e.isMeshBasicMaterial&&console.warn("GLTFExporter: Use MeshStandardMaterial or MeshBasicMaterial for best results.");var r=e.color.toArray().concat([e.opacity]);if(be(r,[1,1,1,1])||(i.pbrMetallicRoughness.baseColorFactor=r),e.isMeshStandardMaterial?(i.pbrMetallicRoughness.metallicFactor=e.metalness,i.pbrMetallicRoughness.roughnessFactor=e.roughness):(i.pbrMetallicRoughness.metallicFactor=.5,i.pbrMetallicRoughness.roughnessFactor=.5),e.metalnessMap||e.roughnessMap){var a=this.buildMetalRoughTexture(e.metalnessMap,e.roughnessMap),o={index:this.processTexture(a)};this.applyTextureTransform(o,a),i.pbrMetallicRoughness.metallicRoughnessTexture=o}if(e.map){var s={index:this.processTexture(e.map)};this.applyTextureTransform(s,e.map),i.pbrMetallicRoughness.baseColorTexture=s}if(e.emissive){var l=e.emissive.clone().multiplyScalar(e.emissiveIntensity),u=Math.max(l.r,l.g,l.b);if(u>1&&(l.multiplyScalar(1/u),console.warn("THREE.GLTFExporter: Some emissive components exceed 1; emissive has been limited")),u>0&&(i.emissiveFactor=l.toArray()),e.emissiveMap){var c={index:this.processTexture(e.emissiveMap)};this.applyTextureTransform(c,e.emissiveMap),i.emissiveTexture=c}}if(e.normalMap){var h={index:this.processTexture(e.normalMap)};e.normalScale&&1!==e.normalScale.x&&(h.scale=e.normalScale.x),this.applyTextureTransform(h,e.normalMap),i.normalTexture=h}if(e.aoMap){var d={index:this.processTexture(e.aoMap),texCoord:1};1!==e.aoMapIntensity&&(d.strength=e.aoMapIntensity),this.applyTextureTransform(d,e.aoMap),i.occlusionTexture=d}e.transparent?i.alphaMode="BLEND":e.alphaTest>0&&(i.alphaMode="MASK",i.alphaCutoff=e.alphaTest),e.side===K.ehD&&(i.doubleSided=!0),""!==e.name&&(i.name=e.name),this.serializeUserData(e,i),this._invokeAll((function(t){t.writeMaterial&&t.writeMaterial(e,i)}));var f=n.materials.push(i)-1;return t.materials.set(e,f),f}},{key:"processMesh",value:function(e){var t=this.cache,n=this.json,i=[e.geometry.uuid];if(Array.isArray(e.material))for(var r=0,a=e.material.length;r<a;r++)i.push(e.material[r].uuid);else i.push(e.material.uuid);var o=i.join(":");if(t.meshes.has(o))return t.meshes.get(o);var s,l=e.geometry;s=e.isLineSegments?te:e.isLineLoop?ne:e.isLine?ie:e.isPoints?ee:e.material.wireframe?te:re;var u={},c={},h=[],d=[],f={uv:"TEXCOORD_0",uv2:"TEXCOORD_1",color:"COLOR_0",skinWeight:"WEIGHTS_0",skinIndex:"JOINTS_0"},p=l.getAttribute("normal");void 0===p||this.isNormalizedNormalAttribute(p)||(console.warn("THREE.GLTFExporter: Creating normalized normal attribute from the non-normalized one."),l.setAttribute("normal",this.createNormalizedNormalAttribute(p)));var A=null;for(var v in l.attributes)if("morph"!==v.slice(0,5)){var g=l.attributes[v];v=f[v]||v.toUpperCase();if(/^(POSITION|NORMAL|TANGENT|TEXCOORD_\d+|COLOR_\d+|JOINTS_\d+|WEIGHTS_\d+)$/.test(v)||(v="_"+v),t.attributes.has(this.getUID(g)))c[v]=t.attributes.get(this.getUID(g));else{A=null;var m=g.array;"JOINTS_0"!==v||m instanceof Uint16Array||m instanceof Uint8Array||(console.warn('GLTFExporter: Attribute "skinIndex" converted to type UNSIGNED_SHORT.'),A=new K.TlE(new Uint16Array(m),g.itemSize,g.normalized));var y=this.processAccessor(A||g,l);null!==y&&(c[v]=y,t.attributes.set(this.getUID(g),y))}}if(void 0!==p&&l.setAttribute("normal",p),0===Object.keys(c).length)return null;if(void 0!==e.morphTargetInfluences&&e.morphTargetInfluences.length>0){var x=[],w=[],C={};if(void 0!==e.morphTargetDictionary)for(var b in e.morphTargetDictionary)C[e.morphTargetDictionary[b]]=b;for(var _=0;_<e.morphTargetInfluences.length;++_){var E={},M=!1;for(var I in l.morphAttributes)if("position"===I||"normal"===I){var S=l.morphAttributes[I][_],k=I.toUpperCase(),B=l.attributes[I];if(t.attributes.has(this.getUID(S,!0)))E[k]=t.attributes.get(this.getUID(S,!0));else{var T=S.clone();if(!l.morphTargetsRelative)for(var D=0,R=S.count;D<R;D++)for(var P=0;P<S.itemSize;P++)0===P&&T.setX(D,S.getX(D)-B.getX(D)),1===P&&T.setY(D,S.getY(D)-B.getY(D)),2===P&&T.setZ(D,S.getZ(D)-B.getZ(D)),3===P&&T.setW(D,S.getW(D)-B.getW(D));E[k]=this.processAccessor(T,l),t.attributes.set(this.getUID(B,!0),E[k])}}else M||(console.warn("GLTFExporter: Only POSITION and NORMAL morph are supported."),M=!0);d.push(E),x.push(e.morphTargetInfluences[_]),void 0!==e.morphTargetDictionary&&w.push(C[_])}u.weights=x,w.length>0&&(u.extras={},u.extras.targetNames=w)}var L=Array.isArray(e.material);if(L&&0===l.groups.length)return null;for(var Q=L?e.material:[e.material],Z=L?l.groups:[{materialIndex:0,start:void 0,count:void 0}],N=0,F=Z.length;N<F;N++){var U={mode:s,attributes:c};if(this.serializeUserData(l,U),d.length>0&&(U.targets=d),null!==l.index){var j=this.getUID(l.index);void 0===Z[N].start&&void 0===Z[N].count||(j+=":"+Z[N].start+":"+Z[N].count),t.attributes.has(j)?U.indices=t.attributes.get(j):(U.indices=this.processAccessor(l.index,l,Z[N].start,Z[N].count),t.attributes.set(j,U.indices)),null===U.indices&&delete U.indices}var O=this.processMaterial(Q[Z[N].materialIndex]);null!==O&&(U.material=O),h.push(U)}u.primitives=h,n.meshes||(n.meshes=[]),this._invokeAll((function(t){t.writeMesh&&t.writeMesh(e,u)}));var z=n.meshes.push(u)-1;return t.meshes.set(o,z),z}},{key:"processCamera",value:function(e){var t=this.json;t.cameras||(t.cameras=[]);var n=e.isOrthographicCamera,i={type:n?"orthographic":"perspective"};return n?i.orthographic={xmag:2*e.right,ymag:2*e.top,zfar:e.far<=0?.001:e.far,znear:e.near<0?0:e.near}:i.perspective={aspectRatio:e.aspect,yfov:K.M8C.degToRad(e.fov),zfar:e.far<=0?.001:e.far,znear:e.near<0?0:e.near},""!==e.name&&(i.name=e.type),t.cameras.push(i)-1}},{key:"processAnimation",value:function(e,t){var n=this.json,i=this.nodeMap;n.animations||(n.animations=[]);for(var r=(e=$.Utils.mergeMorphTargetTracks(e.clone(),t)).tracks,a=[],o=[],s=0;s<r.length;++s){var l=r[s],u=K.iUV.parseTrackName(l.name),c=K.iUV.findNode(t,u.nodeName),h=we[u.propertyName];if("bones"===u.objectName&&(c=!0===c.isSkinnedMesh?c.skeleton.getBoneByName(u.objectIndex):void 0),!c||!h)return console.warn('THREE.GLTFExporter: Could not export animation track "%s".',l.name),null;var d=l.values.length/l.times.length;h===we.morphTargetInfluences&&(d/=c.morphTargetInfluences.length);var f=void 0;!0===l.createInterpolant.isInterpolantFactoryMethodGLTFCubicSpline?(f="CUBICSPLINE",d/=3):f=l.getInterpolation()===K.Syv?"STEP":"LINEAR",o.push({input:this.processAccessor(new K.TlE(l.times,1)),output:this.processAccessor(new K.TlE(l.values,d)),interpolation:f}),a.push({sampler:o.length-1,target:{node:i.get(c),path:h}})}return n.animations.push({name:e.name||"clip_"+n.animations.length,samplers:o,channels:a}),n.animations.length-1}},{key:"processSkin",value:function(e){var t=this.json,n=this.nodeMap,i=t.nodes[n.get(e)],r=e.skeleton;if(void 0===r)return null;var a=e.skeleton.bones[0];if(void 0===a)return null;for(var o=[],s=new Float32Array(16*r.bones.length),l=new K.yGw,u=0;u<r.bones.length;++u)o.push(n.get(r.bones[u])),l.copy(r.boneInverses[u]),l.multiply(e.bindMatrix).toArray(s,16*u);return void 0===t.skins&&(t.skins=[]),t.skins.push({inverseBindMatrices:this.processAccessor(new K.TlE(s,16)),joints:o,skeleton:n.get(a)}),i.skin=t.skins.length-1}},{key:"processNode",value:function(e){var t=this.json,n=this.options,i=this.nodeMap;t.nodes||(t.nodes=[]);var r={};if(n.trs){var a=e.quaternion.toArray(),o=e.position.toArray(),s=e.scale.toArray();be(a,[0,0,0,1])||(r.rotation=a),be(o,[0,0,0])||(r.translation=o),be(s,[1,1,1])||(r.scale=s)}else e.matrixAutoUpdate&&e.updateMatrix(),!1===be(e.matrix.elements,[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1])&&(r.matrix=e.matrix.elements);if(""!==e.name&&(r.name=String(e.name)),this.serializeUserData(e,r),e.isMesh||e.isLine||e.isPoints){var l=this.processMesh(e);null!==l&&(r.mesh=l)}else e.isCamera&&(r.camera=this.processCamera(e));if(e.isSkinnedMesh&&this.skins.push(e),e.children.length>0){for(var u=[],c=0,h=e.children.length;c<h;c++){var d=e.children[c];if(d.visible||!1===n.onlyVisible){var f=this.processNode(d);null!==f&&u.push(f)}}u.length>0&&(r.children=u)}this._invokeAll((function(t){t.writeNode&&t.writeNode(e,r)}));var p=t.nodes.push(r)-1;return i.set(e,p),p}},{key:"processScene",value:function(e){var t=this.json,n=this.options;t.scenes||(t.scenes=[],t.scene=0);var i={};""!==e.name&&(i.name=e.name),t.scenes.push(i);for(var r=[],a=0,o=e.children.length;a<o;a++){var s=e.children[a];if(s.visible||!1===n.onlyVisible){var l=this.processNode(s);null!==l&&r.push(l)}}r.length>0&&(i.nodes=r),this.serializeUserData(e,i)}},{key:"processObjects",value:function(e){var t=new K.xsS;t.name="AuxScene";for(var n=0;n<e.length;n++)t.children.push(e[n]);this.processScene(t)}},{key:"processInput",value:function(e){var t=this.options;e=e instanceof Array?e:[e],this._invokeAll((function(t){t.beforeParse&&t.beforeParse(e)}));for(var n=[],i=0;i<e.length;i++)e[i]instanceof K.xsS?this.processScene(e[i]):n.push(e[i]);n.length>0&&this.processObjects(n);for(var r=0;r<this.skins.length;++r)this.processSkin(this.skins[r]);for(var a=0;a<t.animations.length;++a)this.processAnimation(t.animations[a],e[0]);this._invokeAll((function(t){t.afterParse&&t.afterParse(e)}))}},{key:"_invokeAll",value:function(e){for(var t=0,n=this.plugins.length;t<n;t++)e(this.plugins[t])}}]),e}(),ke=function(){function e(t){(0,i.Z)(this,e),this.writer=t,this.name="KHR_lights_punctual"}return(0,r.Z)(e,[{key:"writeNode",value:function(e,t){if(e.isLight)if(e.isDirectionalLight||e.isPointLight||e.isSpotLight){var n=this.writer,i=n.json,r=n.extensionsUsed,a={};e.name&&(a.name=e.name),a.color=e.color.toArray(),a.intensity=e.intensity,e.isDirectionalLight?a.type="directional":e.isPointLight?(a.type="point",e.distance>0&&(a.range=e.distance)):e.isSpotLight&&(a.type="spot",e.distance>0&&(a.range=e.distance),a.spot={},a.spot.innerConeAngle=(e.penumbra-1)*e.angle*-1,a.spot.outerConeAngle=e.angle),void 0!==e.decay&&2!==e.decay&&console.warn("THREE.GLTFExporter: Light decay may be lost. glTF is physically-based, and expects light.decay=2."),!e.target||e.target.parent===e&&0===e.target.position.x&&0===e.target.position.y&&-1===e.target.position.z||console.warn("THREE.GLTFExporter: Light direction may be lost. For best results, make light.target a child of the light with position 0,0,-1."),r[this.name]||(i.extensions=i.extensions||{},i.extensions[this.name]={lights:[]},r[this.name]=!0);var o=i.extensions[this.name].lights;o.push(a),t.extensions=t.extensions||{},t.extensions[this.name]={light:o.length-1}}else console.warn("THREE.GLTFExporter: Only directional, point, and spot lights are supported.",e)}}]),e}(),Be=function(){function e(t){(0,i.Z)(this,e),this.writer=t,this.name="KHR_materials_unlit"}return(0,r.Z)(e,[{key:"writeMaterial",value:function(e,t){if(e.isMeshBasicMaterial){var n=this.writer.extensionsUsed;t.extensions=t.extensions||{},t.extensions[this.name]={},n[this.name]=!0,t.pbrMetallicRoughness.metallicFactor=0,t.pbrMetallicRoughness.roughnessFactor=.9}}}]),e}(),Te=function(){function e(t){(0,i.Z)(this,e),this.writer=t,this.name="KHR_materials_clearcoat"}return(0,r.Z)(e,[{key:"writeMaterial",value:function(e,t){if(e.isMeshPhysicalMaterial&&0!==e.clearcoat){var n=this.writer,i=n.extensionsUsed,r={};if(r.clearcoatFactor=e.clearcoat,e.clearcoatMap){var a={index:n.processTexture(e.clearcoatMap)};n.applyTextureTransform(a,e.clearcoatMap),r.clearcoatTexture=a}if(r.clearcoatRoughnessFactor=e.clearcoatRoughness,e.clearcoatRoughnessMap){var o={index:n.processTexture(e.clearcoatRoughnessMap)};n.applyTextureTransform(o,e.clearcoatRoughnessMap),r.clearcoatRoughnessTexture=o}if(e.clearcoatNormalMap){var s={index:n.processTexture(e.clearcoatNormalMap)};n.applyTextureTransform(s,e.clearcoatNormalMap),r.clearcoatNormalTexture=s}t.extensions=t.extensions||{},t.extensions[this.name]=r,i[this.name]=!0}}}]),e}(),De=function(){function e(t){(0,i.Z)(this,e),this.writer=t,this.name="KHR_materials_iridescence"}return(0,r.Z)(e,[{key:"writeMaterial",value:function(e,t){if(e.isMeshPhysicalMaterial&&0!==e.iridescence){var n=this.writer,i=n.extensionsUsed,r={};if(r.iridescenceFactor=e.iridescence,e.iridescenceMap){var a={index:n.processTexture(e.iridescenceMap)};n.applyTextureTransform(a,e.iridescenceMap),r.iridescenceTexture=a}if(r.iridescenceIor=e.iridescenceIOR,r.iridescenceThicknessMinimum=e.iridescenceThicknessRange[0],r.iridescenceThicknessMaximum=e.iridescenceThicknessRange[1],e.iridescenceThicknessMap){var o={index:n.processTexture(e.iridescenceThicknessMap)};n.applyTextureTransform(o,e.iridescenceThicknessMap),r.iridescenceThicknessTexture=o}t.extensions=t.extensions||{},t.extensions[this.name]=r,i[this.name]=!0}}}]),e}(),Re=function(){function e(t){(0,i.Z)(this,e),this.writer=t,this.name="KHR_materials_transmission"}return(0,r.Z)(e,[{key:"writeMaterial",value:function(e,t){if(e.isMeshPhysicalMaterial&&0!==e.transmission){var n=this.writer,i=n.extensionsUsed,r={};if(r.transmissionFactor=e.transmission,e.transmissionMap){var a={index:n.processTexture(e.transmissionMap)};n.applyTextureTransform(a,e.transmissionMap),r.transmissionTexture=a}t.extensions=t.extensions||{},t.extensions[this.name]=r,i[this.name]=!0}}}]),e}(),Pe=function(){function e(t){(0,i.Z)(this,e),this.writer=t,this.name="KHR_materials_volume"}return(0,r.Z)(e,[{key:"writeMaterial",value:function(e,t){if(e.isMeshPhysicalMaterial&&0!==e.transmission){var n=this.writer,i=n.extensionsUsed,r={};if(r.thicknessFactor=e.thickness,e.thicknessMap){var a={index:n.processTexture(e.thicknessMap)};n.applyTextureTransform(a,e.thicknessMap),r.thicknessTexture=a}r.attenuationDistance=e.attenuationDistance,r.attenuationColor=e.attenuationColor.toArray(),t.extensions=t.extensions||{},t.extensions[this.name]=r,i[this.name]=!0}}}]),e}(),Le=function(){function e(t){(0,i.Z)(this,e),this.writer=t,this.name="KHR_materials_ior"}return(0,r.Z)(e,[{key:"writeMaterial",value:function(e,t){if(e.isMeshPhysicalMaterial&&1.5!==e.ior){var n=this.writer.extensionsUsed,i={};i.ior=e.ior,t.extensions=t.extensions||{},t.extensions[this.name]=i,n[this.name]=!0}}}]),e}(),Qe=function(){function e(t){(0,i.Z)(this,e),this.writer=t,this.name="KHR_materials_specular"}return(0,r.Z)(e,[{key:"writeMaterial",value:function(e,t){if(e.isMeshPhysicalMaterial&&(1!==e.specularIntensity||!e.specularColor.equals(Ce)||e.specularIntensityMap||e.specularColorTexture)){var n=this.writer,i=n.extensionsUsed,r={};if(e.specularIntensityMap){var a={index:n.processTexture(e.specularIntensityMap)};n.applyTextureTransform(a,e.specularIntensityMap),r.specularTexture=a}if(e.specularColorMap){var o={index:n.processTexture(e.specularColorMap)};n.applyTextureTransform(o,e.specularColorMap),r.specularColorTexture=o}r.specularFactor=e.specularIntensity,r.specularColorFactor=e.specularColor.toArray(),t.extensions=t.extensions||{},t.extensions[this.name]=r,i[this.name]=!0}}}]),e}();$.Utils={insertKeyframe:function(e,t){var n,i=.001,r=e.getValueSize(),a=new e.TimeBufferType(e.times.length+1),o=new e.ValueBufferType(e.values.length+r),s=e.createInterpolant(new e.ValueBufferType(r));if(0===e.times.length){a[0]=t;for(var l=0;l<r;l++)o[l]=0;n=0}else if(t<e.times[0]){if(Math.abs(e.times[0]-t)<i)return 0;a[0]=t,a.set(e.times,1),o.set(s.evaluate(t),0),o.set(e.values,r),n=0}else if(t>e.times[e.times.length-1]){if(Math.abs(e.times[e.times.length-1]-t)<i)return e.times.length-1;a[a.length-1]=t,a.set(e.times,0),o.set(e.values,0),o.set(s.evaluate(t),e.values.length),n=a.length-1}else for(var u=0;u<e.times.length;u++){if(Math.abs(e.times[u]-t)<i)return u;if(e.times[u]<t&&e.times[u+1]>t){a.set(e.times.slice(0,u+1),0),a[u+1]=t,a.set(e.times.slice(u+1),u+2),o.set(e.values.slice(0,(u+1)*r),0),o.set(s.evaluate(t),(u+1)*r),o.set(e.values.slice((u+1)*r),(u+2)*r),n=u+1;break}}return e.times=a,e.values=o,n},mergeMorphTargetTracks:function(e,t){for(var n=[],i={},r=e.tracks,a=0;a<r.length;++a){var o=r[a],s=K.iUV.parseTrackName(o.name),l=K.iUV.findNode(t,s.nodeName);if("morphTargetInfluences"===s.propertyName&&void 0!==s.propertyIndex){if(o.createInterpolant!==o.InterpolantFactoryMethodDiscrete&&o.createInterpolant!==o.InterpolantFactoryMethodLinear){if(o.createInterpolant.isInterpolantFactoryMethodGLTFCubicSpline)throw new Error("THREE.GLTFExporter: Cannot merge tracks with glTF CUBICSPLINE interpolation.");console.warn("THREE.GLTFExporter: Morph target interpolation mode not yet supported. Using LINEAR instead."),(o=o.clone()).setInterpolation(K.NMF)}var u=l.morphTargetInfluences.length,c=l.morphTargetDictionary[s.propertyIndex];if(void 0===c)throw new Error("THREE.GLTFExporter: Morph target name not found: "+s.propertyIndex);var h=void 0;if(void 0!==i[l.uuid]){var d=o.createInterpolant(new o.ValueBufferType(1));h=i[l.uuid];for(var f=0;f<h.times.length;f++)h.values[f*u+c]=d.evaluate(h.times[f]);for(var p=0;p<o.times.length;p++){var A=this.insertKeyframe(h,o.times[p]);h.values[A*u+c]=o.values[p]}}else{for(var v=new((h=o.clone()).ValueBufferType)(u*h.times.length),g=0;g<h.times.length;g++)v[g*u+c]=h.values[g];h.name=(s.nodeName||"")+".morphTargetInfluences",h.values=v,i[l.uuid]=h,n.push(h)}}else n.push(o)}return e.tracks=n,e}};var Ze=function(){function e(){(0,i.Z)(this,e)}return(0,r.Z)(e,[{key:"name",get:function(){return""}},{key:"undoable",get:function(){return!0}},{key:"setObjectValue",value:function(e,t,n){e[t]instanceof K.Ilk?e[t].setStyle(n):("number"===typeof e[t]&&"number"!==typeof n&&(n=Number(n)),e[t]=n)}}]),e}(),Ne=n(37762),Fe=n(10205),Ue=function(){function e(t){(0,i.Z)(this,e),this._center=new K.Pa4,this._size=new K.Pa4,this._bSphere=new K.aLr,this._bBox=new K.ZzF,this.setFromModel(t)}return(0,r.Z)(e,[{key:"setFromModel",value:function(e){if(!e||!(e instanceof K.Tme))throw new Fe.R("model");this._bBox.setFromObject(e),this._bBox.getCenter(this._center),this._bBox.getSize(this._size),this._bBox.getBoundingSphere(this._bSphere)}},{key:"boundingBox",get:function(){return this._bBox}},{key:"boundingSphere",get:function(){return this._bSphere}},{key:"size",get:function(){return this._size}},{key:"center",get:function(){return this._center}}]),e}(),je={uniforms:{tDiffuse:{value:null},opacity:{value:1}},vertexShader:"\n\n\t\tvarying vec2 vUv;\n\n\t\tvoid main() {\n\n\t\t\tvUv = uv;\n\t\t\tgl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );\n\n\t\t}",fragmentShader:"\n\n\t\tuniform float opacity;\n\n\t\tuniform sampler2D tDiffuse;\n\n\t\tvarying vec2 vUv;\n\n\t\tvoid main() {\n\n\t\t\tgl_FragColor = texture2D( tDiffuse, vUv );\n\t\t\tgl_FragColor.a *= opacity;\n\n\n\t\t}"},Oe=function(){function e(){(0,i.Z)(this,e),this.enabled=!0,this.needsSwap=!0,this.clear=!1,this.renderToScreen=!1}return(0,r.Z)(e,[{key:"setSize",value:function(){}},{key:"render",value:function(){console.error("THREE.Pass: .render() must be implemented in derived pass.")}},{key:"dispose",value:function(){}}]),e}(),ze=new K.iKG(-1,1,1,-1,0,1),Ge=new K.u9r;Ge.setAttribute("position",new K.a$l([-1,3,0,-1,-1,0,3,-1,0],3)),Ge.setAttribute("uv",new K.a$l([0,2,0,0,2,0],2));var He=function(){function e(t){(0,i.Z)(this,e),this._mesh=new K.Kj0(Ge,t)}return(0,r.Z)(e,[{key:"dispose",value:function(){this._mesh.geometry.dispose()}},{key:"render",value:function(e){e.render(this._mesh,ze)}},{key:"material",get:function(){return this._mesh.material},set:function(e){this._mesh.material=e}}]),e}(),Ve=function(e){(0,a.Z)(n,e);var t=(0,o.Z)(n);function n(e,r){var a;return(0,i.Z)(this,n),(a=t.call(this)).textureID=void 0!==r?r:"tDiffuse",e instanceof K.jyz?(a.uniforms=e.uniforms,a.material=e):e&&(a.uniforms=K.rDY.clone(e.uniforms),a.material=new K.jyz({defines:Object.assign({},e.defines),uniforms:a.uniforms,vertexShader:e.vertexShader,fragmentShader:e.fragmentShader})),a.fsQuad=new He(a.material),a}return(0,r.Z)(n,[{key:"render",value:function(e,t,n){this.uniforms[this.textureID]&&(this.uniforms[this.textureID].value=n.texture),this.fsQuad.material=this.material,this.renderToScreen?(e.setRenderTarget(null),this.fsQuad.render(e)):(e.setRenderTarget(t),this.clear&&e.clear(e.autoClearColor,e.autoClearDepth,e.autoClearStencil),this.fsQuad.render(e))}},{key:"dispose",value:function(){this.material.dispose(),this.fsQuad.dispose()}}]),n}(Oe),We=function(e){(0,a.Z)(n,e);var t=(0,o.Z)(n);function n(e,r){var a;return(0,i.Z)(this,n),(a=t.call(this)).scene=e,a.camera=r,a.clear=!0,a.needsSwap=!1,a.inverse=!1,a}return(0,r.Z)(n,[{key:"render",value:function(e,t,n){var i,r,a=e.getContext(),o=e.state;o.buffers.color.setMask(!1),o.buffers.depth.setMask(!1),o.buffers.color.setLocked(!0),o.buffers.depth.setLocked(!0),this.inverse?(i=0,r=1):(i=1,r=0),o.buffers.stencil.setTest(!0),o.buffers.stencil.setOp(a.REPLACE,a.REPLACE,a.REPLACE),o.buffers.stencil.setFunc(a.ALWAYS,i,4294967295),o.buffers.stencil.setClear(r),o.buffers.stencil.setLocked(!0),e.setRenderTarget(n),this.clear&&e.clear(),e.render(this.scene,this.camera),e.setRenderTarget(t),this.clear&&e.clear(),e.render(this.scene,this.camera),o.buffers.color.setLocked(!1),o.buffers.depth.setLocked(!1),o.buffers.stencil.setLocked(!1),o.buffers.stencil.setFunc(a.EQUAL,1,4294967295),o.buffers.stencil.setOp(a.KEEP,a.KEEP,a.KEEP),o.buffers.stencil.setLocked(!0)}}]),n}(Oe),qe=function(e){(0,a.Z)(n,e);var t=(0,o.Z)(n);function n(){var e;return(0,i.Z)(this,n),(e=t.call(this)).needsSwap=!1,e}return(0,r.Z)(n,[{key:"render",value:function(e){e.state.buffers.stencil.setLocked(!1),e.state.buffers.stencil.setTest(!1)}}]),n}(Oe),Ye=function(){function e(t,n){if((0,i.Z)(this,e),this.renderer=t,void 0===n){var r=t.getSize(new K.FM8);this._pixelRatio=t.getPixelRatio(),this._width=r.width,this._height=r.height,(n=new K.dd2(this._width*this._pixelRatio,this._height*this._pixelRatio)).texture.name="EffectComposer.rt1"}else this._pixelRatio=1,this._width=n.width,this._height=n.height;this.renderTarget1=n,this.renderTarget2=n.clone(),this.renderTarget2.texture.name="EffectComposer.rt2",this.writeBuffer=this.renderTarget1,this.readBuffer=this.renderTarget2,this.renderToScreen=!0,this.passes=[],this.copyPass=new Ve(je),this.clock=new K.SUY}return(0,r.Z)(e,[{key:"swapBuffers",value:function(){var e=this.readBuffer;this.readBuffer=this.writeBuffer,this.writeBuffer=e}},{key:"addPass",value:function(e){this.passes.push(e),e.setSize(this._width*this._pixelRatio,this._height*this._pixelRatio)}},{key:"insertPass",value:function(e,t){this.passes.splice(t,0,e),e.setSize(this._width*this._pixelRatio,this._height*this._pixelRatio)}},{key:"removePass",value:function(e){var t=this.passes.indexOf(e);-1!==t&&this.passes.splice(t,1)}},{key:"isLastEnabledPass",value:function(e){for(var t=e+1;t<this.passes.length;t++)if(this.passes[t].enabled)return!1;return!0}},{key:"render",value:function(e){void 0===e&&(e=this.clock.getDelta());for(var t=this.renderer.getRenderTarget(),n=!1,i=0,r=this.passes.length;i<r;i++){var a=this.passes[i];if(!1!==a.enabled){if(a.renderToScreen=this.renderToScreen&&this.isLastEnabledPass(i),a.render(this.renderer,this.writeBuffer,this.readBuffer,e,n),a.needsSwap){if(n){var o=this.renderer.getContext(),s=this.renderer.state.buffers.stencil;s.setFunc(o.NOTEQUAL,1,4294967295),this.copyPass.render(this.renderer,this.writeBuffer,this.readBuffer,e),s.setFunc(o.EQUAL,1,4294967295)}this.swapBuffers()}void 0!==We&&(a instanceof We?n=!0:a instanceof qe&&(n=!1))}}this.renderer.setRenderTarget(t)}},{key:"reset",value:function(e){if(void 0===e){var t=this.renderer.getSize(new K.FM8);this._pixelRatio=this.renderer.getPixelRatio(),this._width=t.width,this._height=t.height,(e=this.renderTarget1.clone()).setSize(this._width*this._pixelRatio,this._height*this._pixelRatio)}this.renderTarget1.dispose(),this.renderTarget2.dispose(),this.renderTarget1=e,this.renderTarget2=e.clone(),this.writeBuffer=this.renderTarget1,this.readBuffer=this.renderTarget2}},{key:"setSize",value:function(e,t){this._width=e,this._height=t;var n=this._width*this._pixelRatio,i=this._height*this._pixelRatio;this.renderTarget1.setSize(n,i),this.renderTarget2.setSize(n,i);for(var r=0;r<this.passes.length;r++)this.passes[r].setSize(n,i)}},{key:"setPixelRatio",value:function(e){this._pixelRatio=e,this.setSize(this._width,this._height)}},{key:"dispose",value:function(){this.renderTarget1.dispose(),this.renderTarget2.dispose(),this.copyPass.dispose()}}]),e}(),Je=function(e){(0,a.Z)(n,e);var t=(0,o.Z)(n);function n(e,r,a,o,s){var l;return(0,i.Z)(this,n),(l=t.call(this)).scene=e,l.camera=r,l.overrideMaterial=a,l.clearColor=o,l.clearAlpha=void 0!==s?s:0,l.clear=!0,l.clearDepth=!1,l.needsSwap=!1,l._oldClearColor=new K.Ilk,l}return(0,r.Z)(n,[{key:"render",value:function(e,t,n){var i,r,a=e.autoClear;e.autoClear=!1,void 0!==this.overrideMaterial&&(r=this.scene.overrideMaterial,this.scene.overrideMaterial=this.overrideMaterial),this.clearColor&&(e.getClearColor(this._oldClearColor),i=e.getClearAlpha(),e.setClearColor(this.clearColor,this.clearAlpha)),this.clearDepth&&e.clearDepth(),e.setRenderTarget(this.renderToScreen?null:n),this.clear&&e.clear(e.autoClearColor,e.autoClearDepth,e.autoClearStencil),e.render(this.scene,this.camera),this.clearColor&&e.setClearColor(this._oldClearColor,i),void 0!==this.overrideMaterial&&(this.scene.overrideMaterial=r),e.autoClear=a}}]),n}(Oe),Xe={defines:{DEPTH_PACKING:1,PERSPECTIVE_CAMERA:1},uniforms:{tColor:{value:null},tDepth:{value:null},focus:{value:1},aspect:{value:1},aperture:{value:.025},maxblur:{value:.01},nearClip:{value:1},farClip:{value:1e3}},vertexShader:"\n\n\t\tvarying vec2 vUv;\n\n\t\tvoid main() {\n\n\t\t\tvUv = uv;\n\t\t\tgl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );\n\n\t\t}",fragmentShader:"\n\n\t\t#include <common>\n\n\t\tvarying vec2 vUv;\n\n\t\tuniform sampler2D tColor;\n\t\tuniform sampler2D tDepth;\n\n\t\tuniform float maxblur; // max blur amount\n\t\tuniform float aperture; // aperture - bigger values for shallower depth of field\n\n\t\tuniform float nearClip;\n\t\tuniform float farClip;\n\n\t\tuniform float focus;\n\t\tuniform float aspect;\n\n\t\t#include <packing>\n\n\t\tfloat getDepth( const in vec2 screenPosition ) {\n\t\t\t#if DEPTH_PACKING == 1\n\t\t\treturn unpackRGBAToDepth( texture2D( tDepth, screenPosition ) );\n\t\t\t#else\n\t\t\treturn texture2D( tDepth, screenPosition ).x;\n\t\t\t#endif\n\t\t}\n\n\t\tfloat getViewZ( const in float depth ) {\n\t\t\t#if PERSPECTIVE_CAMERA == 1\n\t\t\treturn perspectiveDepthToViewZ( depth, nearClip, farClip );\n\t\t\t#else\n\t\t\treturn orthographicDepthToViewZ( depth, nearClip, farClip );\n\t\t\t#endif\n\t\t}\n\n\n\t\tvoid main() {\n\n\t\t\tvec2 aspectcorrect = vec2( 1.0, aspect );\n\n\t\t\tfloat viewZ = getViewZ( getDepth( vUv ) );\n\n\t\t\tfloat factor = ( focus + viewZ ); // viewZ is <= 0, so this is a difference equation\n\n\t\t\tvec2 dofblur = vec2 ( clamp( factor * aperture, -maxblur, maxblur ) );\n\n\t\t\tvec2 dofblur9 = dofblur * 0.9;\n\t\t\tvec2 dofblur7 = dofblur * 0.7;\n\t\t\tvec2 dofblur4 = dofblur * 0.4;\n\n\t\t\tvec4 col = vec4( 0.0 );\n\n\t\t\tcol += texture2D( tColor, vUv.xy );\n\t\t\tcol += texture2D( tColor, vUv.xy + ( vec2(  0.0,   0.4  ) * aspectcorrect ) * dofblur );\n\t\t\tcol += texture2D( tColor, vUv.xy + ( vec2(  0.15,  0.37 ) * aspectcorrect ) * dofblur );\n\t\t\tcol += texture2D( tColor, vUv.xy + ( vec2(  0.29,  0.29 ) * aspectcorrect ) * dofblur );\n\t\t\tcol += texture2D( tColor, vUv.xy + ( vec2( -0.37,  0.15 ) * aspectcorrect ) * dofblur );\n\t\t\tcol += texture2D( tColor, vUv.xy + ( vec2(  0.40,  0.0  ) * aspectcorrect ) * dofblur );\n\t\t\tcol += texture2D( tColor, vUv.xy + ( vec2(  0.37, -0.15 ) * aspectcorrect ) * dofblur );\n\t\t\tcol += texture2D( tColor, vUv.xy + ( vec2(  0.29, -0.29 ) * aspectcorrect ) * dofblur );\n\t\t\tcol += texture2D( tColor, vUv.xy + ( vec2( -0.15, -0.37 ) * aspectcorrect ) * dofblur );\n\t\t\tcol += texture2D( tColor, vUv.xy + ( vec2(  0.0,  -0.4  ) * aspectcorrect ) * dofblur );\n\t\t\tcol += texture2D( tColor, vUv.xy + ( vec2( -0.15,  0.37 ) * aspectcorrect ) * dofblur );\n\t\t\tcol += texture2D( tColor, vUv.xy + ( vec2( -0.29,  0.29 ) * aspectcorrect ) * dofblur );\n\t\t\tcol += texture2D( tColor, vUv.xy + ( vec2(  0.37,  0.15 ) * aspectcorrect ) * dofblur );\n\t\t\tcol += texture2D( tColor, vUv.xy + ( vec2( -0.4,   0.0  ) * aspectcorrect ) * dofblur );\n\t\t\tcol += texture2D( tColor, vUv.xy + ( vec2( -0.37, -0.15 ) * aspectcorrect ) * dofblur );\n\t\t\tcol += texture2D( tColor, vUv.xy + ( vec2( -0.29, -0.29 ) * aspectcorrect ) * dofblur );\n\t\t\tcol += texture2D( tColor, vUv.xy + ( vec2(  0.15, -0.37 ) * aspectcorrect ) * dofblur );\n\n\t\t\tcol += texture2D( tColor, vUv.xy + ( vec2(  0.15,  0.37 ) * aspectcorrect ) * dofblur9 );\n\t\t\tcol += texture2D( tColor, vUv.xy + ( vec2( -0.37,  0.15 ) * aspectcorrect ) * dofblur9 );\n\t\t\tcol += texture2D( tColor, vUv.xy + ( vec2(  0.37, -0.15 ) * aspectcorrect ) * dofblur9 );\n\t\t\tcol += texture2D( tColor, vUv.xy + ( vec2( -0.15, -0.37 ) * aspectcorrect ) * dofblur9 );\n\t\t\tcol += texture2D( tColor, vUv.xy + ( vec2( -0.15,  0.37 ) * aspectcorrect ) * dofblur9 );\n\t\t\tcol += texture2D( tColor, vUv.xy + ( vec2(  0.37,  0.15 ) * aspectcorrect ) * dofblur9 );\n\t\t\tcol += texture2D( tColor, vUv.xy + ( vec2( -0.37, -0.15 ) * aspectcorrect ) * dofblur9 );\n\t\t\tcol += texture2D( tColor, vUv.xy + ( vec2(  0.15, -0.37 ) * aspectcorrect ) * dofblur9 );\n\n\t\t\tcol += texture2D( tColor, vUv.xy + ( vec2(  0.29,  0.29 ) * aspectcorrect ) * dofblur7 );\n\t\t\tcol += texture2D( tColor, vUv.xy + ( vec2(  0.40,  0.0  ) * aspectcorrect ) * dofblur7 );\n\t\t\tcol += texture2D( tColor, vUv.xy + ( vec2(  0.29, -0.29 ) * aspectcorrect ) * dofblur7 );\n\t\t\tcol += texture2D( tColor, vUv.xy + ( vec2(  0.0,  -0.4  ) * aspectcorrect ) * dofblur7 );\n\t\t\tcol += texture2D( tColor, vUv.xy + ( vec2( -0.29,  0.29 ) * aspectcorrect ) * dofblur7 );\n\t\t\tcol += texture2D( tColor, vUv.xy + ( vec2( -0.4,   0.0  ) * aspectcorrect ) * dofblur7 );\n\t\t\tcol += texture2D( tColor, vUv.xy + ( vec2( -0.29, -0.29 ) * aspectcorrect ) * dofblur7 );\n\t\t\tcol += texture2D( tColor, vUv.xy + ( vec2(  0.0,   0.4  ) * aspectcorrect ) * dofblur7 );\n\n\t\t\tcol += texture2D( tColor, vUv.xy + ( vec2(  0.29,  0.29 ) * aspectcorrect ) * dofblur4 );\n\t\t\tcol += texture2D( tColor, vUv.xy + ( vec2(  0.4,   0.0  ) * aspectcorrect ) * dofblur4 );\n\t\t\tcol += texture2D( tColor, vUv.xy + ( vec2(  0.29, -0.29 ) * aspectcorrect ) * dofblur4 );\n\t\t\tcol += texture2D( tColor, vUv.xy + ( vec2(  0.0,  -0.4  ) * aspectcorrect ) * dofblur4 );\n\t\t\tcol += texture2D( tColor, vUv.xy + ( vec2( -0.29,  0.29 ) * aspectcorrect ) * dofblur4 );\n\t\t\tcol += texture2D( tColor, vUv.xy + ( vec2( -0.4,   0.0  ) * aspectcorrect ) * dofblur4 );\n\t\t\tcol += texture2D( tColor, vUv.xy + ( vec2( -0.29, -0.29 ) * aspectcorrect ) * dofblur4 );\n\t\t\tcol += texture2D( tColor, vUv.xy + ( vec2(  0.0,   0.4  ) * aspectcorrect ) * dofblur4 );\n\n\t\t\tgl_FragColor = col / 41.0;\n\t\t\tgl_FragColor.a = 1.0;\n\n\t\t}"},Ke=function(e){(0,a.Z)(n,e);var t=(0,o.Z)(n);function n(e,r,a){var o;(0,i.Z)(this,n),(o=t.call(this)).scene=e,o.camera=r;var s=void 0!==a.focus?a.focus:1,l=void 0!==a.aspect?a.aspect:r.aspect,u=void 0!==a.aperture?a.aperture:.025,c=void 0!==a.maxblur?a.maxblur:1;o.renderTargetDepth=new K.dd2(1,1,{minFilter:K.TyD,magFilter:K.TyD}),o.renderTargetDepth.texture.name="BokehPass.depth",o.materialDepth=new K.lRF,o.materialDepth.depthPacking=K.mSO,o.materialDepth.blending=K.jFi;var h=Xe,d=K.rDY.clone(h.uniforms);return d.tDepth.value=o.renderTargetDepth.texture,d.focus.value=s,d.aspect.value=l,d.aperture.value=u,d.maxblur.value=c,d.nearClip.value=r.near,d.farClip.value=r.far,o.materialBokeh=new K.jyz({defines:Object.assign({},h.defines),uniforms:d,vertexShader:h.vertexShader,fragmentShader:h.fragmentShader}),o.uniforms=d,o.needsSwap=!1,o.fsQuad=new He(o.materialBokeh),o._oldClearColor=new K.Ilk,o}return(0,r.Z)(n,[{key:"render",value:function(e,t,n){this.scene.overrideMaterial=this.materialDepth,e.getClearColor(this._oldClearColor);var i=e.getClearAlpha(),r=e.autoClear;e.autoClear=!1,e.setClearColor(16777215),e.setClearAlpha(1),e.setRenderTarget(this.renderTargetDepth),e.clear(),e.render(this.scene,this.camera),this.uniforms.tColor.value=n.texture,this.uniforms.nearClip.value=this.camera.near,this.uniforms.farClip.value=this.camera.far,this.renderToScreen?(e.setRenderTarget(null),this.fsQuad.render(e)):(e.setRenderTarget(t),e.clear(),this.fsQuad.render(e)),this.scene.overrideMaterial=null,e.setClearColor(this._oldClearColor),e.setClearAlpha(i),e.autoClear=r}},{key:"setSize",value:function(e,t){this.renderTargetDepth.setSize(e,t)}},{key:"dispose",value:function(){this.renderTargetDepth.dispose(),this.materialDepth.dispose(),this.materialBokeh.dispose(),this.fsQuad.dispose()}}]),n}(Oe),$e={shaderID:"luminosityHighPass",uniforms:{tDiffuse:{value:null},luminosityThreshold:{value:1},smoothWidth:{value:1},defaultColor:{value:new K.Ilk(0)},defaultOpacity:{value:0}},vertexShader:"\n\n\t\tvarying vec2 vUv;\n\n\t\tvoid main() {\n\n\t\t\tvUv = uv;\n\n\t\t\tgl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );\n\n\t\t}",fragmentShader:"\n\n\t\tuniform sampler2D tDiffuse;\n\t\tuniform vec3 defaultColor;\n\t\tuniform float defaultOpacity;\n\t\tuniform float luminosityThreshold;\n\t\tuniform float smoothWidth;\n\n\t\tvarying vec2 vUv;\n\n\t\tvoid main() {\n\n\t\t\tvec4 texel = texture2D( tDiffuse, vUv );\n\n\t\t\tvec3 luma = vec3( 0.299, 0.587, 0.114 );\n\n\t\t\tfloat v = dot( texel.xyz, luma );\n\n\t\t\tvec4 outputColor = vec4( defaultColor.rgb, defaultOpacity );\n\n\t\t\tfloat alpha = smoothstep( luminosityThreshold, luminosityThreshold + smoothWidth, v );\n\n\t\t\tgl_FragColor = mix( outputColor, texel, alpha );\n\n\t\t}"},et=function(e){(0,a.Z)(n,e);var t=(0,o.Z)(n);function n(e,r,a,o){var s;(0,i.Z)(this,n),(s=t.call(this)).strength=void 0!==r?r:1,s.radius=a,s.threshold=o,s.resolution=void 0!==e?new K.FM8(e.x,e.y):new K.FM8(256,256),s.clearColor=new K.Ilk(0,0,0),s.renderTargetsHorizontal=[],s.renderTargetsVertical=[],s.nMips=5;var l=Math.round(s.resolution.x/2),u=Math.round(s.resolution.y/2);s.renderTargetBright=new K.dd2(l,u),s.renderTargetBright.texture.name="UnrealBloomPass.bright",s.renderTargetBright.texture.generateMipmaps=!1;for(var c=0;c<s.nMips;c++){var h=new K.dd2(l,u);h.texture.name="UnrealBloomPass.h"+c,h.texture.generateMipmaps=!1,s.renderTargetsHorizontal.push(h);var d=new K.dd2(l,u);d.texture.name="UnrealBloomPass.v"+c,d.texture.generateMipmaps=!1,s.renderTargetsVertical.push(d),l=Math.round(l/2),u=Math.round(u/2)}var f=$e;s.highPassUniforms=K.rDY.clone(f.uniforms),s.highPassUniforms.luminosityThreshold.value=o,s.highPassUniforms.smoothWidth.value=.01,s.materialHighPassFilter=new K.jyz({uniforms:s.highPassUniforms,vertexShader:f.vertexShader,fragmentShader:f.fragmentShader,defines:{}}),s.separableBlurMaterials=[];var p=[3,5,7,9,11];l=Math.round(s.resolution.x/2),u=Math.round(s.resolution.y/2);for(var A=0;A<s.nMips;A++)s.separableBlurMaterials.push(s.getSeperableBlurMaterial(p[A])),s.separableBlurMaterials[A].uniforms.texSize.value=new K.FM8(l,u),l=Math.round(l/2),u=Math.round(u/2);s.compositeMaterial=s.getCompositeMaterial(s.nMips),s.compositeMaterial.uniforms.blurTexture1.value=s.renderTargetsVertical[0].texture,s.compositeMaterial.uniforms.blurTexture2.value=s.renderTargetsVertical[1].texture,s.compositeMaterial.uniforms.blurTexture3.value=s.renderTargetsVertical[2].texture,s.compositeMaterial.uniforms.blurTexture4.value=s.renderTargetsVertical[3].texture,s.compositeMaterial.uniforms.blurTexture5.value=s.renderTargetsVertical[4].texture,s.compositeMaterial.uniforms.bloomStrength.value=r,s.compositeMaterial.uniforms.bloomRadius.value=.1,s.compositeMaterial.needsUpdate=!0;s.compositeMaterial.uniforms.bloomFactors.value=[1,.8,.6,.4,.2],s.bloomTintColors=[new K.Pa4(1,1,1),new K.Pa4(1,1,1),new K.Pa4(1,1,1),new K.Pa4(1,1,1),new K.Pa4(1,1,1)],s.compositeMaterial.uniforms.bloomTintColors.value=s.bloomTintColors;var v=je;return s.copyUniforms=K.rDY.clone(v.uniforms),s.copyUniforms.opacity.value=1,s.materialCopy=new K.jyz({uniforms:s.copyUniforms,vertexShader:v.vertexShader,fragmentShader:v.fragmentShader,blending:K.WMw,depthTest:!1,depthWrite:!1,transparent:!0}),s.enabled=!0,s.needsSwap=!1,s._oldClearColor=new K.Ilk,s.oldClearAlpha=1,s.basic=new K.vBJ,s.fsQuad=new He(null),s}return(0,r.Z)(n,[{key:"dispose",value:function(){for(var e=0;e<this.renderTargetsHorizontal.length;e++)this.renderTargetsHorizontal[e].dispose();for(var t=0;t<this.renderTargetsVertical.length;t++)this.renderTargetsVertical[t].dispose();this.renderTargetBright.dispose();for(var n=0;n<this.separableBlurMaterials.length;n++)this.separableBlurMaterials[n].dispose();this.compositeMaterial.dispose(),this.materialCopy.dispose(),this.basic.dispose(),this.fsQuad.dispose()}},{key:"setSize",value:function(e,t){var n=Math.round(e/2),i=Math.round(t/2);this.renderTargetBright.setSize(n,i);for(var r=0;r<this.nMips;r++)this.renderTargetsHorizontal[r].setSize(n,i),this.renderTargetsVertical[r].setSize(n,i),this.separableBlurMaterials[r].uniforms.texSize.value=new K.FM8(n,i),n=Math.round(n/2),i=Math.round(i/2)}},{key:"render",value:function(e,t,i,r,a){e.getClearColor(this._oldClearColor),this.oldClearAlpha=e.getClearAlpha();var o=e.autoClear;e.autoClear=!1,e.setClearColor(this.clearColor,0),a&&e.state.buffers.stencil.setTest(!1),this.renderToScreen&&(this.fsQuad.material=this.basic,this.basic.map=i.texture,e.setRenderTarget(null),e.clear(),this.fsQuad.render(e)),this.highPassUniforms.tDiffuse.value=i.texture,this.highPassUniforms.luminosityThreshold.value=this.threshold,this.fsQuad.material=this.materialHighPassFilter,e.setRenderTarget(this.renderTargetBright),e.clear(),this.fsQuad.render(e);for(var s=this.renderTargetBright,l=0;l<this.nMips;l++)this.fsQuad.material=this.separableBlurMaterials[l],this.separableBlurMaterials[l].uniforms.colorTexture.value=s.texture,this.separableBlurMaterials[l].uniforms.direction.value=n.BlurDirectionX,e.setRenderTarget(this.renderTargetsHorizontal[l]),e.clear(),this.fsQuad.render(e),this.separableBlurMaterials[l].uniforms.colorTexture.value=this.renderTargetsHorizontal[l].texture,this.separableBlurMaterials[l].uniforms.direction.value=n.BlurDirectionY,e.setRenderTarget(this.renderTargetsVertical[l]),e.clear(),this.fsQuad.render(e),s=this.renderTargetsVertical[l];this.fsQuad.material=this.compositeMaterial,this.compositeMaterial.uniforms.bloomStrength.value=this.strength,this.compositeMaterial.uniforms.bloomRadius.value=this.radius,this.compositeMaterial.uniforms.bloomTintColors.value=this.bloomTintColors,e.setRenderTarget(this.renderTargetsHorizontal[0]),e.clear(),this.fsQuad.render(e),this.fsQuad.material=this.materialCopy,this.copyUniforms.tDiffuse.value=this.renderTargetsHorizontal[0].texture,a&&e.state.buffers.stencil.setTest(!0),this.renderToScreen?(e.setRenderTarget(null),this.fsQuad.render(e)):(e.setRenderTarget(i),this.fsQuad.render(e)),e.setClearColor(this._oldClearColor,this.oldClearAlpha),e.autoClear=o}},{key:"getSeperableBlurMaterial",value:function(e){return new K.jyz({defines:{KERNEL_RADIUS:e,SIGMA:e},uniforms:{colorTexture:{value:null},texSize:{value:new K.FM8(.5,.5)},direction:{value:new K.FM8(.5,.5)}},vertexShader:"varying vec2 vUv;\n\t\t\t\tvoid main() {\n\t\t\t\t\tvUv = uv;\n\t\t\t\t\tgl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );\n\t\t\t\t}",fragmentShader:"#include <common>\n\t\t\t\tvarying vec2 vUv;\n\t\t\t\tuniform sampler2D colorTexture;\n\t\t\t\tuniform vec2 texSize;\n\t\t\t\tuniform vec2 direction;\n\n\t\t\t\tfloat gaussianPdf(in float x, in float sigma) {\n\t\t\t\t\treturn 0.39894 * exp( -0.5 * x * x/( sigma * sigma))/sigma;\n\t\t\t\t}\n\t\t\t\tvoid main() {\n\t\t\t\t\tvec2 invSize = 1.0 / texSize;\n\t\t\t\t\tfloat fSigma = float(SIGMA);\n\t\t\t\t\tfloat weightSum = gaussianPdf(0.0, fSigma);\n\t\t\t\t\tvec3 diffuseSum = texture2D( colorTexture, vUv).rgb * weightSum;\n\t\t\t\t\tfor( int i = 1; i < KERNEL_RADIUS; i ++ ) {\n\t\t\t\t\t\tfloat x = float(i);\n\t\t\t\t\t\tfloat w = gaussianPdf(x, fSigma);\n\t\t\t\t\t\tvec2 uvOffset = direction * invSize * x;\n\t\t\t\t\t\tvec3 sample1 = texture2D( colorTexture, vUv + uvOffset).rgb;\n\t\t\t\t\t\tvec3 sample2 = texture2D( colorTexture, vUv - uvOffset).rgb;\n\t\t\t\t\t\tdiffuseSum += (sample1 + sample2) * w;\n\t\t\t\t\t\tweightSum += 2.0 * w;\n\t\t\t\t\t}\n\t\t\t\t\tgl_FragColor = vec4(diffuseSum/weightSum, 1.0);\n\t\t\t\t}"})}},{key:"getCompositeMaterial",value:function(e){return new K.jyz({defines:{NUM_MIPS:e},uniforms:{blurTexture1:{value:null},blurTexture2:{value:null},blurTexture3:{value:null},blurTexture4:{value:null},blurTexture5:{value:null},bloomStrength:{value:1},bloomFactors:{value:null},bloomTintColors:{value:null},bloomRadius:{value:0}},vertexShader:"varying vec2 vUv;\n\t\t\t\tvoid main() {\n\t\t\t\t\tvUv = uv;\n\t\t\t\t\tgl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );\n\t\t\t\t}",fragmentShader:"varying vec2 vUv;\n\t\t\t\tuniform sampler2D blurTexture1;\n\t\t\t\tuniform sampler2D blurTexture2;\n\t\t\t\tuniform sampler2D blurTexture3;\n\t\t\t\tuniform sampler2D blurTexture4;\n\t\t\t\tuniform sampler2D blurTexture5;\n\t\t\t\tuniform float bloomStrength;\n\t\t\t\tuniform float bloomRadius;\n\t\t\t\tuniform float bloomFactors[NUM_MIPS];\n\t\t\t\tuniform vec3 bloomTintColors[NUM_MIPS];\n\n\t\t\t\tfloat lerpBloomFactor(const in float factor) {\n\t\t\t\t\tfloat mirrorFactor = 1.2 - factor;\n\t\t\t\t\treturn mix(factor, mirrorFactor, bloomRadius);\n\t\t\t\t}\n\n\t\t\t\tvoid main() {\n\t\t\t\t\tgl_FragColor = bloomStrength * ( lerpBloomFactor(bloomFactors[0]) * vec4(bloomTintColors[0], 1.0) * texture2D(blurTexture1, vUv) +\n\t\t\t\t\t\tlerpBloomFactor(bloomFactors[1]) * vec4(bloomTintColors[1], 1.0) * texture2D(blurTexture2, vUv) +\n\t\t\t\t\t\tlerpBloomFactor(bloomFactors[2]) * vec4(bloomTintColors[2], 1.0) * texture2D(blurTexture3, vUv) +\n\t\t\t\t\t\tlerpBloomFactor(bloomFactors[3]) * vec4(bloomTintColors[3], 1.0) * texture2D(blurTexture4, vUv) +\n\t\t\t\t\t\tlerpBloomFactor(bloomFactors[4]) * vec4(bloomTintColors[4], 1.0) * texture2D(blurTexture5, vUv) );\n\t\t\t\t}"})}}]),n}(Oe);et.BlurDirectionX=new K.FM8(1,0),et.BlurDirectionY=new K.FM8(0,1);var tt=function(){function e(t){if((0,i.Z)(this,e),!t||!(t instanceof K.CP7))throw new Fe.R("renderer");this._renderer=t;var n=new K.FM8;t.getSize(n),this._composer=new Ye(t),this._composer.setSize(n.x,n.y)}return(0,r.Z)(e,[{key:"dispose",value:function(){this._composer.passes.forEach((function(e){e.dispose&&e.dispose()}))}},{key:"deleteAllPasses",value:function(){this.dispose(),this._composer.passes=[]}},{key:"composer",get:function(){return this._composer}},{key:"addPass",value:function(e){this._composer.addPass(e)}},{key:"removePass",value:function(e){this._composer.removePass(e),this._composer.passes.length>0&&(this._composer.passes[this._composer.passes.length-1].renderToScreen=!0)}},{key:"enablePass",value:function(e,t){e.enabled=t}},{key:"setSize",value:function(e,t){e&&t&&this._composer.setSize(e,t)}},{key:"render",value:function(e,t){this._composer.render(e,t)}},{key:"createRenderPass",value:function(e,t){var n=arguments.length>2&&void 0!==arguments[2]&&arguments[2],i=new Je(e,t);return i.clearAlpha=n,i}},{key:"createDofPass",value:function(e,t,n,i,r){return new Ke(e,t,{focus:n,aperture:i,maxblur:r,width:512,height:512,aspect:1})}},{key:"createBloomPass",value:function(e,t,n){return new et(new K.FM8(1024,1024),3*t,n,e)}},{key:"setCamera",value:function(e){this._composer.passes.forEach((function(t){(t instanceof Je||t instanceof Ke)&&(t.camera=e)}))}}]),e}(),nt=new K.Pa4,it=new K.$V,rt=new K.Pa4,at=function(){function e(t,n){(0,i.Z)(this,e),this.object=t,this.domElement=n,this.enabled=!0,this.movementSpeed=1,this.lookSpeed=.005,this.lookVertical=!0,this.autoForward=!1,this.activeLook=!0,this.heightSpeed=!1,this.heightCoef=1,this.heightMin=0,this.heightMax=1,this.constrainVertical=!1,this.verticalMin=0,this.verticalMax=Math.PI,this.mouseDragOn=!1,this.autoSpeedFactor=0,this.pointerX=0,this.pointerY=0,this.pointerDeltaX=0,this.pointerDeltaY=0,this.moveForward=!1,this.moveBackward=!1,this.moveLeft=!1,this.moveRight=!1,this.virtualJoystickDx=0,this.virtualJoystickDy=0,this.viewHalfX=0,this.viewHalfY=0,this.lat=0,this.lon=0,this.targetPosition=new K.Pa4,this.onKeyDown=this.onKeyDown.bind(this),this.onKeyUp=this.onKeyUp.bind(this),this.onPointerDown=this.onPointerDown.bind(this),this.onPointerUp=this.onPointerUp.bind(this),this.onPointerMove=this.onPointerMove.bind(this),this.domElement.addEventListener("pointerdown",this.onPointerDown),window.addEventListener("keydown",this.onKeyDown),window.addEventListener("keyup",this.onKeyUp),this.handleResize(),this.setOrientation(this)}return(0,r.Z)(e,[{key:"dispose",value:function(){this.domElement.removeEventListener("pointerup",this.onPointerUp),window.removeEventListener("keydown",this.onKeyDown),window.removeEventListener("keyup",this.onKeyUp)}},{key:"onPointerDown",value:function(e){!1!==e.isPrimary&&(this.pointerX=e.clientX,this.pointerY=e.clientY,this.domElement.addEventListener("pointermove",this.onPointerMove),this.domElement.addEventListener("pointerup",this.onPointerUp))}},{key:"onPointerMove",value:function(e){!1!==e.isPrimary&&(this.pointerDeltaX=this.pointerX-e.clientX,this.pointerDeltaY=this.pointerY-e.clientY,this.pointerX=e.clientX,this.pointerY=e.clientY,this.lon-=this.pointerDeltaX*this.lookSpeed,this.lat-=this.pointerDeltaY*this.lookSpeed,this.lat=Math.max(-85,Math.min(85,this.lat)))}},{key:"onPointerUp",value:function(e){!1!==e.isPrimary&&(this.pointerDeltaX=0,this.pointerDeltaY=0,this.domElement.removeEventListener("pointermove",this.onPointerMove),this.domElement.removeEventListener("pointerup",this.onPointerUp))}},{key:"setOrientation",value:function(e){var t=e.object.quaternion;nt.set(0,0,-1).applyQuaternion(t),it.setFromVector3(nt),this.lat=90-K.M8C.radToDeg(it.phi),this.lon=K.M8C.radToDeg(it.theta)}},{key:"getState",value:function(){return{matrix:this.object.matrix.clone(),controllerType:"firstperson"}}},{key:"setState",value:function(e){this.object.quaternion.setFromRotationMatrix(e.matrix),this.object.position.setFromMatrixPosition(e.matrix),this.setOrientation(this)}},{key:"handleResize",value:function(){this.domElement===document?(this.viewHalfX=window.innerWidth/2,this.viewHalfY=window.innerHeight/2):(this.viewHalfX=this.domElement.offsetWidth/2,this.viewHalfY=this.domElement.offsetHeight/2)}},{key:"onKeyDown",value:function(e){switch(e.code){case"ArrowUp":case"KeyW":this.moveForward=!0;break;case"ArrowLeft":case"KeyA":this.moveLeft=!0;break;case"ArrowDown":case"KeyS":this.moveBackward=!0;break;case"ArrowRight":case"KeyD":this.moveRight=!0;break;case"KeyR":this.moveUp=!0;break;case"KeyF":this.moveDown=!0}}},{key:"onKeyUp",value:function(e){switch(e.code){case"ArrowUp":case"KeyW":this.moveForward=!1;break;case"ArrowLeft":case"KeyA":this.moveLeft=!1;break;case"ArrowDown":case"KeyS":this.moveBackward=!1;break;case"ArrowRight":case"KeyD":this.moveRight=!1;break;case"KeyR":this.moveUp=!1;break;case"KeyF":this.moveDown=!1}}},{key:"lookAt",value:function(e,t,n){return e.isVector3?rt.copy(e):rt.set(e,t,n),this.object.lookAt(rt),this.setOrientation(this),this}},{key:"update",value:function(e){if(!1!==this.enabled){var t=this.object.position.y;if(this.heightSpeed){var n=K.M8C.clamp(this.object.position.y,this.heightMin,this.heightMax)-this.heightMin;this.autoSpeedFactor=e*(n*this.heightCoef)}else this.autoSpeedFactor=0;var i=e*this.movementSpeed;(this.moveForward||this.autoForward&&!this.moveBackward)&&this.object.translateZ(-(i+this.autoSpeedFactor)),this.moveBackward&&this.object.translateZ(i),this.moveLeft&&this.object.translateX(-i),this.moveRight&&this.object.translateX(i),this.object.translateX(.1*i*this.virtualJoystickDx),this.object.translateZ(.1*i*this.virtualJoystickDy),this.moveUp&&this.object.translateY(i),this.moveDown&&this.object.translateY(-i);var r=K.M8C.degToRad(90-this.lat),a=K.M8C.degToRad(this.lon);this.constrainVertical&&(r=K.M8C.mapLinear(r,0,Math.PI,this.verticalMin,this.verticalMax));var o=this.object.position;this.targetPosition.setFromSphericalCoords(1,r,a).add(o),this.object.lookAt(this.targetPosition),this.moveUp||this.moveDown||(this.object.position.y=t)}}},{key:"onVirtualJoyStickMove",value:function(e,t){this.virtualJoystickDx=e,this.virtualJoystickDy=t}},{key:"onVirtualJoyStickTouch",value:function(){}},{key:"onVirtualJoyStickRelease",value:function(){this.virtualJoystickDx=0,this.virtualJoystickDy=0}}]),e}(),ot=function(e){(0,a.Z)(n,e);var t=(0,o.Z)(n);function n(e){var r,a=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};(0,i.Z)(this,n),(r=t.call(this,e)).isReflector=!0,r.type="Reflector",r.camera=new K.cPb;var o=(0,y.Z)(r),s=void 0!==a.color?new K.Ilk(a.color):new K.Ilk(8355711),l=a.textureWidth||512,u=a.textureHeight||512,c=a.clipBias||0,h=a.shader||n.ReflectorShader,d=void 0!==a.multisample?a.multisample:4,f=new K.JOQ,p=new K.Pa4,A=new K.Pa4,v=new K.Pa4,g=new K.yGw,m=new K.Pa4(0,0,-1),x=new K.Ltg,w=new K.Pa4,C=new K.Pa4,b=new K.Ltg,_=new K.yGw,E=r.camera,M=new K.dd2(l,u,{samples:d,type:K.cLu}),I=new K.jyz({uniforms:K.rDY.clone(h.uniforms),fragmentShader:h.fragmentShader,vertexShader:h.vertexShader});return I.uniforms.tDiffuse.value=M.texture,I.uniforms.color.value=s,I.uniforms.textureMatrix.value=_,r.material=I,r.onBeforeRender=function(e,t,n){if(A.setFromMatrixPosition(o.matrixWorld),v.setFromMatrixPosition(n.matrixWorld),g.extractRotation(o.matrixWorld),p.set(0,0,1),p.applyMatrix4(g),w.subVectors(A,v),!(w.dot(p)>0)){w.reflect(p).negate(),w.add(A),g.extractRotation(n.matrixWorld),m.set(0,0,-1),m.applyMatrix4(g),m.add(v),C.subVectors(A,m),C.reflect(p).negate(),C.add(A),E.position.copy(w),E.up.set(0,1,0),E.up.applyMatrix4(g),E.up.reflect(p),E.lookAt(C),E.far=n.far,E.updateMatrixWorld(),E.projectionMatrix.copy(n.projectionMatrix),_.set(.5,0,0,.5,0,.5,0,.5,0,0,.5,.5,0,0,0,1),_.multiply(E.projectionMatrix),_.multiply(E.matrixWorldInverse),_.multiply(o.matrixWorld),f.setFromNormalAndCoplanarPoint(p,A),f.applyMatrix4(E.matrixWorldInverse),x.set(f.normal.x,f.normal.y,f.normal.z,f.constant);var i=E.projectionMatrix;b.x=(Math.sign(x.x)+i.elements[8])/i.elements[0],b.y=(Math.sign(x.y)+i.elements[9])/i.elements[5],b.z=-1,b.w=(1+i.elements[10])/i.elements[14],x.multiplyScalar(2/x.dot(b)),i.elements[2]=x.x,i.elements[6]=x.y,i.elements[10]=x.z+1-c,i.elements[14]=x.w,o.visible=!1;var r=e.getRenderTarget(),a=e.xr.enabled,s=e.shadowMap.autoUpdate,l=e.outputEncoding,u=e.toneMapping;e.xr.enabled=!1,e.shadowMap.autoUpdate=!1,e.outputEncoding=K.rnI,e.toneMapping=K.uL9,e.setRenderTarget(M),e.state.buffers.depth.setMask(!0),!1===e.autoClear&&e.clear(),e.render(t,E),e.xr.enabled=a,e.shadowMap.autoUpdate=s,e.outputEncoding=l,e.toneMapping=u,e.setRenderTarget(r);var h=n.viewport;void 0!==h&&e.state.viewport(h),o.visible=!0}},r.getRenderTarget=function(){return M},r.dispose=function(){M.dispose(),o.material.dispose()},r}return(0,r.Z)(n)}(K.Kj0);ot.ReflectorShader={uniforms:{color:{value:null},tDiffuse:{value:null},textureMatrix:{value:null}},vertexShader:"\n\t\tuniform mat4 textureMatrix;\n\t\tvarying vec4 vUv;\n\n\t\t#include <common>\n\t\t#include <logdepthbuf_pars_vertex>\n\n\t\tvoid main() {\n\n\t\t\tvUv = textureMatrix * vec4( position, 1.0 );\n\n\t\t\tgl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );\n\n\t\t\t#include <logdepthbuf_vertex>\n\n\t\t}",fragmentShader:"\n\t\tuniform vec3 color;\n\t\tuniform sampler2D tDiffuse;\n\t\tvarying vec4 vUv;\n\n\t\t#include <logdepthbuf_pars_fragment>\n\n\t\tfloat blendOverlay( float base, float blend ) {\n\n\t\t\treturn( base < 0.5 ? ( 2.0 * base * blend ) : ( 1.0 - 2.0 * ( 1.0 - base ) * ( 1.0 - blend ) ) );\n\n\t\t}\n\n\t\tvec3 blendOverlay( vec3 base, vec3 blend ) {\n\n\t\t\treturn vec3( blendOverlay( base.r, blend.r ), blendOverlay( base.g, blend.g ), blendOverlay( base.b, blend.b ) );\n\n\t\t}\n\n\t\tvoid main() {\n\n\t\t\t#include <logdepthbuf_fragment>\n\n\t\t\tvec4 base = texture2DProj( tDiffuse, vUv );\n\t\t\tgl_FragColor = vec4( blendOverlay( base.rgb, color ), 1.0 );\n\n\t\t\t#include <tonemapping_fragment>\n\t\t\t#include <encodings_fragment>\n\n\t\t}"};var st=n(11752),lt=n(61120),ut=function(e){(0,a.Z)(n,e);var t=(0,o.Z)(n);function n(e){var r;return(0,i.Z)(this,n),(r=t.call(this,e)).type=K.cLu,r}return(0,r.Z)(n,[{key:"parse",value:function(e){var t=function(e,t){switch(e){case 1:console.error("THREE.RGBELoader Read Error: "+(t||""));break;case 2:console.error("THREE.RGBELoader Write Error: "+(t||""));break;case 3:console.error("THREE.RGBELoader Bad File Format: "+(t||""));break;default:console.error("THREE.RGBELoader: Error: "+(t||""))}return-1},n=function(e,t,n){t=t||1024;for(var i=e.pos,r=-1,a=0,o="",s=String.fromCharCode.apply(null,new Uint16Array(e.subarray(i,i+128)));0>(r=s.indexOf("\n"))&&a<t&&i<e.byteLength;)o+=s,a+=s.length,i+=128,s+=String.fromCharCode.apply(null,new Uint16Array(e.subarray(i,i+128)));return-1<r&&(!1!==n&&(e.pos+=a+r+1),o+s.slice(0,r))},i=function(e,t,n,i){var r=e[t+3],a=Math.pow(2,r-128)/255;n[i+0]=e[t+0]*a,n[i+1]=e[t+1]*a,n[i+2]=e[t+2]*a,n[i+3]=1},r=function(e,t,n,i){var r=e[t+3],a=Math.pow(2,r-128)/255;n[i+0]=K.A5E.toHalfFloat(Math.min(e[t+0]*a,65504)),n[i+1]=K.A5E.toHalfFloat(Math.min(e[t+1]*a,65504)),n[i+2]=K.A5E.toHalfFloat(Math.min(e[t+2]*a,65504)),n[i+3]=K.A5E.toHalfFloat(1)},a=new Uint8Array(e);a.pos=0;var o=function(e){var i,r,a=/^\s*GAMMA\s*=\s*(\d+(\.\d+)?)\s*$/,o=/^\s*EXPOSURE\s*=\s*(\d+(\.\d+)?)\s*$/,s=/^\s*FORMAT=(\S+)\s*$/,l=/^\s*\-Y\s+(\d+)\s+\+X\s+(\d+)\s*$/,u={valid:0,string:"",comments:"",programtype:"RGBE",format:"",gamma:1,exposure:1,width:0,height:0};if(e.pos>=e.byteLength||!(i=n(e)))return t(1,"no header found");if(!(r=i.match(/^#\?(\S+)/)))return t(3,"bad initial token");for(u.valid|=1,u.programtype=r[1],u.string+=i+"\n";!1!==(i=n(e));)if(u.string+=i+"\n","#"!==i.charAt(0)){if((r=i.match(a))&&(u.gamma=parseFloat(r[1])),(r=i.match(o))&&(u.exposure=parseFloat(r[1])),(r=i.match(s))&&(u.valid|=2,u.format=r[1]),(r=i.match(l))&&(u.valid|=4,u.height=parseInt(r[1],10),u.width=parseInt(r[2],10)),2&u.valid&&4&u.valid)break}else u.comments+=i+"\n";return 2&u.valid?4&u.valid?u:t(3,"missing image size specifier"):t(3,"missing format specifier")}(a);if(-1!==o){var s=o.width,l=o.height,u=function(e,n,i){var r=n;if(r<8||r>32767||2!==e[0]||2!==e[1]||128&e[2])return new Uint8Array(e);if(r!==(e[2]<<8|e[3]))return t(3,"wrong scanline width");var a=new Uint8Array(4*n*i);if(!a.length)return t(4,"unable to allocate buffer space");for(var o=0,s=0,l=4*r,u=new Uint8Array(4),c=new Uint8Array(l),h=i;h>0&&s<e.byteLength;){if(s+4>e.byteLength)return t(1);if(u[0]=e[s++],u[1]=e[s++],u[2]=e[s++],u[3]=e[s++],2!=u[0]||2!=u[1]||(u[2]<<8|u[3])!=r)return t(3,"bad rgbe scanline format");for(var d=0,f=void 0;d<l&&s<e.byteLength;){var p=(f=e[s++])>128;if(p&&(f-=128),0===f||d+f>l)return t(3,"bad scanline data");if(p)for(var A=e[s++],v=0;v<f;v++)c[d++]=A;else c.set(e.subarray(s,s+f),d),d+=f,s+=f}for(var g=r,m=0;m<g;m++){var y=0;a[o]=c[m+y],y+=r,a[o+1]=c[m+y],y+=r,a[o+2]=c[m+y],y+=r,a[o+3]=c[m+y],o+=4}h--}return a}(a.subarray(a.pos),s,l);if(-1!==u){var c,h,d;switch(this.type){case K.VzW:d=u.length/4;for(var f=new Float32Array(4*d),p=0;p<d;p++)i(u,4*p,f,4*p);c=f,h=K.VzW;break;case K.cLu:d=u.length/4;for(var A=new Uint16Array(4*d),v=0;v<d;v++)r(u,4*v,A,4*v);c=A,h=K.cLu;break;default:console.error("THREE.RGBELoader: unsupported type: ",this.type)}return{width:s,height:l,data:c,header:o.string,gamma:o.gamma,exposure:o.exposure,type:h}}}return null}},{key:"setDataType",value:function(e){return this.type=e,this}},{key:"load",value:function(e,t,i,r){return(0,st.Z)((0,lt.Z)(n.prototype),"load",this).call(this,e,(function(e,n){switch(e.type){case K.VzW:case K.cLu:e.encoding=K.rnI,e.minFilter=K.wem,e.magFilter=K.wem,e.generateMipmaps=!1,e.flipY=!0}t&&t(e,n)}),i,r)}}]),n}(K.yxD),ct="\n  attribute vec3 position;\n  uniform mat4 modelViewMatrix;\n  uniform mat4 projectionMatrix;\n  varying vec2 vUv;\n  void main() {\n    gl_Position = vec4(position, 1.0);\n    vUv = vec2(position.x, position.y) * 0.5 + 0.5;\n  }\n",ht="\n  precision mediump float;\n  \n  uniform vec3 color1;\n  uniform vec3 color2;\n  uniform float aspect;\n  uniform vec2 offset;\n  uniform vec2 scale;\n  uniform float noiseAlpha;\n  uniform bool aspectCorrection;\n  uniform float grainScale;\n  uniform float grainTime;\n  uniform vec2 smooth;\n\n  varying vec2 vUv;\n\n  void main() {\n    vec2 q = vec2(vUv - 0.5);\n    if (aspectCorrection) {\n      q.x *= aspect;\n    }\n    q /= scale;\n    q -= offset;\n    float dst = length(q);\n    dst = smoothstep(smooth.x, smooth.y, dst);\n    vec3 color = mix(color1, color2, dst);\n\n    gl_FragColor.rgb = color;\n    gl_FragColor.a = 1.0;\n  }\n";var dt={defines:{KERNEL_SIZE_FLOAT:"25.0",KERNEL_SIZE_INT:"25"},uniforms:{tDiffuse:{value:null},uImageIncrement:{value:new K.FM8(.001953125,0)},cKernel:{value:[]}},vertexShader:"\n\n\t\tuniform vec2 uImageIncrement;\n\n\t\tvarying vec2 vUv;\n\n\t\tvoid main() {\n\n\t\t\tvUv = uv - ( ( KERNEL_SIZE_FLOAT - 1.0 ) / 2.0 ) * uImageIncrement;\n\t\t\tgl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );\n\n\t\t}",fragmentShader:"\n\n\t\tuniform float cKernel[ KERNEL_SIZE_INT ];\n\n\t\tuniform sampler2D tDiffuse;\n\t\tuniform vec2 uImageIncrement;\n\n\t\tvarying vec2 vUv;\n\n\t\tvoid main() {\n\n\t\t\tvec2 imageCoord = vUv;\n\t\t\tvec4 sum = vec4( 0.0, 0.0, 0.0, 0.0 );\n\n\t\t\tfor( int i = 0; i < KERNEL_SIZE_INT; i ++ ) {\n\n\t\t\t\tsum += texture2D( tDiffuse, imageCoord ) * cKernel[ i ];\n\t\t\t\timageCoord += uImageIncrement;\n\n\t\t\t}\n\n\t\t\tgl_FragColor = sum;\n\n\t\t}",buildKernel:function(e){var t=2*Math.ceil(3*e)+1;t>25&&(t=25);for(var n=.5*(t-1),i=new Array(t),r=0,a=0;a<t;++a)i[a]=ft(a-n,e),r+=i[a];for(var o=0;o<t;++o)i[o]/=r;return i}};function ft(e,t){return Math.exp(-e*e/(2*t*t))}var pt=function(){function e(){(0,i.Z)(this,e),this.resources=new Set}return(0,r.Z)(e,[{key:"track",value:function(e){var t=this;if(!e)return e;if(Array.isArray(e))return e.forEach((function(e){return t.track(e)})),e;if(e instanceof K.xsS)this.track(e.background),this.track(e.environment),this.track(e.children);else if(e instanceof K.Kj0)this.track(e.geometry),this.track(e.material),e.dispose&&this.resources.add(e),this.track(e.children);else if(e instanceof K.woe)this.track(e.geometry),this.track(e.material),this.track(e.children);else if(e instanceof K.F5T){if(this.track(e.map),this.track(e.lightMap),this.track(e.metalnessMap),this.track(e.alphaMap),this.track(e.displacementMap),this.track(e.normalMap),this.track(e.emissiveMap),this.track(e.bumpMap),this.track(e.envMap),this.track(e.roughnessMap),this.track(e.aoMap),this.track(e.clearcoatMap),this.track(e.clearcoatNormalMap),this.track(e.clearcoatRoughnessMap),e.uniforms)for(var n=0,i=Object.values(e.uniforms);n<i.length;n++){var r=i[n];if(r){var a=r.value;(a instanceof K.xEZ||Array.isArray(a))&&this.track(a)}}}else if(e instanceof K.Tme)this.track(e.children);else if(e.dispose)return void this.resources.add(e);return e}},{key:"untrack",value:function(e){this.resources.delete(e)}},{key:"dispose",value:function(){var e,t=(0,Ne.Z)(this.resources);try{for(t.s();!(e=t.n()).done;){var n=e.value;n instanceof K.Tme&&n.parent&&n.parent.remove(n),n instanceof K.xsS||n.dispose&&n.dispose()}}catch(i){t.e(i)}finally{t.f()}this.resources.clear()}}]),e}(),At=function(e){(0,a.Z)(n,e);var t=(0,o.Z)(n);function n(e){var r;(0,i.Z)(this,n),r=t.call(this);var a=je;return r.textureID="tDiffuse",r.uniforms=K.rDY.clone(a.uniforms),r.material=new K.jyz({uniforms:r.uniforms,vertexShader:a.vertexShader,fragmentShader:a.fragmentShader}),r.renderTarget=e,void 0===r.renderTarget&&(r.renderTarget=new K.dd2,r.renderTarget.texture.name="SavePass.rt"),r.needsSwap=!1,r.fsQuad=new He(r.material),r}return(0,r.Z)(n,[{key:"render",value:function(e,t,n){this.uniforms[this.textureID]&&(this.uniforms[this.textureID].value=n.texture),e.setRenderTarget(this.renderTarget),this.clear&&e.clear(),this.fsQuad.render(e)}},{key:"setSize",value:function(e,t){this.renderTarget.setSize(e,t)}},{key:"dispose",value:function(){this.renderTarget.dispose(),this.material.dispose(),this.fsQuad.dispose()}}]),n}(Oe),vt=new K.FM8,gt=new K.Pa4,mt={uniforms:{},vertexShader:["varying vec4 vUv;","void main() {","   vec4 pos = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );","   gl_Position = pos;","   vUv = pos;","}"].join("\n"),fragmentShader:["varying vec4 vUv;","void main() {","\tgl_FragColor = vec4( 0, 0, 0, ((vUv.z / vUv.w) + 1.0) / 2.0);","}"].join("\n")},yt=function(){function e(){(0,i.Z)(this,e)}return(0,r.Z)(e,null,[{key:"renderShadow",value:function(e,t,n,i,r,a){var o=new pt;e.renderer.getSize(vt);var s=(new K.ZzF).setFromObject(i);s.getSize(gt);var l=new K.Pa4;s.getCenter(l);var u=new K.aLr;s.getBoundingSphere(u);var c=.2*gt.x,h=.2*gt.z,d=new K.iKG(-(gt.x/2+c),gt.x/2+c,gt.z/2+h,-(gt.z/2+h),gt.y*a+.001*gt.y,gt.y+.1*gt.y);d.position.add(l),d.position.y=s.max.y+.05*gt.y;var f=d.position.clone();f.y=s.min.y,d.lookAt(f);var p=new K.jyz({fragmentShader:mt.fragmentShader,vertexShader:mt.vertexShader});p.depthFunc=K.w$m,p.side=K._Li,e.renderer.state.buffers.depth.setClear(0);var A=i.clone();A.traverse((function(e){e instanceof K.Kj0&&(e.material=p)}));var v=new K.xsS;v.add(A),v.add(d),v.background=null;var g=new Ye(e.renderer);g.setSize(512,512);var m=new Je(v,d);g.addPass(m);var y=(0,G.Z)({},dt);y.uniforms.uImageIncrement.value=new K.FM8(.001953125,0),y.uniforms.cKernel.value=dt.buildKernel(4),y.uniforms.tDiffuse.value=t.texture;var x=new Ve(y),w=(0,G.Z)({},dt);w.uniforms.uImageIncrement.value=new K.FM8(0,.001953125),w.uniforms.cKernel.value=dt.buildKernel(4),w.uniforms.tDiffuse.value=t.texture;for(var C=new Ve(w),b=1;b<8*r;++b)g.addPass(x),g.addPass(C);g.addPass(new At(t)),o.track(v),n.position.set(l.x,0,l.z);var _=.2*gt.x*2,E=.2*gt.z*2;n.geometry.dispose(),n.geometry=new K._12(gt.x+_,gt.z+E,1,1),e.renderer.setRenderTarget(t);var M=new K.Ilk;e.renderer.getClearColor(M);var I=e.renderer.getClearAlpha();e.renderer.setClearColor(new K.Ilk(0),0),g.render(),e.renderer.setClearColor(M,I),e.renderer.setRenderTarget(null),e.renderer.state.buffers.depth.setClear(1),e.renderer.setSize(vt.x,vt.y),g.renderTarget1.dispose(),g.renderTarget2.dispose(),o.dispose()}}]),e}(),xt=new K.USm,wt=new K.Pa4,Ct=new K.Pa4(1,0,0),bt=new K.Pa4(0,1,0),_t=new K.Pa4(0,0,1);new K.ZzF,new K.Pa4,new K.Pa4;function Et(e,t,n){var i=function(e){var t=(e=e||{}).geometry||new K._12(2,2,1),n=new K.FIo({vertexShader:ct,fragmentShader:ht,side:K.ehD,uniforms:{aspectCorrection:{type:"i",value:!1},aspect:{type:"f",value:1},offset:{type:"v2",value:new K.FM8(0,0)},scale:{type:"v2",value:new K.FM8(1,1)},smooth:{type:"v2",value:new K.FM8(0,1)},color1:{type:"c",value:new K.Ilk("#fff")},color2:{type:"c",value:new K.Ilk("#283844")}},depthTest:!1}),i=new K.Kj0(t,n);return i.frustumCulled=!1,i.style=function(e){if(e=e||{},Array.isArray(e.colors)){var t=e.colors.map((function(e){return"string"===typeof e||"number"===typeof e?new K.Ilk(e):e}));n.uniforms.color1.value.copy(t[0]),n.uniforms.color2.value.copy(t[1])}if("number"===typeof e.aspect&&(n.uniforms.aspect.value=e.aspect),e.smooth){var i=r(e.smooth,K.FM8);n.uniforms.smooth.value.copy(i)}if(e.offset){var a=r(e.offset,K.FM8);n.uniforms.offset.value.copy(a)}if("undefined"!==typeof e.scale){var o=e.scale;"number"===typeof o&&(o=[o,o]),o=r(o,K.FM8),n.uniforms.scale.value.copy(o)}"undefined"!==typeof e.aspectCorrection&&(n.uniforms.aspectCorrection.value=Boolean(e.aspectCorrection))},e&&i.style(e),i;function r(e,t){return Array.isArray(e)?(new t).fromArray(e):e}}({aspect:n,colors:[new K.Ilk(e),new K.Ilk(t)]});return i.name="gradient",i.renderOrder=-1,i}Object.freeze(xt),Object.freeze(wt),Object.freeze(Ct),Object.freeze(bt),Object.freeze(_t);var Mt=function(e,t){void 0===t&&console.warn('THREE.OrbitControls: The second parameter "domElement" is now mandatory.'),t===document&&console.error('THREE.OrbitControls: "document" should not be used as the target "domElement". Please use "renderer.domElement" instead.'),this.object=e,this.domElement=t,this.enabled=!0,this.target=new K.Pa4,this.minDistance=0,this.maxDistance=1/0,this.minZoom=0,this.maxZoom=1/0,this.minPolarAngle=0,this.maxPolarAngle=Math.PI,this.minAzimuthAngle=-1/0,this.maxAzimuthAngle=1/0,this.enableDamping=!1,this.dampingFactor=.05,this.enableZoom=!0,this.zoomSpeed=1,this.enableRotate=!0,this.rotateSpeed=1,this.enablePan=!0,this.panSpeed=1,this.screenSpacePanning=!0,this.keyPanSpeed=7,this.autoRotate=!1,this.autoRotateSpeed=2,this.keys={LEFT:"ArrowLeft",UP:"ArrowUp",RIGHT:"ArrowRight",BOTTOM:"ArrowDown"},this.mouseButtons={LEFT:K.RsA.ROTATE,MIDDLE:K.RsA.DOLLY,RIGHT:K.RsA.PAN},this.touches={ONE:K.QmN.ROTATE,TWO:K.QmN.DOLLY_PAN},this.target0=this.target.clone(),this.position0=this.object.position.clone(),this.zoom0=this.object.zoom,this._domElementKeyEvents=null,this.getPolarAngle=function(){return u.phi},this.getAzimuthalAngle=function(){return u.theta},this.listenToKeyEvents=function(e){e.addEventListener("keydown",O),this._domElementKeyEvents=e},this.clearPanOffset=function(){n.panOffset.copy(wt),n.update()},this.setState=function(e){e.matrix&&n.object.matrix.copy(e.matrix),e.position&&n.object.position.copy(e.position),e.quaternion&&n.object.quaternion.copy(e.quaternion),n.object.zoom=e.zoom,n.panOffset.copy(e.panOffset),n.target.copy(e.target),n.object.updateProjectionMatrix(),n.update()},this.getState=function(){var e;return{matrix:n.object.matrix.clone(),position:n.object.position.clone(),quaternion:n.object.quaternion.clone(),zoom:null!==(e=n.object.zoom)&&void 0!==e?e:1,panOffset:n.panOffset.clone(),target:n.target.clone(),controllerType:"orbit"}},this.saveState=function(){n.target0.copy(n.target),n.position0.copy(n.object.position),n.zoom0=n.object.zoom},this.reset=function(){n.target.copy(n.target0),n.object.position.copy(n.position0),n.object.zoom=n.zoom0,n.object.updateProjectionMatrix(),n.dispatchEvent(i),n.update(),s=o.NONE},this.update=function(){var t=new K.Pa4,r=(new K._fP).setFromUnitVectors(e.up,new K.Pa4(0,1,0)),a=r.clone().invert(),f=new K.Pa4,p=new K._fP,A=2*Math.PI;return function(){var e=n.object.position;t.copy(e).sub(n.target),t.applyQuaternion(r),u.setFromVector3(t),n.autoRotate&&s===o.NONE&&b(2*Math.PI/60/60*n.autoRotateSpeed),n.enableDamping?(u.theta+=c.theta*n.dampingFactor,u.phi+=c.phi*n.dampingFactor):(u.theta+=c.theta,u.phi+=c.phi);var v=n.minAzimuthAngle,g=n.maxAzimuthAngle;return isFinite(v)&&isFinite(g)&&(v<-Math.PI?v+=A:v>Math.PI&&(v-=A),g<-Math.PI?g+=A:g>Math.PI&&(g-=A),u.theta=v<=g?Math.max(v,Math.min(g,u.theta)):u.theta>(v+g)/2?Math.max(v,u.theta):Math.min(g,u.theta)),u.phi=Math.max(n.minPolarAngle,Math.min(n.maxPolarAngle,u.phi)),u.makeSafe(),u.radius*=h,u.radius=Math.max(n.minDistance,Math.min(n.maxDistance,u.radius)),!0===n.enableDamping?n.target.addScaledVector(n.panOffset,n.dampingFactor):n.target.add(n.panOffset),t.setFromSpherical(u),t.applyQuaternion(a),e.copy(n.target).add(t),n.object.lookAt(n.target),!0===n.enableDamping?(c.theta*=1-n.dampingFactor,c.phi*=1-n.dampingFactor,n.panOffset.multiplyScalar(1-n.dampingFactor)):(c.set(0,0,0),n.panOffset.set(0,0,0)),h=1,!!(d||f.distanceToSquared(n.object.position)>l||8*(1-p.dot(n.object.quaternion))>l)&&(n.dispatchEvent(i),f.copy(n.object.position),p.copy(n.object.quaternion),d=!1,!0)}}(),this.dispose=function(){n.domElement.removeEventListener("contextmenu",V),n.domElement.removeEventListener("pointerdown",N),n.domElement.removeEventListener("wheel",j),n.domElement.removeEventListener("touchstart",z),n.domElement.removeEventListener("touchend",H),n.domElement.removeEventListener("touchmove",G),n.domElement.ownerDocument.removeEventListener("pointermove",F),n.domElement.ownerDocument.removeEventListener("pointerup",U),null!==n._domElementKeyEvents&&n._domElementKeyEvents.removeEventListener("keydown",O)},this.panOffset=new K.Pa4;var n=this,i={type:"change"},r={type:"start"},a={type:"end"},o={NONE:-1,ROTATE:0,DOLLY:1,PAN:2,TOUCH_ROTATE:3,TOUCH_PAN:4,TOUCH_DOLLY_PAN:5,TOUCH_DOLLY_ROTATE:6},s=o.NONE,l=1e-6,u=new K.$V,c=new K.$V,h=1,d=!1,f=new K.FM8,p=new K.FM8,A=new K.FM8,v=new K.FM8,g=new K.FM8,m=new K.FM8,y=new K.FM8,x=new K.FM8,w=new K.FM8;function C(){return Math.pow(.95,n.zoomSpeed)}function b(e){c.theta-=e}function _(e){c.phi-=e}var E=function(){var e=new K.Pa4;return function(t,i){e.setFromMatrixColumn(i,0),e.multiplyScalar(-t),n.panOffset.add(e)}}(),M=function(){var e=new K.Pa4;return function(t,i){!0===n.screenSpacePanning?e.setFromMatrixColumn(i,1):(e.setFromMatrixColumn(i,0),e.crossVectors(n.object.up,e)),e.multiplyScalar(t),n.panOffset.add(e)}}(),I=function(){var e=new K.Pa4;return function(t,i){var r=n.domElement;if(n.object.isPerspectiveCamera){var a=n.object.position;e.copy(a).sub(n.target);var o=e.length();o*=Math.tan(n.object.fov/2*Math.PI/180),E(2*t*o/r.clientHeight,n.object.matrix),M(2*i*o/r.clientHeight,n.object.matrix)}else n.object.isOrthographicCamera?(E(t*(n.object.right-n.object.left)/n.object.zoom/r.clientWidth,n.object.matrix),M(i*(n.object.top-n.object.bottom)/n.object.zoom/r.clientHeight,n.object.matrix)):(console.warn("WARNING: OrbitControls.js encountered an unknown camera type - pan disabled."),n.enablePan=!1)}}();function S(e){n.object.isPerspectiveCamera?h/=e:n.object.isOrthographicCamera?(n.object.zoom=Math.max(n.minZoom,Math.min(n.maxZoom,n.object.zoom*e)),n.object.updateProjectionMatrix(),d=!0):(console.warn("WARNING: OrbitControls.js encountered an unknown camera type - dolly/zoom disabled."),n.enableZoom=!1)}function k(e){n.object.isPerspectiveCamera?h*=e:n.object.isOrthographicCamera?(n.object.zoom=Math.max(n.minZoom,Math.min(n.maxZoom,n.object.zoom/e)),n.object.updateProjectionMatrix(),d=!0):(console.warn("WARNING: OrbitControls.js encountered an unknown camera type - dolly/zoom disabled."),n.enableZoom=!1)}function B(e){f.set(e.clientX,e.clientY)}function T(e){v.set(e.clientX,e.clientY)}function D(e){if(1==e.touches.length)f.set(e.touches[0].pageX,e.touches[0].pageY);else{var t=.5*(e.touches[0].pageX+e.touches[1].pageX),n=.5*(e.touches[0].pageY+e.touches[1].pageY);f.set(t,n)}}function R(e){if(1==e.touches.length)v.set(e.touches[0].pageX,e.touches[0].pageY);else{var t=.5*(e.touches[0].pageX+e.touches[1].pageX),n=.5*(e.touches[0].pageY+e.touches[1].pageY);v.set(t,n)}}function P(e){var t=e.touches[0].pageX-e.touches[1].pageX,n=e.touches[0].pageY-e.touches[1].pageY,i=Math.sqrt(t*t+n*n);y.set(0,i)}function L(e){if(1==e.touches.length)p.set(e.touches[0].pageX,e.touches[0].pageY);else{var t=.5*(e.touches[0].pageX+e.touches[1].pageX),i=.5*(e.touches[0].pageY+e.touches[1].pageY);p.set(t,i)}A.subVectors(p,f).multiplyScalar(n.rotateSpeed);var r=n.domElement;b(2*Math.PI*A.x/r.clientHeight),_(2*Math.PI*A.y/r.clientHeight),f.copy(p)}function Q(e){if(1==e.touches.length)g.set(e.touches[0].pageX,e.touches[0].pageY);else{var t=.5*(e.touches[0].pageX+e.touches[1].pageX),i=.5*(e.touches[0].pageY+e.touches[1].pageY);g.set(t,i)}m.subVectors(g,v).multiplyScalar(n.panSpeed),I(m.x,m.y),v.copy(g)}function Z(e){var t=e.touches[0].pageX-e.touches[1].pageX,i=e.touches[0].pageY-e.touches[1].pageY,r=Math.sqrt(t*t+i*i);x.set(0,r),w.set(0,Math.pow(x.y/y.y,n.zoomSpeed)),S(w.y),y.copy(x)}function N(e){if(!1!==n.enabled)switch(e.pointerType){case"mouse":case"pen":!function(e){var t;switch(e.preventDefault(),n.domElement.focus?n.domElement.focus():window.focus(),e.button){case 0:t=n.mouseButtons.LEFT;break;case 1:t=n.mouseButtons.MIDDLE;break;case 2:t=n.mouseButtons.RIGHT;break;default:t=-1}switch(t){case K.RsA.DOLLY:if(!1===n.enableZoom)return;!function(e){y.set(e.clientX,e.clientY)}(e),s=o.DOLLY;break;case K.RsA.ROTATE:if(e.ctrlKey||e.metaKey||e.shiftKey){if(!1===n.enablePan)return;T(e),s=o.PAN}else{if(!1===n.enableRotate)return;B(e),s=o.ROTATE}break;case K.RsA.PAN:if(e.ctrlKey||e.metaKey||e.shiftKey){if(!1===n.enableRotate)return;B(e),s=o.ROTATE}else{if(!1===n.enablePan)return;T(e),s=o.PAN}break;default:s=o.NONE}s!==o.NONE&&(n.domElement.ownerDocument.addEventListener("pointermove",F),n.domElement.ownerDocument.addEventListener("pointerup",U),n.dispatchEvent(r))}(e)}}function F(e){if(!1!==n.enabled)switch(e.pointerType){case"mouse":case"pen":!function(e){if(!1===n.enabled)return;switch(e.preventDefault(),s){case o.ROTATE:if(!1===n.enableRotate)return;!function(e){p.set(e.clientX,e.clientY),A.subVectors(p,f).multiplyScalar(n.rotateSpeed);var t=n.domElement;b(2*Math.PI*A.x/t.clientHeight),_(2*Math.PI*A.y/t.clientHeight),f.copy(p),n.update()}(e);break;case o.DOLLY:if(!1===n.enableZoom)return;!function(e){x.set(e.clientX,e.clientY),w.subVectors(x,y),w.y>0?S(C()):w.y<0&&k(C()),y.copy(x),n.update()}(e);break;case o.PAN:if(!1===n.enablePan)return;!function(e){g.set(e.clientX,e.clientY),m.subVectors(g,v).multiplyScalar(n.panSpeed),I(m.x,m.y),v.copy(g),n.update()}(e)}}(e)}}function U(e){switch(e.pointerType){case"mouse":case"pen":!function(e){if(n.domElement.ownerDocument.removeEventListener("pointermove",F),n.domElement.ownerDocument.removeEventListener("pointerup",U),!1===n.enabled)return;n.dispatchEvent(a),s=o.NONE}()}}function j(e){!1===n.enabled||!1===n.enableZoom||s!==o.NONE&&s!==o.ROTATE||(e.preventDefault(),n.dispatchEvent(r),function(e){e.deltaY<0?k(C()):e.deltaY>0&&S(C()),n.update()}(e),n.dispatchEvent(a))}function O(e){!1!==n.enabled&&!1!==n.enablePan&&function(e){var t=!1;switch(e.code){case n.keys.UP:I(0,n.keyPanSpeed),t=!0;break;case n.keys.BOTTOM:I(0,-n.keyPanSpeed),t=!0;break;case n.keys.LEFT:I(n.keyPanSpeed,0),t=!0;break;case n.keys.RIGHT:I(-n.keyPanSpeed,0),t=!0}t&&(e.preventDefault(),n.update())}(e)}function z(e){if(!1!==n.enabled){switch(e.preventDefault(),e.touches.length){case 1:switch(n.touches.ONE){case K.QmN.ROTATE:if(!1===n.enableRotate)return;D(e),s=o.TOUCH_ROTATE;break;case K.QmN.PAN:if(!1===n.enablePan)return;R(e),s=o.TOUCH_PAN;break;default:s=o.NONE}break;case 2:switch(n.touches.TWO){case K.QmN.DOLLY_PAN:if(!1===n.enableZoom&&!1===n.enablePan)return;!function(e){n.enableZoom&&P(e),n.enablePan&&R(e)}(e),s=o.TOUCH_DOLLY_PAN;break;case K.QmN.DOLLY_ROTATE:if(!1===n.enableZoom&&!1===n.enableRotate)return;!function(e){n.enableZoom&&P(e),n.enableRotate&&D(e)}(e),s=o.TOUCH_DOLLY_ROTATE;break;default:s=o.NONE}break;default:s=o.NONE}s!==o.NONE&&n.dispatchEvent(r)}}function G(e){if(!1!==n.enabled)switch(e.preventDefault(),s){case o.TOUCH_ROTATE:if(!1===n.enableRotate)return;L(e),n.update();break;case o.TOUCH_PAN:if(!1===n.enablePan)return;Q(e),n.update();break;case o.TOUCH_DOLLY_PAN:if(!1===n.enableZoom&&!1===n.enablePan)return;!function(e){n.enableZoom&&Z(e),n.enablePan&&Q(e)}(e),n.update();break;case o.TOUCH_DOLLY_ROTATE:if(!1===n.enableZoom&&!1===n.enableRotate)return;!function(e){n.enableZoom&&Z(e),n.enableRotate&&L(e)}(e),n.update();break;default:s=o.NONE}}function H(e){!1!==n.enabled&&(n.dispatchEvent(a),s=o.NONE)}function V(e){!1!==n.enabled&&e.preventDefault()}n.domElement.addEventListener("contextmenu",V),n.domElement.addEventListener("pointerdown",N),n.domElement.addEventListener("wheel",j),n.domElement.addEventListener("touchstart",z),n.domElement.addEventListener("touchend",H),n.domElement.addEventListener("touchmove",G),this.update()};(Mt.prototype=Object.create(K.pBf.prototype)).constructor=Mt;var It=function(e,t){Mt.call(this,e,t),this.screenSpacePanning=!1,this.mouseButtons.LEFT=K.RsA.PAN,this.mouseButtons.RIGHT=K.RsA.ROTATE,this.touches.ONE=K.QmN.PAN,this.touches.TWO=K.QmN.DOLLY_ROTATE};(It.prototype=Object.create(K.pBf.prototype)).constructor=It;var St=function(){function e(){(0,i.Z)(this,e)}return(0,r.Z)(e,[{key:"init",value:function(e){var t,n,i,r,a=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};if(!e)throw new Fe.R("element");this._renderer=new K.CP7({alpha:null===(t=a.alpha)||void 0===t||t,antialias:null===(n=a.antialias)||void 0===n||n,preserveDrawingBuffer:null===(i=a.preserveDrawingBuffer)||void 0===i||i,canvas:e}),this._renderer.setSize(e.clientWidth,e.clientHeight),this._renderer.outputEncoding=K.knz,this._renderer.toneMapping=null!==(r=a.toneMapping)&&void 0!==r?r:K.uL9,this._renderer.physicallyCorrectLights=!0,this._renderer.setClearColor(0,0),this._renderer.shadowMap.enabled=!1,this._renderer.shadowMap.type=K.ntZ}},{key:"renderer",get:function(){return this._renderer}},{key:"render",value:function(e,t){this._renderer.render(e,t)}},{key:"canvas",get:function(){return this._renderer.domElement}},{key:"xr",get:function(){return this._renderer.xr}},{key:"setSize",value:function(e,t){this._renderer.setSize(e,t)}},{key:"dispose",value:function(){this._renderer.dispose()}}]),e}(),kt=function(){function e(t,n,r){(0,i.Z)(this,e),this._renderer=t,this._composer=n,this._scene=new K.xsS,this._sceneRoot=new K.Tme,this.sceneRoot.name="Scene Root",this.scene.add(this.sceneRoot),this._scene.background=null,this._cameraController=r,this.renderFrame=this.renderFrame.bind(this),this._renderEnabled=!0,this._renderFrameCallbacks=[],this.updateCameraController=!0,this.clock=new K.SUY,this.renderer.renderer.setAnimationLoop(this.renderFrame)}return(0,r.Z)(e,[{key:"scene",get:function(){return this._scene}},{key:"sceneRoot",get:function(){return this._sceneRoot}},{key:"renderer",get:function(){return this._renderer}},{key:"composer",get:function(){return this._composer}},{key:"camera",get:function(){return this._cameraController.object}},{key:"cameraController",get:function(){return this._cameraController},set:function(e){this._cameraController=e,this._composer&&this._composer.setCamera(e.object)}},{key:"renderScene",value:function(){this._killed||(this.composer?this.composer.render(this._scene,this.camera):this.renderer.render(this._scene,this.camera))}},{key:"renderFrame",value:function(e,t){var n=this.clock.getDelta();this._renderer.renderer.xr.isPresenting?this.xrRenderFrameHandler&&this.xrRenderFrameHandler(n,t):this.renderScene(),this._renderEnabled&&(this._cameraController&&this.updateCameraController&&this._cameraController.enabled&&this._cameraController.update(n),this._renderFrameCallbacks.forEach((function(e){e&&e(n,t)})))}},{key:"enableRender",value:function(e){this._renderEnabled=e}},{key:"addRenderFrameCallback",value:function(e){if(!e)throw new Error("Invalid parameter observer");this._renderFrameCallbacks.push(e)}},{key:"removeRenderFrameObserver",value:function(e){if(!e)throw new Error("Invalid parameter observer");this._renderFrameCallbacks.filter((function(t){return t!==e}))}},{key:"pauseRenderLoop",value:function(e){e?this.renderer.renderer.setAnimationLoop(null):this.renderer.renderer.setAnimationLoop(this.renderFrame)}},{key:"clearSceneRoot",value:function(){var e;this.sceneRoot&&((e=this.sceneRoot)&&e.traverse((function(e){!function(e){e&&(e.geometry&&e.geometry.dispose(),e.material&&(e.material.map&&e.material.map.dispose(),e.material.envMap&&e.material.envMap.dispose(),e.material.lightMap&&e.material.lightMap.dispose(),e.material.aoMap&&e.material.aoMap.dispose(),e.material.bumpMap&&e.material.bumpMap.dispose(),e.material.emissiveMap&&e.material.emissiveMap.dispose(),e.material.metalnessMap&&e.material.metalnessMap.dispose(),e.material.normalMap&&e.material.normalMap.dispose(),e.material.displacementMap&&e.material.displacementMap.dispose(),e.material.dispose()))}(e)})),this.sceneRoot.clear())}},{key:"setBackground",value:function(e){this._scene.background=e}},{key:"setEnvironmentMap",value:function(e){this._scene.environment=e}},{key:"setFog",value:function(e){this._scene.fog=e}},{key:"resetEffectManager",value:function(){if(this._composer){this._composer.deleteAllPasses();var e=this._composer.createRenderPass(this._scene,this._cameraController.object,!0);this._composer.addPass(e)}}},{key:"kill",value:function(){this._killed=!0}}]),e}(),Bt=function(){function e(){(0,i.Z)(this,e),this.rayCaster=new K.iMs,this.vec2=new K.FM8}return(0,r.Z)(e,[{key:"intersectionTest",value:function(e,t,n){return this.vec2.set(n.offsetX/n.target.clientWidth*2-1,-n.offsetY/n.target.clientHeight*2+1),this.rayCaster.setFromCamera(this.vec2,t),this.rayCaster.intersectObjects(function(e,t){if(!e)throw new Fe.R("scene");var n=[];return e.traverse((function(e){if(e.isMesh){var i=!0;t&&(i=t(e)),i&&n.push(e)}})),n}(e))}}]),e}(),Tt=new K.iMs,Dt=new K.Pa4,Rt=new K.Pa4,Pt=new K._fP,Lt={X:new K.Pa4(1,0,0),Y:new K.Pa4(0,1,0),Z:new K.Pa4(0,0,1)},Qt={type:"change"},Zt={type:"mouseDown"},Nt={type:"mouseUp",mode:null},Ft={type:"objectChange"},Ut=function(e){(0,a.Z)(n,e);var t=(0,o.Z)(n);function n(e,r){var a;(0,i.Z)(this,n),a=t.call(this),void 0===r&&(console.warn('THREE.TransformControls: The second parameter "domElement" is now mandatory.'),r=document),a.isTransformControls=!0,a.visible=!1,a.domElement=r,a.domElement.style.touchAction="none";var o=new ln;a._gizmo=o,a.add(o);var s=new un;a._plane=s,a.add(s);var l=(0,y.Z)(a);function u(e,t){var n=t;Object.defineProperty(l,e,{get:function(){return void 0!==n?n:t},set:function(t){n!==t&&(n=t,s[e]=t,o[e]=t,l.dispatchEvent({type:e+"-changed",value:t}),l.dispatchEvent(Qt))}}),l[e]=t,s[e]=t,o[e]=t}u("camera",e),u("object",void 0),u("enabled",!0),u("axis",null),u("mode","translate"),u("translationSnap",null),u("rotationSnap",null),u("scaleSnap",null),u("space","world"),u("size",1),u("dragging",!1),u("showX",!0),u("showY",!0),u("showZ",!0);var c=new K.Pa4,h=new K.Pa4,d=new K._fP,f=new K._fP,p=new K.Pa4,A=new K._fP,v=new K.Pa4,g=new K.Pa4,m=new K.Pa4,x=new K.Pa4;return u("worldPosition",c),u("worldPositionStart",h),u("worldQuaternion",d),u("worldQuaternionStart",f),u("cameraPosition",p),u("cameraQuaternion",A),u("pointStart",v),u("pointEnd",g),u("rotationAxis",m),u("rotationAngle",0),u("eye",x),a._offset=new K.Pa4,a._startNorm=new K.Pa4,a._endNorm=new K.Pa4,a._cameraScale=new K.Pa4,a._parentPosition=new K.Pa4,a._parentQuaternion=new K._fP,a._parentQuaternionInv=new K._fP,a._parentScale=new K.Pa4,a._worldScaleStart=new K.Pa4,a._worldQuaternionInv=new K._fP,a._worldScale=new K.Pa4,a._positionStart=new K.Pa4,a._quaternionStart=new K._fP,a._scaleStart=new K.Pa4,a._getPointer=jt.bind((0,y.Z)(a)),a._onPointerDown=zt.bind((0,y.Z)(a)),a._onPointerHover=Ot.bind((0,y.Z)(a)),a._onPointerMove=Gt.bind((0,y.Z)(a)),a._onPointerUp=Ht.bind((0,y.Z)(a)),a.domElement.addEventListener("pointerdown",a._onPointerDown),a.domElement.addEventListener("pointermove",a._onPointerHover),a.domElement.addEventListener("pointerup",a._onPointerUp),a}return(0,r.Z)(n,[{key:"updateMatrixWorld",value:function(){void 0!==this.object&&(this.object.updateMatrixWorld(),null===this.object.parent?console.error("TransformControls: The attached 3D object must be a part of the scene graph."):this.object.parent.matrixWorld.decompose(this._parentPosition,this._parentQuaternion,this._parentScale),this.object.matrixWorld.decompose(this.worldPosition,this.worldQuaternion,this._worldScale),this._parentQuaternionInv.copy(this._parentQuaternion).invert(),this._worldQuaternionInv.copy(this.worldQuaternion).invert()),this.camera.updateMatrixWorld(),this.camera.matrixWorld.decompose(this.cameraPosition,this.cameraQuaternion,this._cameraScale),this.camera.isOrthographicCamera?this.camera.getWorldDirection(this.eye).negate():this.eye.copy(this.cameraPosition).sub(this.worldPosition).normalize(),(0,st.Z)((0,lt.Z)(n.prototype),"updateMatrixWorld",this).call(this,this)}},{key:"pointerHover",value:function(e){if(void 0!==this.object&&!0!==this.dragging){Tt.setFromCamera(e,this.camera);var t=Vt(this._gizmo.picker[this.mode],Tt);this.axis=t?t.object.name:null}}},{key:"pointerDown",value:function(e){if(void 0!==this.object&&!0!==this.dragging&&0===e.button&&null!==this.axis){Tt.setFromCamera(e,this.camera);var t=Vt(this._plane,Tt,!0);t&&(this.object.updateMatrixWorld(),this.object.parent.updateMatrixWorld(),this._positionStart.copy(this.object.position),this._quaternionStart.copy(this.object.quaternion),this._scaleStart.copy(this.object.scale),this.object.matrixWorld.decompose(this.worldPositionStart,this.worldQuaternionStart,this._worldScaleStart),this.pointStart.copy(t.point).sub(this.worldPositionStart)),this.dragging=!0,Zt.mode=this.mode,this.dispatchEvent(Zt)}}},{key:"pointerMove",value:function(e){var t=this.axis,n=this.mode,i=this.object,r=this.space;if("scale"===n?r="local":"E"!==t&&"XYZE"!==t&&"XYZ"!==t||(r="world"),void 0!==i&&null!==t&&!1!==this.dragging&&-1===e.button){Tt.setFromCamera(e,this.camera);var a=Vt(this._plane,Tt,!0);if(a){if(this.pointEnd.copy(a.point).sub(this.worldPositionStart),"translate"===n)this._offset.copy(this.pointEnd).sub(this.pointStart),"local"===r&&"XYZ"!==t&&this._offset.applyQuaternion(this._worldQuaternionInv),-1===t.indexOf("X")&&(this._offset.x=0),-1===t.indexOf("Y")&&(this._offset.y=0),-1===t.indexOf("Z")&&(this._offset.z=0),"local"===r&&"XYZ"!==t?this._offset.applyQuaternion(this._quaternionStart).divide(this._parentScale):this._offset.applyQuaternion(this._parentQuaternionInv).divide(this._parentScale),i.position.copy(this._offset).add(this._positionStart),this.translationSnap&&("local"===r&&(i.position.applyQuaternion(Pt.copy(this._quaternionStart).invert()),-1!==t.search("X")&&(i.position.x=Math.round(i.position.x/this.translationSnap)*this.translationSnap),-1!==t.search("Y")&&(i.position.y=Math.round(i.position.y/this.translationSnap)*this.translationSnap),-1!==t.search("Z")&&(i.position.z=Math.round(i.position.z/this.translationSnap)*this.translationSnap),i.position.applyQuaternion(this._quaternionStart)),"world"===r&&(i.parent&&i.position.add(Dt.setFromMatrixPosition(i.parent.matrixWorld)),-1!==t.search("X")&&(i.position.x=Math.round(i.position.x/this.translationSnap)*this.translationSnap),-1!==t.search("Y")&&(i.position.y=Math.round(i.position.y/this.translationSnap)*this.translationSnap),-1!==t.search("Z")&&(i.position.z=Math.round(i.position.z/this.translationSnap)*this.translationSnap),i.parent&&i.position.sub(Dt.setFromMatrixPosition(i.parent.matrixWorld))));else if("scale"===n){if(-1!==t.search("XYZ")){var o=this.pointEnd.length()/this.pointStart.length();this.pointEnd.dot(this.pointStart)<0&&(o*=-1),Rt.set(o,o,o)}else Dt.copy(this.pointStart),Rt.copy(this.pointEnd),Dt.applyQuaternion(this._worldQuaternionInv),Rt.applyQuaternion(this._worldQuaternionInv),Rt.divide(Dt),-1===t.search("X")&&(Rt.x=1),-1===t.search("Y")&&(Rt.y=1),-1===t.search("Z")&&(Rt.z=1);i.scale.copy(this._scaleStart).multiply(Rt),this.scaleSnap&&(-1!==t.search("X")&&(i.scale.x=Math.round(i.scale.x/this.scaleSnap)*this.scaleSnap||this.scaleSnap),-1!==t.search("Y")&&(i.scale.y=Math.round(i.scale.y/this.scaleSnap)*this.scaleSnap||this.scaleSnap),-1!==t.search("Z")&&(i.scale.z=Math.round(i.scale.z/this.scaleSnap)*this.scaleSnap||this.scaleSnap))}else if("rotate"===n){this._offset.copy(this.pointEnd).sub(this.pointStart);var s=20/this.worldPosition.distanceTo(Dt.setFromMatrixPosition(this.camera.matrixWorld));"E"===t?(this.rotationAxis.copy(this.eye),this.rotationAngle=this.pointEnd.angleTo(this.pointStart),this._startNorm.copy(this.pointStart).normalize(),this._endNorm.copy(this.pointEnd).normalize(),this.rotationAngle*=this._endNorm.cross(this._startNorm).dot(this.eye)<0?1:-1):"XYZE"===t?(this.rotationAxis.copy(this._offset).cross(this.eye).normalize(),this.rotationAngle=this._offset.dot(Dt.copy(this.rotationAxis).cross(this.eye))*s):"X"!==t&&"Y"!==t&&"Z"!==t||(this.rotationAxis.copy(Lt[t]),Dt.copy(Lt[t]),"local"===r&&Dt.applyQuaternion(this.worldQuaternion),this.rotationAngle=this._offset.dot(Dt.cross(this.eye).normalize())*s),this.rotationSnap&&(this.rotationAngle=Math.round(this.rotationAngle/this.rotationSnap)*this.rotationSnap),"local"===r&&"E"!==t&&"XYZE"!==t?(i.quaternion.copy(this._quaternionStart),i.quaternion.multiply(Pt.setFromAxisAngle(this.rotationAxis,this.rotationAngle)).normalize()):(this.rotationAxis.applyQuaternion(this._parentQuaternionInv),i.quaternion.copy(Pt.setFromAxisAngle(this.rotationAxis,this.rotationAngle)),i.quaternion.multiply(this._quaternionStart).normalize())}this.dispatchEvent(Qt),this.dispatchEvent(Ft)}}}},{key:"pointerUp",value:function(e){0===e.button&&(this.dragging&&null!==this.axis&&(Nt.mode=this.mode,this.dispatchEvent(Nt)),this.dragging=!1,this.axis=null)}},{key:"dispose",value:function(){this.domElement.removeEventListener("pointerdown",this._onPointerDown),this.domElement.removeEventListener("pointermove",this._onPointerHover),this.domElement.removeEventListener("pointermove",this._onPointerMove),this.domElement.removeEventListener("pointerup",this._onPointerUp),this.traverse((function(e){e.geometry&&e.geometry.dispose(),e.material&&e.material.dispose()}))}},{key:"attach",value:function(e){return this.object=e,this.visible=!0,this}},{key:"detach",value:function(){return this.object=void 0,this.visible=!1,this.axis=null,this}},{key:"reset",value:function(){this.enabled&&this.dragging&&(this.object.position.copy(this._positionStart),this.object.quaternion.copy(this._quaternionStart),this.object.scale.copy(this._scaleStart),this.dispatchEvent(Qt),this.dispatchEvent(Ft),this.pointStart.copy(this.pointEnd))}},{key:"getRaycaster",value:function(){return Tt}},{key:"getMode",value:function(){return this.mode}},{key:"setMode",value:function(e){this.mode=e}},{key:"setTranslationSnap",value:function(e){this.translationSnap=e}},{key:"setRotationSnap",value:function(e){this.rotationSnap=e}},{key:"setScaleSnap",value:function(e){this.scaleSnap=e}},{key:"setSize",value:function(e){this.size=e}},{key:"setSpace",value:function(e){this.space=e}}]),n}(K.Tme);function jt(e){if(this.domElement.ownerDocument.pointerLockElement)return{x:0,y:0,button:e.button};var t=this.domElement.getBoundingClientRect();return{x:(e.clientX-t.left)/t.width*2-1,y:-(e.clientY-t.top)/t.height*2+1,button:e.button}}function Ot(e){if(this.enabled)switch(e.pointerType){case"mouse":case"pen":this.pointerHover(this._getPointer(e))}}function zt(e){this.enabled&&(document.pointerLockElement||this.domElement.setPointerCapture(e.pointerId),this.domElement.addEventListener("pointermove",this._onPointerMove),this.pointerHover(this._getPointer(e)),this.pointerDown(this._getPointer(e)))}function Gt(e){this.enabled&&this.pointerMove(this._getPointer(e))}function Ht(e){this.enabled&&(this.domElement.releasePointerCapture(e.pointerId),this.domElement.removeEventListener("pointermove",this._onPointerMove),this.pointerUp(this._getPointer(e)))}function Vt(e,t,n){for(var i=t.intersectObject(e,!0),r=0;r<i.length;r++)if(i[r].object.visible||n)return i[r];return!1}var Wt=new K.USm,qt=new K.Pa4(0,1,0),Yt=new K.Pa4(0,0,0),Jt=new K.yGw,Xt=new K._fP,Kt=new K._fP,$t=new K.Pa4,en=new K.yGw,tn=new K.Pa4(1,0,0),nn=new K.Pa4(0,1,0),rn=new K.Pa4(0,0,1),an=new K.Pa4,on=new K.Pa4,sn=new K.Pa4,ln=function(e){(0,a.Z)(n,e);var t=(0,o.Z)(n);function n(){var e;(0,i.Z)(this,n),(e=t.call(this)).isTransformControlsGizmo=!0,e.type="TransformControlsGizmo";var r=new K.vBJ({depthTest:!1,depthWrite:!1,fog:!1,toneMapped:!1,transparent:!0}),a=new K.nls({depthTest:!1,depthWrite:!1,fog:!1,toneMapped:!1,transparent:!0}),o=r.clone();o.opacity=.15;var s=a.clone();s.opacity=.5;var l=r.clone();l.color.setHex(16711680);var u=r.clone();u.color.setHex(65280);var c=r.clone();c.color.setHex(255);var h=r.clone();h.color.setHex(16711680),h.opacity=.5;var d=r.clone();d.color.setHex(65280),d.opacity=.5;var f=r.clone();f.color.setHex(255),f.opacity=.5;var p=r.clone();p.opacity=.25;var A=r.clone();A.color.setHex(16776960),A.opacity=.25,r.clone().color.setHex(16776960);var v=r.clone();v.color.setHex(7895160);var g=new K.fHI(0,.04,.1,12);g.translate(0,.05,0);var m=new K.DvJ(.08,.08,.08);m.translate(0,.04,0);var y=new K.u9r;y.setAttribute("position",new K.a$l([0,0,0,1,0,0],3));var x=new K.fHI(.0075,.0075,.5,3);function w(e,t){var n=new K.XvJ(e,.0075,3,64,t*Math.PI*2);return n.rotateY(Math.PI/2),n.rotateX(Math.PI/2),n}x.translate(0,.25,0);var C={X:[[new K.Kj0(g,l),[.5,0,0],[0,0,-Math.PI/2]],[new K.Kj0(g,l),[-.5,0,0],[0,0,Math.PI/2]],[new K.Kj0(x,l),[0,0,0],[0,0,-Math.PI/2]]],Y:[[new K.Kj0(g,u),[0,.5,0]],[new K.Kj0(g,u),[0,-.5,0],[Math.PI,0,0]],[new K.Kj0(x,u)]],Z:[[new K.Kj0(g,c),[0,0,.5],[Math.PI/2,0,0]],[new K.Kj0(g,c),[0,0,-.5],[-Math.PI/2,0,0]],[new K.Kj0(x,c),null,[Math.PI/2,0,0]]],XYZ:[[new K.Kj0(new K.pQR(.1,0),p.clone()),[0,0,0]]],XY:[[new K.Kj0(new K.DvJ(.15,.15,.01),f.clone()),[.15,.15,0]]],YZ:[[new K.Kj0(new K.DvJ(.15,.15,.01),h.clone()),[0,.15,.15],[0,Math.PI/2,0]]],XZ:[[new K.Kj0(new K.DvJ(.15,.15,.01),d.clone()),[.15,0,.15],[-Math.PI/2,0,0]]]},b={X:[[new K.Kj0(new K.fHI(.2,0,.6,4),o),[.3,0,0],[0,0,-Math.PI/2]],[new K.Kj0(new K.fHI(.2,0,.6,4),o),[-.3,0,0],[0,0,Math.PI/2]]],Y:[[new K.Kj0(new K.fHI(.2,0,.6,4),o),[0,.3,0]],[new K.Kj0(new K.fHI(.2,0,.6,4),o),[0,-.3,0],[0,0,Math.PI]]],Z:[[new K.Kj0(new K.fHI(.2,0,.6,4),o),[0,0,.3],[Math.PI/2,0,0]],[new K.Kj0(new K.fHI(.2,0,.6,4),o),[0,0,-.3],[-Math.PI/2,0,0]]],XYZ:[[new K.Kj0(new K.pQR(.2,0),o)]],XY:[[new K.Kj0(new K.DvJ(.2,.2,.01),o),[.15,.15,0]]],YZ:[[new K.Kj0(new K.DvJ(.2,.2,.01),o),[0,.15,.15],[0,Math.PI/2,0]]],XZ:[[new K.Kj0(new K.DvJ(.2,.2,.01),o),[.15,0,.15],[-Math.PI/2,0,0]]]},_={START:[[new K.Kj0(new K.pQR(.01,2),s),null,null,null,"helper"]],END:[[new K.Kj0(new K.pQR(.01,2),s),null,null,null,"helper"]],DELTA:[[new K.x12(function(){var e=new K.u9r;return e.setAttribute("position",new K.a$l([0,0,0,1,1,1],3)),e}(),s),null,null,null,"helper"]],X:[[new K.x12(y,s.clone()),[-1e3,0,0],null,[1e6,1,1],"helper"]],Y:[[new K.x12(y,s.clone()),[0,-1e3,0],[0,0,Math.PI/2],[1e6,1,1],"helper"]],Z:[[new K.x12(y,s.clone()),[0,0,-1e3],[0,-Math.PI/2,0],[1e6,1,1],"helper"]]},E={XYZE:[[new K.Kj0(w(.5,1),v),null,[0,Math.PI/2,0]]],X:[[new K.Kj0(w(.5,.5),l)]],Y:[[new K.Kj0(w(.5,.5),u),null,[0,0,-Math.PI/2]]],Z:[[new K.Kj0(w(.5,.5),c),null,[0,Math.PI/2,0]]],E:[[new K.Kj0(w(.75,1),A),null,[0,Math.PI/2,0]]]},M={AXIS:[[new K.x12(y,s.clone()),[-1e3,0,0],null,[1e6,1,1],"helper"]]},I={XYZE:[[new K.Kj0(new K.xo$(.25,10,8),o)]],X:[[new K.Kj0(new K.XvJ(.5,.1,4,24),o),[0,0,0],[0,-Math.PI/2,-Math.PI/2]]],Y:[[new K.Kj0(new K.XvJ(.5,.1,4,24),o),[0,0,0],[Math.PI/2,0,0]]],Z:[[new K.Kj0(new K.XvJ(.5,.1,4,24),o),[0,0,0],[0,0,-Math.PI/2]]],E:[[new K.Kj0(new K.XvJ(.75,.1,2,24),o)]]},S={X:[[new K.Kj0(m,l),[.5,0,0],[0,0,-Math.PI/2]],[new K.Kj0(x,l),[0,0,0],[0,0,-Math.PI/2]],[new K.Kj0(m,l),[-.5,0,0],[0,0,Math.PI/2]]],Y:[[new K.Kj0(m,u),[0,.5,0]],[new K.Kj0(x,u)],[new K.Kj0(m,u),[0,-.5,0],[0,0,Math.PI]]],Z:[[new K.Kj0(m,c),[0,0,.5],[Math.PI/2,0,0]],[new K.Kj0(x,c),[0,0,0],[Math.PI/2,0,0]],[new K.Kj0(m,c),[0,0,-.5],[-Math.PI/2,0,0]]],XY:[[new K.Kj0(new K.DvJ(.15,.15,.01),f),[.15,.15,0]]],YZ:[[new K.Kj0(new K.DvJ(.15,.15,.01),h),[0,.15,.15],[0,Math.PI/2,0]]],XZ:[[new K.Kj0(new K.DvJ(.15,.15,.01),d),[.15,0,.15],[-Math.PI/2,0,0]]],XYZ:[[new K.Kj0(new K.DvJ(.1,.1,.1),p.clone())]]},k={X:[[new K.Kj0(new K.fHI(.2,0,.6,4),o),[.3,0,0],[0,0,-Math.PI/2]],[new K.Kj0(new K.fHI(.2,0,.6,4),o),[-.3,0,0],[0,0,Math.PI/2]]],Y:[[new K.Kj0(new K.fHI(.2,0,.6,4),o),[0,.3,0]],[new K.Kj0(new K.fHI(.2,0,.6,4),o),[0,-.3,0],[0,0,Math.PI]]],Z:[[new K.Kj0(new K.fHI(.2,0,.6,4),o),[0,0,.3],[Math.PI/2,0,0]],[new K.Kj0(new K.fHI(.2,0,.6,4),o),[0,0,-.3],[-Math.PI/2,0,0]]],XY:[[new K.Kj0(new K.DvJ(.2,.2,.01),o),[.15,.15,0]]],YZ:[[new K.Kj0(new K.DvJ(.2,.2,.01),o),[0,.15,.15],[0,Math.PI/2,0]]],XZ:[[new K.Kj0(new K.DvJ(.2,.2,.01),o),[.15,0,.15],[-Math.PI/2,0,0]]],XYZ:[[new K.Kj0(new K.DvJ(.2,.2,.2),o),[0,0,0]]]},B={X:[[new K.x12(y,s.clone()),[-1e3,0,0],null,[1e6,1,1],"helper"]],Y:[[new K.x12(y,s.clone()),[0,-1e3,0],[0,0,Math.PI/2],[1e6,1,1],"helper"]],Z:[[new K.x12(y,s.clone()),[0,0,-1e3],[0,-Math.PI/2,0],[1e6,1,1],"helper"]]};function T(e){var t=new K.Tme;for(var n in e)for(var i=e[n].length;i--;){var r=e[n][i][0].clone(),a=e[n][i][1],o=e[n][i][2],s=e[n][i][3],l=e[n][i][4];r.name=n,r.tag=l,a&&r.position.set(a[0],a[1],a[2]),o&&r.rotation.set(o[0],o[1],o[2]),s&&r.scale.set(s[0],s[1],s[2]),r.updateMatrix();var u=r.geometry.clone();u.applyMatrix4(r.matrix),r.geometry=u,r.renderOrder=1/0,r.position.set(0,0,0),r.rotation.set(0,0,0),r.scale.set(1,1,1),t.add(r)}return t}return e.gizmo={},e.picker={},e.helper={},e.add(e.gizmo.translate=T(C)),e.add(e.gizmo.rotate=T(E)),e.add(e.gizmo.scale=T(S)),e.add(e.picker.translate=T(b)),e.add(e.picker.rotate=T(I)),e.add(e.picker.scale=T(k)),e.add(e.helper.translate=T(_)),e.add(e.helper.rotate=T(M)),e.add(e.helper.scale=T(B)),e.picker.translate.visible=!1,e.picker.rotate.visible=!1,e.picker.scale.visible=!1,e}return(0,r.Z)(n,[{key:"updateMatrixWorld",value:function(e){var t=this,i="local"===("scale"===this.mode?"local":this.space)?this.worldQuaternion:Kt;this.gizmo.translate.visible="translate"===this.mode,this.gizmo.rotate.visible="rotate"===this.mode,this.gizmo.scale.visible="scale"===this.mode,this.helper.translate.visible="translate"===this.mode,this.helper.rotate.visible="rotate"===this.mode,this.helper.scale.visible="scale"===this.mode;var r=[];r=(r=(r=r.concat(this.picker[this.mode].children)).concat(this.gizmo[this.mode].children)).concat(this.helper[this.mode].children);for(var a=function(){var e,n=r[o];if(n.visible=!0,n.rotation.set(0,0,0),n.position.copy(t.worldPosition),e=t.camera.isOrthographicCamera?(t.camera.top-t.camera.bottom)/t.camera.zoom:t.worldPosition.distanceTo(t.cameraPosition)*Math.min(1.9*Math.tan(Math.PI*t.camera.fov/360)/t.camera.zoom,7),n.scale.set(1,1,1).multiplyScalar(e*t.size/4),"helper"===n.tag)return n.visible=!1,"AXIS"===n.name?(n.visible=!!t.axis,"X"===t.axis&&(Pt.setFromEuler(Wt.set(0,0,0)),n.quaternion.copy(i).multiply(Pt),Math.abs(qt.copy(tn).applyQuaternion(i).dot(t.eye))>.9&&(n.visible=!1)),"Y"===t.axis&&(Pt.setFromEuler(Wt.set(0,0,Math.PI/2)),n.quaternion.copy(i).multiply(Pt),Math.abs(qt.copy(nn).applyQuaternion(i).dot(t.eye))>.9&&(n.visible=!1)),"Z"===t.axis&&(Pt.setFromEuler(Wt.set(0,Math.PI/2,0)),n.quaternion.copy(i).multiply(Pt),Math.abs(qt.copy(rn).applyQuaternion(i).dot(t.eye))>.9&&(n.visible=!1)),"XYZE"===t.axis&&(Pt.setFromEuler(Wt.set(0,Math.PI/2,0)),qt.copy(t.rotationAxis),n.quaternion.setFromRotationMatrix(Jt.lookAt(Yt,qt,nn)),n.quaternion.multiply(Pt),n.visible=t.dragging),"E"===t.axis&&(n.visible=!1)):"START"===n.name?(n.position.copy(t.worldPositionStart),n.visible=t.dragging):"END"===n.name?(n.position.copy(t.worldPosition),n.visible=t.dragging):"DELTA"===n.name?(n.position.copy(t.worldPositionStart),n.quaternion.copy(t.worldQuaternionStart),Dt.set(1e-10,1e-10,1e-10).add(t.worldPositionStart).sub(t.worldPosition).multiplyScalar(-1),Dt.applyQuaternion(t.worldQuaternionStart.clone().invert()),n.scale.copy(Dt),n.visible=t.dragging):(n.quaternion.copy(i),t.dragging?n.position.copy(t.worldPositionStart):n.position.copy(t.worldPosition),t.axis&&(n.visible=-1!==t.axis.search(n.name))),"continue";if(n.quaternion.copy(i),"translate"===t.mode||"scale"===t.mode){var a=.99;"X"===n.name&&Math.abs(qt.copy(tn).applyQuaternion(i).dot(t.eye))>a&&(n.scale.set(1e-10,1e-10,1e-10),n.visible=!1),"Y"===n.name&&Math.abs(qt.copy(nn).applyQuaternion(i).dot(t.eye))>a&&(n.scale.set(1e-10,1e-10,1e-10),n.visible=!1),"Z"===n.name&&Math.abs(qt.copy(rn).applyQuaternion(i).dot(t.eye))>a&&(n.scale.set(1e-10,1e-10,1e-10),n.visible=!1),"XY"===n.name&&Math.abs(qt.copy(rn).applyQuaternion(i).dot(t.eye))<.2&&(n.scale.set(1e-10,1e-10,1e-10),n.visible=!1),"YZ"===n.name&&Math.abs(qt.copy(tn).applyQuaternion(i).dot(t.eye))<.2&&(n.scale.set(1e-10,1e-10,1e-10),n.visible=!1),"XZ"===n.name&&Math.abs(qt.copy(nn).applyQuaternion(i).dot(t.eye))<.2&&(n.scale.set(1e-10,1e-10,1e-10),n.visible=!1)}else"rotate"===t.mode&&(Xt.copy(i),qt.copy(t.eye).applyQuaternion(Pt.copy(i).invert()),-1!==n.name.search("E")&&n.quaternion.setFromRotationMatrix(Jt.lookAt(t.eye,Yt,nn)),"X"===n.name&&(Pt.setFromAxisAngle(tn,Math.atan2(-qt.y,qt.z)),Pt.multiplyQuaternions(Xt,Pt),n.quaternion.copy(Pt)),"Y"===n.name&&(Pt.setFromAxisAngle(nn,Math.atan2(qt.x,qt.z)),Pt.multiplyQuaternions(Xt,Pt),n.quaternion.copy(Pt)),"Z"===n.name&&(Pt.setFromAxisAngle(rn,Math.atan2(qt.y,qt.x)),Pt.multiplyQuaternions(Xt,Pt),n.quaternion.copy(Pt)));n.visible=n.visible&&(-1===n.name.indexOf("X")||t.showX),n.visible=n.visible&&(-1===n.name.indexOf("Y")||t.showY),n.visible=n.visible&&(-1===n.name.indexOf("Z")||t.showZ),n.visible=n.visible&&(-1===n.name.indexOf("E")||t.showX&&t.showY&&t.showZ),n.material._color=n.material._color||n.material.color.clone(),n.material._opacity=n.material._opacity||n.material.opacity,n.material.color.copy(n.material._color),n.material.opacity=n.material._opacity,t.enabled&&t.axis&&(n.name===t.axis||t.axis.split("").some((function(e){return n.name===e})))&&(n.material.color.setHex(16776960),n.material.opacity=1)},o=0;o<r.length;o++)a();(0,st.Z)((0,lt.Z)(n.prototype),"updateMatrixWorld",this).call(this,e)}}]),n}(K.Tme),un=function(e){(0,a.Z)(n,e);var t=(0,o.Z)(n);function n(){var e;return(0,i.Z)(this,n),(e=t.call(this,new K._12(1e5,1e5,2,2),new K.vBJ({visible:!1,wireframe:!0,side:K.ehD,transparent:!0,opacity:.1,toneMapped:!1}))).isTransformControlsPlane=!0,e.type="TransformControlsPlane",e}return(0,r.Z)(n,[{key:"updateMatrixWorld",value:function(e){var t=this.space;switch(this.position.copy(this.worldPosition),"scale"===this.mode&&(t="local"),an.copy(tn).applyQuaternion("local"===t?this.worldQuaternion:Kt),on.copy(nn).applyQuaternion("local"===t?this.worldQuaternion:Kt),sn.copy(rn).applyQuaternion("local"===t?this.worldQuaternion:Kt),qt.copy(on),this.mode){case"translate":case"scale":switch(this.axis){case"X":qt.copy(this.eye).cross(an),$t.copy(an).cross(qt);break;case"Y":qt.copy(this.eye).cross(on),$t.copy(on).cross(qt);break;case"Z":qt.copy(this.eye).cross(sn),$t.copy(sn).cross(qt);break;case"XY":$t.copy(sn);break;case"YZ":$t.copy(an);break;case"XZ":qt.copy(sn),$t.copy(on);break;case"XYZ":case"E":$t.set(0,0,0)}break;default:$t.set(0,0,0)}0===$t.length()?this.quaternion.copy(this.cameraQuaternion):(en.lookAt(Dt.set(0,0,0),$t,qt),this.quaternion.setFromRotationMatrix(en)),(0,st.Z)((0,lt.Z)(n.prototype),"updateMatrixWorld",this).call(this,e)}}]),n}(K.Kj0),cn=function(e){(0,a.Z)(n,e);var t=(0,o.Z)(n);function n(e,r,a){var o;return(0,i.Z)(this,n),(o=t.call(this)).object=e,o.pos=r.clone(),o.initialPos=a.clone(),o}return(0,r.Z)(n,[{key:"name",get:function(){return"Set Position"}},{key:"execute",value:function(){Vn.setObjectPosition(this.object,this.pos)}},{key:"undo",value:function(){Vn.setObjectPosition(this.object,this.initialPos)}},{key:"redo",value:function(){this.execute()}}]),n}(Ze),hn=function(e){(0,a.Z)(n,e);var t=(0,o.Z)(n);function n(e,r,a){var o;return(0,i.Z)(this,n),(o=t.call(this)).object=e,o.rot=r,o.initialRot=a,o}return(0,r.Z)(n,[{key:"name",get:function(){return"Set Rotation"}},{key:"execute",value:function(){Vn.setObjectRotation(this.object,this.rot)}},{key:"undo",value:function(){Vn.setObjectRotation(this.object,this.initialRot)}},{key:"redo",value:function(){this.execute()}}]),n}(Ze),dn=function(e){(0,a.Z)(n,e);var t=(0,o.Z)(n);function n(e,r,a){var o;return(0,i.Z)(this,n),(o=t.call(this)).object=e,o.scale=r,o.initialScale=a,o}return(0,r.Z)(n,[{key:"name",get:function(){return"Set Scale"}},{key:"execute",value:function(){Vn.setObjectScale(this.object,this.scale)}},{key:"undo",value:function(){Vn.setObjectScale(this.object,this.initialScale)}},{key:"redo",value:function(){this.execute()}}]),n}(Ze),fn=function(){function e(t,n){var r=this;(0,i.Z)(this,e),this._transformControls=new Ut(t,n),this._transformControls.addEventListener("dragging-changed",(function(e){r.onDragChanged&&r.onDragChanged(e)})),this._transformControls.addEventListener("mouseDown",(function(){var e=r._transformControls.object;e&&(r.initialObjectPos=e.position.clone(),r.initialObjectRot=e.rotation.clone(),r.initialObjectScale=e.scale.clone())})),this._transformControls.addEventListener("mouseUp",(function(){var e=r._transformControls.object;if(e)switch(r._transformControls.getMode()){case"translate":if(!r.initialObjectPos.equals(e.position)){var t=new cn(e,e.position.clone(),r.initialObjectPos.clone());Q.execute(t)}break;case"rotate":if(!r.initialObjectRot.equals(e.rotation)){var n=new hn(e,e.rotation,r.initialObjectRot);Q.execute(n)}break;case"scale":if(!r.initialObjectScale.equals(e.scale)){var i=new dn(e,e.scale,r.initialObjectScale);Q.execute(i)}}}))}return(0,r.Z)(e,[{key:"controls",get:function(){return this._transformControls}},{key:"camera",set:function(e){this._transformControls.camera=e}},{key:"object",get:function(){return this._transformControls.object}}]),e}(),pn=function(e){(0,a.Z)(n,e);var t=(0,o.Z)(n);function n(e,r){var a;return(0,i.Z)(this,n),(a=t.call(this)).object=e,a.intersect=r,a}return(0,r.Z)(n,[{key:"name",get:function(){return"Select Object"}},{key:"execute",value:function(){Vn.selectObject(this.object,this.intersect)}},{key:"undo",value:function(){Vn.deselectAll()}},{key:"redo",value:function(){Vn.selectObject(this.object)}}]),n}(Ze),An=function(e){(0,a.Z)(n,e);var t=(0,o.Z)(n);function n(e){var r;return(0,i.Z)(this,n),(r=t.call(this)).object=e,r}return(0,r.Z)(n,[{key:"name",get:function(){return"Deselect Object"}},{key:"execute",value:function(){Vn.deselectAll()}},{key:"undo",value:function(){Vn.selectObject(this.object)}},{key:"redo",value:function(){this.execute()}}]),n}(Ze),vn=function(){function e(t,n){var r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:1,a=arguments.length>3&&void 0!==arguments[3]?arguments[3]:.5,o=arguments.length>4&&void 0!==arguments[4]?arguments[4]:0;if((0,i.Z)(this,e),!t||!(t instanceof St))throw"renderer argument invalid";if(!n||!(n instanceof K.Tme))throw"model argument invalid";this._boundingGeometry=new Ue(n);var s=.2*this._boundingGeometry.size.x*2,l=.2*this._boundingGeometry.size.z*2;this._renderTarget=new K.dd2(512,512,{format:K.wk1});var u=new K.vBJ;u.map=this._renderTarget.texture,u.depthWrite=!1,u.transparent=!0,u.opacity=1-r,u.needsUpdate=!0,this._mesh=new K.Kj0(new K._12(this._boundingGeometry.size.x+s,this._boundingGeometry.size.z+l,1,1),u),this._mesh.rotation.x=-.5*Math.PI,this._mesh.renderOrder=1e6,this._mesh.name="_BAKED_SHADOW_MESH",this._render(t,n,r,a,o)}return(0,r.Z)(e,[{key:"_render",value:function(e,t){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:1,i=arguments.length>3&&void 0!==arguments[3]?arguments[3]:.5,r=arguments.length>4&&void 0!==arguments[4]?arguments[4]:0;this._mesh.material.opacity=1-n,this._mesh.material.needsUpdate=!0,yt.renderShadow(e,this._renderTarget,this._mesh,t,i,r)}},{key:"dispose",value:function(){this._mesh.material.dispose(),this._mesh.geometry.dispose(),this._renderTarget.dispose()}},{key:"mesh",get:function(){return this._mesh}},{key:"renderTarget",get:function(){return this._renderTarget}}]),e}(),gn={uniforms:{tDiffuse:{value:null},h:{value:1/512}},vertexShader:"\n\n\t\tvarying vec2 vUv;\n\n\t\tvoid main() {\n\n\t\t\tvUv = uv;\n\t\t\tgl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );\n\n\t\t}",fragmentShader:"\n\n\t\tuniform sampler2D tDiffuse;\n\t\tuniform float h;\n\n\t\tvarying vec2 vUv;\n\n\t\tvoid main() {\n\n\t\t\tvec4 sum = vec4( 0.0 );\n\n\t\t\tsum += texture2D( tDiffuse, vec2( vUv.x - 4.0 * h, vUv.y ) ) * 0.051;\n\t\t\tsum += texture2D( tDiffuse, vec2( vUv.x - 3.0 * h, vUv.y ) ) * 0.0918;\n\t\t\tsum += texture2D( tDiffuse, vec2( vUv.x - 2.0 * h, vUv.y ) ) * 0.12245;\n\t\t\tsum += texture2D( tDiffuse, vec2( vUv.x - 1.0 * h, vUv.y ) ) * 0.1531;\n\t\t\tsum += texture2D( tDiffuse, vec2( vUv.x, vUv.y ) ) * 0.1633;\n\t\t\tsum += texture2D( tDiffuse, vec2( vUv.x + 1.0 * h, vUv.y ) ) * 0.1531;\n\t\t\tsum += texture2D( tDiffuse, vec2( vUv.x + 2.0 * h, vUv.y ) ) * 0.12245;\n\t\t\tsum += texture2D( tDiffuse, vec2( vUv.x + 3.0 * h, vUv.y ) ) * 0.0918;\n\t\t\tsum += texture2D( tDiffuse, vec2( vUv.x + 4.0 * h, vUv.y ) ) * 0.051;\n\n\t\t\tgl_FragColor = sum;\n\n\t\t}"},mn={uniforms:{tDiffuse:{value:null},v:{value:1/512}},vertexShader:"\n\n\t\tvarying vec2 vUv;\n\n\t\tvoid main() {\n\n\t\t\tvUv = uv;\n\t\t\tgl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );\n\n\t\t}",fragmentShader:"\n\n\t\tuniform sampler2D tDiffuse;\n\t\tuniform float v;\n\n\t\tvarying vec2 vUv;\n\n\t\tvoid main() {\n\n\t\t\tvec4 sum = vec4( 0.0 );\n\n\t\t\tsum += texture2D( tDiffuse, vec2( vUv.x, vUv.y - 4.0 * v ) ) * 0.051;\n\t\t\tsum += texture2D( tDiffuse, vec2( vUv.x, vUv.y - 3.0 * v ) ) * 0.0918;\n\t\t\tsum += texture2D( tDiffuse, vec2( vUv.x, vUv.y - 2.0 * v ) ) * 0.12245;\n\t\t\tsum += texture2D( tDiffuse, vec2( vUv.x, vUv.y - 1.0 * v ) ) * 0.1531;\n\t\t\tsum += texture2D( tDiffuse, vec2( vUv.x, vUv.y ) ) * 0.1633;\n\t\t\tsum += texture2D( tDiffuse, vec2( vUv.x, vUv.y + 1.0 * v ) ) * 0.1531;\n\t\t\tsum += texture2D( tDiffuse, vec2( vUv.x, vUv.y + 2.0 * v ) ) * 0.12245;\n\t\t\tsum += texture2D( tDiffuse, vec2( vUv.x, vUv.y + 3.0 * v ) ) * 0.0918;\n\t\t\tsum += texture2D( tDiffuse, vec2( vUv.x, vUv.y + 4.0 * v ) ) * 0.051;\n\n\t\t\tgl_FragColor = sum;\n\n\t\t}"},yn=function(e){(0,a.Z)(n,e);var t=(0,o.Z)(n);function n(e,r,a,o){var s,l=arguments.length>4&&void 0!==arguments[4]?arguments[4]:{};if((0,i.Z)(this,n),!e||!(e instanceof K.u9r))throw new Fe.R("geometry");if(!r||!(r instanceof K.CP7))throw new Fe.R("renderer");if(!a||!(a instanceof K.xsS))throw new Fe.R("scene");if(!o||!(o instanceof K.V1s))throw new Fe.R("camera");(s=t.call(this,e)).type="Reflector";var u=void 0!==(l=l||{}).color?new K.Ilk(l.color):new K.Ilk(8355711),c=l.textureWidth||512,h=l.textureHeight||512;s.clipBias=l.clipBias||0;var d=l.shader||n.ReflectorShader;s.camera=o,s.reflectorPlane=new K.JOQ,s.normal=new K.Pa4,s.reflectorWorldPosition=new K.Pa4,s.cameraWorldPosition=new K.Pa4,s.rotationMatrix=new K.yGw,s.lookAtPosition=new K.Pa4(0,0,-1),s.clipPlane=new K.Ltg,s.viewport=new K.Ltg,s.view=new K.Pa4,s.target=new K.Pa4,s.q=new K.Ltg,s.textureMatrix=new K.yGw,s.virtualCamera=new K.cPb;var f={minFilter:K.wem,magFilter:K.wem,format:K.wk1,stencilBuffer:!1};s.renderTarget=s.createRenderTarget(c,h,f,!0),s.composer=new Ye(r),s.composer.renderToScreen=!1,s.composer.addPass(new Je(a,s.virtualCamera)),s.verticalBlurPass=new Ve(mn),s.horizontalBlurPass=new Ve(gn),s.composer.addPass(s.verticalBlurPass),s.composer.addPass(s.horizontalBlurPass),s.renderTarget1=s.createRenderTarget(c,h,f),s.composer.addPass(new At(s.renderTarget1));var p=new K.jyz({uniforms:K.rDY.clone(d.uniforms),fragmentShader:d.fragmentShader,vertexShader:d.vertexShader,transparent:!0,depthWrite:!1});return p.uniforms.tDiffuse.value=s.renderTarget1.texture,p.uniforms.tDepth.value=s.renderTarget.depthTexture,p.uniforms.color.value=u,p.uniforms.textureMatrix.value=s.textureMatrix,s.material=p,s}return(0,r.Z)(n,[{key:"createRenderTarget",value:function(e,t,n){var i=arguments.length>3&&void 0!==arguments[3]&&arguments[3],r=new K.dd2(e,t,n);return K.M8C.isPowerOfTwo(e)&&K.M8C.isPowerOfTwo(t)||(r.texture.generateMipmaps=!1),i&&(r.depthBuffer=!0,r.depthTexture=new K.$YQ,r.depthTexture.type=K.LsT),r}},{key:"onBeforeRender",value:function(e,t,n){if(this.reflectorWorldPosition.setFromMatrixPosition(this.matrixWorld),this.cameraWorldPosition.setFromMatrixPosition(n.matrixWorld),this.rotationMatrix.extractRotation(this.matrixWorld),this.normal.set(0,0,1),this.normal.applyMatrix4(this.rotationMatrix),this.view.subVectors(this.reflectorWorldPosition,this.cameraWorldPosition),!(this.view.dot(this.normal)>0)){this.view.reflect(this.normal).negate(),this.view.add(this.reflectorWorldPosition),this.rotationMatrix.extractRotation(n.matrixWorld),this.lookAtPosition.set(0,0,-1),this.lookAtPosition.applyMatrix4(this.rotationMatrix),this.lookAtPosition.add(this.cameraWorldPosition),this.target.subVectors(this.reflectorWorldPosition,this.lookAtPosition),this.target.reflect(this.normal).negate(),this.target.add(this.reflectorWorldPosition),this.virtualCamera.position.copy(this.view),this.virtualCamera.up.set(0,1,0),this.virtualCamera.up.applyMatrix4(this.rotationMatrix),this.virtualCamera.up.reflect(this.normal),this.virtualCamera.lookAt(this.target),this.virtualCamera.far=n.far,this.virtualCamera.updateMatrixWorld(),this.virtualCamera.projectionMatrix.copy(n.projectionMatrix),this.material.uniforms.cameraNear.value=n.near,this.material.uniforms.cameraFar.value=n.far,this.material.uniformsNeedUpdate=!0,this.textureMatrix.set(.5,0,0,.5,0,.5,0,.5,0,0,.5,.5,0,0,0,1),this.textureMatrix.multiply(this.virtualCamera.projectionMatrix),this.textureMatrix.multiply(this.virtualCamera.matrixWorldInverse),this.textureMatrix.multiply(this.matrixWorld),this.reflectorPlane.setFromNormalAndCoplanarPoint(this.normal,this.reflectorWorldPosition),this.reflectorPlane.applyMatrix4(this.virtualCamera.matrixWorldInverse),this.clipPlane.set(this.reflectorPlane.normal.x,this.reflectorPlane.normal.y,this.reflectorPlane.normal.z,this.reflectorPlane.constant);var i=this.virtualCamera.projectionMatrix;this.q.x=(Math.sign(this.clipPlane.x)+i.elements[8])/i.elements[0],this.q.y=(Math.sign(this.clipPlane.y)+i.elements[9])/i.elements[5],this.q.z=-1,this.q.w=(1+i.elements[10])/i.elements[14],this.clipPlane.multiplyScalar(2/this.clipPlane.dot(this.q)),i.elements[2]=this.clipPlane.x,i.elements[6]=this.clipPlane.y,i.elements[10]=this.clipPlane.z+1-this.clipBias,i.elements[14]=this.clipPlane.w,t.traverse((function(e){e instanceof K.woe&&(e.visible=!1)})),this.visible=!1;var r=e.getRenderTarget(),a=e.xr.enabled,o=e.shadowMap.autoUpdate;e.xr.enabled=!1,e.shadowMap.autoUpdate=!1,e.setRenderTarget(this.renderTarget),e.state.buffers.depth.setMask(!0),!1===e.autoClear&&e.clear(),e.render(t,this.virtualCamera),this.blur?(this.material.uniforms.tDiffuse.value=this.renderTarget1.texture,this.composer.render(.01)):this.material.uniforms.tDiffuse.value=this.renderTarget.texture,e.xr.enabled=a,e.shadowMap.autoUpdate=o,e.setRenderTarget(r);var s=n.bounds;if(void 0!==s){var l=e.getSize(),u=e.getPixelRatio();this.viewport.x=s.x*l.width*u,this.viewport.y=s.y*l.height*u,this.viewport.z=s.z*l.width*u,this.viewport.w=s.w*l.height*u,e.state.this.viewport(this.viewport)}this.visible=!0,t.traverse((function(e){e instanceof K.woe&&(e.visible=!0)}))}}},{key:"getRenderTarget",value:function(){return this.renderTarget}},{key:"setFadeScale",value:function(e){this.material.uniforms.fadeScale.value=e*this.camera.far/this.camera.near}},{key:"setColor",value:function(e){this.material.uniforms.color.value=e}},{key:"setOpacity",value:function(e){this.material.uniforms.opacity.value=e}},{key:"enableBlur",value:function(e){this.blur=e}},{key:"dispose",value:function(){this.composer.renderTarget1.dispose(),this.composer.renderTarget2.dispose(),this.renderTarget.dispose(),this.renderTarget1.dispose()}}]),n}(K.Kj0);function xn(e,t,n,i,r,a){var o=new K._12(t,t),s=new yn(o,e.renderer.renderer,e.scene,e.camera,{clipBias:.03,textureWidth:1024,textureHeight:1024,color:4294967295,encoding:K.knz});return s.rotateX(-Math.PI/2),s.setFadeScale(null!==i&&void 0!==i?i:3),s.setOpacity(null!==r&&void 0!==r?r:1),s.setColor(n?new K.Ilk(n):new K.Ilk("#808080")),s.enableBlur(null!==a&&void 0!==a&&a),s}function wn(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"#000000",n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"#ffffff",i=arguments.length>3&&void 0!==arguments[3]?arguments[3]:"#ffffff",r=arguments.length>4?arguments[4]:void 0,a=document.createElement("canvas").getContext("2d");if(a.canvas.width=64,a.canvas.height=64,r)a.drawImage(r,0,0);else{var o=2*Math.PI;a.fillStyle=t,a.beginPath(),a.arc(32,32,32,0,o),a.fill(),a.strokeStyle=i,a.lineWidth=4,a.beginPath(),a.arc(32,32,30,0,o),a.stroke(),a.fillStyle=n,a.font="32px sans-serif",a.textAlign="center",a.textBaseline="middle",a.fillText(e+"",32,32)}var s=new K.ROQ(a.canvas);return s.minFilter=K.wem,s.wrapS=K.uWy,s.wrapT=K.uWy,s}yn.ReflectorShader={uniforms:{color:{type:"c",value:null},tDiffuse:{type:"t",value:null},tDepth:{type:"t",value:null},textureMatrix:{type:"m4",value:null},cameraNear:{type:"f",value:0},cameraFar:{type:"f",value:0},fadeScale:{type:"f",value:3},opacity:{type:"f",value:.5}},vertexShader:["uniform mat4 textureMatrix;","varying vec4 vUv;","void main() {","\tvUv = textureMatrix * vec4( position, 1.0 );","\tgl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );","}"].join("\n"),fragmentShader:["#include <packing>","uniform vec3 color;","uniform sampler2D tDiffuse;","uniform sampler2D tDepth;","uniform float cameraNear;","uniform float cameraFar;","uniform float fadeScale;","uniform float opacity;","varying vec4 vUv;","float readDepth( sampler2D depthSampler, vec4 coord ) {","\tfloat fragCoordZ = texture2DProj( depthSampler, coord ).x;","\tfloat viewZ = perspectiveDepthToViewZ( fragCoordZ, cameraNear, cameraFar );","\treturn viewZToOrthographicDepth( viewZ, cameraNear, cameraFar );","}","void main() {","\tvec4 base = texture2DProj( tDiffuse, vUv );"," \tfloat depth = readDepth( tDepth, vUv );","\tgl_FragColor = vec4(base.rgb * color.rgb, (1.0 - ( depth * fadeScale )) * opacity );","}"].join("\n")};var Cn=new K.Pa4,bn=new K.FM8,_n=new K.FM8,En=function(){function e(t){(0,i.Z)(this,e),this.domPool=[];for(var n=0;n<t;++n)this.domPool.push(document.createElement("div"));this.count=0}return(0,r.Z)(e,[{key:"allocate",value:function(){return this.count===this.domPool.length&&this.domPool.push(document.createElement("div")),this.domPool[this.count++]}},{key:"reset",value:function(){this.count=0}}]),e}(),Mn=function(){function e(t,n){(0,i.Z)(this,e),this.containerElem=t,this.rootElem=document.createElement("div"),this.settings=n,this.domElemPool=new En(16),t.appendChild(this.rootElem)}return(0,r.Z)(e,[{key:"createLabelsFromScene",value:function(){var e=this,t=[];for(this.domElemPool.reset();this.rootElem.firstChild;)this.rootElem.removeChild(this.rootElem.lastChild);return Vn.project.scene.traverse((function(n){if(n.isPoints){var i=e.domElemPool.allocate();i.style.position="absolute",i.style.visibility=n.userData.selected?"visible":"hidden",i.style.top="0",i.style.left="0",i.style.zIndex="1",i.style.marginLeft="0px",i.style.marginTop="0px",i.style.padding="1em",i.style.width="200px",i.style.color="#fff",i.style.background="rgba(0, 0, 0, 0.8)",i.style.borderRadius=".5em",i.style.fontSize="12px",i.style.lineHeight="1.2",i.style.transition="opacity .5s",i.style.overflowX="hidden",i.style.overflowWrap="break-word",i.style.whiteSpace="pre-wrap",i.textContent=n.userData.labelText,t.push({elem:i,object:n}),e.rootElem.appendChild(i)}})),t}},{key:"updateLabels",value:function(e){var t=this;this.createLabelsFromScene().forEach((function(n,i){if(n.object.getWorldPosition(Cn),Cn.project(e),Cn.z<1){var r=Math.round((.5+Cn.x/2)*t.containerElem.clientWidth),a=Math.round((.5-Cn.y/2)*t.containerElem.clientHeight);n.elem.style.left=r+t.settings.size/2+"px",n.elem.style.top=a+t.settings.size/2+"px"}else n.elem.style.left="-1000px"}))}},{key:"selectTest",value:function(e,t,n){var i=this,r=null,a=this.settings.size/2;return _n.set(e,t),Vn.project.scene.traverse((function(e){if(e.isPoints){if(e.userData.selected=!1,e.getWorldPosition(Cn),Cn.project(n),Cn.z>1)return null;bn.set(Math.round((.5+Cn.x/2)*i.containerElem.clientWidth),Math.round((.5-Cn.y/2)*i.containerElem.clientHeight)),bn.distanceTo(_n)<a&&(e.userData.selected=!0,r=e)}})),r}}]),e}(),In=function(){function e(t){if((0,i.Z)(this,e),!t)throw new Fe.R("cameraController");this.cameraController=t,this.camera=t.object,this.targetQuaternion=new K._fP,this.targetPosition=new K.Pa4,this.startPosition=new K.Pa4,this.lookAtPoint=new K.Pa4,this.startQuaternion=new K._fP}return(0,r.Z)(e,[{key:"start",value:function(e,t,n,i){this.rotSpeed=.75,this.transSpeed=.75,this.animating=!0,this.startQuaternion.copy(this.camera.quaternion),this.targetQuaternion.copy(t),this.targetPosition.copy(e),this.startPosition.copy(this.camera.position),this.positionAlpha=0,this.rotationAlpha=0,this.cameraState=n,this.onCompleted=i}},{key:"update",value:function(e){this.animating&&(this.rotationAlpha+=this.rotSpeed*e,this.rotationAlpha>=1&&(this.rotationAlpha=1),this.camera.quaternion.slerpQuaternions(this.startQuaternion,this.targetQuaternion,this.rotationAlpha),this.positionAlpha+=this.transSpeed*e,this.positionAlpha>=1&&(this.positionAlpha=1),this.camera.position.lerpVectors(this.startPosition,this.targetPosition,this.positionAlpha),1===this.rotationAlpha&&1===this.positionAlpha&&(this.animating=!1,this.cameraController.setState(this.cameraState),this.onCompleted&&this.onCompleted()))}}]),e}(),Sn=function(){function e(t,n){var r=this;if((0,i.Z)(this,e),!t||!(t instanceof K.Tme))throw new Fe.R("rootNode");if(!n)throw new Fe.R("clips");this._clips=n,this._mixer=new K.Xcj(t),this._mixer.addEventListener("finished",(function(e){r.onClipEndEventHandler&&r.onClipEndEventHandler(e.action),e.action.userData.finished=!0,e.action.userData.openState=e.action.userData.openState?0:1}))}return(0,r.Z)(e,[{key:"clips",get:function(){return this._clips}},{key:"mixer",get:function(){return this._mixer}},{key:"update",value:function(e){this._mixer&&this._mixer.update(e)}},{key:"playClip",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]&&arguments[1],n=arguments.length>2&&void 0!==arguments[2]&&arguments[2],i=arguments.length>3&&void 0!==arguments[3]?arguments[3]:0,r=this._mixer.clipAction(e);r.userData||(r.userData={}),r.isRunning()&&r.repetitions!==Number.POSITIVE_INFINITY||(void 0===r.userData.openState&&(r.userData.openState=0),t&&(n=!1),n&&!t||(r.userData.openState=0),r.setLoop(K.YKA,t?Number.POSITIVE_INFINITY:1),r.userData.finished&&n&&(r.timeScale=r.userData.openState?-1:1),r.clampWhenFinished=!0,r.enable=!0,this.currentAction&&this.currentAction!==r?this.currentAction.fadeOut(i):i=0,r.reset().fadeIn(i).play(),r.finished=!1,this.currentAction=r)}},{key:"getClipByName",value:function(e){return this._clips.find((function(t){return t.name===e}))}},{key:"stopClip",value:function(e){if(!e)throw new Fe.R("clip");this._mixer.clipAction(e).stop()}},{key:"stopAll",value:function(){var e=this;this._clips.forEach((function(t){e._mixer.clipAction(t).stop()}))}},{key:"pauseClip",value:function(e){if(!e)throw new Fe.R("clip");var t=this._mixer.clipAction(e);t.isRunning&&(t.paused=!0)}},{key:"unPauseClip",value:function(e){if(!e)throw new Fe.R("clip");this._mixer.clipAction(e).paused=!1}},{key:"isClipPlaying",value:function(e){if(!e)throw new Fe.R("clip");return this._mixer.clipAction(e).isRunning()}},{key:"isClipPaused",value:function(e){if(!e)throw new Fe.R("clip");return this._mixer.clipAction(e).paused}},{key:"isAnyClipPlaying",value:function(){var e=this;return this._clips.forEach((function(t){if(e._mixer.clipAction(t).isRunning)return!0})),!1}}]),e}(),kn=new K.Pa4,Bn=new K.Pa4,Tn=new K.Pa4,Dn=function(e){(0,a.Z)(n,e);var t=(0,o.Z)(n);function n(e,r){var a;return(0,i.Z)(this,n),(a=t.call(this)).light=e,a.sprite=new K.jyi,a.sprite.material.map=r,a.sprite.material.sizeAttenuation=!1,a.sprite.scale.set(.05,.05,.05),a.add(a.sprite),a.isLightHelper=!0,a.matrix=a.light.matrixWorld,a.matrixAutoUpdate=!1,a}return(0,r.Z)(n,[{key:"update",value:function(){this.sprite.material.color.copy(this.light.color)}},{key:"dispose",value:function(){this.sprite.geometry.dispose(),this.sprite.material.dispose()}}]),n}(K.Tme),Rn=function(e){(0,a.Z)(n,e);var t=(0,o.Z)(n);function n(e,r){return(0,i.Z)(this,n),t.call(this,e,r)}return(0,r.Z)(n)}(Dn),Pn=function(e){(0,a.Z)(n,e);var t=(0,o.Z)(n);function n(e,r){var a;(0,i.Z)(this,n),a=t.call(this,e,r);var o=new K.u9r;o.setAttribute("position",new K.a$l([0,0,0,0,0,.25],3));var s=new K.nls({fog:!1,toneMapped:!1});return a.targetLine=new K.x12(o,s),a.add(a.targetLine),a}return(0,r.Z)(n,[{key:"update",value:function(){(0,st.Z)((0,lt.Z)(n.prototype),"update",this).call(this),this.targetLine.material.color.copy(this.light.color),this.light.updateWorldMatrix(!0,!1),this.light.target.updateWorldMatrix(!0,!1),kn.setFromMatrixPosition(this.light.matrixWorld),Bn.setFromMatrixPosition(this.light.target.matrixWorld),Tn.subVectors(Bn,kn),void 0!==this.color?this.targetLine.material.color.set(this.color):this.targetLine.material.color.copy(this.light.color),this.targetLine.lookAt(Bn),this.targetLine.scale.z=Tn.length()}},{key:"dispose",value:function(){(0,st.Z)((0,lt.Z)(n.prototype),"dispose",this).call(this),this.targetLine.geometry.dispose(),this.targetLine.material.dispose()}}]),n}(Dn),Ln=function(e){(0,a.Z)(n,e);var t=(0,o.Z)(n);function n(e,r){var a;(0,i.Z)(this,n),a=t.call(this,e,r);for(var o=new K.u9r,s=.1,l=[0,0,0,0,0,.2,0,0,0,s,0,s,0,0,0,-.1,0,s,0,0,0,0,s,s,0,0,0,0,-.1,s],u=0,c=1;u<32;u++,c++){var h=u/32*Math.PI*2,d=c/32*Math.PI*2;l.push(Math.cos(h)*s,Math.sin(h)*s,s,Math.cos(d)*s,Math.sin(d)*s,s)}o.setAttribute("position",new K.a$l(l,3));var f=new K.nls({fog:!1,toneMapped:!1});return a.cone=new K.ejS(o,f),a.add(a.cone),a.update(),a}return(0,r.Z)(n,[{key:"dispose",value:function(){(0,st.Z)((0,lt.Z)(n.prototype),"dispose",this).call(this),this.cone.geometry.dispose(),this.cone.material.dispose()}},{key:"update",value:function(){this.light.updateWorldMatrix(!0,!1),this.light.target.updateWorldMatrix(!0,!1);var e=this.light.distance?this.light.distance:2,t=e*Math.tan(this.light.angle);this.cone.scale.set(t,t,e),kn.setFromMatrixPosition(this.light.target.matrixWorld),this.cone.lookAt(kn),this.cone.material.color.copy(this.light.color)}}]),n}(Dn);function Qn(){var e=new K.DvJ,t=new K.Wid;return new K.Kj0(e,t)}var Zn=function(){function e(t,n){(0,i.Z)(this,e),this._scene=t,this._settings=n,this._assets={}}return(0,r.Z)(e,[{key:"settings",get:function(){return this._settings}},{key:"scene",get:function(){return this._scene}}]),e}(),Nn=n(763),Fn=function(){function e(){(0,i.Z)(this,e),this._state={project:{title:"Untitled",description:""},environment:{backgroundType:"color",backgroundColor:"#fff",backgroundGradientColor1:"#ffffff",backgroundGradientColor2:"#808080",enableReflection:!1,reflectionFadeScale:3,reflectionColor:"#ffffff",reflectionOpacity:1,blurReflection:!1,fogColor:"#BABFD9",fogDensity:.02,fogNear:100,fogFar:1e3,fog:!1,fogType:"exponential"},lighting:{shadowsEnabled:!0,shadowLightIntensity:1,shadowPlaneVisible:!0,shadowPlaneLightness:.7,shadowLightRotation:Math.PI/4,shadowLightElevation:Math.PI/4,shadowBias:1e-4,ambientLightColor:"#ffffff",ambientLightIntensity:.2},cameraController:{controllerType:"orbit",orbitController:{minElevation:0,maxElevation:180,minZoom:0,maxZoom:100},firstPersonController:{moveSpeed:1}},annotations:{visibilityTest:!1,showNavButtons:!1,textColor:"#ffffff",fillColor:"#000000",borderColor:"#ffffff",size:32},viewer:{autoRotate:{enabled:!0,speed:1},menu:{showHelp:!0,showInfo:!0,showOptions:!0},startButton:{show:!0,type:"3d"},ar:{enabled:!0,webAr:!1},vr:{enabled:!1,walkSpeed:1,rayGeometryTest:!0},animations:{startAnimation:"",loopStartAnimation:!1},dimensionsTool:{show:!1}},effects:{bloom:{enabled:!1,radius:.5,threshold:.5,strength:.5},dof:{enabled:!1,focalLength:.5,focus:.5,blur:.5}}}}return(0,r.Z)(e,[{key:"state",get:function(){return this._state},set:function(e){if((0,Nn.merge)(this._state,e),!this.state.lighting||!this.state.environment||!this.state.cameraController||!this.state.cameraController.orbitController||!this.state.cameraController.firstPersonController)throw new Error("editor state corrupt");x.Z.instance.notifyAll(new R)}}]),e}(),Un=new K.Ilk,jn=new K.Ilk,On=new K.Pa4,zn=new K.Pa4,Gn=new K.Pa4,Hn=function(){function e(){(0,i.Z)(this,e),this._effectsPreviewMode=!1,this._envPreviewMode=!1}return(0,r.Z)(e,[{key:"orbitCameraController",get:function(){return this._orbitCameraController}},{key:"firstPersonCameraController",get:function(){return this._firstPersonCameraController}},{key:"cameraController",get:function(){return this._cameraController},set:function(e){this._cameraController=e}},{key:"world",get:function(){return this._world}},{key:"containerElem",get:function(){return this._containerElem}},{key:"canvasElem",get:function(){return this._canvasElem}},{key:"selectedObject",get:function(){return this._selectedObject}},{key:"renderPass",get:function(){return this._renderPass}},{key:"viewport",get:function(){return{width:this.containerElem.clientWidth,height:this.containerElem.clientHeight,aspect:this.containerElem.clientWidth/this.containerElem.clientHeight}}},{key:"effectsPreviewMode",get:function(){return this._effectsPreviewMode},set:function(e){this._effectsPreviewMode=e,this.setEffects()}},{key:"envPreviewMode",get:function(){return this._envPreviewMode},set:function(e){this._envPreviewMode=e,this.setEnvironment()}},{key:"transformControls",get:function(){return this._transformControls}},{key:"project",get:function(){return this._project},set:function(e){var t=this;this._project=e,this.removeLightHelpers(),this.world.clearSceneRoot(),this.world.sceneRoot.add(e.scene),e.scene.traverse((function(e){var n;e.isMesh?(e.receiveShadow=!0,e.castShadow=!0):e.isPoints?e.material=new K.UY4({color:4294967295,size:e.userData.size,sizeAttenuation:!1,depthTest:!1,transparent:!0,map:e.material.map}):e.isLight&&t.updateLight(e),null!==e&&void 0!==e&&null!==(n=e.animations)&&void 0!==n&&n.length&&(e.animationPlayer=new Sn(e,e.animations))})),this.bindCamerasToControllers(e.scene,1),this.renderPass.camera=this.orbitCameraController.object,this.transformControls.camera=this.orbitCameraController.object,this.setLighting(),this.setEnvironment(),this.setCameraController(),this.addLightHelpers(),this.deselectAll(),this.orbitCameraController.object.position.set(20,20,20),this.orbitCameraController.object.lookAt(0,0,0),this.orbitCameraController.update(),this.updateAnnotations(),this.createAllBakedShadows(),this.sceneBBoxHelper&&this.sceneBBoxHelper.setFromObject(e.scene),this.recalculateSceneBounds(),x.Z.instance.notifyAll(new R),x.Z.instance.notifyAll(new _),x.Z.instance.notifyAll(new b)}},{key:"initialize",value:function(e,t){var n=this;this._canvasElem=e,this._containerElem=t,this._project=new Zn(new K.Tme,new Fn),this.mouseDownPos=new K.FM8,this.mouseUpPos=new K.FM8;var i=this.createOrbitCamera();this.project.scene.add(i);var r=this.createFirstPersonCamera();this.project.scene.add(r),this._orbitCameraController=new Mt(i,t),this.orbitCameraController.enablePan=!0,this.orbitCameraController.autoRotate=!1,this.orbitCameraController.autoRotateSpeed=0,this.orbitCameraController.saveState(),i.position.set(20,20,20),i.lookAt(0,0,0),this.orbitCameraController.update(),this._firstPersonCameraController=new at(r,t),this.firstPersonCameraController.lookSpeed=.1,this.firstPersonCameraController.object.position.set(-10,10,-10),this.cameraController=this.orbitCameraController;var a=new St;a.init(e);var o=new tt(a.renderer);this._world=new kt(a,o,this.orbitCameraController),this._renderPass=o.createRenderPass(this.world.scene,i,!0),o.addPass(this.renderPass),this.world.sceneRoot.add(this.project.scene),this.ambientLight=new K.Mig(new K.Ilk(this.project.settings.state.lighting.ambientLightColor),this.project.settings.state.lighting.ambientLightIntensity),this.world.scene.add(this.ambientLight),this.world.renderer.renderer.shadowMap.enabled=this.project.settings.state.lighting.shadowsEnabled,this.world.renderer.renderer.shadowMap.type=K.ntZ,new ResizeObserver((function(e){if(e.length>0){var t=e[0].target.clientWidth,i=e[0].target.clientHeight,r=t/i;n.orbitCameraController.object.aspect=r,n.orbitCameraController.object.zoom=1,n.orbitCameraController.object.updateProjectionMatrix(),n.firstPersonCameraController.object.aspect=r,n.firstPersonCameraController.object.zoom=1,n.firstPersonCameraController.object.updateProjectionMatrix(),n.world.composer&&n.world.composer.setSize(t-1,i),n.world.renderer&&n.world.renderer.setSize(t,i)}})).observe(t),this.objectSelector=new Bt,this._transformControls=new fn(this.world.camera,this.canvasElem),this.transformControls.onDragChanged=function(e){n.orbitCameraController.enabled=!e.value,n.transformControls.object.isLight&&n.updateLight(n.transformControls.object),n.recalculateSceneBounds()},this.world.scene.add(this.transformControls.controls),this.getMousePos=function(e,t,n){var i=e.getBoundingClientRect();return[(t-i.left)/i.width,(n-i.top)/i.height]},this.canvasElem.addEventListener("pointerdown",(function(e){n.mouseDownPos.fromArray(n.getMousePos(n.canvasElem,e.clientX,e.clientY))})),this.canvasElem.addEventListener("pointerup",(function(e){n.mouseUpPos.fromArray(n.getMousePos(n.canvasElem,e.clientX,e.clientY))})),this.canvasElem.addEventListener("click",(function(e){if(!n.mouseUpPos.distanceTo(n.mouseDownPos)){var t,i=n.objectSelector.intersectionTest(n.project.scene,n.world.camera,e),r=!1,a=(0,Ne.Z)(i);try{for(a.s();!(t=a.n()).done;){var o=t.value;if(o.object!==n.selectedObject&&!o.object.isLine&&!o.object.isPoints&&"ezv-baked-shadow"!=o.object.name){var s=new pn(o.object,o);Q.execute(s),o.object.isLight&&n.bindLightHelper(o.object.constructor.name,o.object),x.Z.instance.notifyAll(new M(o)),r=!0;break}}}catch(d){a.e(d)}finally{a.f()}if(!r&&n.selectedObject){var l=new An(n.selectedObject);Q.execute(l)}}x.Z.instance.notifyAll(new E(e));var u=n.annotationLabels.selectTest(e.offsetX,e.offsetY,n.world.camera);if(u){var c=new K._fP;c.setFromRotationMatrix(u.userData.cameraState.matrix);var h=new K.Pa4;h.setFromMatrixPosition(u.userData.cameraState.matrix),n.cameraAnimation=new In(n.world.cameraController),n.orbitCameraController.enabled=!1,n.cameraAnimation.start(h,c,u.userData.cameraState,(function(){n.orbitCameraController.enabled=!0}))}})),this.gradient=Et(this.world.camera),this.world.scene.add(this.gradient),this.reflector=xn(this.world,10,this.project.settings.state.environment.reflectionColor,this.project.settings.state.environment.reflectionFadeScale,this.project.settings.state.environment.reflectionOpacity,this.project.settings.state.environment.blurReflection),this.world.scene.add(this.reflector),this.expFog=new K.yo9(16777215,this.project.settings.state.environment.fogColor,this.project.settings.state.environment.fogDensity),this.fog=new K.ybr(16777215,this.project.settings.state.environment.fogNear,this.project.settings.state.environment.fogFar),this.world.scene.fog="linear"===this.project.settings.state.environment.fogType?this.fog:this.expFog,this.shadowPlane=function(e,t){var n=new K.Tn7;n.opacity=1,n.depthWrite=!1,n.color.set(0);var i=new K.Kj0(new K._12(1,1,8,8),n);return i.receiveShadow=!0,i.rotation.x=-.5*Math.PI,i.position.set(0,1e-4,0),i.scale.set(e,e,e),i}(10,this.project.settings.state.lighting.shadowLightness),this.shadowPlane.name="ezv-shadow-plane",this.world.scene.add(this.shadowPlane),this.shadowLight=function(e,t,n){var i=new K.Ox3;if(i.color.set("#ffffff"),i.intensity=3,i.castShadow=!0,i.shadow.bias=-.0015,i.shadow.radius=1,i.shadow.mapSize.width=1024,i.shadow.mapSize.height=1024,i.shadow.camera.near=.01*e,i.shadow.camera.far=10*e,i.shadow.camera.left=2*-e,i.shadow.camera.right=2*e,i.shadow.camera.top=2*e,i.shadow.camera.bottom=2*-e,i.shadow.camera.updateProjectionMatrix(),void 0!==n&void 0!==t){var r=e,a=r*Math.sin(n)*Math.cos(t),o=r*Math.sin(n)*Math.sin(t),s=r*Math.cos(n);i.position.set(a,s,o)}else i.position.set(2*e,2*e,2*e);return i.lookAt(0,0,0),i}(10,this.project.settings.state.lighting.shadowLightRotation,this.project.settings.state.lighting.shadowLightElevation),this.shadowLight.name="ezv-shadow-light",this.shadowLight.visible=!1,this.world.scene.add(this.shadowLight),this.annotationLabels=new Mn(this.containerElem,this.project.settings.state.annotations),this.world.addRenderFrameCallback((function(e){n.annotationLabels.updateLabels(n.world.camera),n.cameraAnimation.update(e),n.project.scene.traverse((function(t){t.animationPlayer&&t.animationPlayer.update(e)}))})),this.cameraAnimation=new In(this.orbitCameraController),this.setGrid(100,40,new K.Ilk(2105376),new K.Ilk(4202528),!0);var s=document.getElementsByClassName("footer");s.length&&(s[0].style.display="none"),this.lightTexture=(new K.dpR).load("data:image/png;base64,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");var l=this.addPointLight();l.intensity=1,l.position.set(-2,2,-2);var u=Qn();this.addObject(u),this.bloomPass=this.world.composer.createBloomPass(this.project.settings.state.effects.bloom.threshold,this.project.settings.state.effects.bloom.strength,this.project.settings.state.effects.bloom.radius),this.world.composer.addPass(this.bloomPass),this.dofPass=this.world.composer.createDofPass(this.world.scene,this.world.camera,this.project.settings.state.effects.dof.focus*this.world.camera.far*.1,1*this.project.settings.state.effects.dof.focalLength/this.world.camera.far,.01*this.project.settings.state.effects.dof.blur),this.world.composer.addPass(this.dofPass),this.setEffects(),this.newProject(),this.frameObject(this.project.scene)}},{key:"newProject",value:function(){var e=new K.Tme,t=new Fn,n=new Zn(e,t);this.project=n;var i=Qn();i.position.set(0,.5,0),this.addObject(i),this.frameObject(this.project.scene)}},{key:"setGrid",value:function(e,t,n,i,r){this._grid&&(this._grid.removeFromParent(),this._grid.dispose()),this._grid=new K.VLJ(e,t,i,n),this._grid.visible=r,this.world.scene.add(this._grid)}},{key:"createOrbitCamera",value:function(){var e=new K.cPb(45,this.viewport.aspect,.1,1e3);return e.name="Orbit_Camera",e}},{key:"createFirstPersonCamera",value:function(){var e=new K.cPb(45,this.viewport.aspect,.1,1e3);return e.name="First_Person_Camera",e}},{key:"bindCamerasToControllers",value:function(e){var t=e.getObjectByName("Orbit_Camera");t||(t=this.createOrbitCamera(this.viewport.aspect),e.add(t)),this.orbitCameraController.object=t,this.orbitCameraController.saveState();var n=e.getObjectByName("First_Person_Camera");n||(n=this.createFirstPersonCamera(this.viewport.aspect),e.add(n)),this.firstPersonCameraController.object=n}},{key:"renderScene",value:function(){this.world.composer.render(this.world.scene,this.world.camera)}},{key:"toggleFullScreen",value:function(){this.containerElem&&(document.fullscreenElement?document.exitFullscreen?document.exitFullscreen():document.webkitExitFullscreen?document.webkitExitFullscreen():document.mozCancelFullScreen?document.mozCancelFullScreen():document.msExitFullscreen&&document.msExitFullscreen():this.containerElem.requestFullscreen?this.containerElem.requestFullscreen():this.containerElem.mozRequestFullScreen?this.containerElem.mozRequestFullScreen():this.containerElem.msRequestFullscreen?this.containerElem.msRequestFullscreen():this.containerElem.webkitRequestFullscreen&&this.containerElem.webkitRequestFullscreen(Element.ALLOW_KEYBOARD_INPUT))}},{key:"addDepthFadeReflector",value:function(){this.depthFadeReflector&&(this.depthFadeReflector.removeFromParent(),this.depthFadeReflector.dispose());var e=new Ue(this.project.scene);this.depthFadeReflector=xn(this.world,e,this.project.settings.state.environment.reflectionColor,this.project.settings.state.environment.reflectionFadeScale,this.project.settings.state.environment.reflectionOpacity,this.project.settings.state.environment.blurReflection),this.world.scene.add(this.depthFadeReflector)}},{key:"deleteBakedShadowMesh",value:function(e){e.bakedShadow&&(e.bakedShadow.mesh.removeFromParent(),e.bakedShadow.dispose(),e.bakedShadow=null)}},{key:"renderBakedShadow",value:function(e){var t,n,i,r=null!==(t=e.userData.bakedShadowLightness)&&void 0!==t?t:.7,a=null!==(n=e.userData.bakedShadowBlur)&&void 0!==n?n:.7,o=null!==(i=e.userData.bakedShadowFalloff)&&void 0!==i?i:0;this.deleteBakedShadowMesh(e),e.bakedShadow=function(e,t,n,i,r){var a=new vn(t,e,n,i,r);return e.attach(a.mesh),e.bakedShadow=a,a}(e,this.world.renderer,r,a,o),e.attach(e.bakedShadow.mesh),e.bakedShadow.mesh.name="ezv-baked-shadow"}},{key:"removeBakedShadowFromObject",value:function(e){this.deleteBakedShadowMesh(e),delete e.userData.bakedShadowLightness,delete e.userData.bakedShadowBlur,delete e.userData.bakedShadowFalloff}},{key:"getBakedShadowProperties",value:function(e){var t,n,i;return{bakedShadowBlur:null!==(t=e.userData.bakedShadowBlur)&&void 0!==t?t:.7,bakedShadowLightness:null!==(n=e.userData.bakedShadowLightness)&&void 0!==n?n:.7,bakedShadowFalloff:null!==(i=e.userData.bakedShadowFalloff)&&void 0!==i?i:0}}},{key:"setBakedShadowProperties",value:function(e,t){e.userData.bakedShadowBlur=t.bakedShadowBlur,e.userData.bakedShadowLightness=t.bakedShadowLightness,e.userData.bakedShadowFalloff=t.bakedShadowFalloff,this.renderBakedShadow(e,e.userData.bakedShadowLightness,e.userData.bakedShadowBlur,e.userData.bakedShadowFalloff)}},{key:"createAllBakedShadows",value:function(){var e=this;this.project.scene.traverse((function(t){void 0!=t.userData.bakedShadowBlur&&e.renderBakedShadow(t)}))}},{key:"deleteAllBakedShadowMeshes",value:function(){var e=this;this.project.scene.traverse((function(t){t.bakedShadow&&e.deleteBakedShadowMesh(t)}))}},{key:"addObject",value:function(e,t){e&&(t?t.add(e):this.project.scene.add(e),e.traverse((function(e){var t;e instanceof K.Kj0&&(e.receiveShadow=!0,e.castShadow=!0),null!==e&&void 0!==e&&null!==(t=e.animations)&&void 0!==t&&t.length&&(e.animationPlayer=new Sn(e,e.animations))})),this.recalculateSceneBounds(),x.Z.instance.notifyAll(new b))}},{key:"removeObject",value:function(e){if(!e.isCamera){e.removeFromParent(),e.isLight&&e.helper&&this.removeLightHelper(e.helper);var t=new pt;t.track(e),t.dispose(),this.deselectAll(),x.Z.instance.notifyAll(new b)}}},{key:"updateLight",value:function(e){(e instanceof K.PMe||e instanceof K.Ox3)&&(e.helper&&e.helper.update(),e.target&&(e.matrix.extractBasis(On,zn,Gn),e.target.position.set(0,0,0),e.target.position.addScaledVector(Gn,2)))}},{key:"addPointLight",value:function(){var e=new K.cek;this.addObject(e);var t=new Rn(e,this.lightTexture);return e.helper=t,this.world.scene.add(t),e}},{key:"addDirectionalLight",value:function(){var e=new K.Ox3;this.addObject(e),e.add(e.target);var t=new Pn(e,this.lightTexture);return e.helper=t,this.world.scene.add(t),e}},{key:"addSpotLight",value:function(){var e=new K.PMe;this.addObject(e),e.add(e.target);var t=new Ln(e,this.lightTexture);return e.helper=t,this.world.scene.add(t),e}},{key:"addHemisphereLight",value:function(){var e=new K.vmT;this.addObject(e);var t=new Rn(e,this.lightTexture);return e.helper=t,this.world.scene.add(t),e}},{key:"addLightHelpers",value:function(){var e=this;this.project.scene.traverse((function(t){var n;t.isLight&&(t.helper&&(t.helper.removeFromParent(),t.dispose&&t.dispose()),t instanceof K.cek?n=new Rn(t,e.lightTexture):t instanceof K.Ox3?n=new Pn(t,e.lightTexture):t instanceof K.PMe?n=new Ln(t,e.lightTexture):t instanceof K.vmT&&(n=new Rn(t,e.lightTexture)),n&&(t.helper=n,e.world.scene.add(n),t.helper.update()))}))}},{key:"removeLightHelper",value:function(e){if(e.isLightHelper){e.removeFromParent();var t=new pt;t.track(e),t.dispose()}}},{key:"getLightHelpers",value:function(){var e=[];return this.world.scene.traverse((function(t){t.isLightHelper&&e.push(t)})),e}},{key:"removeLightHelpers",value:function(){var e=this;this.getLightHelpers().forEach((function(t){return e.removeLightHelper(t)}))}},{key:"frameObject",value:function(e){var t,n=new Ue(e),i=this.orbitCameraController.object.fov;t=this.orbitCameraController.object.aspect>1?n.boundingSphere.radius/Math.tan(i/2*Math.PI/180):n.boundingSphere.radius/this.orbitCameraController.object.aspect/Math.tan(i/2*Math.PI/180);var r=n.center.x+1*t,a=n.center.y+1*t,o=n.center.z+1*t;this.orbitCameraController.object.position.set(r,a,o),this.orbitCameraController.target.copy(n.center),this.orbitCameraController.clearPanOffset(),this.orbitCameraController.update()}},{key:"frameScene",value:function(){this.frameObject(this.project.scene);var e=new Ue(this.project.scene);this.orbitCameraController.object.near=.01*e.boundingSphere.radius,this.orbitCameraController.object.far=100*e.boundingSphere.radius,this.orbitCameraController.object.updateProjectionMatrix()}},{key:"recalculateSceneBounds",value:function(){var e=new Ue(this.world.sceneRoot),t=e.boundingSphere.radius;this.shadowLight.shadow.camera.near=.01*t,this.shadowLight.shadow.camera.far=10*t,this.shadowLight.shadow.camera.left=2*-t,this.shadowLight.shadow.camera.right=2*t,this.shadowLight.shadow.camera.top=2*t,this.shadowLight.shadow.camera.bottom=2*-t,this.shadowLight.shadow.camera.updateProjectionMatrix();var n=t*Math.sin(this.project.settings.state.lighting.shadowLightElevation)*Math.cos(this.project.settings.state.lighting.shadowLightRotation),i=t*Math.sin(this.project.settings.state.lighting.shadowLightElevation)*Math.sin(this.project.settings.state.lighting.shadowLightRotation),r=t*Math.cos(this.project.settings.state.lighting.shadowLightElevation);this.shadowLight.position.set(e.boundingSphere.center.x+n,e.boundingSphere.center.y+r,e.boundingSphere.center.z+i),On.set(e.boundingSphere.center.x,e.boundingSphere.center.y,e.boundingSphere.center.z),this.shadowLight.lookAt(On);var a=2*(e.boundingSphere.center.length()+t);this.shadowPlane.scale.set(a,a,a),this.reflector.scale.set(a,a,a),this.sceneBBoxHelper&&this.sceneBBoxHelper.update(),this.shadowCameraHelper&&this.shadowCameraHelper.update()}},{key:"selectObject",value:function(e,t){this.selectedObject!==e&&(this._selectedObject=e,this.transformControls.controls.attach(e),x.Z.instance.notifyAll(new I(e,t)))}},{key:"setObjectPosition",value:function(e,t){e.position.copy(t),this.recalculateSceneBounds(),x.Z.instance.notifyAll(new k(e))}},{key:"setObjectRotation",value:function(e,t){e.rotation.copy(t),this.recalculateSceneBounds(),x.Z.instance.notifyAll(new B(e))}},{key:"setObjectScale",value:function(e,t){e.scale.copy(t),this.recalculateSceneBounds(),x.Z.instance.notifyAll(new T(e))}},{key:"deselectAll",value:function(){this.selectedObject&&(x.Z.instance.notifyAll(new S(this.selectedObject)),this._selectedObject=null,this.transformControls.controls.detach())}},{key:"setObjectTransformMode",value:function(e){this.transformControls.controls.setMode(e)}},{key:"getObjectTransformMode",value:function(){return this.transformControls.controls.getMode()}},{key:"setEnvironment",value:function(){if(this.envPreviewMode){var e=this.project.settings.state.environment;switch(e.backgroundType){case"transparent":this.world.scene.background=null,this.gradient.visible=!1;break;case"color":this.world.scene.background=new K.Ilk(e.backgroundColor),this.gradient.visible=!1;break;case"gradient":this.gradient.visible=!0,Un.set(e.backgroundGradientColor1),jn.set(e.backgroundGradientColor2),this.gradient.style({colors:[Un,jn]})}this.reflector.setFadeScale(e.reflectionFadeScale),Un.set(e.reflectionColor),this.reflector.setColor(Un),this.reflector.setOpacity(e.reflectionOpacity),this.reflector.enableBlur(e.blurReflection),this.reflector.visible=e.enableReflection,this.fog.near=e.fogNear,this.fog.far=e.fogFar,this.fog.color.set(e.fogColor),this.expFog.color.set(e.fogColor),this.expFog.density=e.fogDensity,e.fog?this.world.scene.fog="linear"===e.fogType?this.fog:this.expFog:this.world.scene.fog=null}else this.world.scene.background=new K.Ilk(4210752),this.gradient.visible=!1,this.reflector.visible=!1,this.world.scene.fog=null}},{key:"setLighting",value:function(){var e=this.project.settings.state.lighting;this.shadowLight.castShadow=e.shadowsEnabled,this.shadowLight.intensity=e.shadowLightIntensity,this.shadowLight.visible=e.shadowsEnabled,this.shadowLight.shadow.bias=e.shadowBias,this.shadowPlane.visible=e.shadowsEnabled&&e.shadowPlaneVisible,this.shadowPlane.material.opacity=1-e.shadowPlaneLightness,this.ambientLight.intensity=e.ambientLightIntensity,this.ambientLight.color.set(e.ambientLightColor),this.recalculateSceneBounds()}},{key:"setEffects",value:function(){this.effectsPreviewMode?(this.world.composer.enablePass(this.bloomPass,this.project.settings.state.effects.bloom.enabled),this.bloomPass.threshold=this.project.settings.state.effects.bloom.threshold,this.bloomPass.strength=this.project.settings.state.effects.bloom.strength,this.bloomPass.radius=this.project.settings.state.effects.bloom.radius,this.world.composer.enablePass(this.dofPass,this.project.settings.state.effects.dof.enabled),this.dofPass.uniforms.aperture.value=1*this.project.settings.state.effects.dof.focalLength/this.world.camera.far,this.dofPass.uniforms.focus.value=this.project.settings.state.effects.dof.focus*this.world.camera.far*.1,this.dofPass.uniforms.maxblur.value=.02*this.project.settings.state.effects.dof.blur):(this.world.composer.enablePass(this.bloomPass,!1),this.world.composer.enablePass(this.dofPass,!1))}},{key:"setCameraControllerType",value:function(e){"orbit"==e?(this.cameraController=this.orbitCameraController,this.firstPersonCameraController.enabled=!1):(this.cameraController=this.firstPersonCameraController,this.orbitCameraController.enabled=!1),this.world.cameraController=this.cameraController,this.cameraController.enabled=!0}},{key:"setCameraController",value:function(){var e=this.project.settings.state.cameraController;this.setCameraControllerType(e.controllerType),this.orbitCameraController.minPolarAngle=Number(e.orbitController.minElevation)*Math.PI/180,this.orbitCameraController.maxPolarAngle=Number(e.orbitController.maxElevation)*Math.PI/180,this.firstPersonCameraController.movementSpeed=Number(e.firstPersonController.moveSpeed),this.orbitCameraController.update()}},{key:"addAnnotation",value:function(e,t){t.add(e),x.Z.instance.notifyAll(new b)}},{key:"removeAnnotation",value:function(e){e.geometry.dispose(),e.material.dispose(),e.removeFromParent()}},{key:"updateAnnotations",value:function(){var e=this.project.settings.state.annotations;this.project.scene.traverse((function(t){var n,i,r,a,o,s,l,u;t instanceof K.woe&&(n=t,i=e.size,r=t.userData.buttonText,a=t.userData.labelText,o=e.fillColor,s=e.textColor,l=e.borderColor,u=t.userData.cameraState,n.material.map.dispose(),n.material.map=wn(r,o,s,l),n.material.size=i,n.userData={buttonText:r,labelText:a,size:i,fillColor:o,textColor:s,borderColor:l,cameraState:u})}))}}]),e}(),Vn=new Hn,Wn=function(e){(0,a.Z)(n,e);var t=(0,o.Z)(n);function n(){var e,r=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"scene.glb";return(0,i.Z)(this,n),(e=t.call(this)).fn=r,e}return(0,r.Z)(n,[{key:"getAnimations",value:function(){var e=[];return Vn.world.sceneRoot.traverse((function(t){e.push.apply(e,(0,X.Z)(t.animations))})),e}},{key:"save",value:function(e,t){var n=document.createElement("a");n.href=URL.createObjectURL(e),n.download=t||"data.json",n.dispatchEvent(new MouseEvent("click"))}},{key:"execute",value:function(){var e=this;Vn.deleteAllBakedShadowMeshes();var t=this.getAnimations();(new $).parse(Vn.world.sceneRoot,(function(t){e.save(new Blob([t],{type:"application/octet-stream"}),e.fn)}),void 0,{binary:!0,animations:t}),Vn.createAllBakedShadows()}},{key:"undoable",get:function(){return!1}}]),n}(Ze),qn=n(66618),Yn=function(){function e(){(0,i.Z)(this,e)}return(0,r.Z)(e,[{key:"_save",value:function(e,t){var n=document.createElement("a");n.href=URL.createObjectURL(e),n.download=t||"data.json",n.dispatchEvent(new MouseEvent("click"))}},{key:"serializeAnimations",value:function(e){e.traverse((function(e){e.animations&&(e.userData.animations=[],e.animations.forEach((function(t){e.userData.animations.push(K.m7l.toJSON(t))})))}))}},{key:"removeLightChildNodes",value:function(e){e.traverse((function(e){e.isLight&&e.clear()}))}},{key:"zipProject",value:function(){var e=(0,p.Z)((0,f.Z)().mark((function e(t,n){var i,r,a;return(0,f.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(i={},r=new $,this.serializeAnimations(t.scene),this.removeLightChildNodes(t.scene),!n){e.next=8;break}return e.next=7,new Promise((function(e,n){r.parse(t.scene,(function(t){e(new Uint8Array(t))}),(function(e){n(e)}),{binary:!0})}));case 7:i["scene.glb"]=e.sent;case 8:if(!t.envMap||!t.envMap.dataUrl){e.next=17;break}return e.next=11,fetch(t.envMap.dataUrl);case 11:return a=e.sent,e.t0=Uint8Array,e.next=15,a.arrayBuffer();case 15:e.t1=e.sent,i["envmap.hdr"]=new e.t0(e.t1);case 17:return i["settings.json"]=new Uint8Array((new TextEncoder).encode(JSON.stringify(t.settings.state)).buffer),e.abrupt("return",(0,qn.Xo)(i,{level:6}));case 19:case"end":return e.stop()}}),e,this)})));return function(t,n){return e.apply(this,arguments)}}()},{key:"export",value:function(){var e=(0,p.Z)((0,f.Z)().mark((function e(t,n){var i,r,a=arguments;return(0,f.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return i=!(a.length>2&&void 0!==a[2])||a[2],e.next=3,this.zipProject(n,i);case 3:r=e.sent,this._save(new Blob([r],{type:"application/octet-stream"}),t);case 5:case"end":return e.stop()}}),e,this)})));return function(t,n){return e.apply(this,arguments)}}()}]),e}(),Jn=function(e){(0,a.Z)(n,e);var t=(0,o.Z)(n);function n(){return(0,i.Z)(this,n),t.call(this)}return(0,r.Z)(n,[{key:"execute",value:function(){var e=(0,p.Z)((0,f.Z)().mark((function e(){var t,n,i,r;return(0,f.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return Vn.deleteAllBakedShadowMeshes(),t={types:[{description:"Zip Files",accept:{"application/zip":[".zip"]}}]},e.next=4,(new Yn).zipProject(Vn.project,!0);case 4:return n=e.sent,e.prev=5,e.next=8,window.showSaveFilePicker(t);case 8:return i=e.sent,e.next=11,i.createWritable();case 11:return r=e.sent,e.next=14,r.write(n);case 14:return e.next=16,r.close();case 16:e.next=20;break;case 18:e.prev=18,e.t0=e.catch(5);case 20:Vn.createAllBakedShadows();case 21:case"end":return e.stop()}}),e,null,[[5,18]])})));return function(){return e.apply(this,arguments)}}()},{key:"undoable",get:function(){return!1}}]),n}(Ze),Xn=function(e){(0,a.Z)(n,e);var t=(0,o.Z)(n);function n(e){var r;return(0,i.Z)(this,n),(r=t.call(this)).message=e,r}return(0,r.Z)(n)}(w.Z),Kn=function(e){(0,a.Z)(n,e);var t=(0,o.Z)(n);function n(e){var r;return(0,i.Z)(this,n),(r=t.call(this)).message=e,r}return(0,r.Z)(n)}(w.Z),$n=n(12607),ei=function(e){for(var t={},n=0;n<e.length;n++){var i=e[n];t[i.name]=i}return t},ti=function(){function e(){(0,i.Z)(this,e)}return(0,r.Z)(e,[{key:"parse",value:function(){var e=(0,p.Z)((0,f.Z)().mark((function e(t){var n,i,r,a,o,s,l,u,c,h,d,p,A,v,g=arguments;return(0,f.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:n=g.length>1&&void 0!==g[1]?g[1]:{},n=Object.assign({ar:{anchoring:{type:"plane"},planeAnchoring:{alignment:"horizontal"}}},n),(i={})[r="model.usda"]=null,a='#usda 1.0\n(\n    customLayerData = {\n        string creator = "Three.js USDZExporter"\n    }\n    metersPerUnit = 1\n    upAxis = "Y"\n)\n\n',a+=ri(n),o={},s={},t.traverseVisible((function(e){if(e.isMesh){var t=e.geometry,n=e.material;if(n.isMeshStandardMaterial){var r="geometries/Geometry_"+t.id+".usd";if(!(r in i)){var s=ui(t);i[r]=ai(s)}n.uuid in o||(o[n.uuid]=n),a+=oi(e,t,n)}else console.warn("THREE.USDZExporter: Unsupported material type (USDZ only supports MeshStandardMaterial)",e)}else e.isCamera&&(a+=Ai(e))})),a+="\n        }\n    }\n}\n\n",a+=hi(o,s),i[r]=qn.TD(a),a=null,l=(0,f.Z)().mark((function e(){var t,n,r,a,o;return(0,f.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return t=s[u],n=u.split("_")[1],r=1023===t.format,a=ni(t.image,n),e.next=6,new Promise((function(e){return a.toBlob(e,r?"image/png":"image/jpeg",1)}));case 6:return o=e.sent,e.t0=Uint8Array,e.next=10,o.arrayBuffer();case 10:e.t1=e.sent,i["textures/Texture_".concat(u,".").concat(r?"png":"jpg")]=new e.t0(e.t1);case 12:case"end":return e.stop()}}),e)})),e.t0=(0,f.Z)().keys(s);case 16:if((e.t1=e.t0()).done){e.next=21;break}return u=e.t1.value,e.delegateYield(l(),"t2",19);case 19:e.next=16;break;case 21:for(h in c=0,i)d=i[h],p=34+h.length,4!==(A=63&(c+=p))&&(v=new Uint8Array(64-A),i[h]=[d,{extra:{12345:v}}]),c=d.length;return e.abrupt("return",qn.Xo(i,{level:0}));case 24:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}()}]),e}();function ni(e,t){if("undefined"!==typeof HTMLImageElement&&e instanceof HTMLImageElement||"undefined"!==typeof HTMLCanvasElement&&e instanceof HTMLCanvasElement||"undefined"!==typeof OffscreenCanvas&&e instanceof OffscreenCanvas||"undefined"!==typeof ImageBitmap&&e instanceof ImageBitmap){var n=1024/Math.max(e.width,e.height),i=document.createElement("canvas");i.width=e.width*Math.min(1,n),i.height=e.height*Math.min(1,n);var r=i.getContext("2d");if(r.drawImage(e,0,0,i.width,i.height),void 0!==t){for(var a=parseInt(t,16),o=(a>>16&255)/255,s=(a>>8&255)/255,l=(255&a)/255,u=r.getImageData(0,0,i.width,i.height),c=u.data,h=0;h<c.length;h+=4)c[h+0]=c[h+0]*o,c[h+1]=c[h+1]*s,c[h+2]=c[h+2]*l;r.putImageData(u,0,0)}return i}throw new Error("THREE.USDZExporter: No valid image data found. Unable to process texture.")}var ii=7;function ri(e){return'def Xform "Root"\n{\n    def Scope "Scenes" (\n        kind = "sceneLibrary"\n    )\n    {\n        def Xform "Scene" (\n            customData = {\n                bool preliminary_collidesWithEnvironment = 0\n                string sceneName = "Scene"\n            }\n            sceneName = "Scene"\n        )\n        {\n        token preliminary:anchoring:type = "'.concat(e.ar.anchoring.type,'"\n        token preliminary:planeAnchoring:alignment = "').concat(e.ar.planeAnchoring.alignment,'"\n\n')}function ai(e){var t='#usda 1.0\n(\n    customLayerData = {\n        string creator = "Three.js USDZExporter"\n    }\n    metersPerUnit = 1\n    upAxis = "Y"\n)\n\n';return t+=e,qn.TD(t)}function oi(e,t,n){var i="Object_"+e.id,r=si(e.matrixWorld);return e.matrixWorld.determinant()<0&&console.warn("THREE.USDZExporter: USDZ does not support negative scales",e),'def Xform "'.concat(i,'" (\n    prepend references = @./geometries/Geometry_').concat(t.id,".usd@</Geometry>\n)\n{\n    matrix4d xformOp:transform = ").concat(r,'\n    uniform token[] xformOpOrder = ["xformOp:transform"]\n\n    rel material:binding = </Materials/Material_').concat(n.id,">\n}\n\n")}function si(e){var t=e.elements;return"( ".concat(li(t,0),", ").concat(li(t,4),", ").concat(li(t,8),", ").concat(li(t,12)," )")}function li(e,t){return"(".concat(e[t+0],", ").concat(e[t+1],", ").concat(e[t+2],", ").concat(e[t+3],")")}function ui(e){var t=function(e){var t="Geometry",n=e.attributes,i=n.position.count;return'\n    def Mesh "'.concat(t,'"\n    {\n        int[] faceVertexCounts = [').concat(function(e){var t=null!==e.index?e.index.count:e.attributes.position.count;return Array(t/3).fill(3).join(", ")}(e),"]\n        int[] faceVertexIndices = [").concat(function(e){var t=e.index,n=[];if(null!==t)for(var i=0;i<t.count;i++)n.push(t.getX(i));else for(var r=e.attributes.position.count,a=0;a<r;a++)n.push(a);return n.join(", ")}(e),"]\n        normal3f[] normals = [").concat(ci(n.normal,i),'] (\n            interpolation = "vertex"\n        )\n        point3f[] points = [').concat(ci(n.position,i),"]\n        float2[] primvars:st = [").concat(function(e,t){if(void 0===e)return console.warn("USDZExporter: UVs missing."),Array(t).fill("(0, 0)").join(", ");for(var n=[],i=0;i<e.count;i++){var r=e.getX(i),a=e.getY(i);n.push("(".concat(r.toPrecision(ii),", ").concat(1-a.toPrecision(ii),")"))}return n.join(", ")}(n.uv,i),'] (\n            interpolation = "vertex"\n        )\n        uniform token subdivisionScheme = "none"\n    }\n')}(e);return'\ndef "Geometry"\n{\n  '.concat(t,"\n}\n")}function ci(e,t){if(void 0===e)return console.warn("USDZExporter: Normals missing."),Array(t).fill("(0, 0, 0)").join(", ");for(var n=[],i=0;i<e.count;i++){var r=e.getX(i),a=e.getY(i),o=e.getZ(i);n.push("(".concat(r.toPrecision(ii),", ").concat(a.toPrecision(ii),", ").concat(o.toPrecision(ii),")"))}return n.join(", ")}function hi(e,t){var n=[];for(var i in e){var r=e[i];n.push(di(r,t))}return'def "Materials"\n{\n'.concat(n.join(""),"\n}\n\n")}function di(e,t){var n="            ",i=[],r=[];function a(n,i,r){var a=n.id+(r?"_"+r.getHexString():""),o=1023===n.format;return t[a]=n,'\n        def Shader "Transform2d_'.concat(i,'" (\n            sdrMetadata = {\n                string role = "math"\n            }\n        )\n        {\n            uniform token info:id = "UsdTransform2d"\n            float2 inputs:in.connect = </Materials/Material_').concat(e.id,"/uvReader_st.outputs:result>\n            float2 inputs:scale = ").concat(pi(n.repeat),"\n            float2 inputs:translation = ").concat(pi(n.offset),'\n            float2 outputs:result\n        }\n\n        def Shader "Texture_').concat(n.id,"_").concat(i,'"\n        {\n            uniform token info:id = "UsdUVTexture"\n            asset inputs:file = @textures/Texture_').concat(a,".").concat(o?"png":"jpg","@\n            float2 inputs:st.connect = </Materials/Material_").concat(e.id,"/Transform2d_").concat(i,'.outputs:result>\n            token inputs:wrapS = "repeat"\n            token inputs:wrapT = "repeat"\n            float outputs:r\n            float outputs:g\n            float outputs:b\n            float3 outputs:rgb\n            ').concat(e.transparent||e.alphaTest>0?"float outputs:a":"","\n        }")}return e.side===K.ehD&&console.warn("THREE.USDZExporter: USDZ does not support double sided materials",e),null!==e.map?(i.push("".concat(n,"color3f inputs:diffuseColor.connect = </Materials/Material_").concat(e.id,"/Texture_").concat(e.map.id,"_diffuse.outputs:rgb>")),e.transparent?i.push("".concat(n,"float inputs:opacity.connect = </Materials/Material_").concat(e.id,"/Texture_").concat(e.map.id,"_diffuse.outputs:a>")):e.alphaTest>0&&(i.push("".concat(n,"float inputs:opacity.connect = </Materials/Material_").concat(e.id,"/Texture_").concat(e.map.id,"_diffuse.outputs:a>")),i.push("".concat(n,"float inputs:opacityThreshold = ").concat(e.alphaTest))),r.push(a(e.map,"diffuse",e.color))):i.push("".concat(n,"color3f inputs:diffuseColor = ").concat(fi(e.color))),null!==e.emissiveMap?(i.push("".concat(n,"color3f inputs:emissiveColor.connect = </Materials/Material_").concat(e.id,"/Texture_").concat(e.emissiveMap.id,"_emissive.outputs:rgb>")),r.push(a(e.emissiveMap,"emissive"))):e.emissive.getHex()>0&&i.push("".concat(n,"color3f inputs:emissiveColor = ").concat(fi(e.emissive))),null!==e.normalMap&&(i.push("".concat(n,"normal3f inputs:normal.connect = </Materials/Material_").concat(e.id,"/Texture_").concat(e.normalMap.id,"_normal.outputs:rgb>")),r.push(a(e.normalMap,"normal"))),null!==e.aoMap&&(i.push("".concat(n,"float inputs:occlusion.connect = </Materials/Material_").concat(e.id,"/Texture_").concat(e.aoMap.id,"_occlusion.outputs:r>")),r.push(a(e.aoMap,"occlusion"))),null!==e.roughnessMap&&1===e.roughness?(i.push("".concat(n,"float inputs:roughness.connect = </Materials/Material_").concat(e.id,"/Texture_").concat(e.roughnessMap.id,"_roughness.outputs:g>")),r.push(a(e.roughnessMap,"roughness"))):i.push("".concat(n,"float inputs:roughness = ").concat(e.roughness)),null!==e.metalnessMap&&1===e.metalness?(i.push("".concat(n,"float inputs:metallic.connect = </Materials/Material_").concat(e.id,"/Texture_").concat(e.metalnessMap.id,"_metallic.outputs:b>")),r.push(a(e.metalnessMap,"metallic"))):i.push("".concat(n,"float inputs:metallic = ").concat(e.metalness)),null!==e.alphaMap?(i.push("".concat(n,"float inputs:opacity.connect = </Materials/Material_").concat(e.id,"/Texture_").concat(e.alphaMap.id,"_opacity.outputs:r>")),i.push("".concat(n,"float inputs:opacityThreshold = 0.0001")),r.push(a(e.alphaMap,"opacity"))):i.push("".concat(n,"float inputs:opacity = ").concat(e.opacity)),e.isMeshPhysicalMaterial&&(i.push("".concat(n,"float inputs:clearcoat = ").concat(e.clearcoat)),i.push("".concat(n,"float inputs:clearcoatRoughness = ").concat(e.clearcoatRoughness)),i.push("".concat(n,"float inputs:ior = ").concat(e.ior))),'\n    def Material "Material_'.concat(e.id,'"\n    {\n        def Shader "PreviewSurface"\n        {\n            uniform token info:id = "UsdPreviewSurface"\n').concat(i.join("\n"),"\n            int inputs:useSpecularWorkflow = 0\n            token outputs:surface\n        }\n\n        token outputs:surface.connect = </Materials/Material_").concat(e.id,'/PreviewSurface.outputs:surface>\n        token inputs:frame:stPrimvarName = "st"\n\n        def Shader "uvReader_st"\n        {\n            uniform token info:id = "UsdPrimvarReader_float2"\n            token inputs:varname.connect = </Materials/Material_').concat(e.id,".inputs:frame:stPrimvarName>\n            float2 inputs:fallback = (0.0, 0.0)\n            float2 outputs:result\n        }\n\n").concat(r.join("\n"),"\n\n    }\n")}function fi(e){return"(".concat(e.r,", ").concat(e.g,", ").concat(e.b,")")}function pi(e){return"(".concat(e.x,", ").concat(e.y,")")}function Ai(e){var t=e.name?e.name:"Camera_"+e.id,n=si(e.matrixWorld);return e.matrixWorld.determinant()<0&&console.warn("THREE.USDZExporter: USDZ does not support negative scales",e),e.isOrthographicCamera?'def Camera "'.concat(t,'"\n\t\t{\n\t\t\tmatrix4d xformOp:transform = ').concat(n,'\n\t\t\tuniform token[] xformOpOrder = ["xformOp:transform"]\n\t\n\t\t\tfloat2 clippingRange = (').concat(e.near.toPrecision(ii),", ").concat(e.far.toPrecision(ii),")\n\t\t\tfloat horizontalAperture = ").concat((10*(Math.abs(e.left)+Math.abs(e.right))).toPrecision(ii),"\n\t\t\tfloat verticalAperture = ").concat((10*(Math.abs(e.top)+Math.abs(e.bottom))).toPrecision(ii),'\n\t\t\ttoken projection = "orthographic"\n\t\t}\n\t\n\t'):'def Camera "'.concat(t,'"\n\t\t{\n\t\t\tmatrix4d xformOp:transform = ').concat(n,'\n\t\t\tuniform token[] xformOpOrder = ["xformOp:transform"]\n\t\n\t\t\tfloat2 clippingRange = (').concat(e.near.toPrecision(ii),", ").concat(e.far.toPrecision(ii),")\n\t\t\tfloat focalLength = ").concat(e.getFocalLength().toPrecision(ii),"\n\t\t\tfloat focusDistance = ").concat(e.focus.toPrecision(ii),"\n\t\t\tfloat horizontalAperture = ").concat(e.getFilmWidth().toPrecision(ii),'\n\t\t\ttoken projection = "perspective"\n\t\t\tfloat verticalAperture = ').concat(e.getFilmHeight().toPrecision(ii),"\n\t\t}\n\t\n\t")}function vi(e){return new Promise((function(t){return setTimeout(t,e)}))}var gi=function(){function e(t){(0,i.Z)(this,e),this.onLoad=t}return(0,r.Z)(e,[{key:"convertToGLB",value:function(){var e=(0,p.Z)((0,f.Z)().mark((function e(t,n,i){var r,a,o,s=this;return(0,f.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return r=new K.lLk(void 0,void 0,i),e.next=3,new Promise((function(e){s.loadFiles(r,t,n,(function(t){e(t)}),(function(e){return i&&i(e)}))}));case 3:return a=e.sent,e.next=6,vi(5e3);case 6:return e.next=8,new Promise((function(e){(new $).parse(a,(function(t){e(t)}),(function(e){throw e}),{binary:!0,animations:a.animations})}));case 8:return o=e.sent,e.abrupt("return",o);case 10:case"end":return e.stop()}}),e)})));return function(t,n,i){return e.apply(this,arguments)}}()},{key:"exportAsGLB",value:function(){var e=(0,p.Z)((0,f.Z)().mark((function e(t){var n;return(0,f.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,new Promise((function(e){(new $).parse(t,(function(t){e(t)}),(function(e){throw e}),{binary:!0,animations:t.animations})}));case 2:return n=e.sent,e.abrupt("return",n);case 4:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}()},{key:"exportSceneAsUSDZ",value:function(){var e=(0,p.Z)((0,f.Z)().mark((function e(t){return(0,f.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",(new ti).parse(t,{}));case 1:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}()},{key:"loadFiles",value:function(e,t,n,i,r){if(t.length>0){n=n||ei(t),e.setURLModifier((function(e){e=e.replace(/^(\.?\/)/,"");var t=n[e];return t?(console.log("Loading",e),URL.createObjectURL(t)):e})),e.addHandler(/\.tga$/i,new $n.U);for(var a=0;a<t.length;a++)this.loadModelFile(e,t[a],n,i,(function(e){r&&r(e)}))}}},{key:"loadModelFile",value:function(e,t,i,r,a){var o=t.name,s=o.split(".").pop().toLowerCase(),l=new FileReader;switch(s){case"3dm":l.addEventListener("load",function(){var e=(0,p.Z)((0,f.Z)().mark((function e(t){var i,o,s,l;return(0,f.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return i=t.target.result,e.next=3,n.e(3670).then(n.bind(n,73670));case 3:o=e.sent,s=o.Rhino3dmLoader,(l=new s).setLibraryPath("/libs/rhino3dm/"),l.parse(i,(function(e){r(e)}),(function(e){a&&a(e)}));case 8:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}(),!1),l.readAsArrayBuffer(t);break;case"3ds":l.addEventListener("load",function(){var t=(0,p.Z)((0,f.Z)().mark((function t(i){var o,s,l,u;return(0,f.Z)().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.prev=0,t.next=3,n.e(6825).then(n.bind(n,26825));case 3:o=t.sent,s=o.TDSLoader,l=new s(e),u=l.parse(i.target.result),r(u),t.next=13;break;case 10:t.prev=10,t.t0=t.catch(0),a&&a(t.t0.message);case 13:case"end":return t.stop()}}),t,null,[[0,10]])})));return function(e){return t.apply(this,arguments)}}(),!1),l.readAsArrayBuffer(t);break;case"3mf":l.addEventListener("load",function(){var t=(0,p.Z)((0,f.Z)().mark((function t(i){var o,s,l,u;return(0,f.Z)().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.prev=0,t.next=3,n.e(556).then(n.bind(n,40556));case 3:o=t.sent,s=o.ThreeMFLoader,l=new s(e),u=l.parse(i.target.result),r(u),t.next=13;break;case 10:t.prev=10,t.t0=t.catch(0),a&&a(t.t0.message);case 13:case"end":return t.stop()}}),t,null,[[0,10]])})));return function(e){return t.apply(this,arguments)}}(),!1),l.readAsArrayBuffer(t);break;case"amf":l.addEventListener("load",function(){var e=(0,p.Z)((0,f.Z)().mark((function e(t){var i,o,s,l;return(0,f.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,e.next=3,n.e(8372).then(n.bind(n,18372));case 3:i=e.sent,o=i.AMFLoader,s=new o,l=s.parse(t.target.result),r(l),e.next=13;break;case 10:e.prev=10,e.t0=e.catch(0),a&&a(e.t0.message);case 13:case"end":return e.stop()}}),e,null,[[0,10]])})));return function(t){return e.apply(this,arguments)}}(),!1),l.readAsArrayBuffer(t);break;case"dae":l.addEventListener("load",function(){var t=(0,p.Z)((0,f.Z)().mark((function t(i){var s,l,u,c,h;return(0,f.Z)().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.prev=0,s=i.target.result,t.next=4,n.e(1073).then(n.bind(n,61073));case 4:l=t.sent,u=l.ColladaLoader,c=new u(e),(h=c.parse(s)).scene.name=o,r(h.scene),t.next=15;break;case 12:t.prev=12,t.t0=t.catch(0),a&&a(t.t0.message);case 15:case"end":return t.stop()}}),t,null,[[0,12]])})));return function(e){return t.apply(this,arguments)}}(),!1),l.readAsText(t);break;case"drc":l.addEventListener("load",function(){var e=(0,p.Z)((0,f.Z)().mark((function e(t){var i,s,l,u;return(0,f.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return i=t.target.result,e.next=3,Promise.resolve().then(n.bind(n,2969));case 3:s=e.sent,l=s.DRACOLoader,(u=new l).setDecoderPath("/libs/draco/"),u.parse(i,(function(e){var t;if(null!==e.index){var n=new K.Wid;(t=new K.Kj0(e,n)).name=o}else{var i=new K.UY4({size:.01});i.vertexColors=e.hasAttribute("color"),(t=new K.woe(e,i)).name=o}u.dispose(),r(t)}),(function(e){a&&a(e)}));case 8:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}(),!1),l.readAsArrayBuffer(t);break;case"fbx":l.addEventListener("load",function(){var t=(0,p.Z)((0,f.Z)().mark((function t(i){var o,s,l,u,c;return(0,f.Z)().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.prev=0,o=i.target.result,t.next=4,n.e(5306).then(n.bind(n,15306));case 4:s=t.sent,l=s.FBXLoader,u=new l(e),c=u.parse(o),r(c),t.next=14;break;case 11:t.prev=11,t.t0=t.catch(0),a&&a(t.t0.message);case 14:case"end":return t.stop()}}),t,null,[[0,11]])})));return function(e){return t.apply(this,arguments)}}(),!1),l.readAsArrayBuffer(t);break;case"gltf":l.addEventListener("load",function(){var t=(0,p.Z)((0,f.Z)().mark((function t(i){var s,l,u,c,h,d,p;return(0,f.Z)().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return s=i.target.result,t.next=3,Promise.resolve().then(n.bind(n,2969));case 3:return l=t.sent,u=l.DRACOLoader,t.next=7,Promise.resolve().then(n.bind(n,20125));case 7:c=t.sent,h=c.GLTFLoader,(d=new u).setDecoderPath("/libs/draco/gltf"),(p=new h(e)).setDRACOLoader(d),p.parse(s,"",(function(e){var t,n=e.scene;n.name=o,(t=n.animations).push.apply(t,(0,X.Z)(e.animations)),r(n),d.dispose()}),(function(e){a&&a(e)}));case 14:case"end":return t.stop()}}),t)})));return function(e){return t.apply(this,arguments)}}(),!1),l.readAsArrayBuffer(t);break;case"glb":l.addEventListener("load",function(){var e=(0,p.Z)((0,f.Z)().mark((function e(t){var i,s,l,u,c,h,d,p,A,v,g,m;return(0,f.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return i=t.target.result,e.next=3,Promise.resolve().then(n.bind(n,20125));case 3:return s=e.sent,l=s.GLTFLoader,e.next=7,Promise.resolve().then(n.bind(n,2969));case 7:return u=e.sent,c=u.DRACOLoader,e.next=11,Promise.resolve().then(n.bind(n,70995));case 11:return h=e.sent,d=h.KTX2Loader,e.next=15,n.e(5868).then(n.bind(n,65868));case 15:p=e.sent,A=p.MeshoptDecoder,(v=new c).setDecoderPath("/libs/draco/"),(g=new d).setTranscoderPath("/libs/basis/"),(m=new l).setDRACOLoader(v),m.setKTX2Loader(g),m.setMeshoptDecoder(A),m.parse(i,"",(function(e){var t,n=e.scene;n.name=o,(t=n.animations).push.apply(t,(0,X.Z)(e.animations)),r(n),v.dispose()}),(function(e){a&&a(e)}));case 26:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}(),!1),l.readAsArrayBuffer(t);break;case"ifc":l.addEventListener("load",function(){var e=(0,p.Z)((0,f.Z)().mark((function e(t){var i,s,l,u;return(0,f.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,e.next=3,n.e(4702).then(n.bind(n,84702));case 3:return i=e.sent,s=i.IFCLoader,(l=new s).ifcManager.setWasmPath("/libs/ifc"),e.next=9,l.parse(t.target.result);case 9:(u=e.sent).mesh.name=o,r(u.mesh),e.next=17;break;case 14:e.prev=14,e.t0=e.catch(0),a&&a(e.t0.message);case 17:case"end":return e.stop()}}),e,null,[[0,14]])})));return function(t){return e.apply(this,arguments)}}(),!1),l.readAsArrayBuffer(t);break;case"kmz":l.addEventListener("load",function(){var e=(0,p.Z)((0,f.Z)().mark((function e(t){var i,s,l,u;return(0,f.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,e.next=3,Promise.all([n.e(1073),n.e(9421)]).then(n.bind(n,99421));case 3:i=e.sent,s=i.KMZLoader,l=new s,(u=l.parse(t.target.result)).scene.name=o,r(u.scene),e.next=14;break;case 11:e.prev=11,e.t0=e.catch(0),a&&a(e.t0.message);case 14:case"end":return e.stop()}}),e,null,[[0,11]])})));return function(t){return e.apply(this,arguments)}}(),!1),l.readAsArrayBuffer(t);break;case"ldr":case"mpd":l.addEventListener("load",function(){var e=(0,p.Z)((0,f.Z)().mark((function e(t){var i,s,l;return(0,f.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,n.e(8216).then(n.bind(n,98216));case 2:i=e.sent,s=i.LDrawLoader,(l=new s).setPath("../../examples/models/ldraw/officialLibrary/"),l.parse(t.target.result,(function(e){e.name=o,e.rotation.x=Math.PI,r(e)}),(function(e){a&&a(e)}));case 7:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}(),!1),l.readAsText(t);break;case"obj":var u=function(i){l.addEventListener("load",function(){var t=(0,p.Z)((0,f.Z)().mark((function t(s){var l,u,c,h,d;return(0,f.Z)().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.prev=0,l=s.target.result,t.next=4,n.e(528).then(n.bind(n,50528));case 4:u=t.sent,c=u.OBJLoader,h=new c(e),i&&h.setMaterials(i),(d=h.parse(l)).name=o,r(d),t.next=16;break;case 13:t.prev=13,t.t0=t.catch(0),a&&a(t.t0.message);case 16:case"end":return t.stop()}}),t,null,[[0,13]])})));return function(e){return t.apply(this,arguments)}}(),!1),l.readAsText(t)},c=new FileReader(e);c.addEventListener("load",function(){var t=(0,p.Z)((0,f.Z)().mark((function t(i){var r,o,s;return(0,f.Z)().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.prev=0,t.next=3,n.e(2054).then(n.bind(n,42054));case 3:r=t.sent,o=r.MTLLoader,s=new o(e).parse(i.target.result),u(s),t.next=12;break;case 9:t.prev=9,t.t0=t.catch(0),a&&a(t.t0.message);case 12:case"end":return t.stop()}}),t,null,[[0,9]])})));return function(e){return t.apply(this,arguments)}}());var h=o.split(".");h.pop();var d=i[h.join(".")+".mtl"];d?c.readAsText(d):u();break;case"pcd":l.addEventListener("load",function(){var e=(0,p.Z)((0,f.Z)().mark((function e(t){var i,s,l,u;return(0,f.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,i=t.target.result,e.next=4,n.e(5331).then(n.bind(n,45331));case 4:s=e.sent,l=s.PCDLoader,(u=(new l).parse(i)).name=o,r(u),e.next=14;break;case 11:e.prev=11,e.t0=e.catch(0),a&&a(e.t0.message);case 14:case"end":return e.stop()}}),e,null,[[0,11]])})));return function(t){return e.apply(this,arguments)}}(),!1),l.readAsArrayBuffer(t);break;case"ply":l.addEventListener("load",function(){var e=(0,p.Z)((0,f.Z)().mark((function e(t){var i,s,l,u,c,h,d;return(0,f.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,i=t.target.result,e.next=4,n.e(5696).then(n.bind(n,45696));case 4:s=e.sent,l=s.PLYLoader,null!==(u=(new l).parse(i)).index?(h=new K.Wid,(c=new K.Kj0(u,h)).name=o):((d=new K.UY4({size:.01})).vertexColors=u.hasAttribute("color"),(c=new K.woe(u,d)).name=o),r(c),e.next=14;break;case 11:e.prev=11,e.t0=e.catch(0),a&&a(e.t0.message);case 14:case"end":return e.stop()}}),e,null,[[0,11]])})));return function(t){return e.apply(this,arguments)}}(),!1),l.readAsArrayBuffer(t);break;case"stl":l.addEventListener("load",function(){var e=(0,p.Z)((0,f.Z)().mark((function e(t){var i,s,l,u,c,h;return(0,f.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,i=t.target.result,e.next=4,n.e(6036).then(n.bind(n,56036));case 4:s=e.sent,l=s.STLLoader,u=(new l).parse(i),c=new K.Wid,(h=new K.Kj0(u,c)).name=o,r(h),e.next=16;break;case 13:e.prev=13,e.t0=e.catch(0),a&&a(e.t0.message);case 16:case"end":return e.stop()}}),e,null,[[0,13]])})));return function(t){return e.apply(this,arguments)}}(),!1),void 0!==l.readAsBinaryString?l.readAsBinaryString(t):l.readAsArrayBuffer(t);break;case"svg":l.addEventListener("load",function(){var e=(0,p.Z)((0,f.Z)().mark((function e(t){var i,o,s,l,u,c,h,d,p,A,v,g,m,y;return(0,f.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,i=t.target.result,e.next=4,n.e(3324).then(n.bind(n,63324));case 4:for(o=e.sent,s=o.SVGLoader,l=new s,u=l.parse(i).paths,(c=new K.ZAu).scale.multiplyScalar(.1),c.scale.y*=-1,h=0;h<u.length;h++)for(d=u[h],p=new K.vBJ({color:d.color,depthWrite:!1}),A=s.createShapes(d),v=0;v<A.length;v++)g=A[v],m=new K.oa8(g),y=new K.Kj0(m,p),c.add(y);r(c),e.next=18;break;case 15:e.prev=15,e.t0=e.catch(0),a&&a(e.t0.message);case 18:case"end":return e.stop()}}),e,null,[[0,15]])})));return function(t){return e.apply(this,arguments)}}(),!1),l.readAsText(t);break;case"usdz":l.addEventListener("load",function(){var e=(0,p.Z)((0,f.Z)().mark((function e(t){var i,s,l,u;return(0,f.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,i=t.target.result,e.next=4,n.e(8874).then(n.bind(n,68874));case 4:s=e.sent,l=s.USDZLoader,(u=(new l).parse(i)).name=o,r(u),e.next=14;break;case 11:e.prev=11,e.t0=e.catch(0),a&&a(e.t0.message);case 14:case"end":return e.stop()}}),e,null,[[0,11]])})));return function(t){return e.apply(this,arguments)}}(),!1),l.readAsArrayBuffer(t);break;case"vox":l.addEventListener("load",function(){var e=(0,p.Z)((0,f.Z)().mark((function e(t){var i,s,l,u,c;return(0,f.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,i=t.target.result,e.next=4,n.e(4997).then(n.bind(n,14997));case 4:s=e.sent,l=s.VOXLoader,u=s.VOXMesh,c=(new l).parse(i),setTimeout((function(){var e=new K.ZAu;e.name=o;for(var t=0;t<c.length;t++){var n=c[t],i=new u(n);e.add(i)}r(e)}),100),e.next=14;break;case 11:e.prev=11,e.t0=e.catch(0),a&&a(e.t0.message);case 14:case"end":return e.stop()}}),e,null,[[0,11]])})));return function(t){return e.apply(this,arguments)}}(),!1),l.readAsArrayBuffer(t);break;case"vtk":case"vtp":l.addEventListener("load",function(){var e=(0,p.Z)((0,f.Z)().mark((function e(t){var i,s,l,u,c,h;return(0,f.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,i=t.target.result,e.next=4,n.e(9712).then(n.bind(n,99712));case 4:s=e.sent,l=s.VTKLoader,u=(new l).parse(i),c=new K.Wid,(h=new K.Kj0(u,c)).name=o,r(h),e.next=16;break;case 13:e.prev=13,e.t0=e.catch(0),a&&a(e.t0.message);case 16:case"end":return e.stop()}}),e,null,[[0,13]])})));return function(t){return e.apply(this,arguments)}}(),!1),l.readAsArrayBuffer(t);break;case"wrl":l.addEventListener("load",function(){var e=(0,p.Z)((0,f.Z)().mark((function e(t){var i,o,s,l;return(0,f.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,i=t.target.result,e.next=4,n.e(5646).then(n.bind(n,35646));case 4:o=e.sent,s=o.VRMLLoader,l=(new s).parse(i),r(l),e.next=13;break;case 10:e.prev=10,e.t0=e.catch(0),a&&a(e.t0.message);case 13:case"end":return e.stop()}}),e,null,[[0,10]])})));return function(t){return e.apply(this,arguments)}}(),!1),l.readAsText(t);break;case"xyz":l.addEventListener("load",function(){var e=(0,p.Z)((0,f.Z)().mark((function e(t){var i,s,l,u,c,h;return(0,f.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,i=t.target.result,e.next=4,n.e(7520).then(n.bind(n,97520));case 4:s=e.sent,l=s.XYZLoader,u=(new l).parse(i),(c=new K.UY4).vertexColors=u.hasAttribute("color"),(h=new K.woe(u,c)).name=o,r(h),e.next=17;break;case 14:e.prev=14,e.t0=e.catch(0),a&&a(e.t0.message);case 17:case"end":return e.stop()}}),e,null,[[0,14]])})));return function(t){return e.apply(this,arguments)}}(),!1),l.readAsText(t)}}}]),e}(),mi=[".gltf",".obj",".glb",".fbx",".dae",".stl",".wrl",".xyz",".vtk",".vdp",".pcd",".ply",".svg",".usdz",".vox",".mpd",".ldr",".kmz",".drc",".3dm",".3mf",".amf",".3ds"],yi=([].concat(mi,[".mtl",".jpg",".jpeg",".jpe",".jif",".jfif",".png",".tga",".gif",".tiff",".tif",".bmp",".bin"]),n(20125)),xi=n(2969),wi=n(70995),Ci=function(){function e(t){(0,i.Z)(this,e),this.loadingManager=new K.lLk;var n=new yi.GLTFLoader(this.loadingManager);n.setCrossOrigin("anonymous");var r=new xi.DRACOLoader(this.loadingManager);r.setDecoderPath("/libs/draco/"),r.preload(),n.setDRACOLoader(r);var a=new wi.KTX2Loader;a.detectSupport(t),a.setTranscoderPath("/libs/basis/"),n.setKTX2Loader(a),this.loader=n}return(0,r.Z)(e,[{key:"revokeTextures",value:function(e){(0,yi.revokeTextureUrls)(e)}},{key:"loadFile",value:function(e,t,n){var i=this;return new Promise((function(r,a){i.loader.load(e,(function(e){r(e)}),(function(e){t&&t(parseInt(100*e.loaded/e.total))}),(function(e){console.log("error loading gltf: ".concat(e)),n&&n(e),a()}))}))}},{key:"parse",value:function(e,t){var n=this;return new Promise((function(i,r){n.loader.parse(e,"",(function(e){i(e)}),(function(e){console.log("error parsing gltf: ".concat(e)),t&&t(e),r()}))}))}}]),e}();function bi(e){return e.find((function(e){return mi.includes("."+e.name.split(".").pop().toLowerCase())}))}function _i(e,t,n,i){return Ei.apply(this,arguments)}function Ei(){return Ei=(0,p.Z)((0,f.Z)().mark((function e(t,n,i,r){var a,o,s,l,u,c;return(0,f.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(a=bi(n)){e.next=3;break}throw new Error("no valid model file found");case 3:if("glb"!==a.name.split(".").pop().toLowerCase()){e.next=9;break}(o=new FileReader).addEventListener("load",function(){var e=(0,p.Z)((0,f.Z)().mark((function e(n){var a,o,s;return(0,f.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return a=n.target.result,o=new Ci(t),e.next=4,o.parse(a,r);case 4:(s=e.sent).scene.animations=s.animations,i(s.scene);case 7:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}()),o.readAsArrayBuffer(a),e.next=19;break;case 9:return s=new gi,e.next=12,s.convertToGLB(n,void 0,(function(e){throw new Error("Failed to convert file, error: ".concat(e,". Contact support if this error persists"))}));case 12:return l=e.sent,u=new Ci(t),e.next=16,u.parse(l,r);case 16:(c=e.sent).scene.animations=c.animations,i(c.scene);case 19:case"end":return e.stop()}}),e)}))),Ei.apply(this,arguments)}var Mi=function(e){(0,a.Z)(n,e);var t=(0,o.Z)(n);function n(e){var r;return(0,i.Z)(this,n),(r=t.call(this)).files=Array.from(e),r}return(0,r.Z)(n,[{key:"name",get:function(){return"Import Folder"}},{key:"execute",value:function(){_i(Vn.world.renderer.renderer,this.files,(function(e){Vn.addObject(e)}),(function(e){x.Z.instance.notifyAll(new Kn("Error importing file - ".concat(e)))}))}},{key:"undoable",get:function(){return!1}}]),n}(Ze),Ii=function(e){(0,a.Z)(n,e);var t=(0,o.Z)(n);function n(e){var r;return(0,i.Z)(this,n),(r=t.call(this)).object=e,r}return(0,r.Z)(n,[{key:"name",get:function(){return"Add Object"}},{key:"execute",value:function(){this.sphere=Vn.addObject(this.object)}},{key:"undo",value:function(){Vn.removeObject(this.object)}},{key:"redo",value:function(){this.execute()}}]),n}(Ze),Si=function(e){(0,a.Z)(n,e);var t=(0,o.Z)(n);function n(e){var r;return(0,i.Z)(this,n),(r=t.call(this)).files=Array.from(e),r}return(0,r.Z)(n,[{key:"name",get:function(){return"Import File"}},{key:"execute",value:function(){_i(Vn.world.renderer.renderer,this.files,(function(e){new Ii(e).execute(),Vn.frameObject(Vn.project.scene)}),(function(e){x.Z.instance.notifyAll(new Kn("Error importing file - ".concat(e)))}))}},{key:"undoable",get:function(){return!1}}]),n}(Ze);function ki(e){return Bi.apply(this,arguments)}function Bi(){return(Bi=(0,p.Z)((0,f.Z)().mark((function e(t){return(0,f.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",new Promise((function(e,n){var i=new FileReader;i.addEventListener("load",(function(t){return e(t.target.result)})),i.addEventListener("error",n),i.readAsDataURL(t)})));case 1:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function Ti(e){return Di.apply(this,arguments)}function Di(){return(Di=(0,p.Z)((0,f.Z)().mark((function e(t){return(0,f.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",new Promise((function(e,n){var i=new FileReader;i.addEventListener("load",(function(t){return e(t.target.result)})),i.addEventListener("error",n),i.readAsText(t)})));case 1:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function Ri(e){return Pi.apply(this,arguments)}function Pi(){return(Pi=(0,p.Z)((0,f.Z)().mark((function e(t){return(0,f.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",new Promise((function(e,n){(new ut).load(t,(function(n){n.isHDRTexture=!0,n.dataUrl=t,n.needsUpdate=!0,e(n)}),void 0,(function(e){return n("failed to load hdr ".concat(e))}))})));case 1:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function Li(e){return Qi.apply(this,arguments)}function Qi(){return(Qi=(0,p.Z)((0,f.Z)().mark((function e(t){return(0,f.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",new Promise((function(e,n){(new $n.U).load(t,(function(n){n.colorSpace=K.KI_,n.dataUrl=t,n.needsUpdate=!0,e(n)}),void 0,(function(e){return n("failed to load tga ".concat(e))}))})));case 1:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function Zi(e){return Ni.apply(this,arguments)}function Ni(){return(Ni=(0,p.Z)((0,f.Z)().mark((function e(t){return(0,f.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",new Promise((function(e){var n=document.createElement("img");n.addEventListener("load",(function(){var n=new K.xEZ(this);n.dataUrl=t,n.needsUpdate=!0,e(n)}),!1),n.src=t})));case 1:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function Fi(e){return Ui.apply(this,arguments)}function Ui(){return(Ui=(0,p.Z)((0,f.Z)().mark((function e(t){var n;return(0,f.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,ki(t);case 2:return n=e.sent,e.abrupt("return",Ri(n));case 4:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function ji(e){return Oi.apply(this,arguments)}function Oi(){return(Oi=(0,p.Z)((0,f.Z)().mark((function e(t){var n,i,r,a,o,s,l;return(0,f.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if("hdr"!==(n=t.name.split(".").pop().toLowerCase())&&"pic"!==n){e.next=11;break}return e.next=4,ki(t);case 4:return i=e.sent,e.next=7,Ri(i);case 7:return r=e.sent,e.abrupt("return",r);case 11:if("tga"!==n){e.next=21;break}return e.next=14,ki(t);case 14:return a=e.sent,e.next=17,Li(a);case 17:return o=e.sent,e.abrupt("return",o);case 21:if(!t.type.match("image.*")){e.next=29;break}return e.next=24,ki(t);case 24:return s=e.sent,e.next=27,Zi(s);case 27:return l=e.sent,e.abrupt("return",l);case 29:case"end":return e.stop()}}),e)})))).apply(this,arguments)}var zi=n(71617);function Gi(){return Gi=(0,p.Z)((0,f.Z)().mark((function e(t,n){var i;return(0,f.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:(i=new FileReader).addEventListener("load",function(){var e=(0,p.Z)((0,f.Z)().mark((function e(t){var i;return(0,f.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:i=(0,zi.GZ)(new Uint8Array(t.target.result)),n(i);case 2:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}()),i.readAsArrayBuffer(t);case 3:case"end":return e.stop()}}),e)}))),Gi.apply(this,arguments)}var Hi,Vi=function(){function e(){(0,i.Z)(this,e)}return(0,r.Z)(e,[{key:"deserializeAnimations",value:function(e){e.traverse((function(e){e.userData.animations&&(e.animations=[],e.userData.animations.forEach((function(t){e.animations.push(K.m7l.parse(t))})))}))}},{key:"getSceneRoot",value:function(e){return e.name.startsWith("AuxScene")&&1==e.children.length?this.getSceneRoot(e.children[0]):e}},{key:"load",value:function(e,t,n){var i=this;try{var r,a,o;!function(e,t){Gi.apply(this,arguments)}(e,function(){var e=(0,p.Z)((0,f.Z)().mark((function e(s){var l,u,c,h,d,p,A;return(0,f.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:e.t0=(0,f.Z)().keys(s);case 1:if((e.t1=e.t0()).done){e.next=34;break}if(l=e.t1.value,!Object.hasOwnProperty.call(s,l)){e.next=32;break}if(u=s[l],"scene.glb"!==l){e.next=16;break}return c=new Ci(Vn.world.renderer.renderer),e.next=9,c.parse(u.buffer,n);case 9:for(h=e.sent,a=h.scene;a.name.startsWith("AuxScene")&&1===a.children.length;)a=a.children[0];a.parent&&a.removeFromParent(),i.deserializeAnimations(a),e.next=32;break;case 16:if("envmap.hdr"!==l){e.next=25;break}return d=new Blob([u.buffer]),e.next=20,Fi(d);case 20:(o=e.sent).dataUrl=URL.createObjectURL(d),o.mapping=K.dSO,e.next=32;break;case 25:if("settings.json"!==l){e.next=32;break}return p=new Blob([u.buffer]),e.next=29,Ti(p);case 29:A=e.sent,(r=new Fn).state=JSON.parse(A);case 32:e.next=1;break;case 34:a||(a=new K.Tme),r||(r=new Fn),t({scene:a,settings:r,envMap:o});case 37:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}())}catch(s){n&&n("An error occured loading the project file")}}}]),e}(),Wi=function(e){(0,a.Z)(n,e);var t=(0,o.Z)(n);function n(e){var r;return(0,i.Z)(this,n),(r=t.call(this)).file=e,r}return(0,r.Z)(n,[{key:"name",get:function(){return"Import Project"}},{key:"execute",value:function(){try{(new Vi).load(this.file,(function(e){var t=new Zn(e.scene,e.settings);e.envMap&&Vn.world.setEnvironmentMap(e.envMap),t.envMap=e.envMap,Vn.project=t,x.Z.instance.notifyAll(new D),Vn.frameScene()}),(function(e){return x.Z.instance.notifyAll(new Kn(e))}))}catch(e){x.Z.instance.notifyAll(new Kn("An error occured loading the project file"))}}},{key:"undoable",get:function(){return!1}}]),n}(Ze),qi=function(e){(0,a.Z)(n,e);var t=(0,o.Z)(n);function n(){return(0,i.Z)(this,n),t.call(this)}return(0,r.Z)(n,[{key:"name",get:function(){return"New Project"}},{key:"undoable",get:function(){return!1}},{key:"execute",value:function(){Vn.newProject()}}]),n}(Ze),Yi=function(e){(0,a.Z)(n,e);var t=(0,o.Z)(n);function n(){return(0,i.Z)(this,n),t.call(this)}return(0,r.Z)(n,[{key:"execute",value:function(){var e=(0,p.Z)((0,f.Z)().mark((function e(){return(0,f.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:(new Yn).export("publish.zip",Vn.project,!1);case 1:case"end":return e.stop()}}),e)})));return function(){return e.apply(this,arguments)}}()},{key:"undoable",get:function(){return!1}}]),n}(Ze),Ji=function(){function e(){(0,i.Z)(this,e)}return(0,r.Z)(e,[{key:"execute",value:function(e){var t;switch(e){case"new project":t=new qi;break;case"import file":t=new Si(arguments.length<=1?void 0:arguments[1]);break;case"import dir":t=new Mi(arguments.length<=1?void 0:arguments[1]);break;case"import project":t=new Wi(arguments.length<=1?void 0:arguments[1]);break;case"export glb":t=new Wn("scene.glb");break;case"export project":t=new Jn(arguments.length<=1?void 0:arguments[1]);break;case"publish":return(new Yi).execute(),void new Wn("publish.glb").execute()}t&&Q.execute(t)}}]),e}(),Xi=function(e){(0,a.Z)(n,e);var t=(0,o.Z)(n);function n(){return(0,i.Z)(this,n),t.call(this)}return(0,r.Z)(n,[{key:"name",get:function(){return"Delete Object"}},{key:"execute",value:function(){this.object=Vn.selectedObject,this.object&&Vn.removeObject(this.object)}},{key:"undo",value:function(){this.object&&Vn.addObject(this.object)}},{key:"redo",value:function(){this.execute()}}]),n}(Ze),Ki=function(e){(0,a.Z)(n,e);var t=(0,o.Z)(n);function n(e){var r;return(0,i.Z)(this,n),(r=t.call(this)).originalMode=Vn.getObjectTransformMode(),r.mode=e,r}return(0,r.Z)(n,[{key:"name",get:function(){return"Select Transform Mode"}},{key:"execute",value:function(){Vn.setObjectTransformMode(this.mode)}},{key:"undoable",get:function(){return!1}}]),n}(Ze),$i=function(){function e(){(0,i.Z)(this,e)}return(0,r.Z)(e,[{key:"execute",value:function(e){var t;switch(e){case"undo":Q.undo();break;case"redo":Q.redo();break;case"translate":t=new Ki("translate");break;case"rotate":t=new Ki("rotate");break;case"scale":t=new Ki("scale");break;case"delete":t=new Xi}t&&Q.execute(t)}}]),e}(),er=function(e){(0,a.Z)(n,e);var t=(0,o.Z)(n);function n(e){var r;return(0,i.Z)(this,n),(r=t.call(this)).type=e,r}return(0,r.Z)(n,[{key:"name",get:function(){return"Add "+this.type}},{key:"execute",value:function(){switch(this.type){case"DirectionalLight":this.light=Vn.addDirectionalLight();break;case"PointLight":this.light=Vn.addPointLight();break;case"SpotLight":this.light=Vn.addSpotLight();break;case"HemisphereLight":this.light=Vn.addHemisphereLight()}this.light&&Vn.selectObject(this.light)}},{key:"undo",value:function(){Vn.removeObject(this.object)}},{key:"redo",value:function(){Vn.addObject(this.object)}}]),n}(Ze),tr=function(e){(0,a.Z)(n,e);var t=(0,o.Z)(n);function n(e){var r;return(0,i.Z)(this,n),(r=t.call(this)).type=e,r}return(0,r.Z)(n,[{key:"name",get:function(){return"Add "+this.type}},{key:"execute",value:function(){switch(this.type){case"Sphere":this.object=function(){var e=new K.xo$,t=new K.Wid;return new K.Kj0(e,t)}();break;case"Box":this.object=Qn();break;case"Cylinder":this.object=function(){var e=new K.fHI,t=new K.Wid;return new K.Kj0(e,t)}();break;case"Torus":this.object=function(){var e=new K.XvJ,t=new K.Wid;return new K.Kj0(e,t)}();break;case"Capsule":this.object=function(){var e=new K.BVQ,t=new K.Wid;return new K.Kj0(e,t)}();break;case"Tetrahedron":this.object=function(){var e=new K.H$k,t=new K.Wid;return new K.Kj0(e,t)}();break;case"Icosahedron":this.object=function(){var e=new K.cJO,t=new K.Wid;return new K.Kj0(e,t)}();break;case"Dodecahedron":this.object=function(){var e=new K.Kgo,t=new K.Wid;return new K.Kj0(e,t)}();break;case"Lathe":this.object=function(){var e=new K.p7y,t=new K.Wid;return new K.Kj0(e,t)}();break;case"Plane":this.object=function(){var e=new K._12,t=new K.Wid;return new K.Kj0(e,t)}();break;case"Circle":this.object=function(){var e=new K.zf8,t=new K.Wid;return new K.Kj0(e,t)}();break;case"Ring":this.object=function(){var e=new K.o8S,t=new K.Wid;return new K.Kj0(e,t)}();break;case"Tube":this.object=function(){var e=new K.WXh,t=new K.Wid;return new K.Kj0(e,t)}()}this.object&&(Vn.addObject(this.object),Vn.selectObject(this.object))}},{key:"undo",value:function(){Vn.removeObject(this.object)}},{key:"redo",value:function(){Vn.addObject(this.object)}}]),n}(Ze),nr=function(){function e(){(0,i.Z)(this,e)}return(0,r.Z)(e,[{key:"execute",value:function(e){var t,n=e.split(".")[0],i=e.split(".")[1];switch(n){case"primitive":t=new tr(i);break;case"light":t=new er(i)}t&&Q.execute(t)}}]),e}(),ir=function(){function e(t){(0,i.Z)(this,e),this._id=t}return(0,r.Z)(e,[{key:"renderButton",value:function(e,t,n){return(0,c.jsx)("button",{className:e?"active":"",onClick:function(){return t&&t()},children:this.renderButtonIcon()},n)}},{key:"id",get:function(){return this._id}},{key:"renderContent",value:function(){return null}}]),e}(),rr=n(16608),ar=["title","titleId"];function or(){return or=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var n=arguments[t];for(var i in n)Object.prototype.hasOwnProperty.call(n,i)&&(e[i]=n[i])}return e},or.apply(this,arguments)}function sr(e,t){if(null==e)return{};var n,i,r=function(e,t){if(null==e)return{};var n,i,r={},a=Object.keys(e);for(i=0;i<a.length;i++)n=a[i],t.indexOf(n)>=0||(r[n]=e[n]);return r}(e,t);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(e);for(i=0;i<a.length;i++)n=a[i],t.indexOf(n)>=0||Object.prototype.propertyIsEnumerable.call(e,n)&&(r[n]=e[n])}return r}function lr(e,t){var n=e.title,i=e.titleId,r=sr(e,ar);return s.createElement("svg",or({id:"Layer_1",xmlns:"http://www.w3.org/2000/svg",xmlnsXlink:"http://www.w3.org/1999/xlink",x:"0px",y:"0px",viewBox:"0 0 122.88 122.25",style:{enableBackground:"new 0 0 122.88 122.25"},xmlSpace:"preserve",ref:t,"aria-labelledby":i},r),n?s.createElement("title",{id:i},n):null,Hi||(Hi=s.createElement("g",null,s.createElement("path",{d:"M122.57,29.25l0.31,62.88c0.01,3.28-2.05,6.1-5,7.29l0.01,0.01l-54.64,22.09c-0.99,0.4-2.05,0.6-3.12,0.6 c-0.11,0-0.22,0-0.33-0.01c-0.47,0.08-0.95,0.13-1.42,0.13c-1.06,0-2.11-0.21-3.08-0.62L4.94,100.46l0-0.01 C2.03,99.22-0.01,96.32,0,92.94l0.3-62.08c-0.04-0.66,0-1.33,0.12-1.99c0.02-0.95,0.22-1.88,0.58-2.76 c0.84-2.04,2.47-3.55,4.42-4.33l0-0.01L57.98,0.6c2.14-0.86,4.44-0.77,6.4,0.07l52.47,18.97c3.14,1.13,5.13,3.96,5.27,7.01 C122.41,27.49,122.57,28.37,122.57,29.25L122.57,29.25z M51.51,108.46l0.39-54.77L9.82,35.5L8.93,90.49L51.51,108.46L51.51,108.46 L51.51,108.46z M113.58,35.5L66.55,53.7l0.37,54.71l46.94-17.54L113.58,35.5L113.58,35.5L113.58,35.5z"}))))}var ur=s.forwardRef(lr),cr=(n.p,n(27752)),hr=n(75566),dr=n(24076),fr=n(85247),pr=function(e){(0,a.Z)(n,e);var t=(0,o.Z)(n);function n(){var e;return(0,i.Z)(this,n),(e=t.call(this)).canvasRef=s.createRef(),e}return(0,r.Z)(n,[{key:"componentDidUpdate",value:function(e){this.props.texture!==e.texture&&this.canvasRef.current&&this.drawImage(this.props.texture)}},{key:"componentDidMount",value:function(){this.props.texture&&this.drawImage(this.props.texture)}},{key:"renderToCanvas",value:function(e){var t=new K.CP7;t.setSize(e.image.width,e.image.height,!1);var n=new K.xsS,i=new K.iKG(-1,1,1,-1,0,1),r=new K.vBJ({map:e}),a=new K._12(2,2),o=new K.Kj0(a,r);return n.add(o),t.render(n,i),t.domElement}},{key:"drawImage",value:function(e){this.texture=e;var t=this.canvasRef.current.getContext("2d");if(t&&(t.clearRect(0,0,this.canvasRef.current.width,this.canvasRef.current.height),e)){var n=e.image;if(n&&n.width>0){var i=this.canvasRef.current.width/n.width;if(void 0===n.data)t.drawImage(n,0,0,n.width*i,n.height*i);else{var r=this.renderToCanvas(e);t.drawImage(r,0,0,n.width*i,n.height*i)}}}}},{key:"render",value:function(){return(0,c.jsx)("canvas",{ref:this.canvasRef,onClick:this.props.onClick,style:{width:"50px",height:"50px",border:"1px solid #000",margin:"2px",display:"block"}})}}]),n}(s.Component),Ar=n(30014),vr=function(e){(0,a.Z)(n,e);var t=(0,o.Z)(n);function n(){var e;return(0,i.Z)(this,n),(e=t.call(this)).inputRef=s.createRef(),e.onfileSelected=e.onfileSelected.bind((0,y.Z)(e)),e}return(0,r.Z)(n,[{key:"onfileSelected",value:function(){var e=(0,p.Z)((0,f.Z)().mark((function e(t){var n;return(0,f.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,ji(t.target.files[0]);case 2:n=e.sent,this.props.onChange(n);case 4:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()},{key:"render",value:function(){var e=this;return(0,c.jsxs)("div",{onClick:function(){return e.inputRef.current.click()},style:{display:"flex"},children:[(0,c.jsx)(pr,{texture:this.props.texture}),(0,c.jsx)(Ar.Z,{style:{fontSize:"14px"},onClick:function(t){e.props.onDelete(),t.stopPropagation()}}),(0,c.jsx)("input",{ref:this.inputRef,type:"file",style:{display:"none"},onChange:this.onfileSelected})]})}}]),n}(s.Component),gr=function(e){(0,a.Z)(n,e);var t=(0,o.Z)(n);function n(){var e;return(0,i.Z)(this,n),(e=t.call(this)).state={},e}return(0,r.Z)(n,[{key:"render",value:function(){var e=this;if(this.props.viewModel&&0!==Object.keys(this.state).length)return(0,c.jsxs)("div",{className:"material-pane",children:[(0,c.jsxs)("div",{className:"flexrow",children:[(0,c.jsx)("div",{className:"flexcol",children:"Color"}),(0,c.jsx)("div",{className:"flexcol",children:(0,c.jsx)(hr.ZP,{title:"Select Color",children:(0,c.jsx)("input",{type:"color",value:this.state.color,onChange:this.props.viewModel.onColorChanged})})})]}),(0,c.jsxs)("div",{className:"flexrow",children:[(0,c.jsx)("div",{className:"flexcol",children:"Emissive Color"}),(0,c.jsx)("div",{className:"flexcol",children:(0,c.jsx)(hr.ZP,{title:"Select Emissive Color",children:(0,c.jsx)("input",{type:"color",value:this.state.emissive,onChange:this.props.viewModel.onEmissiveChanged})})})]}),(0,c.jsxs)("div",{className:"flexrow",children:[(0,c.jsx)("div",{className:"flexcol",children:"Roughness"}),(0,c.jsx)("div",{className:"flexcol",children:(0,c.jsx)(dr.Z,{value:this.state.roughness,onChange:function(t,n){return e.props.viewModel.onRoughnessChanged(n)}})})]}),(0,c.jsxs)("div",{className:"flexrow",children:[(0,c.jsx)("div",{className:"flexcol",children:"Metalness"}),(0,c.jsx)("div",{className:"flexcol",children:(0,c.jsx)(dr.Z,{value:this.state.metalness,onChange:function(t,n){return e.props.viewModel.onMetalnessChanged(n)}})})]}),(0,c.jsxs)("div",{style:{display:"flex",justifyContent:"left",alignItems:"center"},children:[(0,c.jsx)("div",{className:"flexcol",children:"Transparent"}),(0,c.jsx)("div",{className:"flexcol",children:(0,c.jsx)(fr.Z,{checked:this.state.transparent,onChange:function(t,n){return e.props.viewModel.onTransparentChanged(n)}})})]}),(0,c.jsxs)("div",{className:"flexrow",children:[(0,c.jsx)("div",{className:"flexcol",children:"Opacity"}),(0,c.jsx)("div",{className:"flexcol",children:(0,c.jsx)(dr.Z,{value:this.state.opacity,onChange:function(t,n){return e.props.viewModel.onOpacityChanged(n)}})})]}),(0,c.jsxs)("div",{style:{display:"flex",justifyContent:"left",alignItems:"center"},children:[(0,c.jsx)("div",{className:"flexcol",children:"Depth Test"}),(0,c.jsx)("div",{className:"flexcol",children:(0,c.jsx)(fr.Z,{checked:this.state.depthTest,onChange:function(t,n){return e.props.viewModel.onDepthTestChanged(n)}})})]}),(0,c.jsxs)("div",{style:{display:"flex",justifyContent:"left",alignItems:"center"},children:[(0,c.jsx)("div",{className:"flexcol",children:"Depth Write"}),(0,c.jsx)("div",{className:"flexcol",children:(0,c.jsx)(fr.Z,{checked:this.state.depthWrite,onChange:function(t,n){return e.props.viewModel.onDepthWriteChanged(n)}})})]}),(0,c.jsxs)("div",{className:"flexrow",children:[(0,c.jsx)("div",{className:"flexcol",children:"Map"}),(0,c.jsx)("div",{className:"flexcol",children:(0,c.jsx)(vr,{texture:this.state.map,onChange:function(t){return e.props.viewModel.onMapChanged(t,"map")},onDelete:function(){return e.props.viewModel.onMapDelete("map")}})})]}),(0,c.jsxs)("div",{className:"flexrow",children:[(0,c.jsx)("div",{className:"flexcol",children:"Bump Map"}),(0,c.jsx)("div",{className:"flexcol",children:(0,c.jsx)(vr,{texture:this.state.bumpMap,onChange:function(t){return e.props.viewModel.onMapChanged(t,"bumpMap")},onDelete:function(){return e.props.viewModel.onMapDelete("bumpMap")}})})]}),(0,c.jsxs)("div",{className:"flexrow",children:[(0,c.jsx)("div",{className:"flexcol",children:"Displacement Map"}),(0,c.jsx)("div",{className:"flexcol",children:(0,c.jsx)(vr,{texture:this.state.displacementMap,onChange:function(t){return e.props.viewModel.onMapChanged(t,"displacementMap")},onDelete:function(){return e.props.viewModel.onMapDelete("displacementMap")}})})]}),(0,c.jsxs)("div",{className:"flexrow",children:[(0,c.jsx)("div",{className:"flexcol",children:"AO Map"}),(0,c.jsx)("div",{className:"flexcol",children:(0,c.jsx)(vr,{texture:this.state.aoMap,onChange:function(t){return e.props.viewModel.onMapChanged(t,"aoMap")},onDelete:function(){return e.props.viewModel.onMapDelete("aoMap")}})})]}),(0,c.jsxs)("div",{className:"flexrow",children:[(0,c.jsx)("div",{className:"flexcol",children:"Emissive Map"}),(0,c.jsx)("div",{className:"flexcol",children:(0,c.jsx)(vr,{texture:this.state.emissiveMap,onChange:function(t){return e.props.viewModel.onMapChanged(t,"emissiveMap")},onDelete:function(){return e.props.viewModel.onMapDelete("emissiveMap")}})})]}),(0,c.jsxs)("div",{className:"flexrow",children:[(0,c.jsx)("div",{className:"flexcol",children:"Environment Map"}),(0,c.jsx)("div",{className:"flexcol",children:(0,c.jsx)(vr,{texture:this.state.envMap,onChange:function(t){return e.props.viewModel.onMapChanged(t,"envMap")},onDelete:function(){return e.props.viewModel.onMapDelete("envMap")}})})]}),(0,c.jsxs)("div",{className:"flexrow",children:[(0,c.jsx)("div",{className:"flexcol",children:"Metalness Map"}),(0,c.jsx)("div",{className:"flexcol",children:(0,c.jsx)(vr,{texture:this.state.metalnessMap,onChange:function(t){return e.props.viewModel.onMapChanged(t,"metalnessMap")},onDelete:function(){return e.props.viewModel.onMapDelete("metalnessMap")}})})]})," ",(0,c.jsxs)("div",{className:"flexrow",children:[(0,c.jsx)("div",{className:"flexcol",children:"Normal Map"}),(0,c.jsx)("div",{className:"flexcol",children:(0,c.jsx)(vr,{texture:this.state.normalMap,onChange:function(t){return e.props.viewModel.onMapChanged(t,"normalMap")},onDelete:function(){return e.props.viewModel.onMapDelete("normalMap")}})})]})," ",(0,c.jsxs)("div",{className:"flexrow",children:[(0,c.jsx)("div",{className:"flexcol",children:"Roughness Map"}),(0,c.jsx)("div",{className:"flexcol",children:(0,c.jsx)(vr,{texture:this.state.roughnessMap,onChange:function(t){return e.props.viewModel.onMapChanged(t,"roughnessMap")},onDelete:function(){return e.props.viewModel.onMapDelete("roughnessMap")}})})]}),(0,c.jsxs)("div",{className:"flexrow",children:[(0,c.jsx)("div",{className:"flexcol",children:"Light Map"}),(0,c.jsx)("div",{className:"flexcol",children:(0,c.jsx)(vr,{texture:this.state.lightMap,onChange:function(t){return e.props.viewModel.onMapChanged(t,"lightMap")},onDelete:function(){return e.props.viewModel.onMapDelete("lightMap")}})})]}),(0,c.jsx)("br",{})]})}}]),n}(s.Component),mr=function(e){(0,a.Z)(n,e);var t=(0,o.Z)(n);function n(){var e;return(0,i.Z)(this,n),(e=t.call(this)).state={},e}return(0,r.Z)(n,[{key:"render",value:function(){if(this.props.viewModel&&0!==Object.keys(this.state).length)return(0,c.jsx)(s.Fragment,{children:(0,c.jsxs)("div",{className:"editor-pane",children:[(0,c.jsx)(cr.Z,{label:"Field of View",value:this.state.fov,name:"fov",style:{maxWidth:"200px"},inputProps:{min:20,max:90},onKeyUp:this.props.viewModel.onPropertyBlur,onBlur:this.props.viewModel.onPropertyBlur,onChange:this.props.viewModel.onPropertyChanged}),(0,c.jsx)(cr.Z,{label:"Near Plane",value:this.state.near,name:"near",style:{maxWidth:"200px"},onKeyUp:this.props.viewModel.onPropertyBlur,onBlur:this.props.viewModel.onPropertyBlur,onChange:this.props.viewModel.onPropertyChanged}),(0,c.jsx)(cr.Z,{label:"Far Plane",value:this.state.far,name:"far",style:{maxWidth:"200px"},onKeyUp:this.props.viewModel.onPropertyBlur,onBlur:this.props.viewModel.onPropertyBlur,onChange:this.props.viewModel.onPropertyChanged})]})})}}]),n}(s.Component),yr=function(e){(0,a.Z)(n,e);var t=(0,o.Z)(n);function n(){var e;return(0,i.Z)(this,n),(e=t.call(this)).state={},e}return(0,r.Z)(n,[{key:"render",value:function(){var e=this;if(this.props.viewModel&&0!==Object.keys(this.state).length)return(0,c.jsxs)(s.Fragment,{children:[(0,c.jsxs)("div",{children:["Button Text\xa0",(0,c.jsx)(cr.Z,{value:this.state.buttonText,style:{width:"100px",marginRight:"2px"},onChange:function(t){return e.props.viewModel.onPropertyChanged("buttonText",t.target.value)}})]}),(0,c.jsxs)("div",{className:"editor-pane",children:["Label Text",(0,c.jsx)("textarea",{className:"annotation-box-textinput",multiline:!0,rows:"3",value:this.state.labelText,onChange:function(t){return e.props.viewModel.onPropertyChanged("labelText",t.target.value)}})]})]})}}]),n}(s.Component),xr=n(29536),wr=n(37714),Cr=n(74368),br=function(e){(0,a.Z)(n,e);var t=(0,o.Z)(n);function n(){var e;return(0,i.Z)(this,n),(e=t.call(this)).state={},e}return(0,r.Z)(n,[{key:"render",value:function(){var e,t,n,i=this;return null!==(e=this.state)&&void 0!==e&&null!==(t=e.clipsState)&&void 0!==t&&null!==(n=t.clips)&&void 0!==n&&n.length&&this.props.viewModel?(0,c.jsxs)(s.Fragment,{children:[(0,c.jsx)("div",{className:"editor-sidebar-heading",children:"Animations"}),(0,c.jsx)("table",{className:"animations-table",children:this.state.clipsState.clips.map((function(e,t){return(0,c.jsxs)("tr",{children:[(0,c.jsx)("td",{children:e.name}),(0,c.jsxs)("td",{children:[e.duration.toFixed(2),"s"]}),(0,c.jsx)("td",{children:e.playing?(0,c.jsx)(wr.Z,{onClick:function(){return i.props.viewModel.stopClip(t)},size:"small"}):(0,c.jsx)(xr.Z,{onClick:function(){return i.props.viewModel.playClip(t)},size:"small"})}),(0,c.jsx)("td",{children:(0,c.jsx)(Cr.Z,{style:{opacity:e.loop?"1.0":"0.5"},onClick:function(){return i.props.viewModel.toggleLoop(t)}})})]},t)}))})]}):null}}]),n}(s.Component),_r=function(e){(0,a.Z)(n,e);var t=(0,o.Z)(n);function n(){var e;return(0,i.Z)(this,n),(e=t.call(this)).state={},e}return(0,r.Z)(n,[{key:"render",value:function(){if(this.props.viewModel&&0!==Object.keys(this.state).length&&this.props.viewModel.light)return(0,c.jsxs)(s.Fragment,{children:[(0,c.jsxs)("div",{className:"flexrow",children:[(0,c.jsx)("div",{className:"flexcol",children:"Color"}),(0,c.jsx)("div",{className:"flexcol",children:(0,c.jsx)(hr.ZP,{title:"Select Color",children:(0,c.jsx)("input",{type:"color",name:"color",value:this.state.color,onChange:this.props.viewModel.onPropChanged})})})]}),(0,c.jsxs)("div",{children:["Intensity\xa0",(0,c.jsx)(cr.Z,{value:this.state.intensity,name:"intensity",type:"number",style:{width:"100px",marginRight:"2px"},onChange:this.props.viewModel.onPropChanged})]}),this.state.isSpotlight&&(0,c.jsxs)("div",{children:["Spot Angle\xa0",(0,c.jsx)(cr.Z,{value:this.state.angle,name:"angle",type:"number",style:{width:"100px",marginRight:"2px"},onChange:this.props.viewModel.onPropChanged})]})]})}}]),n}(s.Component),Er=function(e){(0,a.Z)(n,e);var t=(0,o.Z)(n);function n(){var e;return(0,i.Z)(this,n),(e=t.call(this)).state={},e}return(0,r.Z)(n,[{key:"render",value:function(){var e=this;if(this.props.viewModel&&0!==Object.keys(this.state).length&&this.props.viewModel.object)return(0,c.jsx)("div",{children:(0,c.jsxs)("div",{className:"editor-pane",children:[(0,c.jsxs)("div",{className:"editor-sidebar-heading",children:[this.state.type+" "," Properties"]}),(0,c.jsx)("div",{className:"flexrow",children:"Name"}),(0,c.jsx)(cr.Z,{value:this.state.name,style:{width:"250px",marginRight:"2px"},onChange:function(t){return e.props.viewModel.onNameChanged(t,"x")}}),(0,c.jsx)("div",{className:"flexrow",children:"Position"}),(0,c.jsxs)("div",{className:"flexrow",children:[(0,c.jsxs)("div",{children:["x\xa0",(0,c.jsx)(cr.Z,{value:this.state.xPos,type:"number",style:{width:"100px",marginRight:"2px"},onChange:function(t){return e.props.viewModel.onPositionChanged(t,"x")},onBlur:function(t){return e.props.viewModel.onPositionBlur(t,"x")},onKeyUp:function(t){return e.props.viewModel.onPositionBlur(t,"x")}})]}),(0,c.jsxs)("div",{children:["y\xa0",(0,c.jsx)(cr.Z,{value:this.state.yPos,type:"number",style:{width:"100px",marginRight:"2px"},onChange:function(t){return e.props.viewModel.onPositionChanged(t,"y")},onBlur:function(t){return e.props.viewModel.onPositionBlur(t,"y")},onKeyUp:function(t){return e.props.viewModel.onPositionBlur(t,"y")}})]}),(0,c.jsxs)("div",{children:["z\xa0",(0,c.jsx)(cr.Z,{value:this.state.zPos,type:"number",style:{width:"100px",marginRight:"2px"},onChange:function(t){return e.props.viewModel.onPositionChanged(t,"z")},onBlur:function(t){return e.props.viewModel.onPositionBlur(t,"z")},onKeyUp:function(t){return e.props.viewModel.onPositionBlur(t,"z")}})]})]}),(0,c.jsx)("div",{className:"flexrow",children:"Rotation"}),(0,c.jsxs)("div",{className:"flexrow",children:[(0,c.jsxs)("div",{children:["x\xa0",(0,c.jsx)(cr.Z,{value:this.state.xRot,type:"number",style:{width:"100px",marginRight:"2px"},onChange:function(t){return e.props.viewModel.onRotationChanged(t,"x")},onBlur:function(t){return e.props.viewModel.onRotationBlur(t,"x")},onKeyUp:function(t){return e.props.viewModel.onRotationBlur(t,"x")}})]}),(0,c.jsxs)("div",{children:["y\xa0",(0,c.jsx)(cr.Z,{value:this.state.yRot,type:"number",style:{width:"100px",marginRight:"2px"},onChange:function(t){return e.props.viewModel.onRotationChanged(t,"y")},onBlur:function(t){return e.props.viewModel.onRotationBlur(t,"y")},onKeyUp:function(t){return e.props.viewModel.onRotationBlur(t,"y")}})]}),(0,c.jsxs)("div",{children:["z\xa0",(0,c.jsx)(cr.Z,{value:this.state.zRot,type:"number",style:{width:"100px",marginRight:"2px"},onChange:function(t){return e.props.viewModel.onRotationChanged(t,"z")},onBlur:function(t){return e.props.viewModel.onRotationBlur(t,"z")},onKeyUp:function(t){return e.props.viewModel.onRotationBlur(t,"z")}})]})]}),(0,c.jsx)("div",{className:"flexrow",children:"Scale"}),(0,c.jsxs)("div",{className:"flexrow",children:[(0,c.jsxs)("div",{children:["x\xa0",(0,c.jsx)(cr.Z,{value:this.state.xScale,type:"number",style:{width:"100px",marginRight:"2px"},onChange:function(t){return e.props.viewModel.onScaleChanged(t,"x")},onBlur:function(t){return e.props.viewModel.onScaleBlur(t,"x")},onKeyUp:function(t){return e.props.viewModel.onScaleBlur(t,"x")}})]}),(0,c.jsxs)("div",{children:["y\xa0",(0,c.jsx)(cr.Z,{value:this.state.yScale,type:"number",style:{width:"100px",marginRight:"2px"},onChange:function(t){return e.props.viewModel.onScaleChanged(t,"y")},onBlur:function(t){return e.props.viewModel.onScaleBlur(t,"y")},onKeyUp:function(t){return e.props.viewModel.onScaleBlur(t,"y")}})]}),(0,c.jsxs)("div",{children:["z\xa0",(0,c.jsx)(cr.Z,{value:this.state.zScale,type:"number",style:{width:"100px",marginRight:"2px"},onChange:function(t){return e.props.viewModel.onScaleChanged(t,"z")},onBlur:function(t){return e.props.viewModel.onScaleBlur(t,"z")},onKeyUp:function(t){return e.props.viewModel.onScaleBlur(t,"z")}})]})]}),(0,c.jsx)(g.Z,{}),(0,c.jsx)("br",{}),"Mesh"===this.state.type&&this.props.viewModel.materialViewModel&&(0,c.jsxs)("div",{className:"flexrow",children:[(0,c.jsx)("div",{className:"editor-sidebar-heading",children:"Material"}),(0,c.jsx)(gr,{ref:this.props.viewModel.materialViewModel.updateViewState,viewModel:this.props.viewModel.materialViewModel})]}),"Camera"===this.state.type&&(0,c.jsx)(mr,{ref:this.props.viewModel.cameraViewModel.updateViewState,viewModel:this.props.viewModel.cameraViewModel}),"Points"===this.state.type&&(0,c.jsx)(yr,{ref:this.props.viewModel.annotationViewModel.updateViewState,viewModel:this.props.viewModel.annotationViewModel}),"Light"===this.state.type&&(0,c.jsx)(_r,{ref:this.props.viewModel.lightViewModel.updateViewState,viewModel:this.props.viewModel.lightViewModel}),(0,c.jsx)(br,{ref:this.props.viewModel.animationsViewModel.updateViewState,viewModel:this.props.viewModel.animationsViewModel})]})})}}]),n}(s.Component),Mr=n(4942),Ir=function(){function e(){(0,i.Z)(this,e),this.updateViewState=this.updateViewState.bind(this),this.onColorChanged=this.onColorChanged.bind(this),this.onEmissiveChanged=this.onEmissiveChanged.bind(this),this.onRoughnessChanged=this.onRoughnessChanged.bind(this),this.onMetalnessChanged=this.onMetalnessChanged.bind(this),this.onOpacityChanged=this.onOpacityChanged.bind(this),this.onTransparentChanged=this.onTransparentChanged.bind(this),this.onDepthTestChanged=this.onDepthTestChanged.bind(this),this.onDepthWriteChanged=this.onDepthWriteChanged.bind(this),this.onMapChanged=this.onMapChanged.bind(this),this.onMapDelete=this.onMapDelete.bind(this)}return(0,r.Z)(e,[{key:"setMaterial",value:function(e){this.material=e,this.view&&this.setStateFromMaterial()}},{key:"setStateFromMaterial",value:function(){this.view.setState({color:"#"+this.material.color.getHexString(),emissive:"#"+this.material.emissive.getHexString(),roughness:100*this.material.roughness,metalness:100*this.material.metalness,transparent:this.material.transparent,opacity:100*this.material.opacity,depthTest:this.material.depthTest,depthWrite:this.material.depthWrite,map:this.material.map,aoMap:this.material.aoMap,bumpMap:this.material.bumpMap,displacementMap:this.material.displacementMap,emissiveMap:this.material.emissiveMap,envMap:this.material.envMap,lightMap:this.material.lightMap,metalnessMap:this.material.metalnessMap,normalMap:this.material.normalMap,roughnessMap:this.material.roughnessMap})}},{key:"onColorChanged",value:function(e){this.material.color=new K.Ilk(e.target.value),this.updateViewState()}},{key:"onEmissiveChanged",value:function(e){this.material.emissive=new K.Ilk(e.target.value),this.updateViewState()}},{key:"onRoughnessChanged",value:function(e){this.material.roughness=e/100,this.updateViewState()}},{key:"onMetalnessChanged",value:function(e){this.material.metalness=e/100,this.updateViewState()}},{key:"onTransparentChanged",value:function(e){this.material.transparent=e,this.updateViewState(),this.material.needsUpdate=!0}},{key:"onOpacityChanged",value:function(e){this.material.opacity=e/100,this.material.needsUpdate=!0,this.updateViewState()}},{key:"onDepthWriteChanged",value:function(e){this.material.depthWrite=e,this.material.needsUpdate=!0,this.updateViewState()}},{key:"onDepthTestChanged",value:function(e){this.material.depthTest=e,this.material.needsUpdate=!0,this.updateViewState()}},{key:"onMapChanged",value:function(e,t){"envMap"===t&&(e.mapping=K.dSO),this.material[t]=e,this.material.needsUpdate=!0,this.updateViewState()}},{key:"onMapDelete",value:function(e){this.material[e]=null,this.material.needsUpdate=!0,this.updateViewState()}},{key:"updateViewState",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null;e&&(this.view=e),this.view&&this.material&&this.setStateFromMaterial()}}]),e}(),Sr=new K.FM8;function kr(e){var t=1920,n=1080;e.renderer.renderer.getSize(Sr),e.camera&&(e.camera.aspect=t/n,e.camera.updateProjectionMatrix()),e.renderer.renderer.setSize(t,n),e.composer.setSize(t,n),e.renderScene(),e.camera&&(e.camera.aspect=Sr.x/Sr.y,e.camera.updateProjectionMatrix());var i=e.renderer.canvas.toDataURL("image/jpeg",.5);return e.composer.setSize(Sr.x,Sr.y),e.renderer.renderer.setSize(Sr.x,Sr.y),e.renderScene(),i}function Br(e){return e.isScene?"Scene":e.isCamera?"Camera":e.isLight?"Light":e.isMesh?"Mesh":e.isLine?"Line":e.isPoints?"Points":"Node"}var Tr=function(e){(0,a.Z)(n,e);var t=(0,o.Z)(n);function n(e,r,a){var o;return(0,i.Z)(this,n),(o=t.call(this)).object=e,o.propName=r,o.value=a,o.prevValue=e[r],o}return(0,r.Z)(n,[{key:"name",get:function(){return"Set Property"}},{key:"setValue",value:function(e){this.setObjectValue(this.object,this.propName,e)}},{key:"execute",value:function(){this.setValue(this.value)}},{key:"undo",value:function(){this.setValue(this.prevValue)}},{key:"redo",value:function(){this.execute()}}]),n}(Ze),Dr=function(e){(0,a.Z)(n,e);var t=(0,o.Z)(n);function n(e,r,a){return(0,i.Z)(this,n),t.call(this,e,r,a)}return(0,r.Z)(n,[{key:"execute",value:function(){(0,st.Z)((0,lt.Z)(n.prototype),"execute",this).call(this),this.object.updateProjectionMatrix()}},{key:"undo",value:function(){(0,st.Z)((0,lt.Z)(n.prototype),"undo",this).call(this),this.object.updateProjectionMatrix()}}]),n}(Tr),Rr=function(){function e(){var t=this;(0,i.Z)(this,e),this.settings={},this.updateViewState=this.updateViewState.bind(this),this.onPropertyChanged=this.onPropertyChanged.bind(this),this.onPropertyBlur=this.onPropertyBlur.bind(this),x.Z.instance.subscribe(C,(function(){t.camera&&t.setCamera(t.camera)}))}return(0,r.Z)(e,[{key:"setCamera",value:function(e){this.camera=e,this.settings={fov:e.fov,near:e.near,far:e.far},this.updateViewState()}},{key:"onPropertyChanged",value:function(e){this.settings[e.target.name]=e.target.value,this.updateViewState()}},{key:"onPropertyBlur",value:function(e){if(!e.key||"Enter"===e.key){this.settings[e.target.name]=Number(e.target.value);var t=new Dr(this.camera,e.target.name,Number(e.target.value));Q.execute(t),this.updateViewState()}}},{key:"updateViewState",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null;e&&(this.view=e),this.view&&this.camera&&this.view.setState((0,G.Z)({},this.settings))}}]),e}(),Pr=function(e){(0,a.Z)(n,e);var t=(0,o.Z)(n);function n(e,r,a){var o;return(0,i.Z)(this,n),(o=t.call(this)).object=e,o.prevUserData=(0,Nn.cloneDeep)(e.userData),o.userData=(0,Nn.cloneDeep)(e.userData),o.userData[r]=a,o}return(0,r.Z)(n,[{key:"name",get:function(){return"Set Annotation Property"}},{key:"execute",value:function(){(0,Nn.merge)(this.object.userData,this.userData),Vn.updateAnnotations()}},{key:"undo",value:function(){(0,Nn.merge)(this.object.userData,this.prevUserData),Vn.updateAnnotations()}},{key:"redo",value:function(){this.execute()}}]),n}(Ze),Lr=function(){function e(){var t=this;(0,i.Z)(this,e),this.settings={},this.updateViewState=this.updateViewState.bind(this),this.onPropertyChanged=this.onPropertyChanged.bind(this),x.Z.instance.subscribe(C,(function(){t.updateViewState()}))}return(0,r.Z)(e,[{key:"setAnnotation",value:function(e){this.object=e,this.updateViewState()}},{key:"updateViewState",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null;e&&(this.view=e),this.view&&this.object&&this.view.setState((0,G.Z)({},this.object.userData))}},{key:"onPropertyChanged",value:function(e,t){var n=new Pr(this.object,e,t);Q.execute(n),this.updateViewState()}}]),e}(),Qr=function(){function e(){(0,i.Z)(this,e),this.clipsModel={clips:[]},this.playingCount=0,this.updateViewState=this.updateViewState.bind(this),this.playClip=this.playClip.bind(this),this.stopClip=this.stopClip.bind(this)}return(0,r.Z)(e,[{key:"setObject",value:function(e){this.object=e,this.clipsModel.clips=[],e.animationPlayer&&(this.clips=e.animations,this.clips&&this.clips.length&&(this.currentClip=this.clips[0],this.clipsModel={clips:this.clips.map((function(e){return{name:e.name,duration:e.duration,playing:!1}}))})),this.updateViewState()}},{key:"update",value:function(e){this.object.animationPlayer.update(e)}},{key:"playClip",value:function(e){this.stopAll(),this.object.animationPlayer.playClip(this.clips[e],this.clipsModel.clips[e].loop),this.clipsModel.clips[e].playing=!0,++this.playingCount,this.updateViewState()}},{key:"playClipByName",value:function(e){this.stopAll();var t=this.clips.findIndex((function(t){return t.name===e}));-1!==t&&this.playClip(t)}},{key:"stopAll",value:function(){var e=this;this.clips.forEach((function(t,n){e.stopClip(n)}))}},{key:"stopClip",value:function(e){this.object.animationPlayer.stopClip(this.clips[e]),this.clipsModel.clips[e].playing=!1,--this.playingCount,this.updateViewState()}},{key:"toggleLoop",value:function(e){this.clipsModel.clips[e].loop=!this.clipsModel.clips[e].loop,this.updateViewState()}},{key:"updateViewState",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null;e&&(this.view=e),this.view&&this.view.setState({clipsState:(0,G.Z)({},this.clipsModel)})}}]),e}(),Zr=function(e){(0,a.Z)(n,e);var t=(0,o.Z)(n);function n(e,r,a){return(0,i.Z)(this,n),t.call(this,e,r,a)}return(0,r.Z)(n,[{key:"execute",value:function(){(0,st.Z)((0,lt.Z)(n.prototype),"execute",this).call(this),this.object.helper&&this.object.helper.update()}},{key:"undo",value:function(){(0,st.Z)((0,lt.Z)(n.prototype),"undo",this).call(this),Vn.updateLightHelper(this.object.constructor.name)}}]),n}(Tr),Nr=function(){function e(){var t=this;(0,i.Z)(this,e),this.settings={},this.updateViewState=this.updateViewState.bind(this),this.onPropChanged=this.onPropChanged.bind(this),x.Z.instance.subscribe(C,(function(){t.light&&t.setLight(t.light)}))}return(0,r.Z)(e,[{key:"setLight",value:function(e){this.light=e,this.settings={color:"#"+e.color.getHexString(),intensity:e.intensity,power:e.power,angle:e instanceof K.PMe?e.angle:0,isSpotlight:e instanceof K.PMe},this.updateViewState()}},{key:"onPropChanged",value:function(e){var t=new Zr(this.light,e.target.name,e.target.value);Q.execute(t),this.settings[e.target.name]=e.target.value,this.updateViewState()}},{key:"updateViewState",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null;e&&(this.view=e),this.view&&this.light&&this.view.setState((0,G.Z)({},this.settings))}}]),e}(),Fr=function(){function e(){var t=this;(0,i.Z)(this,e),this.updateViewState=this.updateViewState.bind(this),this.onRotationChanged=this.onRotationChanged.bind(this),this.onRotationBlur=this.onRotationBlur.bind(this),this.onPositionChanged=this.onPositionChanged.bind(this),this.onPositionBlur=this.onPositionBlur.bind(this),this.visible=!1,this.objectType="Node",this.materialViewModel=new Ir,this.cameraViewModel=new Rr,this.annotationViewModel=new Lr,this.animationsViewModel=new Qr,this.lightViewModel=new Nr,x.Z.instance.subscribe(I,(function(e){t.object=e.object,t.objectType=Br(t.object),t.object.isMesh?t.materialViewModel.setMaterial(t.object.material):t.object.isCamera?t.cameraViewModel.setCamera(t.object):t.object.isPoints?t.annotationViewModel.setAnnotation(t.object):t.object.isLight&&t.lightViewModel.setLight(t.object),t.animationsViewModel.setObject(t.object),t.visible=!0,t.updateViewState()})),x.Z.instance.subscribe(S,(function(){t.visible=!1,t.updateViewState(),t.object=null})),x.Z.instance.subscribe(k,(function(e){t.object=e.object,t.updateViewState()})),x.Z.instance.subscribe(B,(function(e){t.object=e.object,t.updateViewState()})),x.Z.instance.subscribe(T,(function(e){t.object=e.object,t.updateViewState()}))}return(0,r.Z)(e,[{key:"getType",value:function(){return this.object instanceof K.Kj0?"Mesh":"Object"}},{key:"updateViewState",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null;e&&(this.view=e),this.view&&(this.view.setState({visible:this.visible}),this.object&&this.view.setState({xPos:this.object.position.x.toFixed(4),yPos:this.object.position.y.toFixed(4),zPos:this.object.position.z.toFixed(4),xRot:K.M8C.radToDeg(this.object.rotation.x).toFixed(1),yRot:K.M8C.radToDeg(this.object.rotation.y).toFixed(1),zRot:K.M8C.radToDeg(this.object.rotation.z).toFixed(1),xScale:this.object.scale.x.toFixed(4),yScale:this.object.scale.y.toFixed(4),zScale:this.object.scale.z.toFixed(4),type:this.objectType,name:this.object.name})),this.materialViewModel&&this.materialViewModel.updateViewState()}},{key:"onRotationChanged",value:function(e,t){this.view.setState((0,Mr.Z)({},t+"Rot",e.target.value))}},{key:"onRotationBlur",value:function(e,t){if("Enter"===e.key&&this.object){var n=this.object.rotation.clone();n[t]=K.M8C.degToRad(Number(e.target.value));var i=new hn(this.object,n,this.object.rotation);Q.execute(i)}}},{key:"onPositionChanged",value:function(e,t){this.view.setState((0,Mr.Z)({},t+"Pos",e.target.value))}},{key:"onPositionBlur",value:function(e,t){if("Enter"===e.key&&this.object){var n=this.object.position.clone();n[t]=Number(e.target.value);var i=new cn(this.object,n,this.object.position);Q.execute(i)}}},{key:"onScaleChanged",value:function(e,t){this.view.setState((0,Mr.Z)({},t+"Scale",e.target.value))}},{key:"onScaleBlur",value:function(e,t){if("Enter"===e.key&&this.object){var n=this.object.scale.clone();n[t]=Number(e.target.value);var i=new dn(this.object,n,this.object.scale);Q.execute(i)}}},{key:"onNameChanged",value:function(e){this.object&&(this.object.name=e.target.value,this.view.setState({name:e.target.value}))}}]),e}(),Ur=function(e){(0,a.Z)(n,e);var t=(0,o.Z)(n);function n(){var e;return(0,i.Z)(this,n),(e=t.call(this)).viewModel=new Fr,e}return(0,r.Z)(n,[{key:"renderButtonIcon",value:function(){return(0,c.jsx)(rr.Z,{component:ur,viewBox:"0 0 121.48 122.88",style:{width:"24px"}})}},{key:"renderContent",value:function(){return(0,c.jsxs)(s.Fragment,{children:[(0,c.jsx)("div",{className:"editor-sidebar-heading",style:{fontSize:"large"},children:"Object Properties"}),(0,c.jsx)(Er,{ref:this.viewModel.updateViewState,viewModel:this.viewModel})]})}}]),n}(ir),jr=n(78842),Or=n(97595),zr=n(60745),Gr=n(85699),Hr=function(e){(0,a.Z)(n,e);var t=(0,o.Z)(n);function n(){var e;return(0,i.Z)(this,n),(e=t.call(this)).state={tree:null,expandedNodeIds:[],selectedNodeIds:[]},e}return(0,r.Z)(n,[{key:"render",value:function(){return this.state.tree?(0,c.jsxs)(s.Fragment,{children:[(0,c.jsx)("div",{className:"editor-sidebar-heading",children:"Scene Graph"}),(0,c.jsx)(jr.Z,{defaultCollapseIcon:(0,c.jsx)(Or.Z,{}),defaultExpandIcon:(0,c.jsx)(zr.Z,{}),defaultExpanded:this.state.expandedNodeIds,defaultSelected:this.state.selectedNodeIds,onNodeToggle:this.props.viewModel.onNodeToggle,onNodeSelect:this.props.viewModel.onNodeSelected,children:this.renderTree(this.state.tree)})]}):null}},{key:"renderTree",value:function(e){var t=this;return(0,c.jsx)(Gr.Z,{nodeId:e.id,label:Br(e.object),onClick:function(){return t.props.viewModel.onObjectClicked(e.object)},children:Array.isArray(e.children)?e.children.map((function(e){return t.renderTree(e)})):null},e.id)}}]),n}(s.Component),Vr=function(){function e(){var t=this;(0,i.Z)(this,e),this.updateViewState=this.updateViewState.bind(this),this.onObjectClicked=this.onObjectClicked.bind(this),this.onNodeToggle=this.onNodeToggle.bind(this),this.onNodeSelected=this.onNodeSelected.bind(this),this.expandedNodeIds=[],this.selectedNodeIds=[],x.Z.instance.subscribe(b,(function(){t.createTree()})),this.createTree()}return(0,r.Z)(e,[{key:"createTree",value:function(){this.tree=this.buildTree(Vn.world.sceneRoot),this.updateViewState()}},{key:"buildTree",value:function(e){var t=this,n={name:e.name,id:e.uuid,children:[],object:e};return this.expandedNodeIds.push(n.id),e.children.forEach((function(e){n.children.push(t.buildTree(e))})),n}},{key:"updateViewState",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null;e&&(this.view=e),this.view&&this.view.setState({tree:this.tree,expandedNodeIds:this.expandedNodeIds,selectedNodeIds:this.selectedNodeIds})}},{key:"onNodeToggle",value:function(e,t){this.expandedNodeIds=(0,X.Z)(t),this.updateViewState()}},{key:"onNodeSelected",value:function(e,t){this.selectedNodeIds=[t],this.updateViewState()}},{key:"onObjectClicked",value:function(e){Q.execute(new pn(e))}}]),e}(),Wr=n(2224),qr=n(63727),Yr=function(e){(0,a.Z)(n,e);var t=(0,o.Z)(n);function n(){var e;return(0,i.Z)(this,n),(e=t.call(this)).state={},e}return(0,r.Z)(n,[{key:"render",value:function(){var e=this;if(this.props.viewModel&&0!==Object.keys(this.state).length)return(0,c.jsxs)("div",{className:"editor-pane",children:[(0,c.jsx)("div",{className:"editor-sidebar-heading",children:"Environment Map"}),(0,c.jsx)("div",{className:"flexrow",children:(0,c.jsx)(vr,{texture:this.state.envMap,onChange:this.props.viewModel.onEnvMapChanged,onDelete:this.props.viewModel.onEnvMapDelete})}),(0,c.jsx)("div",{className:"editor-sidebar-heading",children:"Background"}),(0,c.jsx)("div",{style:{display:"flex"},children:(0,c.jsxs)(qr.Z,{native:!0,value:this.state.settings.backgroundType,onChange:function(t){return e.props.viewModel.setProperty("backgroundType",t.target.value)},style:{minWidth:"200px",marginBottom:"10px"},children:[(0,c.jsx)("option",{value:"transparent",children:"Transparent"}),(0,c.jsx)("option",{value:"gradient",children:"Gradient"}),(0,c.jsx)("option",{value:"color",children:"Color"})]})}),"color"===this.state.settings.backgroundType&&(0,c.jsxs)("div",{className:"flexrow-la",children:[(0,c.jsx)("div",{className:"ctl-label",children:"Background Color\xa0"}),(0,c.jsx)("input",{type:"color",value:this.state.settings.backgroundColor,onChange:function(t){return e.props.viewModel.setProperty("backgroundColor",t.target.value)}})]}),"gradient"===this.state.settings.backgroundType&&(0,c.jsxs)("div",{children:[(0,c.jsx)("div",{className:"ctl-label",children:"Background Gradient"}),(0,c.jsx)("input",{type:"color",value:this.state.settings.backgroundGradientColor1,onChange:function(t){return e.props.viewModel.setProperty("backgroundGradientColor1",t.target.value)}}),(0,c.jsx)("input",{type:"color",value:this.state.settings.backgroundGradientColor2,onChange:function(t){return e.props.viewModel.setProperty("backgroundGradientColor2",t.target.value)}})]}),"transparent"===this.state.settings.backgroundType&&(0,c.jsx)("div",{}),(0,c.jsx)("div",{className:"editor-sidebar-heading",children:"Reflection Plane"}),(0,c.jsxs)("div",{children:[(0,c.jsxs)("label",{className:"checkboxLabel",children:["Enable Reflection",(0,c.jsx)("input",{type:"checkbox",checked:this.state.settings.enableReflection,onChange:function(t){return e.props.viewModel.setProperty("enableReflection",t.target.checked)}}),(0,c.jsx)("span",{className:"checkboxCheckmark"})]}),this.state.settings.enableReflection&&(0,c.jsx)("div",{children:(0,c.jsxs)(s.Fragment,{children:[(0,c.jsx)(cr.Z,{label:"Fade Depth",type:"number",value:this.state.settings.reflectionFadeScale,style:{minWidth:"100px"},inputProps:{min:0},onChange:function(t){return e.props.viewModel.setProperty("reflectionFadeScale",t.target.value)}}),(0,c.jsxs)("div",{className:"flexrow-la",children:[(0,c.jsx)("div",{className:"ctl-label",children:"Color\xa0"}),(0,c.jsx)("input",{type:"color",value:this.state.settings.reflectionColor,onChange:function(t){return e.props.viewModel.setProperty("reflectionColor",t.target.value)}})]}),(0,c.jsx)("div",{className:"ctl-label",children:"Opacity"}),(0,c.jsx)(dr.Z,{style:{width:"200px"},value:100*this.state.settings.reflectionOpacity,onChange:function(t,n){return e.props.viewModel.setProperty("reflectionOpacity",n/100)}}),(0,c.jsxs)("label",{className:"checkboxLabel",children:["Blur Reflection",(0,c.jsx)("input",{type:"checkbox",checked:this.state.settings.blurReflection,onChange:function(t){return e.props.viewModel.setProperty("blurReflection",t.target.checked)}}),(0,c.jsx)("span",{className:"checkboxCheckmark"})]})]})})]}),(0,c.jsx)("div",{className:"editor-sidebar-heading",children:"Fog"}),(0,c.jsx)("div",{children:(0,c.jsxs)("label",{className:"checkboxLabel",children:["Fog",(0,c.jsx)("input",{type:"checkbox",checked:this.state.settings.fog,onChange:function(t){return e.props.viewModel.setProperty("fog",t.target.checked)}}),(0,c.jsx)("span",{className:"checkboxCheckmark"})]})}),this.state.settings.fog&&(0,c.jsxs)(s.Fragment,{children:[(0,c.jsxs)("div",{className:"flexrow-la",children:[(0,c.jsxs)("label",{className:"radioContainer",style:{marginLeft:"5px"},onChange:function(){return e.props.viewModel.setProperty("fogType","exponential")},children:["Exponential",(0,c.jsx)("input",{type:"radio",checked:"exponential"===this.state.settings.fogType}),(0,c.jsx)("span",{className:"radioCheckmark"})]}),(0,c.jsxs)("label",{className:"radioContainer",style:{marginLeft:"5px"},onChange:function(){return e.props.viewModel.setProperty("fogType","linear")},children:["Linear",(0,c.jsx)("input",{type:"radio",checked:"linear"===this.state.settings.fogType}),(0,c.jsx)("span",{className:"radioCheckmark"})]})]}),"linear"===this.state.settings.fogType&&(0,c.jsxs)("div",{children:[(0,c.jsx)(cr.Z,{label:"Fog Near",type:"number",value:this.state.settings.fogNear,onChange:function(t){return e.props.viewModel.setProperty("fogNear",t.target.value)}}),(0,c.jsx)("br",{}),(0,c.jsx)(cr.Z,{label:"Fog Far",type:"number",value:this.state.settings.fogFar,onChange:function(t){return e.props.viewModel.setProperty("fogFar",t.target.value)}}),(0,c.jsx)("br",{})]}),"exponential"===this.state.settings.fogType&&(0,c.jsx)(cr.Z,{label:"Density",type:"number",value:this.state.settings.fogDensity,onChange:function(t){return e.props.viewModel.setProperty("fogDensity",t.target.value)}}),(0,c.jsxs)("div",{className:"flexrow-la",children:[(0,c.jsx)("div",{className:"ctl-label",children:"Color"}),(0,c.jsx)("input",{type:"color",value:this.state.settings.fogColor,onChange:function(t){return e.props.viewModel.setProperty("fogColor",t.target.value)}})]}),(0,c.jsx)("br",{}),(0,c.jsx)("br",{}),(0,c.jsx)("br",{})]}),(0,c.jsx)(g.Z,{}),(0,c.jsxs)("label",{className:"checkboxLabel",children:["Preview",(0,c.jsx)("input",{type:"checkbox",checked:this.state.viewState.preview,onChange:function(t){return e.props.viewModel.onViewStateChanged("preview",t.target.checked)}}),(0,c.jsx)("span",{className:"checkboxCheckmark"})]})]})}}]),n}(s.Component),Jr=function(e){(0,a.Z)(n,e);var t=(0,o.Z)(n);function n(e,r){var a;return(0,i.Z)(this,n),(a=t.call(this)).settings=(0,Nn.cloneDeep)(e),a.prevSettings=(0,Nn.cloneDeep)(r),a}return(0,r.Z)(n,[{key:"name",get:function(){return"Set Environment Property"}},{key:"execute",value:function(){Vn.project.settings.state={environment:this.settings},Vn.setEnvironment()}},{key:"undo",value:function(){Vn.project.settings.state={environment:this.prevSettings},Vn.setEnvironment()}},{key:"redo",value:function(){this.execute()}}]),n}(Ze),Xr=function(e){(0,a.Z)(n,e);var t=(0,o.Z)(n);function n(e){var r;return(0,i.Z)(this,n),(r=t.call(this)).prevTexture=Vn.world.scene.environment,r.texture=e,r}return(0,r.Z)(n,[{key:"name",get:function(){return"Set Environment Map"}},{key:"execute",value:function(){this.texture&&(this.texture.mapping=K.dSO),Vn.project.envMap=this.texture,Vn.world.setEnvironmentMap(this.texture)}},{key:"undo",value:function(){Vn.project.envMap=this.prevTexture,Vn.world.setEnvironmentMap(this.prevTexture)}},{key:"redo",value:function(){this.execute()}}]),n}(Ze),Kr=function(){function e(){var t=this;(0,i.Z)(this,e),this.onEnvMapChanged=this.onEnvMapChanged.bind(this),this.onEnvMapDelete=this.onEnvMapDelete.bind(this),this.updateViewState=this.updateViewState.bind(this),this.setProperty=this.setProperty.bind(this),this.onViewStateChanged=this.onViewStateChanged.bind(this),x.Z.instance.subscribe(R,(function(){t.updateViewState()})),x.Z.instance.subscribe(D,(function(){t.updateViewState()})),this.setFromSettings(),this.viewState={preview:!1}}return(0,r.Z)(e,[{key:"setFromSettings",value:function(){Vn.setEnvironment(Vn.project.settings.state.environment)}},{key:"onEnvMapChanged",value:function(e){Q.execute(new Xr(e)),this.updateViewState()}},{key:"onEnvMapDelete",value:function(){Q.execute(new Xr(null)),this.updateViewState()}},{key:"setProperty",value:function(e,t){var n=(0,Nn.cloneDeep)(Vn.project.settings.state.environment);n[e]=t;var i=new Jr(n,Vn.project.settings.state.environment);Q.execute(i),this.updateViewState()}},{key:"onViewStateChanged",value:function(e,t){this.viewState[e]=t,Vn.envPreviewMode=this.viewState.preview,this.updateViewState()}},{key:"updateViewState",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null;e&&(this.view=e),this.view&&this.view.setState({envMap:Vn.world.scene.environment,settings:Vn.project.settings.state.environment,viewState:this.viewState})}}]),e}(),$r=function(e){(0,a.Z)(n,e);var t=(0,o.Z)(n);function n(){var e;return(0,i.Z)(this,n),(e=t.call(this)).onClick=e.onClick.bind((0,y.Z)(e)),e.viewModel=new Vr,e.environmentSettingsViewModel=new Kr,e.environmentSettingsViewModel.updateViewState(),e}return(0,r.Z)(n,[{key:"onClick",value:function(){this.environmentSettingsViewModel.updateViewState()}},{key:"renderButtonIcon",value:function(){return(0,c.jsx)(Wr.Z,{})}},{key:"renderContent",value:function(){return(0,c.jsxs)(s.Fragment,{children:[(0,c.jsx)("div",{className:"editor-sidebar-heading",style:{fontSize:"large"},children:"Scene Properties"}),(0,c.jsx)(Hr,{viewModel:this.viewModel,ref:this.viewModel.updateViewState}),(0,c.jsx)(Yr,{ref:this.environmentSettingsViewModel.updateViewState,viewModel:this.environmentSettingsViewModel})]})}}]),n}(ir),ea=n(47616),ta=function(e){(0,a.Z)(n,e);var t=(0,o.Z)(n);function n(e,r){var a;return(0,i.Z)(this,n),(a=t.call(this)).settings=(0,Nn.cloneDeep)(e),a.prevSettings=(0,Nn.cloneDeep)(r),a}return(0,r.Z)(n,[{key:"name",get:function(){return"Set Lighting Property"}},{key:"execute",value:function(){Vn.project.settings.state={lighting:this.settings},Vn.setLighting()}},{key:"undo",value:function(){Vn.project.settings.state={lighting:this.prevSettings},Vn.setLighting()}},{key:"redo",value:function(){this.execute()}}]),n}(Ze),na=function(e){(0,a.Z)(n,e);var t=(0,o.Z)(n);function n(e){var r;return(0,i.Z)(this,n),(r=t.call(this)).object=e,r}return(0,r.Z)(n,[{key:"name",get:function(){return"Add Baked Shadow"}},{key:"execute",value:function(){Vn.renderBakedShadow(this.object)}},{key:"undo",value:function(){Vn.removeBakedShadowFromObject(this.object)}},{key:"redo",value:function(){this.execute()}}]),n}(Ze),ia=function(e){(0,a.Z)(n,e);var t=(0,o.Z)(n);function n(e){var r;return(0,i.Z)(this,n),(r=t.call(this)).object=e,r}return(0,r.Z)(n,[{key:"name",get:function(){return"Remove Baked Shadow"}},{key:"execute",value:function(){Vn.removeBakedShadowFromObject(this.object)}},{key:"undo",value:function(){Vn.renderBakedShadow(this.object)}},{key:"redo",value:function(){this.execute()}}]),n}(Ze),ra=function(e){(0,a.Z)(n,e);var t=(0,o.Z)(n);function n(e,r){var a;return(0,i.Z)(this,n),(a=t.call(this)).object=e,a.props=r,a}return(0,r.Z)(n,[{key:"name",get:function(){return"Set Baked Shadow"}},{key:"execute",value:function(){Vn.setBakedShadowProperties(this.object,this.props)}},{key:"undo",value:function(){}},{key:"redo",value:function(){this.execute()}}]),n}(Ze),aa=function(){function e(){var t=this;(0,i.Z)(this,e),this.savedProps={},this.bakedShadowProps={},this.updateViewState=this.updateViewState.bind(this),this.setProperty=this.setProperty.bind(this),this.onSliderChange=this.onSliderChange.bind(this),this.onSliderEnd=this.onSliderEnd.bind(this),this.onAddBakedShadowClicked=this.onAddBakedShadowClicked.bind(this),this.onRemoveBakedShadowClicked=this.onRemoveBakedShadowClicked.bind(this),this.onBakedShadowPropertyChanged=this.onBakedShadowPropertyChanged.bind(this),x.Z.instance.subscribe(I,(function(e){t.selectedObject=e.object,t.bakedShadowProps=Vn.getBakedShadowProperties(t.selectedObject),t.updateViewState()})),x.Z.instance.subscribe(S,(function(){t.selectedObject=null,t.updateViewState()}))}return(0,r.Z)(e,[{key:"setProperty",value:function(e,t){var n=(0,Nn.cloneDeep)(Vn.project.settings.state.lighting);n[e]=t;var i=new ta(n,Vn.project.settings.state.lighting);Q.execute(i),this.updateViewState()}},{key:"onSliderChange",value:function(e,t){this.savedSettings||(this.savedSettings=(0,Nn.cloneDeep)(Vn.project.settings.state.lighting)),this.setProperty(e,t,!1)}},{key:"onAddBakedShadowClicked",value:function(){if(Vn.selectedObject){var e=new na(Vn.selectedObject);Q.execute(e),this.showAddButton=!1,this.updateViewState()}}},{key:"onRemoveBakedShadowClicked",value:function(){if(Vn.selectedObject){var e=new ia(Vn.selectedObject);Q.execute(e),this.showAddButton=!0,this.updateViewState()}}},{key:"onRefreshBakedShadowClicked",value:function(){}},{key:"onSliderEnd",value:function(){var e=new ta(Vn.project.settings.state.lighting,this.savedSettings);Q.execute(e),this.updateViewState(),this.savedSettings=null}},{key:"onBakedShadowPropertyChanged",value:function(e,t){if(this.selectedObject){this.bakedShadowProps[e]=t;var n=new ra(this.selectedObject,this.bakedShadowProps);Q.execute(n),this.updateViewState()}}},{key:"updateViewState",value:function(){var e,t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null;(t&&(this.view=t),this.view)&&this.view.setState({showControls:null!=this.selectedObject,showAddButton:null==(null===(e=this.selectedObject)||void 0===e?void 0:e.bakedShadow),bakedShadowBlur:this.bakedShadowProps.bakedShadowBlur,bakedShadowLightness:this.bakedShadowProps.bakedShadowLightness,bakedShadowFalloff:this.bakedShadowProps.bakedShadowFalloff,settings:Vn.project.settings.state.lighting})}}]),e}(),oa=n(67025),sa=n(95480),la=n(66709),ua=n(7857),ca=n(35271),ha=function(e){(0,a.Z)(n,e);var t=(0,o.Z)(n);function n(){var e;return(0,i.Z)(this,n),(e=t.call(this)).state={},e}return(0,r.Z)(n,[{key:"render",value:function(){var e=this;if(this.props.viewModel&&0!==Object.keys(this.state).length)return(0,c.jsxs)("div",{className:"editor-pane",children:[(0,c.jsx)("div",{className:"editor-sidebar-heading",children:"Shadows"}),(0,c.jsx)("div",{children:(0,c.jsxs)("label",{className:"checkboxLabel",children:["Enabled",(0,c.jsx)("input",{type:"checkbox",checked:this.state.settings.shadowsEnabled,onChange:function(t){return e.props.viewModel.setProperty("shadowsEnabled",t.target.checked)}}),(0,c.jsx)("span",{className:"checkboxCheckmark"})]})}),(0,c.jsx)("div",{children:(0,c.jsx)(cr.Z,{label:"Shadow Bias",type:"number",InputLabelProps:{shrink:!0},value:this.state.settings.shadowBias,onChange:function(t){return e.props.viewModel.setProperty("shadowBias",t.target.value)}})}),this.state.settings.shadowsEnabled&&(0,c.jsxs)("div",{children:[(0,c.jsx)("div",{children:(0,c.jsxs)("label",{className:"checkboxLabel",children:["Shadow Plane",(0,c.jsx)("input",{type:"checkbox",checked:this.state.settings.shadowPlaneVisible,onChange:function(t){return e.props.viewModel.setProperty("shadowPlaneVisible",t.target.checked)}}),(0,c.jsx)("span",{className:"checkboxCheckmark"})]})}),this.state.settings.shadowPlaneVisible&&(0,c.jsxs)("div",{className:"flexrow",children:[(0,c.jsx)("div",{className:"flexcol",children:"Lightness\xa0"}),(0,c.jsx)("div",{className:"flexcol",children:(0,c.jsx)(dr.Z,{style:{width:"200px"},value:100*this.state.settings.shadowPlaneLightness,onChange:function(t,n){return e.props.viewModel.onSliderChange("shadowPlaneLightness",n/100)},onChangeCommitted:function(t,n){return e.props.viewModel.onSliderEnd("shadowPlaneLightness",100*n)}})})]}),(0,c.jsx)("div",{className:"ctl-label",children:"Shadow Light"}),(0,c.jsxs)("div",{className:"flexrow",children:[(0,c.jsx)("div",{className:"flexcol",children:"Rotation"}),(0,c.jsx)("div",{className:"flexcol",children:(0,c.jsx)(dr.Z,{style:{width:"200px",marginRight:"8px"},value:this.state.settings.shadowLightRotation/(2*Math.PI)*100,onChange:function(t,n){return e.props.viewModel.onSliderChange("shadowLightRotation",n/100*2*Math.PI)},onChangeCommitted:function(t,n){return e.props.viewModel.onSliderEnd("shadowLightRotation",n/100*2*Math.PI)}})})]}),(0,c.jsxs)("div",{className:"flexrow",children:[(0,c.jsx)("div",{className:"flexcol",children:"Elevation"}),(0,c.jsx)("div",{className:"flexcol",children:(0,c.jsx)(dr.Z,{style:{width:"200px",marginRight:"8px"},value:this.state.settings.shadowLightElevation/(2*Math.PI)*100,onChange:function(t,n){return e.props.viewModel.onSliderChange("shadowLightElevation",n/100*2*Math.PI)},onChangeCommitted:function(t,n){return e.props.viewModel.onSliderEnd("shadowLightElevation",n/100*2*Math.PI)}})})]})]}),(0,c.jsx)("div",{className:"editor-sidebar-heading",children:"Baked Shadow"}),this.state.showControls?(0,c.jsxs)("div",{children:[(0,c.jsxs)("div",{className:"flexrow",children:[(0,c.jsx)(oa.Z,{onClick:this.props.viewModel.onRefereshBakedShadowClicked,children:(0,c.jsx)(la.Z,{})}),(0,c.jsx)(oa.Z,{disabled:!this.state.showAddButton,onClick:this.props.viewModel.onAddBakedShadowClicked,children:(0,c.jsx)(ua.Z,{})}),(0,c.jsx)(oa.Z,{disabled:this.state.showAddButton,onClick:this.props.viewModel.onRemoveBakedShadowClicked,children:(0,c.jsx)(ca.Z,{})})]}),(0,c.jsxs)("div",{className:"flexrow",children:[(0,c.jsx)("div",{className:"flexcol",children:"Softness"}),(0,c.jsx)("div",{className:"flexcol",children:(0,c.jsx)(dr.Z,{style:{width:"200px",marginRight:"8px"},value:100*this.state.bakedShadowBlur,onChange:function(t,n){return e.props.viewModel.onBakedShadowPropertyChanged("bakedShadowBlur",n/100)}})})]}),(0,c.jsxs)("div",{className:"flexrow",children:[(0,c.jsx)("div",{className:"flexcol",children:"Lightness"}),(0,c.jsx)("div",{className:"flexcol",children:(0,c.jsx)(dr.Z,{style:{width:"200px",marginRight:"8px"},value:100*this.state.bakedShadowLightness,onChange:function(t,n){return e.props.viewModel.onBakedShadowPropertyChanged("bakedShadowLightness",n/100)}})})]}),(0,c.jsxs)("div",{className:"flexrow",children:[(0,c.jsx)("div",{className:"flexcol",children:"Depth"}),(0,c.jsx)("div",{className:"flexcol",children:(0,c.jsx)(dr.Z,{style:{width:"200px",marginRight:"8px"},value:100*this.state.bakedShadowFalloff,onChange:function(t,n){return e.props.viewModel.onBakedShadowPropertyChanged("bakedShadowFalloff",n/100)}})})]})]}):(0,c.jsx)("div",{children:"Select an object to edit"}),(0,c.jsx)("div",{className:"editor-sidebar-heading",children:"Ambient Light"}),(0,c.jsx)(sa.Z,{children:"Brightness"}),(0,c.jsx)(dr.Z,{style:{width:"200px"},value:100*this.state.settings.ambientLightIntensity,onChange:function(t,n){return e.props.viewModel.setProperty("ambientLightIntensity",n/100)}}),(0,c.jsx)(sa.Z,{children:"Color"}),(0,c.jsx)("input",{type:"color",value:this.state.settings.ambientLightColor,onChange:function(t){return e.props.viewModel.setProperty("ambientLightColor",t.target.value)}})]})}}]),n}(s.Component),da=function(e){(0,a.Z)(n,e);var t=(0,o.Z)(n);function n(){var e;return(0,i.Z)(this,n),(e=t.call(this)).viewModel=new aa,e}return(0,r.Z)(n,[{key:"renderButtonIcon",value:function(){return(0,c.jsx)(ea.Z,{})}},{key:"renderContent",value:function(){return(0,c.jsxs)(s.Fragment,{children:[(0,c.jsx)("div",{className:"editor-sidebar-heading",style:{fontSize:"large"},children:"Lighting Properties"}),(0,c.jsx)(ha,{viewModel:this.viewModel,ref:this.viewModel.updateViewState})]})}}]),n}(ir),fa=n(44378),pa=function(e){(0,a.Z)(n,e);var t=(0,o.Z)(n);function n(){var e;return(0,i.Z)(this,n),(e=t.call(this)).state={},e}return(0,r.Z)(n,[{key:"render",value:function(){if(this.props.viewModel&&0!==Object.keys(this.state).length)return(0,c.jsxs)(s.Fragment,{children:[(0,c.jsxs)("div",{className:"editor-pane",children:[(0,c.jsx)("div",{className:"editor-sidebar-heading",children:"Controller Type"}),(0,c.jsx)("div",{className:"flexrow-la",children:(0,c.jsxs)(qr.Z,{native:!0,name:"controllerType",value:this.state.settings.controllerType,style:{width:"200px"},onChange:this.props.viewModel.onPropertyChanged,children:[(0,c.jsx)("option",{value:"orbit",children:"Orbit"}),(0,c.jsx)("option",{value:"fp",children:"First Person"})]})}),(0,c.jsx)("div",{className:"editor-sidebar-heading",children:"Camera Target"}),(0,c.jsx)("div",{children:(0,c.jsx)(cr.Z,{value:this.state.targetName,style:{maxWidth:"200px"},disabled:!0,inputProps:{min:0}})}),(0,c.jsx)("div",{className:"editor-sidebar-heading",children:"Properties"}),"orbit"===this.state.settings.controllerType&&(0,c.jsxs)(s.Fragment,{children:[(0,c.jsx)(cr.Z,{label:"Minimum Zoom Distance",type:"number",name:"orbitController.minZoom",value:this.state.settings.orbitController.minZoom,style:{maxWidth:"200px"},inputProps:{min:0},onBlur:this.props.viewModel.onPropertyBlur,onKeyUp:this.props.viewModel.onPropertyBlur,onChange:this.props.viewModel.onPropertyChanged}),(0,c.jsx)(cr.Z,{label:"Maximum Zoom Distance",type:"number",name:"orbitController.maxZoom",value:this.state.settings.orbitController.maxZoom,style:{maxWidth:"200px"},inputProps:{min:0},onBlur:this.props.viewModel.onPropertyBlur,onKeyUp:this.props.viewModel.onPropertyBlur,onChange:this.props.viewModel.onPropertyChanged}),(0,c.jsx)(cr.Z,{label:"Minimum Polar Angle",type:"number",name:"orbitController.minElevation",value:this.state.settings.orbitController.minElevation,style:{maxWidth:"200px"},inputProps:{min:0,max:180},onBlur:this.props.viewModel.onPropertyBlur,onKeyUp:this.props.viewModel.onPropertyBlur,onChange:this.props.viewModel.onPropertyChanged}),(0,c.jsx)(cr.Z,{label:"Maximum Polar Angle",type:"number",name:"orbitController.maxElevation",value:this.state.settings.orbitController.maxElevation,style:{maxWidth:"200px"},inputProps:{min:0,max:180},onBlur:this.props.viewModel.onPropertyBlur,onKeyUp:this.props.viewModel.onPropertyBlur,onChange:this.props.viewModel.onPropertyChanged})]}),"fp"==this.state.settings.controllerType&&(0,c.jsx)(s.Fragment,{children:(0,c.jsx)(cr.Z,{label:"Move Speed",type:"number",name:"firstPersonController.moveSpeed",value:this.state.settings.firstPersonController.moveSpeed,style:{maxWidth:"200px"},inputProps:{min:0},onBlur:this.props.viewModel.onPropertyBlur,onKeyUp:this.props.viewModel.onPropertyBlur,onChange:this.props.viewModel.onPropertyChanged})})]}),(0,c.jsx)("div",{className:"editor-sidebar-heading",children:"Controls"}),"fp"===this.state.settings.controllerType&&(0,c.jsxs)("div",{className:"flexrow",children:[(0,c.jsxs)("div",{className:"flexcol",children:["Look around",(0,c.jsx)("br",{}),"Foward/back",(0,c.jsx)("br",{}),"Left/right",(0,c.jsx)("br",{}),"Up/down",(0,c.jsx)("br",{})]}),(0,c.jsxs)("div",{className:"flexcol",children:["Mouse",(0,c.jsx)("br",{}),"W/S or virtual joystick",(0,c.jsx)("br",{}),"A/D or virtual joystick",(0,c.jsx)("br",{}),"R/F"]})]}),"oribit"==this.state.settings.cameraControllerType&&(0,c.jsxs)("div",{className:"flexrow",children:[(0,c.jsxs)("div",{className:"flexcol",children:["Orbit around",(0,c.jsx)("br",{}),"Zoom",(0,c.jsx)("br",{}),"Pan",(0,c.jsx)("br",{})]}),(0,c.jsxs)("div",{className:"flexcol",children:["Mouse",(0,c.jsx)("br",{}),"Mouse wheel",(0,c.jsx)("br",{}),"Mouse + CTRL",(0,c.jsx)("br",{})]})]})]})}}]),n}(s.Component),Aa=function(e){(0,a.Z)(n,e);var t=(0,o.Z)(n);function n(e,r){var a;return(0,i.Z)(this,n),(a=t.call(this)).settings=(0,Nn.cloneDeep)(e),a.prevSettings=(0,Nn.cloneDeep)(r),a}return(0,r.Z)(n,[{key:"name",get:function(){return"Set Controller Property"}},{key:"execute",value:function(){Vn.project.settings.state={cameraController:this.settings},Vn.setCameraController()}},{key:"undo",value:function(){Vn.project.settings.state={cameraController:this.prevSettings},Vn.setCameraController()}},{key:"redo",value:function(){this.execute()}}]),n}(Ze),va=function(){function e(){var t=this;(0,i.Z)(this,e),this.updateViewState=this.updateViewState.bind(this),this.onPropertyChanged=this.onPropertyChanged.bind(this),x.Z.instance.subscribe(C,(function(){return t.updateViewState()})),this.updateViewState()}return(0,r.Z)(e,[{key:"onPropertyChanged",value:function(e){"controllerType"===e.target.name&&x.Z.instance.notifyAll(new P(e.target.value));var t=(0,Nn.cloneDeep)(Vn.project.settings.state.cameraController);(0,Nn.set)(t,e.target.name,e.target.value);var n=new Aa(t,Vn.project.settings.state.cameraController);Q.execute(n),this.updateViewState()}},{key:"updateViewState",value:function(){var e,t,n,i=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null;(i&&(this.view=i),this.view)&&this.view.setState({targetName:null!==(e=null===(t=Vn.world.cameraController)||void 0===t||null===(n=t.object)||void 0===n?void 0:n.name)&&void 0!==e?e:"",settings:Vn.project.settings.state.cameraController})}}]),e}(),ga=function(e){(0,a.Z)(n,e);var t=(0,o.Z)(n);function n(){var e;return(0,i.Z)(this,n),(e=t.call(this)).viewModel=new va,e}return(0,r.Z)(n,[{key:"renderButtonIcon",value:function(){return(0,c.jsx)(fa.Z,{})}},{key:"renderContent",value:function(){return(0,c.jsxs)(s.Fragment,{children:[(0,c.jsx)("div",{className:"editor-sidebar-heading",style:{fontSize:"large"},children:"Camera Controller Properties"}),(0,c.jsx)(pa,{viewModel:this.viewModel,ref:this.viewModel.updateViewState})]})}}]),n}(ir),ma=n(26513),ya=function(e){(0,a.Z)(n,e);var t=(0,o.Z)(n);function n(){var e;return(0,i.Z)(this,n),(e=t.call(this)).state={},e}return(0,r.Z)(n,[{key:"render",value:function(){var e=this;if(this.props.viewModel&&0!==Object.keys(this.state).length)return(0,c.jsxs)(s.Fragment,{children:[(0,c.jsxs)("div",{className:"flexrow",children:[(0,c.jsx)("div",{style:{width:"250px"},children:"Occlusion Test"}),(0,c.jsx)("div",{children:(0,c.jsx)(fr.Z,{checked:this.state.modelState.visibilityTest,onChange:function(t,n){return e.props.viewModel.onCommitProperty("visibilityTest",n)}})})]}),(0,c.jsxs)("div",{className:"flexrow",children:[(0,c.jsx)("div",{style:{width:"250px"},children:"Show Nav Buttons"}),(0,c.jsx)("div",{children:(0,c.jsx)(fr.Z,{checked:this.state.modelState.showNavButtons,onChange:function(t,n){return e.props.viewModel.onCommitProperty("showNavButtons",n)}})})]}),(0,c.jsx)("div",{className:"editor-sidebar-heading",children:"Button Properties"}),(0,c.jsxs)("div",{children:["Size\xa0",(0,c.jsx)(cr.Z,{value:this.state.modelState.size,name:"size",type:"number",style:{width:"60px",marginRight:"2px"},onBlur:this.props.viewModel.onPropertyBlur,onKeyUp:this.props.viewModel.onPropertyBlur,onChange:this.props.viewModel.onPropertyChanged})]}),(0,c.jsxs)("div",{className:"flexrow",children:[(0,c.jsx)("div",{className:"flexcol",children:"Text Color"}),(0,c.jsx)("div",{className:"flexcol",children:(0,c.jsx)(hr.ZP,{title:"Select Color",children:(0,c.jsx)("input",{type:"color",value:this.state.modelState.textColor,onChange:function(t){return e.props.viewModel.onCommitProperty("textColor",t.target.value)}})})})]}),(0,c.jsxs)("div",{className:"flexrow",children:[(0,c.jsx)("div",{className:"flexcol",children:"Fill Color"}),(0,c.jsx)("div",{className:"flexcol",children:(0,c.jsx)(hr.ZP,{title:"Select Color",children:(0,c.jsx)("input",{type:"color",value:this.state.modelState.fillColor,name:"backgroundColor",onChange:function(t){return e.props.viewModel.onCommitProperty("fillColor",t.target.value)}})})})]}),(0,c.jsxs)("div",{className:"flexrow",children:[(0,c.jsx)("div",{className:"flexcol",children:"Border Color"}),(0,c.jsx)("div",{className:"flexcol",children:(0,c.jsx)(hr.ZP,{title:"Select Color",children:(0,c.jsx)("input",{type:"color",value:this.state.modelState.borderColor,name:"borderColor",onChange:function(t){return e.props.viewModel.onCommitProperty("borderColor",t.target.value)}})})})]}),(0,c.jsx)("div",{className:"editor-sidebar-heading",children:"Add Annotation"}),(0,c.jsxs)("div",{children:["Button Text\xa0",(0,c.jsx)(cr.Z,{value:this.state.viewState.buttonText,style:{width:"100px",marginRight:"2px"},onChange:function(t){return e.props.viewModel.onViewStatePropertyChanged("buttonText",t.target.value)}})]}),(0,c.jsxs)("div",{children:["Label Text",(0,c.jsx)("textarea",{className:"annotation-box-textinput",multiline:!0,rows:"3",value:this.state.viewState.labelText,onChange:function(t){return e.props.viewModel.onViewStatePropertyChanged("labelText",t.target.value)}}),"add"===this.state.viewState.editMode?(0,c.jsxs)("div",{children:[(0,c.jsx)("div",{children:"Click on the model to position the label. Rotate, zoom and pan the camera to adjust the view."}),(0,c.jsx)(ma.Z,{variant:"contained",color:"primary",size:"small",disabled:"edit"!==this.state.viewState.editMode,onClick:this.props.viewModel.onEditModeOk,children:"Ok"})]}):(0,c.jsx)(ma.Z,{variant:"contained",color:"primary",size:"small",disabled:this.state.viewState.addButtonDisabled,onClick:this.props.viewModel.onAddAnnotation,children:"Add"})]})]})}}]),n}(s.Component),xa=function(e){(0,a.Z)(n,e);var t=(0,o.Z)(n);function n(e,r,a,o,s){var l;return(0,i.Z)(this,n),(l=t.call(this)).parent=s,l.settings=e,l.position=r,l.buttonText=a,l.labelText=o,l}return(0,r.Z)(n,[{key:"name",get:function(){return"Add Annotation"}},{key:"execute",value:function(){return this.annot=function(e,t,n,i,r,a,o){var s=new K.u9r;s.setAttribute("position",new K.a$l([0,0,0],3));var l=wn(t,i,r,a),u=new K.UY4({color:4294967295,size:e,sizeAttenuation:!1,depthTest:!1,transparent:!0,map:l}),c=new K.woe(s,u);return c.renderOrder=Number.POSITIVE_INFINITY,c.userData={buttonText:t,labelText:n,size:e,fillColor:i,textColor:r,borderColor:a,cameraState:o},c}(this.settings.size,this.buttonText,this.labelText,this.settings.fillColor,this.settings.textColor,this.settings.borderColor,Vn.world.cameraController.getState()),this.annot.position.copy(this.position),Vn.addAnnotation(this.annot,this.parent),this.annot}},{key:"undo",value:function(){Vn.removeAnnotation(this.annot)}},{key:"redo",value:function(){this.execute()}}]),n}(Ze),wa=function(e){(0,a.Z)(n,e);var t=(0,o.Z)(n);function n(e,r){var a;return(0,i.Z)(this,n),(a=t.call(this)).settings=(0,Nn.cloneDeep)(e),a.prevSettings=(0,Nn.cloneDeep)(r),a}return(0,r.Z)(n,[{key:"name",get:function(){return"Set Environment Property"}},{key:"execute",value:function(){Vn.project.settings.state={annotations:this.settings},Vn.updateAnnotations()}},{key:"undo",value:function(){Vn.project.settings.state={annotations:this.prevSettings},Vn.updateAnnotations()}},{key:"redo",value:function(){this.execute()}}]),n}(Ze),Ca=function(){function e(){var t=this;(0,i.Z)(this,e),this.viewState={editMode:"select",addButtonDisabled:!1,labelText:"Enter description",buttonText:"1"},this.updateViewState=this.updateViewState.bind(this),this.onEditModeOk=this.onEditModeOk.bind(this),this.onPropertyChanged=this.onPropertyChanged.bind(this),this.onPropertyBlur=this.onPropertyBlur.bind(this),this.onAddAnnotation=this.onAddAnnotation.bind(this),x.Z.instance.subscribe(R,(function(){t.updateViewState()})),x.Z.instance.subscribe(M,(function(e){if("add"===t.viewState.editMode){var n=new xa(Vn.project.settings.state.annotations,e.intersect.point,t.viewState.buttonText,t.viewState.labelText,e.intersect.object);Q.execute(n),t.viewState.editMode="select",t.updateViewState()}}))}return(0,r.Z)(e,[{key:"onCommitProperty",value:function(e,t){var n=(0,Nn.cloneDeep)(Vn.project.settings.state.annotations);n[e]=t;var i=new wa(n,Vn.project.settings.state.annotations);Q.execute(i),this.updateViewState()}},{key:"onPropertyChanged",value:function(e){Vn.project.settings.state={annotations:(0,Mr.Z)({},e.target.name,e.target.value)},this.updateViewState()}},{key:"onPropertyBlur",value:function(e){e.key&&"Enter"!==e.key||this.onCommitProperty(e.target.name,e.target.value)}},{key:"onViewStatePropertyChanged",value:function(e,t){this.viewState[e]=t,this.updateViewState()}},{key:"onEditModeOk",value:function(){this.viewState.editMode="select",this.updateViewState()}},{key:"onAddAnnotation",value:function(){this.viewState.editMode="add",this.updateViewState()}},{key:"updateViewState",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null;e&&(this.view=e),this.view&&this.view.setState({viewState:this.viewState,modelState:Vn.project.settings.state.annotations})}}]),e}(),ba=n(96782),_a=function(e){(0,a.Z)(n,e);var t=(0,o.Z)(n);function n(){var e;return(0,i.Z)(this,n),(e=t.call(this)).viewModel=new Ca,e}return(0,r.Z)(n,[{key:"renderButtonIcon",value:function(){return(0,c.jsx)(ba.Z,{})}},{key:"renderContent",value:function(){return(0,c.jsxs)(s.Fragment,{children:[(0,c.jsx)("div",{className:"editor-sidebar-heading",style:{fontSize:"large"},children:"Annotation Properties"}),(0,c.jsx)(ya,{viewModel:this.viewModel,ref:this.viewModel.updateViewState})]})}}]),n}(ir),Ea=function(e){(0,a.Z)(n,e);var t=(0,o.Z)(n);function n(){var e;return(0,i.Z)(this,n),(e=t.call(this)).state={},e}return(0,r.Z)(n,[{key:"render",value:function(){var e=this;return 0!==!Object.keys(this.state).length&&this.props.viewModel&&this.state.viewState?(0,c.jsxs)("div",{children:[(0,c.jsx)("div",{className:"editor-sidebar-heading",style:{fontSize:"large"},children:"Project Settings"}),(0,c.jsx)("div",{children:(0,c.jsx)(cr.Z,{InputLabelProps:{shrink:!0},label:"Title",value:this.state.settings.project.title,style:{width:"98%"},inputProps:{min:0},onChange:function(t){return e.props.viewModel.onPropertyChanged("project.title",t.target.value)}})}),(0,c.jsxs)("div",{children:["Description",(0,c.jsx)("textarea",{className:"annotation-box-textinput",multiline:!0,rows:"3",value:this.state.settings.project.description,onChange:function(t){return e.props.viewModel.onPropertyChanged("project.description",t.target.value)}})]}),"Project Image",(0,c.jsx)("img",{className:"image-thumb",src:this.state.viewState.loadingImage}),(0,c.jsx)(ma.Z,{style:{width:"120px"},variant:"contained",color:"primary",onClick:this.props.viewModel.onCaptureScreen,children:"Capture Image"}),(0,c.jsx)("div",{className:"editor-sidebar-heading",style:{fontSize:"large"},children:"Viewer settings"}),(0,c.jsx)("div",{className:"editor-sidebar-heading",children:"Auto-rotate"}),(0,c.jsxs)("label",{className:"checkboxLabel",children:["Auto Rotate",(0,c.jsx)("input",{type:"checkbox",checked:this.state.settings.viewer.autoRotate.enabled,onChange:function(t){return e.props.viewModel.onPropertyChanged("viewer.autoRotate.enabled",t.target.checked)}}),(0,c.jsx)("span",{className:"checkboxCheckmark"})]}),(0,c.jsx)("div",{children:(0,c.jsx)(cr.Z,{InputLabelProps:{shrink:!0},label:"Auto Rotate Speed",type:"number",value:this.state.settings.viewer.autoRotate.speed,style:{width:"150px"},inputProps:{min:0},onChange:function(t){return e.props.viewModel.onPropertyChanged("viewer.autoRotate.speed",t.target.value)}})}),(0,c.jsx)("div",{className:"editor-sidebar-heading",children:"Menus"}),(0,c.jsxs)("label",{className:"checkboxLabel",children:["Show Options",(0,c.jsx)("input",{type:"checkbox",checked:this.state.settings.viewer.menu.showOptions,onChange:function(t){return e.props.viewModel.onPropertyChanged("viewer.menu.showOptions",t.target.checked)}}),(0,c.jsx)("span",{className:"checkboxCheckmark"})]}),(0,c.jsxs)("label",{className:"checkboxLabel",children:["Show Help",(0,c.jsx)("input",{type:"checkbox",checked:this.state.settings.viewer.menu.showHelp,onChange:function(t){return e.props.viewModel.onPropertyChanged("viewer.menu.showHelp",t.target.checked)}}),(0,c.jsx)("span",{className:"checkboxCheckmark"})]}),(0,c.jsxs)("label",{className:"checkboxLabel",children:["Show Info",(0,c.jsx)("input",{type:"checkbox",checked:this.state.settings.viewer.menu.showInfo,onChange:function(t){return e.props.viewModel.onPropertyChanged("viewer.menu.showInfo",t.target.checked)}}),(0,c.jsx)("span",{className:"checkboxCheckmark"})]}),(0,c.jsx)("div",{className:"editor-sidebar-heading",children:"AR Settings"}),(0,c.jsxs)("label",{className:"checkboxLabel",children:["Enable AR",(0,c.jsx)("input",{type:"checkbox",checked:this.state.settings.viewer.ar.enabled,onChange:function(t){return e.props.viewModel.onPropertyChanged("viewer.ar.enabled",t.target.checked)}}),(0,c.jsx)("span",{className:"checkboxCheckmark"})]}),(0,c.jsxs)("label",{className:"checkboxLabel",children:["Use WebAR",(0,c.jsx)("input",{type:"checkbox",checked:this.state.settings.viewer.ar.webAr,onChange:function(t){return e.props.viewModel.onPropertyChanged("viewer.ar.webAr",t.target.checked)}}),(0,c.jsx)("span",{className:"checkboxCheckmark"})]}),(0,c.jsx)("div",{className:"editor-sidebar-heading",children:"VR Settings"}),(0,c.jsxs)("label",{className:"checkboxLabel",children:["Enable VR",(0,c.jsx)("input",{type:"checkbox",checked:this.state.settings.viewer.vr.enabled,onChange:function(t){return e.props.viewModel.onPropertyChanged("viewer.vr.enabled",t.target.checked)}}),(0,c.jsx)("span",{className:"checkboxCheckmark"})]}),(0,c.jsx)(cr.Z,{label:"Walk speed",type:"number",InputLabelProps:{shrink:!0},value:this.state.settings.viewer.vr.walkSpeed,style:{width:"150px"},onChange:function(t){return e.props.viewModel.onPropertyChanged("viewer.vr.walkSpeed",t.target.value)}}),(0,c.jsxs)("label",{className:"checkboxLabel",children:["Stop walking when outside floor geometry",(0,c.jsx)("input",{type:"checkbox",checked:this.state.settings.viewer.vr.rayGeometryTest,onChange:function(t){return e.props.viewModel.onPropertyChanged("viewer.vr.rayGeometryTest",t.target.checked)}}),(0,c.jsx)("span",{className:"checkboxCheckmark"})]}),(0,c.jsx)("div",{className:"editor-sidebar-heading",children:"Dimensions Tool"}),(0,c.jsxs)("label",{className:"checkboxLabel",children:["Show Dimensions Tool",(0,c.jsx)("input",{type:"checkbox",checked:this.state.settings.viewer.dimensionsTool.show,onChange:function(t){return e.props.viewModel.onPropertyChanged("viewer.dimensionsTool.show",t.target.checked)}}),(0,c.jsx)("span",{className:"checkboxCheckmark"})]}),(0,c.jsx)("div",{className:"editor-sidebar-heading",children:"Animations"}),(0,c.jsx)("div",{children:(0,c.jsx)(cr.Z,{InputLabelProps:{shrink:!0},label:"Start Animation",value:this.state.settings.viewer.animations.startAnimation,style:{width:"250px"},onChange:function(t){return e.props.viewModel.onPropertyChanged("viewer.animations.startAnimation",t.target.value)}})}),(0,c.jsxs)("label",{className:"checkboxLabel",children:["Loop Start Animation",(0,c.jsx)("input",{type:"checkbox",checked:this.state.settings.viewer.animations.loopStartAnimation,onChange:function(t){return e.props.viewModel.onPropertyChanged("viewer.animations.loopStartAnimation",t.target.checked)}}),(0,c.jsx)("span",{className:"checkboxCheckmark"})]}),(0,c.jsx)("br",{}),(0,c.jsx)("br",{})]}):null}}]),n}(s.Component),Ma=function(){function e(){var t=this;(0,i.Z)(this,e),this.viewState={imageSrc:null},this.updateViewState=this.updateViewState.bind(this),this.onCaptureScreen=this.onCaptureScreen.bind(this),this.onSetVRPosition=this.onSetVRPosition.bind(this),this.onClearVRPosition=this.onClearVRPosition.bind(this),this.onPropertyChanged=this.onPropertyChanged.bind(this),x.Z.instance.subscribe(R,(function(){return t.updateViewState()})),x.Z.instance.subscribe(_,(function(){Vn.project.loadingImage&&(t.viewState.loadingImage=Vn.project.loadingImage),t.updateViewState()}))}return(0,r.Z)(e,[{key:"onSetVRPosition",value:function(){var e=function(e,t){var n=new K.iMs(e.position,new K.Pa4(0,-1,0),0,1e3).intersectObjects(t,!0);return n.length?n[0].point:null}(this.world.camera,this.scene);this.model.initialVrPosition=[this.world.camera.position.x,e?e.y:0,this.world.camera.position.z],this.model.initialVrRotation=[this.world.camera.rotation.x,this.world.camera.rotation.y,this.world.camera.rotation.z],this.updateViewState(),x.Z.instance.notifyAll(new Xn("Initial VR position set. Save the scene to save settings."))}},{key:"onClearVRPosition",value:function(){this.model.initialVrPosition=null,this.model.initialVrRotation=null,this.updateViewState(),x.Z.instance.notifyAll(new Xn("Initial VR position cleared. Save the scene."))}},{key:"onPropertyChanged",value:function(e,t){var n={};(0,Nn.set)(n,e,t),Vn.project.settings.state=(0,G.Z)({},n),this.updateViewState()}},{key:"onCaptureScreen",value:function(){var e=(0,p.Z)((0,f.Z)().mark((function e(){var t;return(0,f.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:t=kr(Vn.world),this.viewState.loadingImage=t,Vn.project.loadingImage=t,this.updateViewState();case 4:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}()},{key:"updateViewState",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null;e&&(this.view=e),this.view&&this.view.setState({settings:Vn.project.settings.state,viewState:(0,G.Z)({},this.viewState)})}}]),e}(),Ia=n(90925),Sa=function(e){(0,a.Z)(n,e);var t=(0,o.Z)(n);function n(){var e;return(0,i.Z)(this,n),(e=t.call(this)).viewModel=new Ma,e}return(0,r.Z)(n,[{key:"renderButtonIcon",value:function(){return(0,c.jsx)(Ia.Z,{})}},{key:"renderContent",value:function(){return(0,c.jsx)(s.Fragment,{children:(0,c.jsx)(Ea,{viewModel:this.viewModel,ref:this.viewModel.updateViewState})})}}]),n}(ir),ka=function(e){(0,a.Z)(n,e);var t=(0,o.Z)(n);function n(){return(0,i.Z)(this,n),t.call(this)}return(0,r.Z)(n,[{key:"name",get:function(){return"Frame All"}},{key:"undoable",get:function(){return!1}},{key:"execute",value:function(){Vn.frameScene()}}]),n}(Ze),Ba=function(e){(0,a.Z)(n,e);var t=(0,o.Z)(n);function n(){return(0,i.Z)(this,n),t.call(this)}return(0,r.Z)(n,[{key:"name",get:function(){return"Frame Selection"}},{key:"undoable",get:function(){return!1}},{key:"execute",value:function(){Vn.selectedObject&&Vn.frameObject(Vn.selectedObject)}}]),n}(Ze),Ta=function(){function e(){(0,i.Z)(this,e)}return(0,r.Z)(e,[{key:"execute",value:function(e){var t;switch(e){case"frame selection":t=new Ba;break;case"frame scene":t=new ka}t&&Q.execute(t)}}]),e}(),Da=function(e){(0,a.Z)(n,e);var t=(0,o.Z)(n);function n(e,r){var a;return(0,i.Z)(this,n),(a=t.call(this)).prevValue=(0,Nn.get)(Vn.project.settings.state.effects,e),a.propName=e,a.value=r,a}return(0,r.Z)(n,[{key:"name",get:function(){return"Set Effects Property"}},{key:"setValue",value:function(e){var t={};(0,Nn.set)(t,this.propName,e),Vn.project.settings.state={effects:t},Vn.setEffects()}},{key:"execute",value:function(){this.setValue(this.value)}},{key:"undo",value:function(){this.setValue(this.prevValue)}},{key:"redo",value:function(){this.execute()}}]),n}(Ze),Ra=function(){function e(){(0,i.Z)(this,e),this.updateViewState=this.updateViewState.bind(this),this.viewState={preview:!1}}return(0,r.Z)(e,[{key:"onPropertyChanged",value:function(e,t){var n=new Da(e,t);Q.execute(n),this.updateViewState()}},{key:"onViewStateChanged",value:function(e,t){this.viewState[e]=t,Vn.effectsPreviewMode=this.viewState.preview,this.updateViewState()}},{key:"updateViewState",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null;e&&(this.view=e);var t=Vn.project.settings.state.effects;this.view&&this.view.setState({settings:t,viewState:this.viewState})}}]),e}(),Pa=function(e){(0,a.Z)(n,e);var t=(0,o.Z)(n);function n(){var e;return(0,i.Z)(this,n),(e=t.call(this)).state={},e}return(0,r.Z)(n,[{key:"render",value:function(){var e=this;return this.props.viewModel&&0!==Object.keys(this.state).length?(0,c.jsxs)(s.Fragment,{children:[(0,c.jsx)("div",{className:"editor-sidebar-heading",children:"Bloom Effect"}),(0,c.jsxs)("label",{className:"checkboxLabel",children:["Enabled",(0,c.jsx)("input",{type:"checkbox",checked:this.state.settings.bloom.enabled,onChange:function(t){return e.props.viewModel.onPropertyChanged("bloom.enabled",t.target.checked)}}),(0,c.jsx)("span",{className:"checkboxCheckmark"})]}),(0,c.jsx)(sa.Z,{children:"Strength"}),(0,c.jsx)(dr.Z,{style:{width:"200px"},value:100*this.state.settings.bloom.strength,onChange:function(t,n){return e.props.viewModel.onPropertyChanged("bloom.strength",n/100)}}),(0,c.jsx)(sa.Z,{children:"Threshold"}),(0,c.jsx)(dr.Z,{style:{width:"200px"},value:100*this.state.settings.bloom.threshold,onChange:function(t,n){return e.props.viewModel.onPropertyChanged("bloom.threshold",n/100)}}),(0,c.jsx)(sa.Z,{children:"Radius"}),(0,c.jsx)(dr.Z,{style:{width:"200px"},value:100*this.state.settings.bloom.radius,onChange:function(t,n){return e.props.viewModel.onPropertyChanged("bloom.radius",n/100)}}),(0,c.jsx)("div",{className:"editor-sidebar-heading",children:"Depth of Field"}),(0,c.jsxs)("label",{className:"checkboxLabel",children:["Enabled",(0,c.jsx)("input",{type:"checkbox",checked:this.state.settings.dof.enabled,onChange:function(t){return e.props.viewModel.onPropertyChanged("dof.enabled",t.target.checked)}}),(0,c.jsx)("span",{className:"checkboxCheckmark"})]}),(0,c.jsx)(sa.Z,{children:"Focus"}),(0,c.jsx)(dr.Z,{style:{width:"200px"},value:100*this.state.settings.dof.focus,onChange:function(t,n){return e.props.viewModel.onPropertyChanged("dof.focus",n/100)}}),(0,c.jsx)(sa.Z,{children:"Focal Length"}),(0,c.jsx)(dr.Z,{style:{width:"200px"},value:100*this.state.settings.dof.focalLength,onChange:function(t,n){return e.props.viewModel.onPropertyChanged("dof.focalLength",n/100)}}),(0,c.jsx)(sa.Z,{children:"Blur"}),(0,c.jsx)(dr.Z,{style:{width:"200px"},value:100*this.state.settings.dof.blur,onChange:function(t,n){return e.props.viewModel.onPropertyChanged("dof.blur",n/100)}}),(0,c.jsx)(g.Z,{}),(0,c.jsxs)("label",{className:"checkboxLabel",children:["Preview",(0,c.jsx)("input",{type:"checkbox",checked:this.state.viewState.preview,onChange:function(t){return e.props.viewModel.onViewStateChanged("preview",t.target.checked)}}),(0,c.jsx)("span",{className:"checkboxCheckmark"})]})]}):null}}]),n}(s.Component),La=n(73892),Qa=function(e){(0,a.Z)(n,e);var t=(0,o.Z)(n);function n(){var e;return(0,i.Z)(this,n),(e=t.call(this)).viewModel=new Ra,e}return(0,r.Z)(n,[{key:"renderButtonIcon",value:function(){return(0,c.jsx)(La.Z,{})}},{key:"renderContent",value:function(){return(0,c.jsxs)(s.Fragment,{children:[(0,c.jsx)("div",{className:"editor-sidebar-heading",style:{fontSize:"large"},children:"Effects Properties"}),(0,c.jsx)(Pa,{viewModel:this.viewModel,ref:this.viewModel.updateViewState})]})}}]),n}(ir),Za=n(43115),Na=function(){function e(){(0,i.Z)(this,e),this.onPropertyChanged=this.onPropertyChanged.bind(this),this.updateViewState=this.updateViewState.bind(this),this.viewState={gridOn:!0,gridSize:100,gridDivisions:40,gridCenterColor:"#402020",gridColor:"#202020"};var t=localStorage.getItem("editor-prefs");t&&(this.viewState=JSON.parse(t)),this.setGrid()}return(0,r.Z)(e,[{key:"onPropertyChanged",value:function(e,t){this.viewState[e]=t,this.updateViewState(),this.setGrid(),localStorage.setItem("editor-prefs",JSON.stringify(this.viewState))}},{key:"setGrid",value:function(){Vn.setGrid(this.viewState.gridSize,this.viewState.gridDivisions,new K.Ilk(this.viewState.gridColor),new K.Ilk(this.viewState.gridCenterColor),this.viewState.gridOn)}},{key:"updateViewState",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null;e&&(this.view=e),this.view&&this.view.setState({viewState:(0,G.Z)({},this.viewState)})}}]),e}(),Fa=function(e){(0,a.Z)(n,e);var t=(0,o.Z)(n);function n(){var e;return(0,i.Z)(this,n),(e=t.call(this)).state={},e}return(0,r.Z)(n,[{key:"render",value:function(){var e=this;return this.props.viewModel&&0!==Object.keys(this.state).length?(0,c.jsxs)("div",{children:[(0,c.jsx)("div",{className:"editor-sidebar-heading",children:"Grid"}),(0,c.jsx)("div",{children:(0,c.jsxs)("label",{className:"checkboxLabel",children:["Show",(0,c.jsx)("input",{type:"checkbox",checked:this.state.viewState.gridOn,onChange:function(t){return e.props.viewModel.onPropertyChanged("gridOn",t.target.checked)}}),(0,c.jsx)("span",{className:"checkboxCheckmark"})]})}),(0,c.jsx)("div",{children:(0,c.jsx)(cr.Z,{label:"Size",InputLabelProps:{shrink:!0},value:this.state.viewState.gridSize,style:{width:"200px"},onChange:function(t){return e.props.viewModel.onPropertyChanged("gridSize",t.target.value)}})}),(0,c.jsx)("div",{children:(0,c.jsx)(cr.Z,{label:"Divisions",InputLabelProps:{shrink:!0},value:this.state.viewState.gridDivisions,style:{width:"200px"},onChange:function(t){return e.props.viewModel.onPropertyChanged("gridDivisions",t.target.value)}})}),(0,c.jsxs)("div",{className:"flexrow",children:[(0,c.jsx)("div",{className:"flexcol",children:"Line Color"}),(0,c.jsx)("div",{className:"flexcol",children:(0,c.jsx)(hr.ZP,{title:"Select Color",children:(0,c.jsx)("input",{type:"color",value:this.state.viewState.gridColor,onChange:function(t){return e.props.viewModel.onPropertyChanged("gridColor",t.target.value)}})})})]}),(0,c.jsxs)("div",{className:"flexrow",children:[(0,c.jsx)("div",{className:"flexcol",children:"Center Line Color"}),(0,c.jsx)("div",{className:"flexcol",children:(0,c.jsx)(hr.ZP,{title:"Select Color",children:(0,c.jsx)("input",{type:"color",value:this.state.viewState.gridCenterColor,onChange:function(t){return e.props.viewModel.onPropertyChanged("gridCenterColor",t.target.value)}})})})]})]}):null}}]),n}(s.Component),Ua=function(e){(0,a.Z)(n,e);var t=(0,o.Z)(n);function n(){var e;return(0,i.Z)(this,n),(e=t.call(this)).viewModel=new Na,e}return(0,r.Z)(n,[{key:"renderButtonIcon",value:function(){return(0,c.jsx)(Za.Z,{})}},{key:"renderContent",value:function(){return(0,c.jsxs)(s.Fragment,{children:[(0,c.jsx)("div",{className:"editor-sidebar-heading",style:{fontSize:"large"},children:"Preferences"}),(0,c.jsx)(Fa,{viewModel:this.viewModel,ref:this.viewModel.updateViewState})]})}}]),n}(ir),ja=function(){function e(){var t=this;(0,i.Z)(this,e),this.viewState={errorMsg:"",message:"",tabs:[],showVirtualJoystick:!1,responseDialogOpen:!1},this.updateViewState=this.updateViewState.bind(this),this.onJoystickMove=this.onJoystickMove.bind(this),this.onJoystickRelease=this.onJoystickRelease.bind(this),this.onJoystickTouch=this.onJoystickTouch.bind(this),this.onResponseDialogOk=this.onResponseDialogOk.bind(this),this.onResponseDialogCancel=this.onResponseDialogCancel.bind(this),this.getUserResponse=this.getUserResponse.bind(this),this.onErrorAlertClose=this.onErrorAlertClose.bind(this),this.onMessageAlertClose=this.onMessageAlertClose.bind(this),x.Z.instance.subscribe(Kn,(function(e){t.viewState.errorMsg=e.message,t.updateViewState()})),x.Z.instance.subscribe(P,(function(e){t.viewState.showVirtualJoystick="fp"===e.type,t.updateViewState()})),this.loadedData={},this.loadedData.projectConfig=new J}return(0,r.Z)(e,[{key:"featureManager",get:function(){return this._featureManager}},{key:"initialize",value:function(e,t){Vn.initialize(e,t),this.fileCommands=new Ji,this.editCommands=new $i,this.addCommands=new nr,this.viewCommands=new Ta,this.viewState.fileCommands=this.fileCommands,this.viewState.editCommands=this.editCommands,this.viewState.addCommands=this.addCommands,this.viewState.viewCommands=this.viewCommands,this.createFeatures(),this.updateViewState()}},{key:"updateViewState",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null;e&&(this.view=e),this.view&&this.view.setState((0,G.Z)({},this.viewState))}},{key:"onJoystickMove",value:function(e,t){Vn.firstPersonCameraController&&Vn.firstPersonCameraController.onVirtualJoyStickMove(e,t)}},{key:"onJoystickTouch",value:function(){Vn.firstPersonCameraController&&Vn.firstPersonCameraController.onVirtualJoyStickTouch()}},{key:"onJoystickRelease",value:function(){Vn.firstPersonCameraController&&Vn.firstPersonCameraController.onVirtualJoyStickRelease()}},{key:"createFeatures",value:function(){this._featureManager=new H,this.viewState.tabs.push(new Ur),this.viewState.tabs.push(new $r),this.viewState.tabs.push(new da),this.viewState.tabs.push(new ga),this.viewState.tabs.push(new _a),this.viewState.tabs.push(new Qa),this.viewState.tabs.push(new Sa),this.viewState.tabs.push(new Ua),this.updateViewState()}},{key:"onResponseDialogOk",value:function(){this.responseCallback(),this.viewState.responseDialogOpen=!1,this.updateViewState()}},{key:"onResponseDialogCancel",value:function(){this.viewState.responseDialogOpen=!1,this.updateViewState()}},{key:"onErrorAlertClose",value:function(){this.viewState.errorMsg="",this.updateViewState()}},{key:"onMessageAlertClose",value:function(){this.viewState.message="",this.updateViewState()}},{key:"getUserResponse",value:function(e,t){this.viewState.responseDialogOpen=!0,this.viewState.responseDialogText=e,this.responseCallback=function(){return t()},this.updateViewState()}}]),e}(),Oa=function(e){(0,a.Z)(n,e);var t=(0,o.Z)(n);function n(e){var r;return(0,i.Z)(this,n),(r=t.call(this,e)).canvasContainerRef=s.createRef(),r.canvasRef=s.createRef(),r.tabs=[],r}return(0,r.Z)(n,[{key:"componentDidMount",value:function(){this.viewModel=new ja,this.viewModel.updateViewState(),this.forceUpdate()}},{key:"render",value:function(){return this.viewModel?(0,c.jsx)(z,{ref:this.viewModel.updateViewState,viewModel:this.viewModel,containerRef:this.canvasContainerRef,canvasRef:this.canvasRef,tabs:this.tabs}):null}}]),n}(s.Component)},86317:function(e){e.exports="data:image/png;base64,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"},27399:function(e){e.exports="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAGQAAABkCAYAAABw4pVUAAAAAXNSR0IArs4c6QAAAARnQU1BAACxjwv8YQUAAAAJcEhZcwAADsMAAA7DAcdvqGQAAAhtSURBVHhe7Z1tbFNVGMfX2662xGkRY8BoBDFSEZ0QtzUICgET4hcNvid+0ITMgOtotyWLhA+LkZjhlnUdW2DRZBoDxoHhg5FEQf0AoSlMARMcQRTUCUEZG+jmurbz//SelZa169t92/b8krNzztOm6z3/+zzPuS8911RkcLxerz0SiSw2mUyLUJwwLUKZh+JAKRkbGyuBfQ7aRWhfQfs6mlQGUC7C1gtbLz6j12Kx9La0tAzTe42K4QSprKycZbfbV6K5BgO5BvVjKBK9pgBRlBMoByHUweHh4SOdnZ1DsVcMgu6CNDQ0WPr7+8slSVqDQVoLEVwwW+VXVSeEcpTEwf891NfXF+zu7o7IL+mDboK43e6FEGE9mlQqMCC67hwQZQxfIYBqH0q33+//TbykKZoPAnLCA9FodAuar2EAimWrsYAgo6g+QWlsbW09EzNqhGaCwCOWms3mrWg+h6JUTlAbyjn7seO8h8nAcdmkLqoLsmnTprlWq7UVzZdky9SDwhmqrtHR0S0dHR2XZKs6qCYIkrU0ODjoRnh6B3vYbcI8pYEu17AtWx0ORzu2j7xHcVQRBOHpHiTsPfjyK4RpWgFhDmNHe7Wtre0PYVIMxWM5kvazEOPUdBWDoG2jbaRtFSbFUMxDkCtuLS4ubsKXfVOYZgTwlp0Izd6urq7/hKkgFBGkvr7+9pGRka/QLJctMwuIErDZbOsaGxsHhSlvChaE8gWms1+i+YhsmZlAlFPIK2uRV/4SprwoSBA62oYY36J5r2yZ2UCUs8gtz+CY5Wdhypm8Bamurl6Cf34IzbtkCyO4jDy6FqL8KPo5kZcgVVVVC+AZh/GP7xYmJgF4yp/YWVdClF+EKWtyFsTj8dC1iMMo98cMTEogyjmIUg5R+oUpK3I6DqGpLaqvUViMDCB6LIQoB8SYZU1Oglit1t2oHpZ7TBaUY8zorHHWmEWdEYQqD6pqucfkgNPlcg0GgOhPSlY5BFosg/sF4IaGvH5hdDB2o8gny7M5hZ8xZNXV1dG09nMWI39o7CBKN53REKa0ZBQkHA5vR3Wf3GMKYP7IyAhdF5qUSUOW1+t9Csp+J7qMMqz2+XxpxzSthzQ0NFij0egu0WUUAjv4Thpb0Z1AWkEGBga2IPbRTWmMgtCY9vf314juBFKGrJqamgcjkQhdZLpFmBhluU53Y6a64pjSQ+g2HRZDVUrMZvO7op3EBA+h+6YQ535C0yJbGJUIY8df7Pf7z4p+jAkegjfVoWIx1MeCKFQr2nGSPETcQ0WnjO2yhVEZuhN/IabBF+XuTR5isVheR8ViaAeN9ctyUyZJEEmSXhFNRjvICeLEBfF4PPQ7jFK5x2hIqRj7GIkekqQUox2Y1cYjU6IgdFc6ow/xsY/NsuAy81H9Sm1GNxZgtnV+3ENWiZrRj5gGLIhxYEEMRkwDkzg6jx8pMvoRCoXmSRCDfozPGADSQopGoyyIcZgvARbEIOAA0UlJnY5BGANgMpmcElSZK/qMzpAW5CG0qg5jDBwsiIFAyLJJ9Ef0GZ1ByLJRDmFBjEMsZDEGggShpfAYYzBAOUSRFQiYwiEtKIewIAaBtOCQZSxiIUvVBbmY7CEtKGT1ij6jM6QFeQgLYhBIC8oh5+Uuoze0+rYUCoXYQwyC2WzulcQqmxdkE6MjF3w+38D4qRP+pa3+xDRgQYwDC2IwbghC95SiOkltRhdOCg3iHkK/LfxUNBmNSRz7uCCYcu3FkSKtcc5oCI056BbdG4KIlTSDco/RkGBbW9s50b4hCAGl9osmoxEmkykpVSQJwmFLW2isLRYLLZsYJ0kQEbY65R6jAZ1NTU2XRTtGkiAERGtGFZZ7jIqEJUlqEu04EwShtTcgyj7RZVSCxlhEpCQmCELgze+jcC5RCRpbHHs0im4SKQWBl/Sg+kzuMUqDmdXHmOr+ILpJpBSEEKsC0SNMGQWBc/wDQdKuKJd2IeVgMHjN5XLRajXrZAujBBCj3ufz0SM+UpLWQwiHw+GHosdElykQjGUPjanopmTSZWIJt9u9GNOzY1B2ljAxeQAxhjCGj8M7aLW+tEzqIQSSz2l80Fuiy+QJjWEmMYisFuMPBAInKioqHsKHLhEmJjc+ghgNoj0pGT1kHJvNRo/D41uGcgShiiLMRtHNSMYckkhVVZXTYrF8gyY9ZYfJAMS4hPFyNTc3Z31XT06CECxKdpAYqFbl+vjvnAUhhChH0LxDtjCJ5CsGkXUOSWTHjh10t+PTKDk98GqGQGOSlxhEXoIQmDV8H4lEaNHMvB+iON2AZ5xDAn80XzGIvAUhaDF5iLIcTb4WX1R0nBJ4S0tLn+jnRV455GYqKytn2e32L7B3rBammcYBbPvzEIPO/RVE1k9pm4yenp7R0tLS3dhD6BrKCny5gjxvqoAQFcG2bhsaGtrY3t4+IswFoYiHJOLxeJ5AtQdluj+wmELTi8ilR+WuMijiIYkEAoHfy8rKPpQkiZ5wWYaiuOg6E0XpQO5c7/f74/dTKYWqg+V2u5eazeYP0FwmW6Y8NLPckO5qnxKoGuvpizscjjLEWjpbXPDT+PUC3/8aqmraFjXFIDQLJ7W1tXdi73obTTrRNlUeiUGzpl3w8m3Nzc1/yyZ10Ty+I+nTOTC6Xm9kYWJCoGxH0tZ0CV3dEi4Jg1CwFdPGDeimfa6fxugmxDiGmAFt3rz5SQjzBgR6AXVOzx9XgH9R9qJ0QQTdf0lmCEHGoSdgXr16tRSilEOccpioLEJfke+Jz6QDVzrPFMRHBtENzp49+yT+byj2BgNgKEFS4fV67eFw2InE6sQAOjGQtM4w5SFaK7IEthLY5tB70b6CNt1LRoUW1aGwcwb2XpQz+IzTSpzeUI+iov8B/kkAJCiZq4EAAAAASUVORK5CYII="}}]);
//# sourceMappingURL=2137.5bb10174.chunk.js.map