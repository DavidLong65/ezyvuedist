"use strict";(self.webpackChunkezyview=self.webpackChunkezyview||[]).push([[748],{5748:function(e,t,n){n.r(t),n.d(t,{AMFLoader:function(){return m}});var a=n(5671),r=n(3144),o=n(136),i=n(7277),l=n(3272),s=n(2038),m=function(e){(0,o.Z)(n,e);var t=(0,i.Z)(n);function n(e){return(0,a.Z)(this,n),t.call(this,e)}return(0,r.Z)(n,[{key:"load",value:function(e,t,n,a){var r=this,o=new l.hH6(r.manager);o.setPath(r.path),o.setResponseType("arraybuffer"),o.setRequestHeader(r.requestHeader),o.setWithCredentials(r.withCredentials),o.load(e,(function(n){try{t(r.parse(n))}catch(o){a?a(o):console.error(o),r.manager.itemError(e)}}),n,a)}},{key:"parse",value:function(e){function t(e){for(var t="AMF Material",a=e.attributes.id.textContent,r={r:1,g:1,b:1,a:1},o=null,i=0;i<e.childNodes.length;i++){var s=e.childNodes[i];"metadata"===s.nodeName&&void 0!==s.attributes.type?"name"===s.attributes.type.value&&(t=s.textContent):"color"===s.nodeName&&(r=n(s))}return o=new l.xoR({flatShading:!0,color:new l.Ilk(r.r,r.g,r.b),name:t}),1!==r.a&&(o.transparent=!0,o.opacity=r.a),{id:a,material:o}}function n(e){for(var t={r:1,g:1,b:1,a:1},n=0;n<e.childNodes.length;n++){var a=e.childNodes[n];"r"===a.nodeName?t.r=a.textContent:"g"===a.nodeName?t.g=a.textContent:"b"===a.nodeName?t.b=a.textContent:"a"===a.nodeName&&(t.a=a.textContent)}return t}function a(e){var t={name:"",triangles:[],materialid:null},n=e.firstElementChild;for(void 0!==e.attributes.materialid&&(t.materialId=e.attributes.materialid.nodeValue);n;){if("metadata"===n.nodeName)void 0!==n.attributes.type&&"name"===n.attributes.type.value&&(t.name=n.textContent);else if("triangle"===n.nodeName){var a=n.getElementsByTagName("v1")[0].textContent,r=n.getElementsByTagName("v2")[0].textContent,o=n.getElementsByTagName("v3")[0].textContent;t.triangles.push(a,r,o)}n=n.nextElementSibling}return t}function r(e){for(var t=[],n=[],a=e.firstElementChild;a;){if("vertex"===a.nodeName)for(var r=a.firstElementChild;r;){if("coordinates"===r.nodeName){var o=r.getElementsByTagName("x")[0].textContent,i=r.getElementsByTagName("y")[0].textContent,l=r.getElementsByTagName("z")[0].textContent;t.push(o,i,l)}else if("normal"===r.nodeName){var s=r.getElementsByTagName("nx")[0].textContent,m=r.getElementsByTagName("ny")[0].textContent,d=r.getElementsByTagName("nz")[0].textContent;n.push(s,m,d)}r=r.nextElementSibling}a=a.nextElementSibling}return{vertices:t,normals:n}}function o(e){for(var t=e.attributes.id.textContent,o={name:"amfobject",meshes:[]},i=null,l=e.firstElementChild;l;){if("metadata"===l.nodeName)void 0!==l.attributes.type&&"name"===l.attributes.type.value&&(o.name=l.textContent);else if("color"===l.nodeName)i=n(l);else if("mesh"===l.nodeName){for(var s=l.firstElementChild,m={vertices:[],normals:[],volumes:[],color:i};s;){if("vertices"===s.nodeName){var d=r(s);m.normals=m.normals.concat(d.normals),m.vertices=m.vertices.concat(d.vertices)}else"volume"===s.nodeName&&m.volumes.push(a(s));s=s.nextElementSibling}o.meshes.push(m)}l=l.nextElementSibling}return{id:t,obj:o}}var i,m,d=function(e){var t=new DataView(e);if("PK"===String.fromCharCode(t.getUint8(0),t.getUint8(1))){var n=null,a=null;console.log("THREE.AMFLoader: Loading Zip");try{n=s.GZ(new Uint8Array(e))}catch(i){if(i instanceof ReferenceError)return console.log("THREE.AMFLoader: fflate missing and file is compressed."),null}for(a in n)if(".amf"===a.toLowerCase().slice(-4))break;console.log("THREE.AMFLoader: Trying to load file asset: "+a),t=new DataView(n[a].buffer)}var r=(new TextDecoder).decode(t),o=(new DOMParser).parseFromString(r,"application/xml");return"amf"!==o.documentElement.nodeName.toLowerCase()?(console.log("THREE.AMFLoader: Error loading AMF - no AMF document found."),null):o}(e),u="",c="",f=function(e){var t=1,n="millimeter";void 0!==e.documentElement.attributes.unit&&(n=e.documentElement.attributes.unit.value.toLowerCase());var a={millimeter:1,inch:25.4,feet:304.8,meter:1e3,micron:.001};return void 0!==a[n]&&(t=a[n]),console.log("THREE.AMFLoader: Unit scale: "+t),t}(d),v={},g={},h=d.documentElement.childNodes;for(i=0;i<h.length;i++){var b=h[i];if("metadata"===b.nodeName)void 0!==b.attributes.type&&("name"===b.attributes.type.value?u=b.textContent:"author"===b.attributes.type.value&&(c=b.textContent));else if("material"===b.nodeName){var E=t(b);v[E.id]=E.material}else if("object"===b.nodeName){var N=o(b);g[N.id]=N.obj}}var C=new l.ZAu,x=new l.xoR({color:11184895,flatShading:!0});for(var p in C.name=u,C.userData.author=c,C.userData.loader="AMF",g){var y=g[p],w=y.meshes,T=new l.ZAu;for(T.name=y.name||"",i=0;i<w.length;i++){var A=x,M=w[i],F=new l.a$l(M.vertices,3),L=null;if(M.normals.length&&(L=new l.a$l(M.normals,3)),M.color){var R=M.color;(A=x.clone()).color=new l.Ilk(R.r,R.g,R.b),1!==R.a&&(A.transparent=!0,A.opacity=R.a)}var k=M.volumes;for(m=0;m<k.length;m++){var B=k[m],S=new l.u9r,H=A;S.setIndex(B.triangles),S.setAttribute("position",F.clone()),L&&S.setAttribute("normal",L.clone()),void 0!==v[B.materialId]&&(H=v[B.materialId]),S.scale(f,f,f),T.add(new l.Kj0(S,H.clone()))}}C.add(T)}return C}}]),n}(l.aNw)}}]);